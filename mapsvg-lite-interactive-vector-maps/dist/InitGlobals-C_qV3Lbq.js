import{p as t,_ as e,u as i,m as s,t as o,g as n,d as r,c as a,a as l,r as h,b as c,e as d,i as u,f as p,R as m,h as g,s as f,j as v,k as y,l as b,n as w,o as x,q as k,v as S,w as E,x as T,y as _,z as C,A as B,M as D}from"./Mapsvg-DBa-U9x6.js";function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}var R=/^\s+/,A=/\s+$/;function j(t,e){if(e=e||{},(t=t||"")instanceof j)return t;if(!(this instanceof j))return new j(t,e);var i=L(t);this._originalInput=t,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||i.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}function L(t){var e={r:0,g:0,b:0},i=1,s=null,o=null,n=null,r=!1,a=!1;return"string"==typeof t&&(t=St(t)),"object"==M(t)&&(kt(t.r)&&kt(t.g)&&kt(t.b)?(e=P(t.r,t.g,t.b),r=!0,a="%"===String(t.r).substr(-1)?"prgb":"rgb"):kt(t.h)&&kt(t.s)&&kt(t.v)?(s=ut(t.s),o=ut(t.v),e=N(t.h,s,o),r=!0,a="hsv"):kt(t.h)&&kt(t.s)&&kt(t.l)&&(s=ut(t.s),n=ut(t.l),e=O(t.h,s,n),r=!0,a="hsl"),t.hasOwnProperty("a")&&(i=t.a)),i=nt(i),{ok:r,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:i}}function P(t,e,i){return{r:255*rt(t,255),g:255*rt(e,255),b:255*rt(i,255)}}function F(t,e,i){t=rt(t,255),e=rt(e,255),i=rt(i,255);var s=Math.max(t,e,i),o=Math.min(t,e,i),n,r,a=(s+o)/2;if(s==o)n=r=0;else{var l=s-o;switch(r=a>.5?l/(2-s-o):l/(s+o),s){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:r,l:a}}function O(t,e,i){var s,o,n;function r(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}if(t=rt(t,360),e=rt(e,100),i=rt(i,100),0===e)s=o=n=i;else{var a=i<.5?i*(1+e):i+e-i*e,l=2*i-a;s=r(l,a,t+1/3),o=r(l,a,t),n=r(l,a,t-1/3)}return{r:255*s,g:255*o,b:255*n}}function I(t,e,i){t=rt(t,255),e=rt(e,255),i=rt(i,255);var s=Math.max(t,e,i),o=Math.min(t,e,i),n,r,a=s,l=s-o;if(r=0===s?0:l/s,s==o)n=0;else{switch(s){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:r,v:a}}function N(t,e,i){t=6*rt(t,360),e=rt(e,100),i=rt(i,100);var s=Math.floor(t),o=t-s,n=i*(1-e),r=i*(1-o*e),a=i*(1-(1-o)*e),l=s%6,h,c,d;return{r:255*[i,r,n,n,a,i][l],g:255*[a,i,i,r,n,n][l],b:255*[n,n,a,i,i,r][l]}}function H(t,e,i,s){var o=[dt(Math.round(t).toString(16)),dt(Math.round(e).toString(16)),dt(Math.round(i).toString(16))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function z(t,e,i,s,o){var n=[dt(Math.round(t).toString(16)),dt(Math.round(e).toString(16)),dt(Math.round(i).toString(16)),dt(pt(s))];return o&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)&&n[3].charAt(0)==n[3].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0):n.join("")}function V(t,e,i,s){var o;return[dt(pt(s)),dt(Math.round(t).toString(16)),dt(Math.round(e).toString(16)),dt(Math.round(i).toString(16))].join("")}function q(t,e){e=0===e?0:e||10;var i=j(t).toHsl();return i.s-=e/100,i.s=at(i.s),j(i)}function G(t,e){e=0===e?0:e||10;var i=j(t).toHsl();return i.s+=e/100,i.s=at(i.s),j(i)}function U(t){return j(t).desaturate(100)}function W(t,e){e=0===e?0:e||10;var i=j(t).toHsl();return i.l+=e/100,i.l=at(i.l),j(i)}function X(t,e){e=0===e?0:e||10;var i=j(t).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-e/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-e/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-e/100*255))),j(i)}function Q(t,e){e=0===e?0:e||10;var i=j(t).toHsl();return i.l-=e/100,i.l=at(i.l),j(i)}function Y(t,e){var i=j(t).toHsl(),s=(i.h+e)%360;return i.h=s<0?360+s:s,j(i)}function Z(t){var e=j(t).toHsl();return e.h=(e.h+180)%360,j(e)}function K(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var i=j(t).toHsl(),s=[j(t)],o=360/e,n=1;n<e;n++)s.push(j({h:(i.h+n*o)%360,s:i.s,l:i.l}));return s}function J(t){var e=j(t).toHsl(),i=e.h;return[j(t),j({h:(i+72)%360,s:e.s,l:e.l}),j({h:(i+216)%360,s:e.s,l:e.l})]}function tt(t,e,i){e=e||6,i=i||30;var s=j(t).toHsl(),o=360/i,n=[j(t)];for(s.h=(s.h-(o*e>>1)+720)%360;--e;)s.h=(s.h+o)%360,n.push(j(s));return n}function et(t,e){e=e||6;for(var i=j(t).toHsv(),s=i.h,o=i.s,n=i.v,r=[],a=1/e;e--;)r.push(j({h:s,s:o,v:n})),n=(n+a)%1;return r}j.prototype={isDark:function t(){return this.getBrightness()<128},isLight:function t(){return!this.isDark()},isValid:function t(){return this._ok},getOriginalInput:function t(){return this._originalInput},getFormat:function t(){return this._format},getAlpha:function t(){return this._a},getBrightness:function t(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function t(){var e=this.toRgb(),i,s,o,n,r,a;return i=e.r/255,s=e.g/255,o=e.b/255,.2126*(n=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(r=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(a=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))},setAlpha:function t(e){return this._a=nt(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function t(){var e=I(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function t(){var e=I(this._r,this._g,this._b),i=Math.round(360*e.h),s=Math.round(100*e.s),o=Math.round(100*e.v);return 1==this._a?"hsv("+i+", "+s+"%, "+o+"%)":"hsva("+i+", "+s+"%, "+o+"%, "+this._roundA+")"},toHsl:function t(){var e=F(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function t(){var e=F(this._r,this._g,this._b),i=Math.round(360*e.h),s=Math.round(100*e.s),o=Math.round(100*e.l);return 1==this._a?"hsl("+i+", "+s+"%, "+o+"%)":"hsla("+i+", "+s+"%, "+o+"%, "+this._roundA+")"},toHex:function t(e){return H(this._r,this._g,this._b,e)},toHexString:function t(e){return"#"+this.toHex(e)},toHex8:function t(e){return z(this._r,this._g,this._b,this._a,e)},toHex8String:function t(e){return"#"+this.toHex8(e)},toRgb:function t(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function t(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function t(){return{r:Math.round(100*rt(this._r,255))+"%",g:Math.round(100*rt(this._g,255))+"%",b:Math.round(100*rt(this._b,255))+"%",a:this._a}},toPercentageRgbString:function t(){return 1==this._a?"rgb("+Math.round(100*rt(this._r,255))+"%, "+Math.round(100*rt(this._g,255))+"%, "+Math.round(100*rt(this._b,255))+"%)":"rgba("+Math.round(100*rt(this._r,255))+"%, "+Math.round(100*rt(this._g,255))+"%, "+Math.round(100*rt(this._b,255))+"%, "+this._roundA+")"},toName:function t(){return 0===this._a?"transparent":!(this._a<1)&&(st[H(this._r,this._g,this._b,!0)]||!1)},toFilter:function t(e){var i="#"+V(this._r,this._g,this._b,this._a),s=i,o=this._gradientType?"GradientType = 1, ":"";if(e){var n=j(e);s="#"+V(n._r,n._g,n._b,n._a)}return"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr="+i+",endColorstr="+s+")"},toString:function t(e){var i=!!e;e=e||this._format;var s=!1,o=this._a<1&&this._a>=0,n;return i||!o||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(s=this.toRgbString()),"prgb"===e&&(s=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(s=this.toHexString()),"hex3"===e&&(s=this.toHexString(!0)),"hex4"===e&&(s=this.toHex8String(!0)),"hex8"===e&&(s=this.toHex8String()),"name"===e&&(s=this.toName()),"hsl"===e&&(s=this.toHslString()),"hsv"===e&&(s=this.toHsvString()),s||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function t(){return j(this.toString())},_applyModification:function t(e,i){var s=e.apply(null,[this].concat([].slice.call(i)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function t(){return this._applyModification(W,arguments)},brighten:function t(){return this._applyModification(X,arguments)},darken:function t(){return this._applyModification(Q,arguments)},desaturate:function t(){return this._applyModification(q,arguments)},saturate:function t(){return this._applyModification(G,arguments)},greyscale:function t(){return this._applyModification(U,arguments)},spin:function t(){return this._applyModification(Y,arguments)},_applyCombination:function t(e,i){return e.apply(null,[this].concat([].slice.call(i)))},analogous:function t(){return this._applyCombination(tt,arguments)},complement:function t(){return this._applyCombination(Z,arguments)},monochromatic:function t(){return this._applyCombination(et,arguments)},splitcomplement:function t(){return this._applyCombination(J,arguments)},triad:function t(){return this._applyCombination(K,[3])},tetrad:function t(){return this._applyCombination(K,[4])}},j.fromRatio=function(t,e){if("object"==M(t)){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]="a"===s?t[s]:ut(t[s]));t=i}return j(t,e)},j.equals=function(t,e){return!(!t||!e)&&j(t).toRgbString()==j(e).toRgbString()},j.random=function(){return j.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},j.mix=function(t,e,i){i=0===i?0:i||50;var s=j(t).toRgb(),o=j(e).toRgb(),n=i/100,r;return j({r:(o.r-s.r)*n+s.r,g:(o.g-s.g)*n+s.g,b:(o.b-s.b)*n+s.b,a:(o.a-s.a)*n+s.a})},j.readability=function(t,e){var i=j(t),s=j(e);return(Math.max(i.getLuminance(),s.getLuminance())+.05)/(Math.min(i.getLuminance(),s.getLuminance())+.05)},j.isReadable=function(t,e,i){var s=j.readability(t,e),o,n;switch(n=!1,(o=Et(i)).level+o.size){case"AAsmall":case"AAAlarge":n=s>=4.5;break;case"AAlarge":n=s>=3;break;case"AAAsmall":n=s>=7}return n},j.mostReadable=function(t,e,i){var s=null,o=0,n,r,a,l;r=(i=i||{}).includeFallbackColors,a=i.level,l=i.size;for(var h=0;h<e.length;h++)(n=j.readability(t,e[h]))>o&&(o=n,s=j(e[h]));return j.isReadable(t,s,{level:a,size:l})||!r?s:(i.includeFallbackColors=!1,j.mostReadable(t,["#fff","#000"],i))};var it=j.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},st=j.hexNames=ot(it);function ot(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}function nt(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function rt(t,e){ht(t)&&(t="100%");var i=ct(t);return t=Math.min(e,Math.max(0,parseFloat(t))),i&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function at(t){return Math.min(1,Math.max(0,t))}function lt(t){return parseInt(t,16)}function ht(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)}function ct(t){return"string"==typeof t&&-1!=t.indexOf("%")}function dt(t){return 1==t.length?"0"+t:""+t}function ut(t){return t<=1&&(t=100*t+"%"),t}function pt(t){return Math.round(255*parseFloat(t)).toString(16)}function mt(t){return lt(t)/255}var gt=(bt="[\\s|\\(]+("+(yt="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+yt+")[,|\\s]+("+yt+")\\s*\\)?",wt="[\\s|\\(]+("+yt+")[,|\\s]+("+yt+")[,|\\s]+("+yt+")[,|\\s]+("+yt+")\\s*\\)?",{CSS_UNIT:new RegExp(yt),rgb:new RegExp("rgb"+bt),rgba:new RegExp("rgba"+wt),hsl:new RegExp("hsl"+bt),hsla:new RegExp("hsla"+wt),hsv:new RegExp("hsv"+bt),hsva:new RegExp("hsva"+wt),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}),ft,vt,yt,bt,wt,xt;function kt(t){return!!gt.CSS_UNIT.exec(t)}function St(t){t=t.replace(R,"").replace(A,"").toLowerCase();var e=!1,i;if(it[t])t=it[t],e=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(i=gt.rgb.exec(t))?{r:i[1],g:i[2],b:i[3]}:(i=gt.rgba.exec(t))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=gt.hsl.exec(t))?{h:i[1],s:i[2],l:i[3]}:(i=gt.hsla.exec(t))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=gt.hsv.exec(t))?{h:i[1],s:i[2],v:i[3]}:(i=gt.hsva.exec(t))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=gt.hex8.exec(t))?{r:lt(i[1]),g:lt(i[2]),b:lt(i[3]),a:mt(i[4]),format:e?"name":"hex8"}:(i=gt.hex6.exec(t))?{r:lt(i[1]),g:lt(i[2]),b:lt(i[3]),format:e?"name":"hex"}:(i=gt.hex4.exec(t))?{r:lt(i[1]+""+i[1]),g:lt(i[2]+""+i[2]),b:lt(i[3]+""+i[3]),a:mt(i[4]+""+i[4]),format:e?"name":"hex8"}:!!(i=gt.hex3.exec(t))&&{r:lt(i[1]+""+i[1]),g:lt(i[2]+""+i[2]),b:lt(i[3]+""+i[3]),format:e?"name":"hex"}}function Et(t){var e,i;return"AA"!==(e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==e&&(e="AA"),"small"!==(i=(t.size||"small").toLowerCase())&&"large"!==i&&(i="small"),{level:e,size:i}}class Tt extends Array{constructor(t,e,i){if(e?super(...e):super(),this.key=t,this.dict={},this.nextId=1,this.options=Object.assign({autoId:!1,unique:!1},i),this.length>0){let t=0;const e=this;if(this.options.autoId){let t=0,i=!1;this.forEach((function(s){null!=s[e.key]?s[e.key]>t&&(t=s[e.key]):i=!0})),this.nextId=++t,i&&this.forEach((function(t){null==t[e.key]&&(t[e.key]=e.nextId,e.nextId++)}))}this.forEach((function(i){e.dict[i[e.key]]=t,t++}))}}push(...t){return t.forEach((t=>{(!this.options.unique||this.options.unique&&!this.get(t[this.key]))&&(super.push(t),!0===this.options.autoId&&(t[this.key]=this.nextId++),this.dict[t[this.key]]=this.length-1)})),this.length}pop(){const t=undefined,e=this[this.length-1][this.key];return super.pop(),delete this.dict[e],this.reindex(),super.pop()}update(t){if(null!=t[this.key]){const e=this.get(t[this.key]);for(const i in t)e[i]=t[i];return e}return!1}get(t){return this.findById(t)}findById(t){const e=this.dict[t];return void 0===e?void 0:this[e]}deleteById(t){const e=this.dict[t];void 0!==e&&(delete this.dict[t],this.splice(e,1))}delete(t){this.deleteById(t)}clear(){return this.splice(0,this.length),this.length=0,this.reindex(),this}reindex(){const t=this;this.dict={},this.forEach((function(e,i){t.dict[e[t.key]]=i}))}sort(t){return super.sort(t),this.reindex(),this}splice(t,e){const i=super.splice(t,e);return this.reindex(),i}toObject(){const t={};for(const e of this)t[e[this.key]]=e;return t}}function _t(t){return t&&"clientX"in t&&"clientY"in t}class Ct{constructor(t){this.handler=t.handler,this.name=t.name,this.options=t.options||{}}}class Bt{constructor({context:t,contextName:e,parent:i,map:s}){this.listeners=new Array,this.context=t,this.contextName=e,this.bubbleTo=i,this.map=s}on(t,e,i){if(null==i?void 0:i.unique){const e=this.listeners.find((e=>e.name===t&&e.options.unique));e&&this.off(t,e.handler)}const s=new Ct({handler:e,name:t,options:i});return this.listeners.push(s),this}once(t,e){return this.on(t,e,{repeat:1})}off(t,e){const i=this.listeners.filter((e=>e.name===t));return i.length&&i.forEach(((t,i)=>{if(void 0===e||t.handler===e){const e=this.listeners.indexOf(t);this.listeners.splice(e,1)}})),this}trigger(t,e,i){var s;const o=_t(e)?e:void 0,n=null!==(s=_t(e)?i:e)&&void 0!==s?s:{},r=this.listeners.filter((e=>e.name===t)),a={domEvent:o,data:n,name:t,map:this.map};if(r.length>0){const e=[];r.forEach(((i,s)=>{var o;try{if(-1!==i.name.indexOf("old")){const t=Array.from(Object.values(n));i.handler&&i.handler.apply(this.context,t||[this.context])}else i.handler&&i.handler.apply(this.context,[a]);i.options.repeat&&i.options.repeat--,0===i.options.repeat&&e.push(i)}catch(e){console.error(`MapSVG: event handler error for "${this.contextName}.${t}" on map  ID=${(null===(o=this.map)||void 0===o?void 0:o.id)||"unknown"} with data:`,{handler:i.handler,data:n},e)}})),this.listeners=this.listeners.filter(((t,i)=>!e.includes(t)))}if(this.bubbleTo)o?this.bubbleTo.trigger(t+"."+this.contextName,o,n):this.bubbleTo.trigger(t+"."+this.contextName,n);else{const e=new CustomEvent(t+".mapsvg",{detail:a});window.dispatchEvent(e)}return this}}!function(t){t.REQUEST="request",t.RESPONSE="response",t.RENDER="render",t.MAP_LOAD="mapLoad"}(xt||(xt={}));class Dt{constructor(){this.middlewares=[]}add(t,e,i=!1){if(i){const e=this.middlewares.find((e=>e.name===t&&e.options.unique));e&&this.off(t,e.handler)}return e&&this.middlewares.push({name:t,handler:e,options:{unique:null!=i&&i}}),this.middlewares}get(t){return this.middlewares.filter((e=>e.name===t)).map((t=>t.handler))}clear(){return this.middlewares.splice(0,this.middlewares.length-1),this.middlewares}off(t,e){const i=this.middlewares.filter((e=>e.name===t));return i.length&&i.forEach(((t,i)=>{if(void 0===e||t.handler===e){const e=this.middlewares.indexOf(t);this.middlewares.splice(e,1)}})),this}removeByType(t){return this.middlewares=this.middlewares.filter((e=>e.name!==t)),this.middlewares}run(t,e){const i=this.middlewares.filter((e=>e.name===t)).map((t=>t.handler));let s=e[0];for(const o of i){let i;try{i=o.apply(this,e)}catch(s){console.error(`Error in middleware ${t}:`,s),i=e[0]}s=i}return s}}const Mt={type:"text",db_type:"varchar(255)",label:"",name:"",renamable:!0,visible:!0,hiddenOnTable:!1,searchable:!1,readonly:!1,protected:!1};class Rt{constructor(e){const i=["visible","searchable","readonly","protected","renamable"],s=Object.assign(Object.assign({},Mt),e);Object.assign(this,s),"distance"===this.type&&(this.parameterName="Object.distance",this.parameterNameShort="distance"),i.forEach((e=>{this[e]=t(this[e])})),!this.options||this.options instanceof Tt||(this.options=new Tt("value",this.options))}getEnumLabel(t){if(!this.options)return null;const e=this.options.get(t);return void 0!==e?e.label:""}}var At;!function(t){t.UPDATE="update"}(At||(At={}));const jt={strict:!0,type:"object"};function Lt(t){return"post"===t||"object"===t?[{url:"/objects/%name%",method:"GET",name:"index"},{url:"/objects/%name%/[:id]",method:"GET",name:"show"},{url:"/objects/%name%",method:"POST",name:"create"},{url:"/objects/%name%/[:id]",method:"PUT",name:"update"},{url:"/objects/%name%/[:id]",method:"DELETE",name:"delete"},{url:"/objects/%name%/[:id]/import",method:"POST",name:"import"},{url:"/objects/%name%",method:"DELETE",name:"clear"},{url:"/objects/%name%/[:id]/distinct/[:fieldName]",method:"GET",name:"distinct"}]:"region"===t?[{url:"/regions/%name%",method:"GET",name:"index"},{url:"/regions/%name%/[:id]",method:"GET",name:"show"},{url:"/regions/%name%",method:"POST",name:"create"},{url:"/regions/%name%/[:id]",method:"PUT",name:"update"},{url:"/regions/%name%/[:id]/import",method:"POST",name:"import"},{url:"/regions/%name%/[:id]",method:"DELETE",name:"delete"},{url:"/regions/%name%/[:id]/distinct/[:fieldName]",method:"GET",name:"distinct"}]:[]}class Pt{constructor(t){this.fields=new Tt("name"),this.apiEndpoints=new Tt("name");const i=Object.assign(Object.assign({},jt),t),{name:s,type:o}=i,n=e(i,["name","type"]);this.setName(s),this.setType(o),this.build(n),this.lastChangeTime=Date.now(),this.events=new Bt({context:this,contextName:"schema"})}setAuthorization(t){this.authorization=t}setApiEndpoints(t){return this.apiEndpoints.clear(),t&&this.apiEndpoints.push(...t),this.apiEndpoints}setApiBaseUrl(t){t&&(this.apiBaseUrl=t.replace(/\/+$/,""))}setObjectNameSingular(t){this.objectNameSingular=t}setObjectNamePlural(t){this.objectNamePlural=t}build(t){for(const e in t){const s="set"+i(e);void 0!==t[e]&&"function"==typeof this[s]&&this[s](t[e])}}setType(t){this.type=t;const e=undefined;if(["region","object","post"].includes(this.type)){const t=Lt(this.type).map((t=>Object.assign(Object.assign({},t),{url:t.url.replace("%name%",this.name)})));this.setApiEndpoints(t),this.setApiBaseUrl(s.routes.api.replace(/\/+$/,""))}}setPostType(t){this.postType=t}update(t){this.build(t)}setRemote(t){this.remote=t}setStrict(t){this.strict=t}setId(t){this.id=t}setTitle(t){this.title=t}setName(t){this.name=t}loaded(){return 0!==this.fields.length}setFields(t){t&&(this.fields.clear(),t.forEach((t=>{this.fields.push(new Rt(t))})))}addField(t){const e=t instanceof Rt?t:new Rt(t);this.fields.push(e),o(this.events.trigger,500,this,[At.UPDATE,{schema:this}])}getFields(){return this.fields}getFieldNames(){return this.fields.map((t=>t.name))}getField(t){return this.fields.findById(t)}getFieldByType(t){let e=null;return this.fields.forEach((function(i){i.type===t&&(e=i)})),e}getColumns(t){t=t||{};const e=this.fields,i=0!==Object.keys(t).length;let s=[];if(i){let i;e.forEach((function(e){i=!0;for(const s in t)i=e[s]==t[s];i&&s.push(e)}))}else s=e;return s}getData(){const t=undefined;return{id:this.id,title:this.title,name:this.name,fields:this.fields,type:this.type,authorization:this.authorization,apiEndpoints:this.apiEndpoints,apiBaseUrl:this.apiBaseUrl,objectNamePlural:this.objectNamePlural,objectNameSingular:this.objectNameSingular,remote:this.remote,postType:this.postType}}}class Ft{constructor(t){for(const e in t)this[e]=t[e];this.state=this._state,this.state_short=this._state_short,this.zip=this._zip,this.county=this._county}getData(){const t={};return["route","address_formatted","administrative_area_level_1","administrative_area_level_1_short","administrative_area_level_2","administrative_area_level_2_short","country","country_short","postal_code"].forEach((e=>{this[e]&&(t[e]=this[e])})),t}get _state(){return"US"===this.country_short?this.administrative_area_level_1:null}get _state_short(){return"US"===this.country_short?this.administrative_area_level_1_short:null}get _county(){return"US"===this.country_short?this.administrative_area_level_2:null}get _zip(){return this.postal_code}}class Ot{constructor(t,e){this.x=t,this.y=e}}function It(t){return"object"==typeof t&&"x"in t&&"y"in t}let Nt=class t{constructor(t,e){let i,s;"object"==typeof t?t.x&&t.y?(i=parseFloat(t.x+""),s=parseFloat(t.y+"")):(console.error("MapSVG: incorrect format of {x, y} object for SVGPoint."),i=0,s=0):(i=parseFloat(t+""),s=parseFloat(e+"")),this.x=i,this.y=s}toString(){return this.x+","+this.y}};function Ht(t){return"object"==typeof t&&"lat"in t&&"lng"in t}class zt{constructor(t,e){let i,s;"object"==typeof t?t.lat&&t.lng?(i=parseFloat(t.lat+""),s=parseFloat(t.lng+"")):(console.error("MapSVG: incorrect format of {lat, lng} object for GeoPoint."),i=0,s=0):(i=parseFloat(t+""),s=parseFloat(e+"")),this.lat=i,this.lng=s}toString(){return this.lat+","+this.lng}}class Vt{constructor(t){t.img=t.img||"_pin_default.png",this.update(t)}update(t){t.object&&this.setObject(t.object),t.img&&this.setImage(t.img),t.address&&this.setAddress(t.address),t.svgPoint&&this.setSvgPoint(t.svgPoint),t.geoPoint&&this.setGeoPoint(t.geoPoint)}setObject(t){this.object=t}setImage(t){if("string"!=typeof t)return;let e=t.split("/").pop();-1!==t.indexOf("uploads")&&(e="uploads/"+e),this.img=e,this.imagePath=this.getImageUrl(),this.marker&&this.marker&&this.marker.setImage(this.imagePath)}getImageUrl(){return this.img&&0===this.img.indexOf("uploads/")?s.routes.uploads+"markers/"+this.img.replace("uploads/",""):s.routes.root+"markers/"+(this.img||"_pin_default.png")}setAddress(t){this.address=new Ft(t)}setSvgPoint(t){this.svgPoint=t instanceof Nt?t:new Nt(t),this.marker&&this.marker.setSvgPointFromLocation()}setGeoPoint(t){this.geoPoint=t instanceof zt?t:new zt(t),this.marker&&this.marker.setSvgPointFromLocation()}getMarkerImage(){return this.img&&0===this.img.indexOf("uploads/")?s.routes.uploads+"markers/"+this.img.replace("uploads/",""):s.routes.root+"markers/"+(this.img||"_pin_default.png")}getData(){const t={img:this.img,imagePath:this.imagePath,markerImagePath:this.marker&&this.marker.object?this.marker.object.getMarkerImage():this.imagePath,address:this.address};return this.geoPoint&&(t.geoPoint={lat:this.geoPoint.lat,lng:this.geoPoint.lng}),this.svgPoint&&(t.svgPoint={x:this.svgPoint.x,y:this.svgPoint.y}),t}}const qt={set:(t,e,i,s)=>(e in t?t[e]=i:t.build({[e]:i}),!0),get:(t,e,i)=>e in t._data?t._data[e]:"function"==typeof t[e]?function(...i){return t[e](...i)}:e in t?t[e]:void 0};class Gt{constructor(t,e){return this.initialLoad=!0,this._data={},e&&this.setSchema(e),this.dirtyFields=[],this.initialLoad=!0,this.build(t),this.initialLoad=!1,this._data.id&&this.clearDirtyFields(),new Proxy(this,qt)}setSchema(t){this.schema=t}get(t){if(this.schema.getField(t))return this._data[t]}set(t,e){this.schema.getField(t)&&this.update({[t]:e})}update(t){const e=undefined;return this.build(t)}build(t){for(const e in t){let s=this.schema.getField(e);if(!s){if(this.schema.strict)continue;s=new Rt({type:"text",name:e,label:i(e),db_type:"text"}),this.schema.addField(s)}switch(this.initialLoad||this.dirtyFields.push(e),s.type){case"region":this._data.regions=t[e];break;case"location":if(null!=t[e]&&""!=t[e]&&0!==Object.keys(t[e]).length)if(t[e]instanceof Vt)this._data.location=t[e];else{const i={img:this.isMarkersByFieldEnabled()?this.getMarkerImage(t):t[e].img,address:new Ft(t[e].address)};t[e].geoPoint&&t[e].geoPoint.lat&&t[e].geoPoint.lng?i.geoPoint=new zt(t[e].geoPoint):t[e].svgPoint&&t[e].svgPoint.x&&t[e].svgPoint.y&&(i.svgPoint=new Nt(t[e].svgPoint)),null!=this._data.location?this._data.location.update(i):this._data.location=new Vt(i)}else this._data.location=null;break;case"datetime":null!=t[e]&&""!=t[e]?this._data[e]=new Date(t[e]):this._data[e]=null;break;case"json":this._data[e]="string"==typeof t[e]?JSON.parse(t[e]):t[e];break;default:this._data[e]=t[e]}}const e=undefined;this.getLocationField()&&this.isMarkersByFieldEnabled()&&this.isMarkerFieldChanged(t)&&this.reloadMarkerImage()}isMarkerFieldChanged(t){return-1!==Object.keys(t).indexOf(this.getLocationField().markerField)}setLocationField(){}getLocationField(){return this.schema.getFieldByType("location")}reloadMarkerImage(){this._data.location&&this._data.location.setImage(this.getMarkerImage())}getMarkerImage(t){let e;if(this.isMarkersByFieldEnabled()){const i=this.getLocationField(),o=i.markerField.replace("Object.","");return e=n(t||this._data,o),e?("regions"===o?e=e[0]&&e[0].id:0===o.indexOf("post.taxonomy.")?e=e[0]&&e[0].name:0===o.indexOf("post.meta.")?e=e[0]&&e[0].value:Array.isArray(e)&&(e=e[0].value),i.markersByField[e]||i.defaultMarkerPath||s.defaultMarkerImage):i.defaultMarkerPath||s.defaultMarkerImage}return this._data.location.imagePath}isMarkersByFieldEnabled(){const t=this.getLocationField();return!!t&&!!(t.markersByFieldEnabled&&t.markerField&&Object.values(t.markersByField).length>0)}clone(){const t=this.getData();return new Gt(t,this.schema)}getEnumLabel(t,e,i){const s=t.options.get(e[i]);return void 0!==s?s.label:""}getDirtyFields(){const t={};return this.dirtyFields.forEach((e=>{t[e]=this._data[e]})),t.id=this._data.id,null!=t.location&&t.location instanceof Vt&&(t.location=t.location.getData()),this.schema.getFieldByType("region")&&(t.regions=this._data.regions),t}clearDirtyFields(){this.dirtyFields=[]}getData(){const t={};for(const e in this._data){null!==this._data[e]&&void 0!==this._data[e]&&"function"==typeof this._data[e].getData?t[e]=this._data[e].getData():t[e]=this._data[e];const i=this.schema.getField(e);["select","radio","enum","status"].includes(i.type)&&(t[e+"_text"]=i.getEnumLabel(t[e]))}return t}getRegions(t){return this._data.regions}getRegionsForTable(t){return this._data.regions?this._data.regions.filter((e=>!e.tableName||e.tableName===t)):[]}linkToRegions(t,e){if(0===t.length)return;const i=undefined,s=this.getRegionsForTable(e).map((t=>t.id));s.length>0&&t.filter((t=>s.includes(t.id))).forEach((t=>{t.objects.clear(),t.objects.push(this)}))}}const $t=new Pt({id:-1,type:"schema",name:"schema",title:"Schema",apiEndpoints:new Tt("name",[{name:"index",url:"schemas",method:"GET"},{name:"show",url:"schemas/[:id]",method:"GET"},{name:"create",url:"schemas",method:"POST"},{name:"update",url:"schemas/[:id]",method:"PUT"},{name:"delete",url:"schemas/[:id]",method:"DELETE"},{name:"clear",url:"schemas",method:"DELETE"}]),objectNameSingular:"schema",objectNamePlural:"schemas",strict:!0,remote:!1,fields:[{name:"id",type:"id"},{name:"type",type:"text"},{name:"title",type:"text"},{name:"fields",type:"text"},{name:"apiEndpoints",type:"text"},{name:"objectNameSingular",type:"text"},{name:"objectNamePlural",type:"text"},{name:"strict",type:"boolean"},{name:"remote",type:"boolean"}]});class Ut{constructor(t){if(this.filters={},this.filterout={},this.page=1,this.setSearch(""),t)for(const e in t)void 0!==t[e]&&(this[e]=t[e])}setFields(t){const e=this;for(const i in t)"filters"==i?e.setFilters(t[i]):e[i]=t[i]}update(t){for(const e in t)void 0!==t[e]&&("filters"===e?this.setFilters(t[e]):this[e]=t[e])}get(){return{search:this.search,searchField:this.searchField,searchFallback:this.searchFallback,filters:this.filters,filterout:this.filterout,page:this.page,sort:this.sort,perpage:this.perpage,lastpage:this.lastpage}}clearFilters(){this.resetFilters()}setFilters(t){r(this.filters,t),a(this.filters)}setSearch(t){this.search=t}setFilterOut(t){null===t?delete this.filterout:this.filterout=t}resetFilters(t){this.filters={},this.setSearch("")}setFilterField(t,e){this.filters[t]=e}hasFilters(){return Object.keys(this.filters).length>0||this.search&&this.search.length>0}removeFilter(t){this.filters[t]=null,delete this.filters[t]}requestSchema(t){this.withSchema=t||!0}}const Wt=jQuery;class Xt{constructor(t){this.putAvailable=null,this.deleteAvailable=null,this.apiUrl=t}getUrl(t){return 0===t.indexOf("http:")||0===t.indexOf("https:")?t:l(this.apiUrl)+h(t)}get(t,e){return Wt.ajax({url:this.getUrl(t),type:"GET",data:e,beforeSend:t=>{this.addNonceHeader(t)}})}fetch(t,e){return fetch(0===t.indexOf("http:")?t:this.apiUrl+t)}post(t,e){const i={url:this.getUrl(t),type:"POST",data:e,beforeSend:t=>{this.addNonceHeader(t)}};return e instanceof FormData&&(i.processData=!1,i.contentType=!1),!1!==i.processData&&this.processObjectData(e),Wt.ajax(i)}put(t,e){return Wt.Deferred((i=>{this.ensureMethodAvailability("PUT").then((s=>{const o={url:this.getUrl(t),type:s?"PUT":"POST",data:e,beforeSend:t=>{this.addNonceHeader(t),s||t.setRequestHeader("X-HTTP-Method-Override","PUT")}};e instanceof FormData&&(o.processData=!1,o.contentType=!1),!1!==o.processData&&this.processObjectData(e),Wt.ajax(o).done((t=>i.resolve(t))).fail(((t,e,s)=>i.reject(t,e,s)))}))})).promise()}delete(t){return Wt.Deferred((e=>{this.ensureMethodAvailability("DELETE").then((i=>{Wt.ajax({url:this.getUrl(t),type:i?"DELETE":"POST",beforeSend:t=>{this.addNonceHeader(t),i||t.setRequestHeader("X-HTTP-Method-Override","DELETE")}}).done((t=>e.resolve(t))).fail(((t,i,s)=>e.reject(t,i,s)))}))})).promise()}ajax(t,e){return e.url=this.getUrl(t),e.beforeSend=t=>{this.addNonceHeader(t)},Wt.ajax(e)}ensureMethodAvailability(t){return"PUT"===t&&null!==this.putAvailable?Promise.resolve(this.putAvailable):"DELETE"===t&&null!==this.deleteAvailable?Promise.resolve(this.deleteAvailable):this.checkMethodAvailability(t).then((e=>("PUT"===t?this.putAvailable=e:this.deleteAvailable=e,e)))}checkMethodAvailability(t){return c(this,void 0,void 0,(function*(){try{return yield Wt.ajax({url:this.getUrl("/method-check"),type:t,beforeSend:t=>{this.addNonceHeader(t)}}),!0}catch(t){return!1}}))}processObjectData(t){t instanceof Object&&Object.keys(t).forEach((e=>{Array.isArray(t[e])&&0===t[e].length?t[e]=null:t[e]instanceof Object&&this.processObjectData(t[e])}))}addNonceHeader(t){s.nonce&&t.setRequestHeader("X-WP-Nonce",s.nonce)}getValuesByField(t,e){const i=`objects/${e}/distinct/${t}`;return this.get(i)}}const Qt=jQuery;var Yt;!function(t){t.AFTER_INIT="afterInit",t.AFTER_LOAD="afterLoad",t.FAILED_LOAD="failedLoad",t.BEFORE_LOAD="beforeLoad",t.BEFORE_FETCH="beforeFetch",t.AFTER_FETCH="afterFetch",t.CHANGE="change",t.BEFORE_UPDATE="beforeUpdate",t.AFTER_UPDATE="afterUpdate",t.BEFORE_CREATE="beforeCreate",t.AFTER_CREATE="afterCreate",t.BEFORE_DELETE="beforeDelete",t.AFTER_DELETE="afterDelete",t.AFTER_UPDATE_SCHEMA="afterUpdateSchema"}(Yt||(Yt={}));class Zt{constructor(t,e){this.hasMore=!1,this.className="",this.classType=Gt,this.map=e,this.server=new Xt(s.routes.api),this.query=new Ut,this.objects=new Tt("id"),this.completeChunks=0,this.setSchema(t),this.middlewares=new Dt}getApiEndpoint(t,e){const i=this.schema.apiEndpoints.get(t);if(!i)return null;const o=i.url.replace(/\[:(\w+)\]/g,((t,i)=>e&&void 0!==e[i]?e[i]:`[:${i}]`)),n=undefined;return{url:l(this.schema.apiBaseUrl||s.routes.api)+h(o),method:i.method,name:i.name}}init(){var t;this.events=new Bt({context:this,contextName:"repository",map:this.map,parent:null===(t=this.map)||void 0===t?void 0:t.events}),this.events.trigger(Yt.AFTER_INIT,{repository:this})}setNoFiltersNoLoad(t){this.noFiltersNoLoad=t}setSchema(t){if(t instanceof Pt)this.schema=t,this.schema.events.on(At.UPDATE,(()=>this.find()));else{const e=()=>c(this,void 0,void 0,(function*(){const{useRepository:e}=yield Promise.resolve().then((function(){return oe})),i=undefined;e("schemas",this.map).find({filters:{name:t}}).done((t=>{const e=t.items[0];e?(this.setSchema(e),this.find()):console.error("Schema not found")}))}));e()}}getSchema(){return this.schema}loadDataFromResponse(t,e){t=this.middlewares.run(xt.RESPONSE,[t,Object.assign(Object.assign({},e),{repository:this,map:this.map})]);const i=this.defaultResponseMiddleware(t,e);this.objects.clear(),this.schema.objectNamePlural,this.events.trigger(Yt.BEFORE_LOAD,{data:i,repository:this}),"items"in i&&"object"==typeof i.items?(i.items.forEach((t=>{this.objects.push(t)})),this.hasMore=i.hasMore):this.hasMore=!1,this.loaded=!0,this.events.trigger(Yt.AFTER_LOAD,{data:t,repository:this})}reload(){return c(this,void 0,void 0,(function*(){return yield this.find()}))}create(t){const e=jQuery.Deferred();e.promise();const i={};i[this.schema.objectNameSingular]=this.encodeData(t);const s=this.getRequest("create",null,i);return this.events.trigger(Yt.BEFORE_CREATE,{object:i[this.schema.objectNameSingular]}),this.server.post(s.url,s.data).done((t=>{const i=this.getResponse(t,s),o=i.data[this.schema.objectNameSingular];o?(this.objects.push(o),this.events.trigger(Yt.AFTER_CREATE,{object:o}),e.resolve(o)):e.reject(i)})).fail((t=>{e.reject(t)})),e}findById(t,e=!1){const i=jQuery.Deferred();i.promise();const s=this.getRequest("show",{id:t});let o;return e||(o=this.objects.findById(t.toString())),!e&&o?i.resolve(o):this.server.get(s.url,s.data).done((t=>{const e=this.getResponse(t,s);this.events.trigger(Yt.AFTER_LOAD,{data:e.data,repository:this});const o=e.data[this.schema.objectNameSingular];o?i.resolve(o):i.reject(e)})).fail((t=>{i.reject(t)})),i}getRequest(t,e,i={}){const s=this.getApiEndpoint(t,e);if(!s)throw new Error(`API endpoint ${s} does not exists for repository '${this.schema.objectNamePlural}'`);const o={repository:this,url:s.url,action:s.name,method:s.method,data:i};return o.data=this.middlewares.run(xt.REQUEST,[o.data,{request:o,repository:this,map:this.map}]),o}getResponse(t,e){const i={data:t};return i.data=this.middlewares.run(xt.RESPONSE,[i.data,{request:e,response:i,repository:this,map:this.map}]),i.data=this.defaultResponseMiddleware(i.data,{request:e,response:i}),i}find(t){const e=jQuery.Deferred();e.promise(),void 0!==t&&this.query.update(t);const i=this.getRequest("index",null,this.query);i.data!==this.query&&this.query.update(i.data);const s={query:this.query,repository:this};if(this.events.trigger(Yt.BEFORE_LOAD,{query:this.query,repository:this}),s.query!==this.query&&(s.query instanceof Ut||(s.query=new Ut(s.query)),this.query=s.query),this.noFiltersNoLoad&&!this.query.hasFilters())return this.objects.clear(),this.events.trigger(Yt.AFTER_LOAD,{data:{},repository:this}),e.resolve(this.getLoaded()),e;let o=!1;return 0===this.schema.fields.length&&(this.query.update({withSchema:!0}),o=!0),this.server.get(i.url,i.data).done((t=>{o&&this.query.update({withSchema:!1});const s={data:t};this.loadDataFromResponse(s.data,{request:i,response:s}),e.resolve(this.getLoaded())})).fail((t=>{e.reject(t)})),e}getLoaded(){return this.objects}getLoadedObject(t){return this.objects.findById(t.toString())}getLoadedAsArray(){return this.objects}update(t){const e=jQuery.Deferred();e.promise();const i={},s="getDirtyFields"in t?t.getDirtyFields():t,o=this.encodeData(s);i[this.schema.objectNameSingular]=o;const n=this.getRequest("update",{id:s.id},i);return this.events.trigger(Yt.BEFORE_UPDATE,{object:i[this.schema.objectNameSingular]}),this.server.put(n.url,n.data).done((i=>{"clearDirtyFields"in t&&t.clearDirtyFields(),this.getResponse(i,n),e.resolve(t),this.events.trigger(Yt.AFTER_UPDATE,{object:t,updatedFields:o})})).fail(((t,i)=>{e.reject(t,i)})),e}delete(t){const e=jQuery.Deferred();e.promise();const i=this.getRequest("delete",{id:t});return this.events.trigger(Yt.BEFORE_DELETE,{object:Object.assign({id:t},this.objects.findById(t))}),this.server.delete(i.url).done((s=>{this.getResponse(s,i),this.objects.delete(t.toString()),this.events.trigger(Yt.AFTER_DELETE,{repository:this,object:{id:t}}),e.resolve()})).fail((t=>{e.reject(t)})),e}clear(){const t=jQuery.Deferred();t.promise();const e=this.getRequest("clear",null);return this.server.delete(e.url).done((i=>{this.objects.clear(),this.getResponse(i,e),this.events.trigger(Yt.AFTER_LOAD,{repository:this,data:this.objects}),t.resolve()})).fail((e=>{t.reject(e)})),t}onFirstPage(){return 1===this.query.page}onLastPage(){return!1===this.hasMore}encodeData(t){return t}defaultResponseMiddleware(t,e){let i;const s=t;if(i="string"==typeof s?JSON.parse(s):Object.assign({},s),"items"in i&&"hasMore"in i){const{items:t,schema:e,hasMore:s}=i;if(e&&this.schema.update(e),t&&Array.isArray(t)&&t.length>0){const e=t[0];i.items="objectNamePlural"in e?t.map((t=>new Pt(t))):t.map((t=>new Gt(t,this.schema)))}}else"schema"in i&&(i.schema=new Pt(i.schema)),this.schema.objectNameSingular in i&&(i[this.schema.objectNameSingular]=new Gt(i[this.schema.objectNameSingular],this.schema));return i}import(t,e,i){const s=this,o=s.schema.getFieldByType("location");let n="en";return o&&o.language&&(n=o.language),t=this.formatCSV(t,i),this.importByChunks(t,n,e).done((function(){s.find()}))}importByChunks(t,e,i){const s=this;let o,n,r;const a=50,l=[];for(o=0,n=t.length;o<n;o+=a)r=t.slice(o,o+a),l.push(r);if(l.length>0){let t=0;const o=l[0][0]&&l[0][0].location?1e3:0,n=Qt.Deferred();return n.promise(),s.completeChunks=0,l.forEach((function(r){t+=o,setTimeout((function(){const t={language:e,convertLatlngToAddress:i};t[s.schema.objectNamePlural]=JSON.stringify(r);const o="region"===s.schema.type?"regions":"objects";s.server.post(o+"/"+s.schema.name+"/import",t).done((function(t){s.completeChunk(l,n)})).fail((t=>{console.error(t)}))}),t)})),n}return null}completeChunk(t,e){this.completeChunks++,this.completeChunks===t.length&&e.resolve()}formatCSV(t,e){const i=this,s=/^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)[\s]?[,\s]?[\s]?[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/g,o=e.regionsRepository.getSchema().name;return t.forEach((function(n,r){const a={};for(const t in n){const r=i.schema.getField(t);if(void 0!==r)switch(r.type){case"region":a[t]={},a[t]=n[t].split(",").map((function(t){return t.trim()})).filter((function(t){return void 0!==e.getRegion(t)||void 0!==e.regions.find((function(e){return e.title===t}))})).map((function(t){let i=e.getRegion(t);return void 0===i&&(i=e.regions.find((function(e){return e.title===t}))),{id:i.id,title:i.title,tableName:o}}));break;case"location":if(n[t].match(s)){let e=",";-1!==n[t].indexOf(",")?e=",":-1!==n[t].indexOf(" ")&&(e=" ");const i=n[t].split(e).map((function(t){return parseFloat(t)}));2==i.length&&i[0]>-90&&i[0]<90&&i[1]>-180&&i[1]<180?a[t]={geoPoint:{lat:i[0],lng:i[1]}}:a[t]=""}else n[t]&&(a[t]={address:n[t]});"object"==typeof a[t]&&(a[t].img=e.options.defaultMarkerImage);break;case"select":{const e=undefined;if(i.schema.getField(t).multiselect){const e=i.schema.getField(t).options.map((function(t){return t.label}));if(a[t]=n[t].split(",").map((function(t){return t.trim()})).filter((function(t){return-1!==e.indexOf(t)})).map((function(e){return i.schema.getField(t).options.filter((function(t){return t.label==e}))[0]})),0===a[t].length){const e=i.schema.getField(t).options.map((function(t){return t.value+""}));a[t]=n[t].split(",").map((function(t){return t.trim()})).filter((function(t){return-1!==e.indexOf(t)})).map((function(e){return i.schema.getField(t).options.filter((function(t){return t.value==e}))[0]}))}}else a[t]=n[t];break}default:a[t]=n[t]}}t[r]=a})),t}getOptionsByField(t){return c(this,void 0,void 0,(function*(){const[e,...i]=t.split("."),s=this.schema.getField(e);if(!s)return new Promise((t=>{t([])}));switch(s.type){case"region":{const t=s.options.sort((function(t,e){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return{label:t.title,value:t.id}}));return new Promise((e=>{e(t)}))}case"status":case"select":case"radio":case"checkboxes":return new Promise((t=>{t(s.options)}));case"post":{const t=s.post_type,{useRepository:e}=yield Promise.resolve().then((function(){return oe})),o=undefined;return e(["postTypes",t],this.map).getOptionsByField(i.join("."))}default:{if(i.length>0)return console.error("Nested fields are not supported for this field type: "+t),new Promise((t=>{t([])}));const s=this.getRequest("distinct",{fieldName:e});return new Promise(((t,e)=>{this.server.get(s.url).done((e=>{const i=e.items.map((t=>({label:t,value:t})));t(i)})).fail(e)}))}}}))}}class Kt extends Zt{constructor(t,e){super(t,e),this.className="Schema"}update(t){const e=jQuery.Deferred();e.promise();const i={};i[this.schema.objectNameSingular]=this.encodeData(t);const s=this.getRequest("update",{id:t.id},i);return this.server.put(s.url,s.data).done((i=>{e.resolve(i),this.events.trigger(Yt.AFTER_UPDATE,{schema:i}),t instanceof Pt&&t.events.trigger("update")})).fail((()=>{e.reject()})),e}encodeData(t){const e=t.getData();let i=JSON.stringify(e);i=i.replace(/select/g,"!mapsvg-encoded-slct"),i=i.replace(/table/g,"!mapsvg-encoded-tbl"),i=i.replace(/database/g,"!mapsvg-encoded-db"),i=i.replace(/varchar/g,"!mapsvg-encoded-vc"),i=i.replace(/int\(11\)/g,"!mapsvg-encoded-int");const s=JSON.parse(i);return s.fields=JSON.stringify(e.fields),s.apiEndpoints=JSON.stringify(e.apiEndpoints),s}}class Jt extends Zt{constructor(t,e){super(t,e)}encodeData(t){const e={};return void 0!==t.options&&(e.options=JSON.stringify(t.options),e.options=e.options.replace(/select/g,"!mapsvg-encoded-slct"),e.options=e.options.replace(/table/g,"!mapsvg-encoded-tbl"),e.options=e.options.replace(/database/g,"!mapsvg-encoded-db"),e.options=e.options.replace(/varchar/g,"!mapsvg-encoded-vc"),e.options=e.options.replace(/int\(11\)/g,"!mapsvg-encoded-int")),void 0!==t.title&&(e.title=t.title),void 0!==t.id&&(e.id=t.id),void 0!==t.status&&(e.status=t.status),void 0!==t.version&&(e.version=t.version),void 0!==t.svgFileLastChanged&&(e.svgFileLastChanged=t.svgFileLastChanged),e}defaultResponseMiddleware(t){let e;return e="string"==typeof t?JSON.parse(t):t,e}copy(t,e){const i=jQuery.Deferred();i.promise();const s={options:{title:e}},o=this.getRequest("copy",{id:t},s);return this.server.post(o.url,this.encodeData(s)).done((t=>{const e=this.defaultResponseMiddleware(t);this.objects.clear(),this.events.trigger(Yt.AFTER_LOAD),this.events.trigger("cleared"),i.resolve(e.map)})).fail((()=>{i.reject()})),i}createFromV2(t){const e=jQuery.Deferred();e.promise();const i={};i[this.schema.objectNameSingular]=this.encodeData(t);const s=this.getRequest("createFromV2",null,i);return this.server.post(s.url,i).done((t=>{const i=undefined,s=this.defaultResponseMiddleware(t)[this.schema.objectNameSingular];this.objects.push(s),e.resolve(s),this.events.trigger(Yt.AFTER_CREATE,this,[s])})).fail((()=>{e.reject()})),e}}class te extends Zt{getOptionsByField(t){return c(this,void 0,void 0,(function*(){if("post_status"===t)return new Promise((t=>{t([{label:"Published",value:"publish"},{label:"Draft",value:"draft"},{label:"Pending",value:"pending"},{label:"Private",value:"private"},{label:"Trash",value:"trash"},{label:"Future",value:"future"},{label:"Scheduled",value:"scheduled"},{label:"Pending Review",value:"pending-review"},{label:"Pending Import",value:"pending-import"},{label:"Auto Draft",value:"auto-draft"},{label:"Inherit",value:"inherit"}])}));if(0===t.indexOf("meta.")){t=t.replace("meta.","");const e=undefined,i=(yield this.getMetaValues(t)).items.filter((t=>null!=t)).map((t=>({label:t,value:t})));return new Promise((t=>{t(i)}))}if(0===t.indexOf("taxonomy.")){t=t.replace("taxonomy.","");const e=undefined,i=(yield this.getTaxonomyValues(t)).items.filter((t=>null!=t)).map((t=>({label:t,value:t})));return new Promise((t=>{t(i)}))}{const e=this.getRequest("getFieldValues",{fieldName:t});return new Promise(((t,i)=>{this.server.get(e.url).done((e=>{const i=e.items.map((t=>({label:t.label,value:t.value})));t(i)})).fail(i)}))}}))}getTaxonomyValues(t){const e=this.getRequest("getTaxonomyValues",{fieldName:t});return new Promise(((t,i)=>{this.server.get(e.url).done(t).fail(i)}))}getMetaValues(t){const e=this.getRequest("getMetaValues",{fieldName:t});return new Promise(((t,i)=>{this.server.get(e.url).done(t).fail(i)}))}getPostFields(){const t=this.getRequest("get",{});return new Promise(((e,i)=>{this.server.get(t.url).done(e).fail(i)}))}}const ee={maps:{class:Jt,schema:{name:"maps",objectNameSingular:"map",objectNamePlural:"maps",apiEndpoints:[{url:"maps",method:"GET",name:"index"},{url:"maps/[:id]",method:"GET",name:"show"},{url:"maps",method:"POST",name:"create"},{url:"maps/createFromV2",method:"POST",name:"createFromV2"},{url:"maps/[:id]/copy",method:"POST",name:"copy"},{url:"maps/[:id]",method:"PUT",name:"update"},{url:"maps/[:id]",method:"DELETE",name:"delete"},{url:"maps",method:"DELETE",name:"clear"}],fields:[{name:"id",label:"ID",type:"ID",db_type:"int(11)",visible:!0,protected:!0},{name:"title",label:"Title",type:"text",db_type:"varchar(255)",visible:!0},{name:"options",label:"Options",type:"textarea",db_type:"longtext",visible:!0},{name:"svgFilePath",label:"SVG file path",type:"text",db_type:"varchar(512)",visible:!0},{name:"svgFileLastChanged",label:"SVG file last changed",type:"text",db_type:"int(11)",visible:!0},{name:"version",label:"Version",type:"text",db_type:"varchar(50)",visible:!0},{name:"status",label:"Status",type:"text",db_type:"tinyint",visible:!1},{name:"statusChangedAt",label:"Status Changed At",type:"text",db_type:"timestamp",visible:!1}]}},regions:{class:Zt,schema:{objectNameSingular:"region",objectNamePlural:"regions",apiEndpoints:[{url:"regions/[:name]",method:"GET",name:"index"},{url:"regions/[:name]/[:id]",method:"GET",name:"show"},{url:"regions/[:name]/[:id]/distinct/[:fieldName]",method:"GET",name:"distinct"},{url:"regions/[:name]",method:"POST",name:"create"},{url:"regions/[:name]/[:id]",method:"PUT",name:"update"},{url:"regions/[:name]/[:id]/import",method:"POST",name:"import"},{url:"regions/[:name]/[:id]",method:"DELETE",name:"delete"}]}},objects:{class:Zt,schema:{objectNameSingular:"object",objectNamePlural:"objects",apiEndpoints:[{url:"objects/[:name]",method:"GET",name:"index"},{url:"objects/[:name]/[:id]",method:"GET",name:"show"},{url:"objects/[:name]/[:id]/distinct/[:fieldName]",method:"GET",name:"distinct"},{url:"objects/[:name]",method:"POST",name:"create"},{url:"objects/[:name]/[:id]",method:"PUT",name:"update"},{url:"objects/[:name]/[:id]",method:"DELETE",name:"delete"},{url:"objects/[:name]/[:id]/import",method:"POST",name:"import"},{url:"objects/[:name]",method:"DELETE",name:"clear"}]}},schemas:{class:Kt,schema:$t},logs:{class:Zt,schema:{objectNameSingular:"log",objectNamePlural:"logs"}},tokens:{class:Zt,schema:{name:"tokens",objectNameSingular:"token",objectNamePlural:"tokens",apiEndpoints:new Tt("name",[{name:"index",url:"tokens",method:"GET"},{name:"create",url:"tokens",method:"POST"},{name:"delete",url:"tokens/[:id]",method:"DELETE"}]),fields:[{name:"id",label:"ID",type:"id",db_type:"int(11)",protected:!0,auto_increment:!0},{label:"Token",name:"token",type:"text",db_type:"varchar(255)"},{label:"Token first four",name:"tokenFirstFour",type:"text",db_type:"varchar(255)"},{label:"Hashed token",name:"hashedToken",type:"text",db_type:"varchar(255)"},{name:"createdAt",label:"Created at",type:"datetime",db_type:"datetime"},{name:"lastUsedAt",label:"Last used at",type:"datetime",db_type:"datetime"},{name:"accessRights",label:"Access rights",type:"json",db_type:"json"}]}},postTypes:{class:te,schema:{objectNameSingular:"postType",objectNamePlural:"postTypes",apiEndpoints:[{url:"post-types",method:"GET",name:"index"},{url:"post-types/[:name]",method:"GET",name:"get"},{url:"post-types/[:name]/taxonomy/[:fieldName]",method:"GET",name:"getTaxonomyValues"},{url:"post-types/[:name]/meta/[:fieldName]",method:"GET",name:"getMetaValues"},{url:"post-types/[:name]/field/[:fieldName]",method:"GET",name:"getFieldValues"}]}}};function ie(t){return"object"==typeof t&&null!==t&&"string"==typeof t.name}function se(t,e){let i,s,o,n;if(ie(t)){o=new Pt(t);let i="";if(o.type)i="post"===o.type||"api"===o.type?"objects":o.type+"s";else{if(!o.objectNamePlural)throw new Error("Invalid schema options");i=o.objectNamePlural}n=new ee[i].class(o,e)}else{"string"==typeof t?(i=t,s=t):Array.isArray(t)&&2===t.length&&(s=t[0],i=t[1]);const r=Object.assign({},ee[s].schema);["postTypes","regions","objects"].includes(s)&&r.apiEndpoints.forEach((t=>{t.url=t.url.replace(/\[:name\]/g,`${i}`)})),o=new Pt(r),n=new ee[s].class(o,e)}if(("regions"===s||"objects"===s||"posts"===s)&&e){const t=undefined;e.middlewares.middlewares.filter((t=>t.name===xt.REQUEST||t.name===xt.RESPONSE)).forEach((t=>{n.middlewares.add(t.name,t.handler,t.options.unique)}))}return n.init(),n}var oe=Object.freeze({__proto__:null,useRepository:se});const ne=jQuery;var re;!function(t){t.RESIZE="resize",t.BEFORE_SHOW="beforeShow",t.AFTER_SHOW="afterShow",t.BEFORE_CLOSE="beforeClose",t.AFTER_CLOSE="afterClose",t.BEFORE_REDRAW="beforeRedraw",t.AFTER_REDRAW="afterRedraw",t.BEFORE_LOAD="beforeLoad",t.AFTER_LOAD="afterLoad",t.AFTER_UNLOAD="afterUnload"}(re||(re={}));class ae{constructor(e){var i,s;this.openedFullscreen=!1,this.uid=d(),this.containers={parent:e.container},this.parent=e.parent,this.destroyed=!1,this.options=e.options,this.position=e.position,this.classList=e.classList||[],this.classList.push("mapsvg-controller-container"),this.opened=!0,this.loaded=!1,this.closable=null!==(i=e.closable)&&void 0!==i&&i,this.canClose=!0,this.fullscreen=r({sm:!1,md:!1,lg:!1},e.fullscreen),this.map=e.map,this.template=e.template||"",this.scrollable=void 0===e.scrollable||e.scrollable,this.withToolbar=void 0===e.withToolbar||e.withToolbar,this.noPadding=null!==(s=e.noPadding)&&void 0!==s&&s,this.autoresize=t(e.autoresize),this.setState(e.state),this.eventOptions=e.events,this.middlewareOptions=e.middleware,e.styles&&(this.styles=e.styles),this.middlewares=new Dt}viewDidLoad(){}viewDidAppear(){}viewDidDisappear(){}viewWillRedraw(){}viewDidRedraw(){}updateScroll(){if(!this.scrollable)return;const t=this;ne(this.containers.contentWrap).nanoScroller({preventPageScrolling:!0}),setTimeout((function(){ne(t.containers.contentWrap).nanoScroller({preventPageScrolling:!0})}),300)}adjustHeight(){const t=this;ne(t.containers.main).height(ne(t.containers.main).find(".mapsvg-auto-height").outerHeight()+(t.containers.toolbar?ne(t.containers.toolbar).outerHeight():0))}init(){if(!this.destroyed){if(this.position&&this.classList.push("mapsvg-"+this.position),this.events=new Bt({context:this,contextName:this.name,map:this.map,parent:this.parent&&this.parent.events?this.parent.events:void 0}),this.events)for(const t in this.eventOptions)"function"==typeof this.eventOptions[t]&&this.events.on(t,this.eventOptions[t]);this.middlewareOptions&&this.middlewareOptions.forEach((t=>this.middlewares.add(t.name,t.handler))),this.templates={toolbar:Handlebars.compile(this.getToolbarTemplate()),main:Handlebars.compile(this.getMainTemplate())},this.render()}}getToolbarTemplate(){return this.closable&&this.withToolbar?'<div class="mapsvg-popover-close mapsvg-details-close"></div>':""}setMainTemplate(t){return this.templates.main=Handlebars.compile(t)}getMainTemplate(){return this.template||""}getWrapperTemplate(){return"<div></div>"}setStyles(t){Object.assign(this.containers.main.style,t)}render(){if(!this.destroyed){for(const[t,e]of Object.entries(this.fullscreen))e&&this.classList.push(`mapsvg-fullscreen-${t}`);(u()&&this.fullscreen.sm||p()&&this.fullscreen.md||this.fullscreen.lg)&&(this.containers.parent=document.body,this.openedFullscreen=!0,document.body.classList.add("mapsvg-modal-fullscreen")),this.containers.main=ne("<div />")[0],this.containers.main.classList.add(...this.classList),this.setStyles(this.styles),ne(this.containers.main).toggleClass("mapsvg-invisible",!this.opened),this.containers.view=ne("<div />").attr("id","mapsvg-controller-"+this.name).addClass("mapsvg-controller-view")[0],this.containers.contentWrap=ne("<div />").addClass("mapsvg-controller-view-wrap")[0],this.containers.contentWrap2=ne("<div />")[0],this.containers.sizer=ne("<div />").addClass("mapsvg-auto-height")[0],this.containers.contentView=ne("<div />").toggleClass("mapsvg-controller-view-content",!this.noPadding)[0],this.containers.sizer.appendChild(this.containers.contentView),this.scrollable&&(ne(this.containers.contentWrap).addClass("nano"),ne(this.containers.contentWrap2).addClass("nano-content")),this.containers.contentWrap.appendChild(this.containers.contentWrap2),this.containers.contentWrap2.appendChild(this.containers.sizer),this.withToolbar&&this.templates.toolbar&&(this.containers.toolbar=ne("<div />").addClass("mapsvg-controller-view-toolbar")[0],this.containers.view.appendChild(this.containers.toolbar)),this.containers.view.append(this.containers.contentWrap),this.containers.main.append(this.containers.view),this.containers.parent.appendChild(this.containers.main),this.autoresize&&(this.resizeSensor=new m(this.containers.sizer,(()=>{this.adjustHeight(),this.updateScroll(),this.events.trigger(re.RESIZE,{controller:this})}))),this.closable&&!this.mobileCloseBtn&&(this.mobileCloseBtn=ne('<button class="mapsvg-mobile-modal-close">'+this.map.getData().options.mobileView.labelClose+"</button>")[0],ne(this.containers.view).append(this.mobileCloseBtn)),this.loaded=!0,this.viewDidLoad(),this.events.trigger(re.AFTER_LOAD,{controller:this}),setTimeout((()=>{this.setEventHandlers(),this.redraw()}),1)}}setState(t,e=!1){this.state=e?t:Object.assign(Object.assign({},this.state),t),this.loaded&&this.redraw()}redraw(){if(this.destroyed)return;this.events.trigger(re.BEFORE_REDRAW,{controller:this});let t=Object.assign({},this.state);t=this.middlewares.run(xt.RENDER,[t,{controller:this}]),this.viewWillRedraw();try{ne(this.containers.contentView).html(this.templates.main(t))}catch(t){console.error(t),ne(this.containers.contentView).html("")}this.withToolbar&&this.templates.toolbar&&ne(this.containers.toolbar).html(this.templates.toolbar(t)),this.resize(),this.viewDidRedraw(),this.events.trigger(re.AFTER_REDRAW,{controller:this})}resize(){this.updateTopShift(),this.updateScroll(),this.autoresize&&(this.adjustHeight(),this.resizeSensor.setScroll())}updateTopShift(){const t=this;this.withToolbar&&(ne(t.containers.contentWrap).css({top:ne(t.containers.toolbar).outerHeight(!0)+"px"}),setTimeout((function(){ne(t.containers.contentWrap).css({top:ne(t.containers.toolbar).outerHeight(!0)+"px"})}),100),setTimeout((function(){ne(t.containers.contentWrap).css({top:ne(t.containers.toolbar).outerHeight(!0)+"px"})}),200),setTimeout((function(){ne(t.containers.contentWrap).css({top:ne(t.containers.toolbar).outerHeight(!0)+"px"}),t.updateScroll()}),500))}setEventHandlers(){const t=t=>(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),"click"!==t.type&&"touchend"!==t.type||this.close(),!1);this.closable&&(ne(this.containers.toolbar).on("click touchend touchstart mousedown",".mapsvg-popover-close",(e=>{t(e)})),ne(this.containers.view).on("click touchend touchstart mousedown",".mapsvg-mobile-modal-close",(e=>{t(e)})),ne(window).off("keydown.details.mapsvg-"+this.map.id).on("keydown.details.mapsvg-"+this.map.id,(t=>{27==t.keyCode&&this.close()})))}open(){!this.closable&&this.destroyed||(this.events.trigger(re.BEFORE_SHOW,{controller:this}),ne(this.containers.main).toggleClass("mapsvg-invisible",!1),this.opened=!0,this.resize(),this.viewDidAppear(),this.events.trigger(re.AFTER_SHOW,{controller:this}))}close(){this.closable&&this.canClose&&this.opened&&!1!==this.viewWillClose()&&(this.openedFullscreen&&document.body.classList.remove("mapsvg-modal-fullscreen"),this.events.trigger(re.BEFORE_CLOSE,{controller:this}),ne(this.containers.main).toggleClass("mapsvg-invisible",!0),this.opened=!1,this.events.trigger(re.AFTER_CLOSE,{controller:this}))}set canClose(t){this._canClose=t}get canClose(){return this._canClose}viewWillClose(){return!0}viewWillGetDestroyed(){}destroy(){this.destroyed||(this.close(),this.viewWillGetDestroyed(),this.resizeSensor&&this.resizeSensor.destroy(),delete this.resizeSensor,ne(this.containers.view).empty().remove(),ne(this.containers.main).empty().remove(),ne(window).off("keydown.details.mapsvg-"+this.map.id),ne("body").off("mouseup.popover.mapsvg touchend.popover.mapsvg"),this.events.trigger(re.AFTER_UNLOAD,{controller:this}),this.events=null,this.destroyed=!0)}setOptions(t){}is(t){return"details"!==t&&"modal"!==t||(t="detailsView"),this.name===t}}jQuery;class le extends ae{constructor(t){super(t),this.name="detailsView",this.classList.push("mapsvg-details-container"),this.closable=!0,this.autoresize=t.autoresize,this.position=t.position||"absolute"}viewDidLoad(){}}const he=jQuery;class ce{constructor(t,e,i){var s;this.readonly=void 0!==t.readonly&&t.readonly,this.protected=void 0!==t.protected&&t.protected,this.renamable=void 0===t.renamable||t.renamable,this.auto_increment=void 0!==t.auto_increment&&t.auto_increment,this.not_null=void 0!==t.not_null&&t.not_null,this.searchable=void 0!==t.searchable&&t.searchable,this.visible=void 0===t.visible||t.visible,this.hiddenOnTable=void 0!==t.hiddenOnTable&&t.hiddenOnTable,this.showIf=null!==(s=t.showIf)&&void 0!==s?s:{},this.typeLabel="Form Element",this.formBuilder=e,this.events=new Bt({context:this,contextName:"formElement",map:this.formBuilder.mapsvg,parent:this.formBuilder.events}),this.type=t.type,this.value=t.value,this.db_type=t.db_type||"varchar(255)",this.label=this.label||(void 0===t.label?"Label":t.label),this.name=this.name||t.name||"label",this.help=t.help||"",this.placeholder=t.placeholder,this.setExternal(i);let o=this.type;if("marker"===o&&this.mapIsGeo&&(o="marker-geo"),"location"===o&&this.mapIsGeo&&(o="location-geo"),this.filtersMode){if(this.parameterName=t.parameterName||"","distance"===this.type)this.parameterNameShort="distance";else{const t=this.parameterName.split(".");if(t.length>1){const[e,...i]=t;this.parameterNameShort=i[0]+i.slice(1).map((t=>`[${t}]`)).join("")}else this.parameterNameShort=this.parameterName}this.name=this.parameterNameShort,this.placeholder=t.placeholder||"",this.templates={main:Handlebars.compile(he("#mapsvg-filters-tmpl-"+o+"-view").html())}}else this.templates={main:Handlebars.compile(he("#mapsvg-data-tmpl-"+o+"-view").html())};this.inputs={}}init(){this.setDomElements(),this.setEventHandlers()}setDomElements(){this.domElements={main:he(this.templates.main(this.getDataForTemplate()))[0]},he(this.domElements.main).data("formElement",this),this.visible||he(this.domElements.main).hide(),this.addSelect2()}setEventHandlers(){const t=this;this.formBuilder.editMode&&he(this.domElements.main).on("click",(()=>{t.events.trigger("click",{formElement:this})}))}addSelect2(){he().mselect2&&(he(this.domElements.main).find("select").css({width:"100%",display:"block"}).mselect2().on("select2:focus",(function(){he(this).mselect2("open")})),he(this.domElements.main).find(".select2-selection--multiple .select2-search__field").css("width","100%"))}setEditorEventHandlers(){const t=this;he(this.domElements.edit).on("click","button.mapsvg-remove",(function(){t.destroy()})),he(this.domElements.edit).on("click",".mapsvg-filter-insert-options",(function(){return c(this,void 0,void 0,(function*(){const e=t.parameterName.split("."),[i,...s]=e,o=s.join("."),n="Object"===i?t.formBuilder.mapsvg.objectsRepository:t.formBuilder.mapsvg.regionsRepository,r=yield n.getOptionsByField(o);if(r){const t=r.map((function(t){return t.label+":"+t.value}));he(this).closest(".form-group").find("textarea").val(t.join("\n")).trigger("change")}}))})),he(this.domElements.edit).on("keyup change paste","input, textarea, select",(function(){const e=he(this).attr("name"),i=he(this).data("array");if("status"===t.type&&i){const e=he(this).data("param"),i=he(this).closest("tr").index();t.options[i]=t.options[i]||{label:"",value:"",color:"",disabled:!1},t.options[i][e]=he(this).is(":checkbox")?he(this).prop("checked"):he(this).val(),t.redraw()}else if("distance"===t.type&&i){const e=he(this).data("param"),i=he(this).closest("tr").index();t.options[i]||(t.options[i]={value:"",default:!1}),"default"===e?(t.options.forEach((function(t){t.default=!1})),t.options[i].default=he(this).prop("checked")):t.options[i].value=he(this).val(),t.redraw()}else{if("label"==e||"name"==e)return!1;{let i;if(i="checkbox"==he(this).attr("type")?he(this).prop("checked"):he(this).val(),"radio"==he(this).attr("type")){const t=he(this).attr("name");i=he('input[name="'+t+'"]:checked').val()}t.update(e,i)}}})),he(this.domElements.edit).on("keyup change paste",'input[name="label"]',(function(){if(!t.nameChanged){if(t.label=he(this).val()+"",!1!==t.renamable&&"region"!=t.type&&"location"!=t.type&&"title"!=t.type){let e=he(this).val()+"";e=e.toLowerCase().replace(/ /g,"_").replace(/\W/g,""),e.length<64&&he(t.domElements.edit).find('input[name="name"]').val(e),t.name=e+""}he(t.domElements.main).find("label").first().html(t.label),t.filtersMode||he(t.domElements.main).find("label").first().append('<div class="field-name">'+t.name+"</div>")}})),he(this.domElements.edit).on("keyup change paste",'input[name="name"]',(function(e){e.target.value&&(e.target.value.match(/[^a-zA-Z0-9_]/g)&&(e.target.value=e.target.value.replace(/[^a-zA-Z0-9_]/g,""),he(e.target).trigger("change")),e.target.value[0].match(/[^a-zA-Z_]/g)&&(e.target.value=e.target.value[0].replace(/[^a-zA-Z_]/g,"")+e.target.value.slice(1),he(e.target).trigger("change"))),"region"!=t.type&&(t.name=e.target.value),he(t.domElements.main).find("label").html(t.label+'<div class="field-name">'+t.name+"</div>"),t.nameChanged=!0})),he(this.domElements.edit).on("keyup change paste",'textarea[name="help"]',(function(e){he(t.domElements.main).find(".form-text").text(e.target.value)}))}getOptions(){return c(this,void 0,void 0,(function*(){return this.options}))}getEditor(){return this.filtersMode?this.templates.edit=this.templates.edit||Handlebars.compile(he("#mapsvg-filters-tmpl-"+this.type+"-control").html()):this.templates.edit=this.templates.edit||Handlebars.compile(he("#mapsvg-data-tmpl-"+this.type+"-control").html()),this.domElements.edit=he("<div>"+this.templates.edit(this.getDataForTemplate())+"</div>")[0],this.domElements.edit}destroyEditor(){he(this.domElements.edit).empty().remove()}initEditor(){he(this.domElements.edit).find("input").first().select(),he().colorpicker&&he(this.domElements.edit).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(){const t=undefined;""==he(this).find("input").val()&&he(this).find("i").css({"background-color":""})})),he().mselect2&&"distance"!==this.type&&he(this.domElements.edit).find("select").css({width:"100%",display:"block"}).mselect2(),this.setEditorEventHandlers()}getSchema(){const t=undefined;return Object.assign({type:this.type,db_type:this.db_type,label:this.label,name:this.name,value:this.value,searchable:this.searchable,help:this.help,visible:void 0===this.visible||this.visible,readonly:this.readonly,placeholder:this.placeholder,protected:this.protected,renamable:this.renamable,auto_increment:this.auto_increment,not_null:this.not_null,options:this.options?this.getSchemaFieldOptionsList():void 0},this.filtersMode?{parameterName:this.parameterName,parameterNameShort:this.parameterNameShort}:void 0)}getSchemaFieldOptionsList(){const t=[];return this.options.forEach(((e,i)=>{""!==this.options[i].value&&t.push(this.options[i])})),t}getDataForTemplate(){const t=this.getSchema();if(t._name=t.name,this.namespace){t.name=this.name.split("[")[0];let e=this.name.split("[")[1]||"";e&&(e="["+e),t.name=this.namespace+"["+t.name+"]"+e}return t.external=this.external,t}update(t,e){const i=this;if("options"==t){const t=[];e=e.split("\n").forEach((function(e){e=e.trim().split(":"),"checkbox"==i.type&&3==e.length?t.push({label:e[0],name:e[1],value:e[2]}):"radio"!=i.type&&"select"!=i.type&&"checkboxes"!=i.type||2!=e.length||t.push({label:e[0],value:e[1]})})),this.options=t}else this[t]=e;"parameterName"==t&&he(this.domElements.edit).find(".mapsvg-filter-param-name").text(e)}redraw(){const t=he(this.templates.main(this.getDataForTemplate()));he(this.domElements.main).html(t.html()),he().mselect2&&("distance"!==this.type?he(this.domElements.main).find("select").css({width:"100%",display:"block"}).mselect2().on("select2:focus",(function(){he(this).mselect2("open")})):he(this.domElements.main).find("select").mselect2().on("select2:focus",(function(){he(this).mselect2("open")})))}redrawEditor(){this.domElements.edit&&(he(this.domElements.edit).empty(),he(this.domElements.edit).html("<div>"+this.templates.edit(this.getDataForTemplate())+"</div>"),this.initEditor())}setOptions(t){return t?(this.options=[],this.optionsDict={},t.forEach(((t,e)=>{this.options.push(t),this.optionsDict[e]=t})),this.options):this.setOptions([{label:"Option one",name:"option_one",value:1},{label:"Option two",name:"option_two",value:2}])}getData(){return{name:this.name,value:this.getValue()}}destroy(){if(he().mselect2){const t=he(this.domElements.main).find(".mapsvg-select2");t.length&&t.mselect2("destroy")}he(this.domElements.main).empty().remove(),he(this.domElements.edit).empty().remove(),this.events.trigger("delete",{formElement:this})}show(){he(this.domElements.main).show()}hide(){he(this.domElements.main).hide()}setExternal(t){this.external=t,void 0!==this.external.mapIsGeo&&(this.mapIsGeo=this.external.mapIsGeo),void 0!==this.external.editMode&&(this.editMode=this.external.editMode),void 0!==this.external.filtersMode&&(this.filtersMode=this.external.filtersMode),void 0!==this.external.namespace&&(this.namespace=this.external.namespace)}getValue(){return this.value}setValue(t,e=!0){this.value=t,e&&this.setInputValue(t)}setInputValue(t){}triggerChanged(){this.events.trigger("change",{formElement:this,name:this.name,field:this.name,value:this.value})}}const de=jQuery;class ue extends ce{constructor(t,e,i){super(t,e,i),void 0===t.showAsSwitch?this.showAsSwitch=!0:this.showAsSwitch=t.showAsSwitch,this.db_type="tinyint(1)",this.typeLabel="Checkbox",this.checkboxLabel=t.checkboxLabel,this.checkboxValue=t.checkboxValue}setDomElements(){super.setDomElements(),this.inputs.checkbox=de(this.domElements.main).find("input")[0],this.inputs.switch=de(this.domElements.main).find("input")[0]}setEventHandlers(){super.setEventHandlers(),de(this.inputs.checkbox).on("change",(t=>{this.setValue(t.target.checked,!1),this.triggerChanged()}))}setEditorEventHandlers(){super.setEditorEventHandlers(),de(this.domElements.edit).on("change","[name='showAsSwitch']",(t=>{this.showAsSwitch&&de(this.domElements.main).find("[name='checkboxToSwitch']").addClass("form-switch form-switch-md"),this.showAsSwitch||de(this.domElements.main).find("[name='checkboxToSwitch']").removeClass("form-switch form-switch-md")})),de(this.domElements.edit).on("keyup change paste",'[name="checkboxLabel"]',(t=>{de(this.domElements.main).find(".form-check-label").text(t.target.value)}))}getSchema(){const t=super.getSchema();return this.checkboxLabel&&(t.checkboxLabel=this.checkboxLabel),this.checkboxValue&&(t.checkboxValue=this.checkboxValue),t.showAsSwitch=this.showAsSwitch,t}setInputValue(t){this.inputs.checkbox.checked=!0===t}}const pe=jQuery;class me extends ce{constructor(t,e,i){super(t,e,i),this.db_type="text",this.typeLabel="Checkboxes",this.checkboxLabel=t.checkboxLabel,this.setOptions(t.options)}setDomElements(){super.setDomElements(),this.$checkboxes=pe(this.domElements.main).find('input[type="checkbox"]'),this.setInputValue(this.value||[])}setEventHandlers(){super.setEventHandlers(),this.$checkboxes.on("change",(t=>{const e=[];pe(this.domElements.main).find("input:checked").each(((t,i)=>{e.push(jQuery(i).attr("value"))})),this.setValue(e,!1),this.triggerChanged()}))}setInputValue(t){null===t?pe(this.domElements.main).find("input").prop("checked",!1):t.forEach((t=>{pe(this.domElements.main).find(`input[value="${t}"]`).prop("checked",!0)}))}}const ge=jQuery;class fe extends ce{constructor(t,e,i){super(t,e,i),this.formBuilder.admin&&(this.languages=["en-GB","ar","az","bg","bs","ca","cs","cy","da","de","el","es","et","eu","fa","fi","fo","fr","gl","he","hr","hu","hy","id","is","it","ja","ka","kh","kk","kr","lt","lv","mk","ms","nb","nl","nl-BE","no","pl","pt-BR","pt","ro","rs","rs-latin","ru","sk","sl","sq","sr","sr-latin","sv","sw","th","tr","uk","vi","zh-CN","zh-TW"]),this.db_type="varchar(50)",this.typeLabel="Datetime",this.language=t.language}setDomElements(){super.setDomElements(),this.inputs.date=ge(this.domElements.main).find("input")[0]}setEventHandlers(){super.setEventHandlers(),ge(this.inputs.date).on("change",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}getSchema(){const t=super.getSchema();return t.language=this.language,t}getDataForTemplate(){const t=super.getDataForTemplate();return this.formBuilder.admin&&(t.languages=this.languages),t.language=this.language,t}}var ve="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ye,be,we,xe;function ke(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/function Se(){if(be)return ye;be=1;var t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function s(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function o(){try{if(!Object.assign)return!1;var t=new String("abc"),e;if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var i={},s=0;s<10;s++)i["_"+String.fromCharCode(s)]=s;if("0123456789"!==Object.getOwnPropertyNames(i).map((function(t){return i[t]})).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(t){o[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(t){return!1}}return ye=o()?Object.assign:function(o,n){for(var r,a=s(o),l,h=1;h<arguments.length;h++){for(var c in r=Object(arguments[h]))e.call(r,c)&&(a[c]=r[c]);if(t){l=t(r);for(var d=0;d<l.length;d++)i.call(r,l[d])&&(a[l[d]]=r[l[d]])}}return a},ye}function Ee(){if(xe)return we;xe=1;var t=Se(),e={isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:Array.isArray,isFunction:function(t){return"function"==typeof t},isObject:function(t){return"object"==typeof t},isUndefined:function(t){return void 0===t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(t){return t instanceof $},toStr:function t(i){return e.isUndefined(i)||null===i?"":i+""},bind:function(t,e){return t.bind(e)},each:function(t,e){t.forEach(e)},map:function(t,e){return t.map(e)},filter:function(t,e){return t.filter(e)},every:function(t,e){var i=!0;if(!t)return i;for(var s in t)if(t.hasOwnProperty(s)){var o=t[s];if(!(i=e.call(null,o,s,t)))return!1}return!!i},some:function(t,e){var i=!1;if(!t)return i;for(var s in t)if(t.hasOwnProperty(s)){var o=t[s];if(i=e.call(null,o,s,t))return!1}return!!i},mixin:Se(),identity:function(t){return t},clone:function(e){return t({},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function t(i){return e.isFunction(i)?i:s;function s(){return String(i)}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var s,o;return function(){var n=this,r=arguments,a,l;return a=function(){s=null,i||(o=t.apply(n,r))},l=i&&!s,clearTimeout(s),s=setTimeout(a,e),l&&(o=t.apply(n,r)),o}},throttle:function(t,e){var i,s,o,n,r,a;return r=0,a=function(){r=new Date,o=null,n=t.apply(i,s)},function(){var l=new Date,h=e-(l-r);return i=this,s=arguments,h<=0?(clearTimeout(o),o=null,r=l,n=t.apply(i,s)):o||(o=setTimeout(a,h)),n}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){},error:function(t){throw new Error(t)}};return we=e}function Te(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _e={exports:{}},Ce=_e.exports,Be,De,Me,Re,Ae,je,Le;
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.3.1
 */function Pe(){return Be||(Be=1,t=_e,function(e,i){t.exports=i()}(Ce,(function(){function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}var i=void 0,s=i=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=0,n=void 0,r=void 0,a=function t(e,i){w[o]=e,w[o+1]=i,2===(o+=2)&&(r?r(x):S())};function l(t){r=t}function h(t){a=t}var c="undefined"!=typeof window?window:void 0,d=c||{},u=d.MutationObserver||d.WebKitMutationObserver,p="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),m="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function g(){return function(){return process.nextTick(x)}}function f(){return function(){n(x)}}function v(){var t=0,e=new u(x),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function y(){var t=new MessageChannel;return t.port1.onmessage=x,function(){return t.port2.postMessage(0)}}function b(){var t=setTimeout;return function(){return t(x,1)}}var w=new Array(1e3);function x(){for(var t=0;t<o;t+=2){var e,i;(0,w[t])(w[t+1]),w[t]=void 0,w[t+1]=void 0}o=0}function k(){try{var t,e=Te("vertx");return n=e.runOnLoop||e.runOnContext,f()}catch(t){return b()}}var S=void 0;function E(t,e){var i=arguments,s=this,o=new this.constructor(C);void 0===o[_]&&K(o);var n=s._state,r;return n?(r=i[n-1],a((function(){return X(n,o,r,s._result)}))):q(s,o,t,e),o}function T(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(C);return N(i,t),i}S=p?g():u?v():m?y():void 0===c?k():b();var _=Math.random().toString(36).substring(16);function C(){}var B=void 0,D=1,M=2,R=new $;function A(){return new TypeError("You cannot resolve a promise with itself")}function j(){return new TypeError("A promises callback cannot return that same promise.")}function L(t){try{return t.then}catch(t){return R.error=t,R}}function P(t,e,i,s){try{t.call(e,i,s)}catch(t){return t}}function F(t,e,i){a((function(t){var s=!1,o=P(i,e,(function(i){s||(s=!0,e!==i?N(t,i):z(t,i))}),(function(e){s||(s=!0,V(t,e))}),"Settle: "+(t._label||" unknown promise"));!s&&o&&(s=!0,V(t,o))}),t)}function O(t,e){e._state===D?z(t,e._result):e._state===M?V(t,e._result):q(e,void 0,(function(e){return N(t,e)}),(function(e){return V(t,e)}))}function I(t,i,s){i.constructor===t.constructor&&s===E&&i.constructor.resolve===T?O(t,i):s===R?V(t,R.error):void 0===s?z(t,i):e(s)?F(t,i,s):z(t,i)}function N(e,i){e===i?V(e,A()):t(i)?I(e,i,L(i)):z(e,i)}function H(t){t._onerror&&t._onerror(t._result),G(t)}function z(t,e){t._state===B&&(t._result=e,t._state=D,0!==t._subscribers.length&&a(G,t))}function V(t,e){t._state===B&&(t._state=M,t._result=e,a(H,t))}function q(t,e,i,s){var o=t._subscribers,n=o.length;t._onerror=null,o[n]=e,o[n+D]=i,o[n+M]=s,0===n&&t._state&&a(G,t)}function G(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var s=void 0,o=void 0,n=t._result,r=0;r<e.length;r+=3)s=e[r],o=e[r+i],s?X(i,s,o,n):o(n);t._subscribers.length=0}}function $(){this.error=null}var U=new $;function W(t,e){try{return t(e)}catch(t){return U.error=t,U}}function X(t,i,s,o){var n=e(s),r=void 0,a=void 0,l=void 0,h=void 0;if(n){if((r=W(s,o))===U?(h=!0,a=r.error,r=null):l=!0,i===r)return void V(i,j())}else r=o,l=!0;i._state!==B||(n&&l?N(i,r):h?V(i,a):t===D?z(i,r):t===M&&V(i,r))}function Q(t,e){try{e((function e(i){N(t,i)}),(function e(i){V(t,i)}))}catch(e){V(t,e)}}var Y=0;function Z(){return Y++}function K(t){t[_]=Y++,t._state=void 0,t._result=void 0,t._subscribers=[]}function J(t,e){this._instanceConstructor=t,this.promise=new t(C),this.promise[_]||K(this.promise),s(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?z(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&z(this.promise,this._result))):V(this.promise,tt())}function tt(){return new Error("Array Methods must be provided an Array")}function et(t){return new J(this,t).promise}function it(t){var e=this;return s(t)?new e((function(i,s){for(var o=t.length,n=0;n<o;n++)e.resolve(t[n]).then(i,s)})):new e((function(t,e){return e(new TypeError("You must pass an array to race."))}))}function st(t){var e,i=new this(C);return V(i,t),i}function ot(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function nt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function rt(t){this[_]=Z(),this._result=this._state=void 0,this._subscribers=[],C!==t&&("function"!=typeof t&&ot(),this instanceof rt?Q(this,t):nt())}function at(){var t=void 0;if(void 0!==ve)t=ve;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=rt}return J.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===B&&i<t;i++)this._eachEntry(e[i],i)},J.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,s=i.resolve;if(s===T){var o=L(t);if(o===E&&t._state!==B)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(i===rt){var n=new i(C);I(n,t,o),this._willSettleAt(n,e)}else this._willSettleAt(new i((function(e){return e(t)})),e)}else this._willSettleAt(s(t),e)},J.prototype._settledAt=function(t,e,i){var s=this.promise;s._state===B&&(this._remaining--,t===M?V(s,i):this._result[e]=i),0===this._remaining&&z(s,this._result)},J.prototype._willSettleAt=function(t,e){var i=this;q(t,void 0,(function(t){return i._settledAt(D,e,t)}),(function(t){return i._settledAt(M,e,t)}))},rt.all=et,rt.race=it,rt.resolve=T,rt.reject=st,rt._setScheduler=l,rt._setAsap=h,rt._asap=a,rt.prototype={constructor:rt,then:E,catch:function t(e){return this.then(null,e)}},at(),rt.polyfill=at,rt.Promise=rt,rt}))),_e.exports;var t,e}function Fe(){if(Me)return De;Me=1;var t=Ee();function e(e){this.maxSize=t.isNumber(e)?e:100,this.reset(),this.maxSize<=0&&(this.set=this.get=t.noop)}function i(){this.head=this.tail=null}function s(t,e){this.key=t,this.val=e,this.prev=this.next=null}return t.mixin(e.prototype,{set:function t(e,i){var o=this.list.tail,n;this.size>=this.maxSize&&(this.list.remove(o),delete this.hash[o.key],this.size--),(n=this.hash[e])?(n.val=i,this.list.moveToFront(n)):(n=new s(e,i),this.list.add(n),this.hash[e]=n,this.size++)},get:function t(e){var i=this.hash[e];if(i)return this.list.moveToFront(i),i.val},reset:function t(){this.size=0,this.hash={},this.list=new i}}),t.mixin(i.prototype,{add:function t(e){this.head&&(e.next=this.head,this.head.prev=e),this.head=e,this.tail=this.tail||e},remove:function t(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),De=e}function Oe(){if(Ae)return Re;Ae=1;var t=Fe(),e=Ee(),i=0,s={},o=6,n=new t(10);function r(e){e=e||{},this.cancelled=!1,this.lastReq=null,this._send=e.transport,this._get=e.limiter?e.limiter(this._get):this._get,this._cache=!1===e.cache?new t(0):n}return r.setMaxPendingRequests=function t(e){o=e},r.resetCache=function t(){n.reset()},e.mixin(r.prototype,{_fingerprint:function(t){return(t=t||{}).url+t.type+JSON.stringify(t.data||{})},_get:function(t,e){var n=this,r,a;function l(t){e(null,t),n._cache.set(r,t)}function h(){e(!0)}function c(){i--,delete s[r],n.onDeckRequestArgs&&(n._get.apply(n,n.onDeckRequestArgs),n.onDeckRequestArgs=null)}r=this._fingerprint(t),this.cancelled||r!==this.lastReq||((a=s[r])?a.then(l,h):i<o?(i++,s[r]=this._send(t).then((function(t){l(t),c()}),(function(){h(),c()}))):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(t,i){var s,o;i=i||e.noop,t=e.isString(t)?{url:t}:t||{},o=this._fingerprint(t),this.cancelled=!1,this.lastReq=o,(s=this._cache.get(o))?i(null,s):this._get(t,i)},cancel:function(){this.cancelled=!0}}),Re=r}function Ie(){if(Le)return je;Le=1;var t=Ee(),e=Oe();function i(t){this.url=t.url,this.prepare=t.prepare,this.transform=t.transform,this.transport=new e({cache:t.cache,limiter:t.limiter,transport:t.transport})}return t.mixin(i.prototype,{_settings:function t(){return{url:this.url,type:"GET",dataType:"json"}},get:function t(e,i){var s=this,o;if(i)return e=e||"",o=this.prepare(e,this._settings()),this.transport.get(o,n);function n(t,e){i(t?[]:s.transform(e))}},cancelLastRequest:function t(){this.transport.cancel()}}),je=i}var Ne={exports:{}},He,ze,Ve,qe,Ge,$e,Ue,We,Xe,Qe,Ye,Ze,Ke;function Je(){return ze?He:(ze=1,He=function(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&(e+=1);return e})}function ti(){if(qe)return Ve;qe=1;var t=Je();function e(t,e,i){this._obj=t||{},this._set=e,this._clear=i,this.length=0}var i=e.prototype;return i.setItem=function(t,e){t=encodeURIComponent(t),this._obj[t]=e,this._updateLength(),this._set&&this._set(this._obj)},i.getItem=function(t){return t=encodeURIComponent(t),void 0===this._obj[t]?null:this._obj[t]},i.removeItem=function(t){t=encodeURIComponent(t),delete this._obj[t],this._updateLength(),this._set&&this._set(this._obj)},i.key=function(t){var e=0;for(var i in this._obj){if(e===t)return decodeURIComponent(i);e++}return null},i.clear=function(){delete this._obj,this._clear&&this._clear()},i._updateLength=function(){this.length=t(this._obj)},Ve=e}function ei(){if($e)return Ge;function t(t,e,i){var s,o;i?((s=new Date).setTime(s.getTime()+24*i*60*60*1e3),o="; expires="+s.toGMTString()):o="",document.cookie=t+"="+e+o+"; path=/"}function e(t){var e=t+"=",i=document.cookie.split(";"),s,o;for(s=0;s<i.length;s++){for(o=i[s];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(e))return o.substring(e.length,o.length)}return null}return $e=1,Ge={create:t,read:e}}function ii(){if(Ue)return Ne.exports;Ue=1;var t=ti(),e=ei(),i=!0;try{window.localStorage.setItem("test","42"),window.sessionStorage.setItem("test","42")}catch(t){i=!1}if(i)window.localStorage.removeItem("test"),window.sessionStorage.removeItem("test"),Ne.exports={localStorage:window.localStorage,sessionStorage:window.sessionStorage};else{var s=e.read("localStorage"),o=new t(s?JSON.parse(s):{},(function(t){e.create("localStorage",JSON.stringify(t),365)}),(function(){e.create("localStorage","",365)})),n=new t;Ne.exports={localStorage:o,sessionStorage:n}}return Ne.exports}function si(){if(Xe)return We;Xe=1;var t=ii(),e=Ee(),i;try{(i=t.localStorage).setItem("~~~","!"),i.removeItem("~~~")}catch(t){i=null}function s(t,s){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix)),this.ls=s||i,!this.ls&&this._noop()}function o(){return(new Date).getTime()}function n(t){return JSON.stringify(e.isUndefined(t)?null:t)}function r(t){return JSON.parse(t)}function a(t){var e,s,o=[],n=i.length;for(e=0;e<n;e++)(s=i.key(e)).match(t)&&o.push(s.replace(t,""));return o}return e.mixin(s.prototype,{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=e.noop},_safeSet:function(t,e){try{this.ls.setItem(t,e)}catch(t){"QuotaExceededError"===t.name&&(this.clear(),this._noop())}},get:function(t){return this.isExpired(t)&&this.remove(t),r(this.ls.getItem(this._prefix(t)))},set:function(t,i,s){return e.isNumber(s)?this._safeSet(this._ttlKey(t),n(o()+s)):this.ls.removeItem(this._ttlKey(t)),this._safeSet(this._prefix(t),n(i))},remove:function(t){return this.ls.removeItem(this._ttlKey(t)),this.ls.removeItem(this._prefix(t)),this},clear:function(){var t,e=a(this.keyMatcher);for(t=e.length;t--;)this.remove(e[t]);return this},isExpired:function(t){var i=r(this.ls.getItem(this._ttlKey(t)));return!!(e.isNumber(i)&&o()>i)}}),We=s}function oi(){if(Ye)return Qe;Ye=1;var t=si(),e=Ee(),i="data",s="protocol",o="thumbprint",n=null;function r(e){this.url=e.url,this.ttl=e.ttl,this.cache=e.cache,this.prepare=e.prepare,this.transform=e.transform,this.transport=e.transport,this.thumbprint=e.thumbprint,this.storage=new t(e.cacheKey)}return n="undefined"!=typeof window?window.location:{protocol:"https:"},e.mixin(r.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(t){this.cache&&(this.storage.set(i,t,this.ttl),this.storage.set(s,n.protocol,this.ttl),this.storage.set(o,this.thumbprint,this.ttl))},fromCache:function(){var t={},e;return this.cache?(t.data=this.storage.get(i),t.protocol=this.storage.get(s),t.thumbprint=this.storage.get(o),e=t.thumbprint!==this.thumbprint||t.protocol!==n.protocol,t.data&&!e?t.data:null):null},fromNetwork:function(t){var e=this,i;function s(){t(!0)}function o(i){t(null,e.transform(i))}t&&(i=this.prepare(this._settings()),this.transport(i).then(o,s))},clear:function(){return this.storage.clear(),this}}),Qe=r}function ni(){if(Ke)return Ze;Ke=1;var t=Ee();function e(e){return(e=t.toStr(e))?e.split(/\s+/):[]}function i(e){return(e=t.toStr(e))?e.split(/\W+/):[]}function s(e){return function i(s){return s=t.isArray(s)?s:[].slice.call(arguments,0),function i(o){var n=[];return t.each(s,(function(i){n=n.concat(e(t.toStr(o[i])))})),n}}}return Ze={nonword:i,whitespace:e,obj:{nonword:s(i),whitespace:s(e)}}}var ri={exports:{}},ai={exports:{}},li,hi,ci,di,ui;function pi(){return li||(li=1,function(t){function e(t){if(t)return i(t)}function i(t){for(var i in e.prototype)t[i]=e.prototype[i];return t}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+t],s;if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<i.length;o++)if((s=i[o])===e||s.fn===e){i.splice(o,1);break}return 0===i.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(i)for(var s=0,o=(i=i.slice(0)).length;s<o;++s)i[s].apply(this,e);return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}(ai)),ai.exports}function mi(){if(ci)return hi;function t(t){return null!==t&&"object"==typeof t}return ci=1,hi=t}function gi(){if(ui)return di;ui=1;var t=mi();function e(t){if(t)return i(t)}function i(t){for(var i in e.prototype)t[i]=e.prototype[i];return t}di=e,e.prototype.clearTimeout=function t(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},e.prototype.parse=function t(e){return this._parser=e,this},e.prototype.responseType=function(t){return this._responseType=t,this},e.prototype.serialize=function t(e){return this._serializer=e,this},e.prototype.timeout=function t(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var i in e)switch(i){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",i)}return this},e.prototype.retry=function t(e,i){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=i,this};var s=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];return e.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var i=this._retryCallback(t,e);if(!0===i)return!0;if(!1===i)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~s.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},e.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},e.prototype.then=function t(e,i){if(!this._fullfilledPromise){var s=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(t,e){s.end((function(i,s){i?e(i):t(s)}))}))}return this._fullfilledPromise.then(e,i)},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.use=function t(e){return e(this),this},e.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},e.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},e.prototype.get=function(t){return this._header[t.toLowerCase()]},e.prototype.getHeader=e.prototype.get,e.prototype.set=function(e,i){if(t(e)){for(var s in e)this.set(s,e[s]);return this}return this._header[e.toLowerCase()]=i,this.header[e]=i,this},e.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},e.prototype.field=function(e,i){if(null==e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),t(e)){for(var s in e)this.field(s,e[s]);return this}if(Array.isArray(i)){for(var o in i)this.field(e,i[o]);return this}if(null==i)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof i&&(i=""+i),this._getFormData().append(e,i),this},e.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},e.prototype._auth=function(t,e,i,s){switch(i.type){case"basic":this.set("Authorization","Basic "+s(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},e.prototype.withCredentials=function(t){return null==t&&(t=!0),this._withCredentials=t,this},e.prototype.redirects=function(t){return this._maxRedirects=t,this},e.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},e.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},e.prototype.send=function(e){var i=t(e),s=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),i&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(i&&t(this._data))for(var o in e)this._data[o]=e[o];else"string"==typeof e?(s||this.type("form"),s=this._header["content-type"],this._data="application/x-www-form-urlencoded"==s?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!i||this._isHost(e)||s||this.type("json"),this},e.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},e.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var i=this.url.substring(e+1).split("&");"function"==typeof this._sort?i.sort(this._sort):i.sort(),this.url=this.url.substring(0,e)+"?"+i.join("&")}}},e.prototype._appendQueryString=function(){console.trace("Unsupported")},e.prototype._timeoutError=function(t,e,i){if(!this._aborted){var s=new Error(t+e+"ms exceeded");s.timeout=e,s.code="ECONNABORTED",s.errno=i,this.timedout=!0,this.abort(),this.callback(s)}},e.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))},di}var fi={},vi,yi,bi,wi,xi;function ki(){return vi||(vi=1,fi.type=function(t){return t.split(/ *; */).shift()},fi.params=function(t){return t.split(/ *; */).reduce((function(t,e){var i=e.split(/ *= */),s=i.shift(),o=i.shift();return s&&o&&(t[s]=o),t}),{})},fi.parseLinks=function(t){return t.split(/ *, */).reduce((function(t,e){var i=e.split(/ *; */),s=i[0].slice(1,-1),o;return t[i[1].split(/ *= */)[1].slice(1,-1)]=s,t}),{})},fi.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}),fi}function Si(){if(bi)return yi;bi=1;var t=ki();function e(t){if(t)return i(t)}function i(t){for(var i in e.prototype)t[i]=e.prototype[i];return t}return yi=e,e.prototype.get=function(t){return this.header[t.toLowerCase()]},e.prototype._setHeaderProperties=function(e){var i=e["content-type"]||"";this.type=t.type(i);var s=t.params(i);for(var o in s)this[o]=s[o];this.links={};try{e.link&&(this.links=t.parseLinks(e.link))}catch(t){}},e.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t},yi}function Ei(){if(xi)return wi;function t(){this._defaults=[]}return xi=1,["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach((function(e){t.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}})),t.prototype._setDefaults=function(t){this._defaults.forEach((function(e){t[e.fn].apply(t,e.arguments)}))},wi=t}var Ti=ri.exports,_i,Ci,Bi,Di,Mi,Ri,Ai,ji,Li,Pi,Fi,Oi,Ii;function Ni(){return _i||(_i=1,function(t,e){var i;"undefined"!=typeof window?i=window:"undefined"!=typeof self?i=self:(console.warn("Using browser-only version of superagent in non-browser environment"),i=Ti);var s=pi(),o=gi(),n=mi(),r=Si(),a=Ei();function l(){}var h=e=t.exports=function(t,i){return"function"==typeof i?new e.Request("GET",t).end(i):1==arguments.length?new e.Request("GET",t):new e.Request(t,i)};e.Request=v,h.getXHR=function(){if(!(!i.XMLHttpRequest||i.location&&"file:"==i.location.protocol&&i.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var c="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function d(t){if(!n(t))return t;var e=[];for(var i in t)u(e,i,t[i]);return e.join("&")}function u(t,e,i){if(null!=i)if(Array.isArray(i))i.forEach((function(i){u(t,e,i)}));else if(n(i))for(var s in i)u(t,e+"["+s+"]",i[s]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));else null===i&&t.push(encodeURIComponent(e))}function p(t){for(var e={},i=t.split("&"),s,o,n=0,r=i.length;n<r;++n)-1==(o=(s=i[n]).indexOf("="))?e[decodeURIComponent(s)]="":e[decodeURIComponent(s.slice(0,o))]=decodeURIComponent(s.slice(o+1));return e}function m(t){for(var e=t.split(/\r?\n/),i={},s,o,n,r,a=0,l=e.length;a<l;++a)-1!==(s=(o=e[a]).indexOf(":"))&&(n=o.slice(0,s).toLowerCase(),r=c(o.slice(s+1)),i[n]=r);return i}function g(t){return/[\/+]json($|[^-\w])/.test(t)}function f(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=m(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function v(t,e){var i=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",(function(){var t=null,e=null,s;try{e=new f(i)}catch(e){return(t=new Error("Parser is unable to parse the response")).parse=!0,t.original=e,i.xhr?(t.rawResponse=void 0===i.xhr.responseType?i.xhr.responseText:i.xhr.response,t.status=i.xhr.status?i.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),i.callback(t)}i.emit("response",e);try{i._isResponseOK(e)||(s=new Error(e.statusText||"Unsuccessful HTTP response"))}catch(t){s=t}s?(s.original=t,s.response=e,s.status=e.status,i.callback(s,e)):i.callback(null,e)}))}function y(t,e,i){var s=h("DELETE",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s}h.serializeObject=d,h.parseString=p,h.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},h.serialize={"application/x-www-form-urlencoded":d,"application/json":JSON.stringify},h.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse},r(f.prototype),f.prototype._parseBody=function(t){var e=h.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&g(this.type)&&(e=h.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},f.prototype.toError=function(){var t=this.req,e=t.method,i=t.url,s="cannot "+e+" "+i+" ("+this.status+")",o=new Error(s);return o.status=this.status,o.method=e,o.url=i,o},h.Response=f,s(v.prototype),o(v.prototype),v.prototype.type=function(t){return this.set("Content-Type",h.types[t]||t),this},v.prototype.accept=function(t){return this.set("Accept",h.types[t]||t),this},v.prototype.auth=function(t,e,i){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(i=e,e=""),i||(i={type:"function"==typeof btoa?"basic":"auto"});var s=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,i,s)},v.prototype.query=function(t){return"string"!=typeof t&&(t=d(t)),t&&this._query.push(t),this},v.prototype.attach=function(t,e,i){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,i||e.name)}return this},v.prototype._getFormData=function(){return this._formData||(this._formData=new i.FormData),this._formData},v.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var i=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),i(t,e)},v.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},v.prototype.buffer=v.prototype.ca=v.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},v.prototype.pipe=v.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},v.prototype._isHost=function t(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},v.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||l,this._finalizeQueryString(),this._end()},v.prototype._end=function(){var t=this,e=this.xhr=h.getXHR(),i=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var i=e.readyState;if(i>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==i){var s;try{s=e.status}catch(t){s=0}if(!s){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var s=function(e,i){i.total>0&&(i.percent=i.loaded/i.total*100),i.direction=e,t.emit("progress",i)};if(this.hasListeners("progress"))try{e.onprogress=s.bind(null,"download"),e.upload&&(e.upload.onprogress=s.bind(null,"upload"))}catch(t){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof i&&!this._isHost(i)){var o=this._header["content-type"],n=this._serializer||h.serialize[o?o.split(";")[0]:""];!n&&g(o)&&(n=h.serialize["application/json"]),n&&(i=n(i))}for(var r in this.header)null!=this.header[r]&&this.header.hasOwnProperty(r)&&e.setRequestHeader(r,this.header[r]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==i?i:null),this},h.agent=function(){return new a},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(t){a.prototype[t.toLowerCase()]=function(e,i){var s=new h.Request(t,e);return this._setDefaults(s),i&&s.end(i),s}})),a.prototype.del=a.prototype.delete,h.get=function(t,e,i){var s=h("GET",t);return"function"==typeof e&&(i=e,e=null),e&&s.query(e),i&&s.end(i),s},h.head=function(t,e,i){var s=h("HEAD",t);return"function"==typeof e&&(i=e,e=null),e&&s.query(e),i&&s.end(i),s},h.options=function(t,e,i){var s=h("OPTIONS",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s},h.del=y,h.delete=y,h.patch=function(t,e,i){var s=h("PATCH",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s},h.post=function(t,e,i){var s=h("POST",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s},h.put=function(t,e,i){var s=h("PUT",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s}}(ri,ri.exports)),ri.exports}function Hi(){if(Bi)return Ci;Bi=1;var t=Pe().Promise,e=Ni();return Ci=function(i){return new t((function(t,s){e.get(i.url).end((function(e,i){if(e)return s(e);t(i.body)}))}))}}function zi(){return Mi?Di:(Mi=1,Di="1.0.0")}function Vi(){if(Ai)return Ri;Ai=1;var t=Ee(),e=Hi(),i=zi();function s(s){var o;return s?(o={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:t.identity,transform:t.identity,transport:null},s=t.isString(s)?{url:s}:s,!(s=t.mixin(o,s)).url&&t.error("prefetch requires url to be set"),s.transform=s.filter||s.transform,s.cacheKey=s.cacheKey||s.url,s.thumbprint=i+s.thumbprint,s.transport=s.transport?(s.transport,function(t){}):e,s):null}function o(i){var s;if(i)return s={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:t.identity,transport:null},i=t.isString(i)?{url:i}:i,!(i=t.mixin(s,i)).url&&t.error("remote requires url to be set"),i.transform=i.filter||i.transform,i.prepare=n(i),i.limiter=r(i),i.transport=i.transport?(i.transport,function(t){}):e,delete i.replace,delete i.wildcard,delete i.rateLimitBy,delete i.rateLimitWait,i}function n(t){var e,i,s;return e=t.prepare,i=t.replace,s=t.wildcard,e||(e=i?o:t.wildcard?n:r);function o(t,e){return e.url=i(e.url,t),e}function n(t,e){return e.url=e.url.replace(s,encodeURIComponent(t)),e}function r(t,e){return e}}function r(e){var i,s,o;return i=e.limiter,s=e.rateLimitBy,o=e.rateLimitWait,i||(i=/^throttle$/i.test(s)?r(o):n(o)),i;function n(e){return function(i){return t.debounce(i,e)}}function r(e){return function(i){return t.throttle(i,e)}}}function a(t){return function(t){}}return Ri=function(e){var i,n;return i={initialize:!0,identify:t.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},!(e=t.mixin(i,e||{})).datumTokenizer&&t.error("datumTokenizer is required"),!e.queryTokenizer&&t.error("queryTokenizer is required"),n=e.sorter,e.sorter=n?function(t){return t.sort(n)}:t.identity,e.local=t.isFunction(e.local)?e.local():e.local,e.prefetch=s(e.prefetch),e.remote=o(e.remote),e},Ri}function qi(){if(Li)return ji;Li=1;var t=Ee(),e="c",i="i";function s(e){if(!(e=e||{}).datumTokenizer||!e.queryTokenizer)throw new Error("datumTokenizer and queryTokenizer are both required");this.identify=e.identify||t.stringify,this.datumTokenizer=e.datumTokenizer,this.queryTokenizer=e.queryTokenizer,this.reset()}function o(e){return e=t.filter(e,(function(t){return!!t})),e=t.map(e,(function(t){return t.toLowerCase()}))}function n(){var t={};return t[i]=[],t[e]={},t}function r(t){for(var e={},i=[],s=0,o=t.length;s<o;s++)e[t[s]]||(e[t[s]]=!0,i.push(t[s]));return i}function a(t,e){var i=0,s=0,o=[];t=t.sort(),e=e.sort();for(var n=t.length,r=e.length;i<n&&s<r;)t[i]<e[s]?i++:(t[i]>e[s]||(o.push(t[i]),i++),s++);return o}return t.mixin(s.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(s){var r=this;s=t.isArray(s)?s:[s],t.each(s,(function(s){var a,l;r.datums[a=r.identify(s)]=s,l=o(r.datumTokenizer(s)),t.each(l,(function(t){var s,o,l;for(s=r.trie,o=t.split("");l=o.shift();)(s=s[e][l]||(s[e][l]=n()))[i].push(a)}))}))},get:function(e){var i=this;return t.map(e,(function(t){return i.datums[t]}))},search:function(s){var n=this,l,h;return l=o(this.queryTokenizer(s)),t.each(l,(function(t){var s,o,r,l;if(h&&0===h.length)return!1;for(s=n.trie,o=t.split("");s&&(r=o.shift());)s=s[e][r];if(!s||0!==o.length)return h=[],!1;l=s[i].slice(0),h=h?a(h,l):l})),h?t.map(r(h),(function(t){return n.datums[t]})):[]},all:function(){var t=[];for(var e in this.datums)t.push(this.datums[e]);return t},reset:function(){this.datums={},this.trie=n()},serialize:function t(){return{datums:this.datums,trie:this.trie}}}),ji=s}function Gi(){if(Fi)return Pi;Fi=1;var t=Ee(),e=Pe().Promise,i=Ie(),s=oi(),o=ni(),n=Vi(),r=qi(),a=Oe();function l(t){t=n(t),this.sorter=t.sorter,this.identify=t.identify,this.sufficient=t.sufficient,this.local=t.local,this.remote=t.remote?new i(t.remote):null,this.prefetch=t.prefetch?new s(t.prefetch):null,this.index=new r({identify:this.identify,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),!1!==t.initialize&&this.initialize()}return l.tokenizers=o,t.mixin(l.prototype,{__ttAdapter:function t(){var e=this;return this.remote?i:s;function i(t,i,s){return e.search(t,i,s)}function s(t,i){return e.search(t,i)}},_loadPrefetch:function t(){var i=this,s;return this.prefetch?(s=this.prefetch.fromCache())?(this.index.bootstrap(s),new e((function(t,e){t()}))):new e((function(t,e){i.prefetch.fromNetwork((function(s,o){if(s)return e(s);try{i.add(o),i.prefetch.store(i.index.serialize()),t()}catch(t){e(t)}}))})):new e((function(t,e){t()}))},_initialize:function(){var t=this;return this.clear(),(this.initPromise=this._loadPrefetch()).then(e),this.initPromise;function e(){t.add(t.local)}},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){return this.index.add(t),this},get:function(e){return e=t.isArray(e)?e:[].slice.call(arguments),this.index.get(e)},search:function(e,i,s){var o=this,n;return n=this.sorter(this.index.search(e)),i(this.remote?n.slice():n),this.remote&&n.length<this.sufficient?this.remote.get(e,r):this.remote&&this.remote.cancelLastRequest(),this;function r(e){var i=[];t.each(e,(function(e){!t.some(n,(function(t){return o.identify(e)===o.identify(t)}))&&i.push(e)})),s&&s(i)}},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return a.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),Pi=l}function $i(){return Ii?Oi:(Ii=1,Oi=Gi())}var Ui,Wi=ke($i());const Xi=jQuery;class Qi extends ce{constructor(e,i,s){var o,n;super(e,i,s),this.name="distance",this.typeLabel="Search by address",this.label=this.label||(void 0===e.label?"Search radius":e.label),this.distanceControl=e.distanceControl||"select",this.distanceUnits=e.distanceUnits||"km",this.distanceUnitsLabel=e.distanceUnitsLabel||"km",this.fromLabel=e.fromLabel||"from",this.placeholder=e.placeholder,this.userLocationButton=e.userLocationButton||!1,this.type=e.type,this.addressField=e.addressField||!0,this.addressFieldPlaceholder=e.addressFieldPlaceholder||"Address",this.languages=[{value:"sq",label:"Albanian"},{value:"ar",label:"Arabic"},{value:"eu",label:"Basque"},{value:"be",label:"Belarusian"},{value:"bg",label:"Bulgarian"},{value:"my",label:"Burmese"},{value:"bn",label:"Bengali"},{value:"ca",label:"Catalan"},{value:"zh-cn",label:"Chinese (simplified)"},{value:"zh-tw",label:"Chinese (traditional)"},{value:"hr",label:"Croatian"},{value:"cs",label:"Czech"},{value:"da",label:"Danish"},{value:"nl",label:"Dutch"},{value:"en",label:"English"},{value:"en-au",label:"English (australian)"},{value:"en-gb",label:"English (great Britain)"},{value:"fa",label:"Farsi"},{value:"fi",label:"Finnish"},{value:"fil",label:"Filipino"},{value:"fr",label:"French"},{value:"gl",label:"Galician"},{value:"de",label:"German"},{value:"el",label:"Greek"},{value:"gu",label:"Gujarati"},{value:"iw",label:"Hebrew"},{value:"hi",label:"Hindi"},{value:"hu",label:"Hungarian"},{value:"id",label:"Indonesian"},{value:"it",label:"Italian"},{value:"ja",label:"Japanese"},{value:"kn",label:"Kannada"},{value:"kk",label:"Kazakh"},{value:"ko",label:"Korean"},{value:"ky",label:"Kyrgyz"},{value:"lt",label:"Lithuanian"},{value:"lv",label:"Latvian"},{value:"mk",label:"Macedonian"},{value:"ml",label:"Malayalam"},{value:"mr",label:"Marathi"},{value:"no",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"pt",label:"Portuguese"},{value:"pt-br",label:"Portuguese (brazil)"},{value:"pt-pt",label:"Portuguese (portugal)"},{value:"pa",label:"Punjabi"},{value:"ro",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"sl",label:"Slovenian"},{value:"es",label:"Spanish"},{value:"sv",label:"Swedish"},{value:"tl",label:"Tagalog"},{value:"ta",label:"Tamil"},{value:"te",label:"Telugu"},{value:"th",label:"Thai"},{value:"tr",label:"Turkish"},{value:"uk",label:"Ukrainian"},{value:"uz",label:"Uzbek"},{value:"vi",label:"Vietnamese"}],this.countries=window.mapsvg.countries,this.country=e.country,this.language=e.language,this.searchByZip=e.searchByZip,this.zipLength=parseInt(e.zipLength)||5,this.userLocationButton=t(e.userLocationButton),this.options=e.options||[{value:"10",default:!0},{value:"30",default:!1},{value:"50",default:!1},{value:"100",default:!1}],this.value||(this.value={units:this.distanceUnits,geoPoint:{lat:null,lng:null},length:(null===(o=this.options.find((t=>t.default)))||void 0===o?void 0:o.value)||(null===(n=this.options[0])||void 0===n?void 0:n.value),address:"",country:this.country}),this.defaultLength=this.value.length}setDomElements(){super.setDomElements(),this.inputs.units=Xi(this.domElements.main).find('[name="distanceUnits"]')[0],this.inputs.geoPoint=Xi(this.domElements.main).find('[name="distanceGeoPoint"]')[0],this.inputs.length=Xi(this.domElements.main).find('[name="distanceLength"]')[0],this.inputs.address=Xi(this.domElements.main).find('[name="distance"]')[0]}getSchema(){const e=super.getSchema();return e.distanceControl=this.distanceControl,e.distanceUnits=this.distanceUnits,e.distanceUnitsLabel=this.distanceUnitsLabel,e.fromLabel=this.fromLabel,e.addressField=this.addressField,e.addressFieldPlaceholder=this.addressFieldPlaceholder,e.userLocationButton=this.userLocationButton,e.placeholder=this.placeholder,e.language=this.language,e.country=this.country,e.searchByZip=this.searchByZip,e.zipLength=parseInt(this.zipLength+""),e.userLocationButton=t(this.userLocationButton),"none"===e.distanceControl&&(e.distanceDefault=e.options.filter((function(t){return t.default}))[0].value),e.options.forEach((function(i,s){""===e.options[s].value?e.options.splice(s,1):e.options[s].default=t(e.options[s].default)})),e}getDataForTemplate(){const e=super.getDataForTemplate();return this.formBuilder.admin&&(e.languages=this.languages,e.countries=this.countries),e.language=this.language,e.country=this.country,e.searchByZip=this.searchByZip,e.zipLength=this.zipLength,e.userLocationButton=t(this.userLocationButton),e}initEditor(){super.initEditor(),this.mayBeAddDistanceRow(),Xi().mselect2&&Xi(this.domElements.edit).find("select").mselect2()}setEventHandlers(){super.setEventHandlers();const t=this;Xi(this.domElements.edit).on("keyup change paste",".mapsvg-edit-distance-row input",(function(){t.mayBeAddDistanceRow()}));const e=new Xt(s.routes.api),i=new Wi({datumTokenizer:Wi.tokenizers.obj.whitespace("formatted_address"),queryTokenizer:Wi.tokenizers.whitespace,remote:{url:e.getUrl("geocoding")+"?address="+(!0===this.searchByZip?"zip%20":"")+"%QUERY%&language="+this.language+(this.country?"&country="+this.country:""),wildcard:"%QUERY%",transform:function(t){return t.error_message&&console.error(t.error_message),t.results},rateLimitWait:600}}),o=Xi(this.domElements.main).find(".typeahead");if(this.spinner=Xi("<span class='spinner-border spinner-border-sm'></span>")[0],this.searchByZip?(Xi(this.domElements.main).find(".mapsvg-distance-fields").addClass("search-by-zip"),o.on("change keyup",(e=>{const s=Xi(e.target).val().toString();s.length===t.zipLength&&(Xi(this.spinner).appendTo(Xi(e.target).closest(".distance-search-wrap")),this.formBuilder.setIsLoading(!0),i.search(Xi(e.target).val(),(t=>this.handleAddressFieldChange(s,t)),(t=>this.handleAddressFieldChange(s,t,!0))))}))):(o.typeahead({minLength:3},{name:"mapsvg-addresses",display:"formatted_address",limit:5,async:!0,source:(t,e,i)=>{const s={address:t};this.country&&(s.componentRestrictions={country:this.country}),g(s,i)}}).on("typeahead:asyncrequest",(t=>{Xi(this.spinner).appendTo(Xi(t.target).closest(".twitter-typeahead")),this.formBuilder.setIsLoading(!0)})).on("typeahead:asynccancel typeahead:asyncreceive",(t=>{Xi(this.spinner).remove(),this.formBuilder.setIsLoading(!1)})),Xi(this.domElements.main).find(".mapsvg-distance-fields").removeClass("search-by-zip")),t.userLocationButton){const e=undefined;Xi(this.domElements.main).find(".user-location-button").on("click",(()=>{t.formBuilder.mapsvg.showUserLocation((t=>{i.search(t.geoPoint.lat+","+t.geoPoint.lng,(e=>this.setAddressByUserLocation(e,t)),(e=>this.setAddressByUserLocation(e,t))),this.setValue({geoPoint:t.geoPoint}),this.triggerChanged()}))}))}o.on("change keyup",(t=>{const e=undefined;""===t.target.value&&null!==this.getValue()&&(this.setValue(null),this.triggerChanged())})),o.on("typeahead:select",((t,e)=>{this.setValue({address:e.formatted_address,geoPoint:e.geometry.location.toJSON()}),this.triggerChanged(),o.blur()})),Xi(this.inputs.geoPoint).on("change",(t=>{const e=t.target.value.split(",").map((t=>parseFloat(t)));this.setValue({geoPoint:{lat:e[0],lng:e[1]}},!1),this.triggerChanged()})),Xi(this.inputs.length).on("change",(t=>{this.setLength(parseInt(t.target.value),!1),this.triggerChanged()}))}setAddressByUserLocation(t,e){t&&t[0]?this.setAddress(t[0].formatted_address):this.setAddress(e.geoPoint.lat+","+e.geoPoint.lng)}handleAddressFieldChange(t,e,i=!1){i&&(Xi(this.spinner).remove(),this.formBuilder.setIsLoading(!1)),e&&e[0]&&(this.setValue({address:t,geoPoint:e[0].geometry.location},!1),this.triggerChanged())}addSelect2(){Xi().mselect2&&Xi(this.domElements.main).find("select").mselect2().on("select2:focus",(function(){Xi(this).mselect2("open")}))}mayBeAddDistanceRow(){const t=this,e=Xi(Xi("#mapsvg-edit-distance-row").html()),i=Xi(t.domElements.edit).find(".mapsvg-edit-distance-row:last-child input");if(i&&i.last()&&i.last().val()&&i.last().val().toString().trim().length){const i=undefined;e.clone().insertAfter(Xi(t.domElements.edit).find(".mapsvg-edit-distance-row:last-child"))}const s=Xi(t.domElements.edit).find(".mapsvg-edit-distance-row"),o=s.eq(s.length-2),n=s.eq(s.length-1);o.length&&n.length&&!o.find("input:eq(0)").val().toString().trim()&&!n.find("input:eq(0)").val().toString().trim()&&n.remove()}setValue(t,e=!0){if(null===t)this.setGeoPoint(null),this.setAddress("");else for(const s in t)if(void 0!==this.value[s]){const o="set"+i(s);"function"==typeof this[o]&&this[o](t[s],e)}}setGeoPoint(t,e=!0){this.value.geoPoint=null===t?{lat:null,lng:null}:t,e&&this.setInputGeoPointValue(t)}setInputGeoPointValue(t){this.inputs.geoPoint.value=t?t.lat+","+t.lng:""}setLength(t,e=!0){this.value.length=parseInt(t.toString()),this.defaultLength=this.value.length,e&&this.setInputLengthValue(this.value.length)}setInputLengthValue(t){this.inputs.length.value=t.toString()}setAddress(t,e=!0){this.value.address=null!==t?t:"",e&&this.setInputAddressValue(this.value.address)}setInputAddressValue(t){this.inputs.address.value=t}getValue(){return null===this.value.geoPoint.lat?null:this.value}}const Yi=jQuery;class Zi extends ce{constructor(e,i,s){super(e,i,s),this.searchFallback=t(e.searchFallback),this.width=this.formBuilder.filtersHide&&!this.formBuilder.modal?null:e.width||"100%",this.db_type="varchar(255)",this.typeLabel="Colorpicker"}setDomElements(){super.setDomElements(),this.inputs.text=Yi(this.domElements.main).find("input.cpicker")[0],Yi(this.domElements.main).find(".colorpicker-element").colorpicker()}getSchema(){const t=super.getSchema();return t.searchType=this.searchType,t}setEventHandlers(){super.setEventHandlers(),Yi(this.inputs.text).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()})),Yi(this.domElements.main).find(".colorpicker-element").colorpicker().on("changeColor.colorpicker",(t=>{this.setValue(this.inputs.text.value,!1),this.triggerChanged()}))}setInputValue(t){this.inputs.text.value=t}}jQuery;class Ki extends ce{constructor(t,e,i){super(t,e,i),this.readonly=!0,this.typeLabel="Empty"}}class Ji extends ce{constructor(t,e,i){super(t,e,i),this.typeLabel="ID"}getData(){return{name:"id",value:this.value}}}
/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ts(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function es(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ts(Object(i),!0).forEach((function(e){ss(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ts(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function is(t){return is="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},is(t)}function ss(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function os(){return os=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},os.apply(this,arguments)}function ns(t,e){if(null==t)return{};var i={},s=Object.keys(t),o,n;for(n=0;n<s.length;n++)o=s[n],e.indexOf(o)>=0||(i[o]=t[o]);return i}function rs(t,e){if(null==t)return{};var i=ns(t,e),s,o;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(o=0;o<n.length;o++)s=n[o],e.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}var as="1.15.2";function ls(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var hs=ls(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),cs=ls(/Edge/i),ds=ls(/firefox/i),us=ls(/safari/i)&&!ls(/chrome/i)&&!ls(/android/i),ps=ls(/iP(ad|od|hone)/i),ms=ls(/chrome/i)&&ls(/android/i),gs={capture:!1,passive:!1};function fs(t,e,i){t.addEventListener(e,i,!hs&&gs)}function vs(t,e,i){t.removeEventListener(e,i,!hs&&gs)}function ys(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function bs(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function ws(t,e,i,s){if(t){i=i||document;do{if(null!=e&&(">"===e[0]?t.parentNode===i&&ys(t,e):ys(t,e))||s&&t===i)return t;if(t===i)break}while(t=bs(t))}return null}var xs=/\s+/g,ks;function Ss(t,e,i){if(t&&e)if(t.classList)t.classList[i?"add":"remove"](e);else{var s=(" "+t.className+" ").replace(xs," ").replace(" "+e+" "," ");t.className=(s+(i?" "+e:"")).replace(xs," ")}}function Es(t,e,i){var s=t&&t.style;if(s){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];e in s||-1!==e.indexOf("webkit")||(e="-webkit-"+e),s[e]=i+("string"==typeof i?"":"px")}}function Ts(t,e){var i="";if("string"==typeof t)i=t;else do{var s=Es(t,"transform");s&&"none"!==s&&(i=s+" "+i)}while(!e&&(t=t.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function _s(t,e,i){if(t){var s=t.getElementsByTagName(e),o=0,n=s.length;if(i)for(;o<n;o++)i(s[o],o);return s}return[]}function Cs(){var t=document.scrollingElement;return t||document.documentElement}function Bs(t,e,i,s,o){if(t.getBoundingClientRect||t===window){var n,r,a,l,h,c,d;if(t!==window&&t.parentNode&&t!==Cs()?(r=(n=t.getBoundingClientRect()).top,a=n.left,l=n.bottom,h=n.right,c=n.height,d=n.width):(r=0,a=0,l=window.innerHeight,h=window.innerWidth,c=window.innerHeight,d=window.innerWidth),(e||i)&&t!==window&&(o=o||t.parentNode,!hs))do{if(o&&o.getBoundingClientRect&&("none"!==Es(o,"transform")||i&&"static"!==Es(o,"position"))){var u=o.getBoundingClientRect();r-=u.top+parseInt(Es(o,"border-top-width")),a-=u.left+parseInt(Es(o,"border-left-width")),l=r+n.height,h=a+n.width;break}}while(o=o.parentNode);if(s&&t!==window){var p=Ts(o||t),m=p&&p.a,g=p&&p.d;p&&(l=(r/=g)+(c/=g),h=(a/=m)+(d/=m))}return{top:r,left:a,bottom:l,right:h,width:d,height:c}}}function Ds(t,e,i){for(var s=Ps(t,!0),o=Bs(t)[e];s;){var n,r=void 0;if(!(r=o>=Bs(s)[i]))return s;if(s===Cs())break;s=Ps(s,!1)}return!1}function Ms(t,e,i,s){for(var o=0,n=0,r=t.children;n<r.length;){if("none"!==r[n].style.display&&r[n]!==Wo.ghost&&(s||r[n]!==Wo.dragged)&&ws(r[n],i.draggable,t,!1)){if(o===e)return r[n];o++}n++}return null}function Rs(t,e){for(var i=t.lastElementChild;i&&(i===Wo.ghost||"none"===Es(i,"display")||e&&!ys(i,e));)i=i.previousElementSibling;return i||null}function As(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Wo.clone||e&&!ys(t,e)||i++;return i}function js(t){var e=0,i=0,s=Cs();if(t)do{var o=Ts(t),n=o.a,r=o.d;e+=t.scrollLeft*n,i+=t.scrollTop*r}while(t!==s&&(t=t.parentNode));return[e,i]}function Ls(t,e){for(var i in t)if(t.hasOwnProperty(i))for(var s in e)if(e.hasOwnProperty(s)&&e[s]===t[i][s])return Number(i);return-1}function Ps(t,e){if(!t||!t.getBoundingClientRect)return Cs();var i=t,s=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=Es(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return Cs();if(s||e)return i;s=!0}}}while(i=i.parentNode);return Cs()}function Fs(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function Os(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function Is(t,e){return function(){if(!ks){var i=arguments,s=this;1===i.length?t.call(s,i[0]):t.apply(s,i),ks=setTimeout((function(){ks=void 0}),e)}}}function Ns(){clearTimeout(ks),ks=void 0}function Hs(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function zs(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}function Vs(t,e,i){var s={};return Array.from(t.children).forEach((function(o){var n,r,a,l;if(ws(o,e.draggable,t,!1)&&!o.animated&&o!==i){var h=Bs(o);s.left=Math.min(null!==(n=s.left)&&void 0!==n?n:1/0,h.left),s.top=Math.min(null!==(r=s.top)&&void 0!==r?r:1/0,h.top),s.right=Math.max(null!==(a=s.right)&&void 0!==a?a:-1/0,h.right),s.bottom=Math.max(null!==(l=s.bottom)&&void 0!==l?l:-1/0,h.bottom)}})),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var qs="Sortable"+(new Date).getTime();function Gs(){var t=[],e;return{captureAnimationState:function e(){var i;(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==Es(e,"display")&&e!==Wo.ghost){t.push({target:e,rect:Bs(e)});var i=es({},t[t.length-1].rect);if(e.thisAnimationDuration){var s=Ts(e,!0);s&&(i.top-=s.f,i.left-=s.e)}e.fromRect=i}}))},addAnimationState:function e(i){t.push(i)},removeAnimationState:function e(i){t.splice(Ls(t,{target:i}),1)},animateAll:function i(s){var o=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof s&&s());var n=!1,r=0;t.forEach((function(t){var e=0,i=t.target,s=i.fromRect,a=Bs(i),l=i.prevFromRect,h=i.prevToRect,c=t.rect,d=Ts(i,!0);d&&(a.top-=d.f,a.left-=d.e),i.toRect=a,i.thisAnimationDuration&&Os(l,a)&&!Os(s,a)&&(c.top-a.top)/(c.left-a.left)==(s.top-a.top)/(s.left-a.left)&&(e=Us(c,l,h,o.options)),Os(a,s)||(i.prevFromRect=s,i.prevToRect=a,e||(e=o.options.animation),o.animate(i,c,a,e)),e&&(n=!0,r=Math.max(r,e),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),e),i.thisAnimationDuration=e)})),clearTimeout(e),n?e=setTimeout((function(){"function"==typeof s&&s()}),r):"function"==typeof s&&s(),t=[]},animate:function t(e,i,s,o){if(o){Es(e,"transition",""),Es(e,"transform","");var n=Ts(this.el),r=n&&n.a,a=n&&n.d,l=(i.left-s.left)/(r||1),h=(i.top-s.top)/(a||1);e.animatingX=!!l,e.animatingY=!!h,Es(e,"transform","translate3d("+l+"px,"+h+"px,0)"),this.forRepaintDummy=$s(e),Es(e,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),Es(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){Es(e,"transition",""),Es(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),o)}}}}function $s(t){return t.offsetWidth}function Us(t,e,i,s){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*s.animation}var Ws=[],Xs={initializeByDefault:!0},Qs={mount:function t(e){for(var i in Xs)Xs.hasOwnProperty(i)&&!(i in e)&&(e[i]=Xs[i]);Ws.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),Ws.push(e)},pluginEvent:function t(e,i,s){var o=this;this.eventCanceled=!1,s.cancel=function(){o.eventCanceled=!0};var n=e+"Global";Ws.forEach((function(t){i[t.pluginName]&&(i[t.pluginName][n]&&i[t.pluginName][n](es({sortable:i},s)),i.options[t.pluginName]&&i[t.pluginName][e]&&i[t.pluginName][e](es({sortable:i},s)))}))},initializePlugins:function t(e,i,s,o){for(var n in Ws.forEach((function(t){var o=t.pluginName;if(e.options[o]||t.initializeByDefault){var n=new t(e,i,e.options);n.sortable=e,n.options=e.options,e[o]=n,os(s,n.defaults)}})),e.options)if(e.options.hasOwnProperty(n)){var r=this.modifyOption(e,n,e.options[n]);void 0!==r&&(e.options[n]=r)}},getEventProperties:function t(e,i){var s={};return Ws.forEach((function(t){"function"==typeof t.eventProperties&&os(s,t.eventProperties.call(i[t.pluginName],e))})),s},modifyOption:function t(e,i,s){var o;return Ws.forEach((function(t){e[t.pluginName]&&t.optionListeners&&"function"==typeof t.optionListeners[i]&&(o=t.optionListeners[i].call(e[t.pluginName],s))})),o}};function Ys(t){var e=t.sortable,i=t.rootEl,s=t.name,o=t.targetEl,n=t.cloneEl,r=t.toEl,a=t.fromEl,l=t.oldIndex,h=t.newIndex,c=t.oldDraggableIndex,d=t.newDraggableIndex,u=t.originalEvent,p=t.putSortable,m=t.extraEventProperties;if(e=e||i&&i[qs]){var g,f=e.options,v="on"+s.charAt(0).toUpperCase()+s.substr(1);!window.CustomEvent||hs||cs?(g=document.createEvent("Event")).initEvent(s,!0,!0):g=new CustomEvent(s,{bubbles:!0,cancelable:!0}),g.to=r||i,g.from=a||i,g.item=o||i,g.clone=n,g.oldIndex=l,g.newIndex=h,g.oldDraggableIndex=c,g.newDraggableIndex=d,g.originalEvent=u,g.pullMode=p?p.lastPutMode:void 0;var y=es(es({},m),Qs.getEventProperties(s,e));for(var b in y)g[b]=y[b];i&&i.dispatchEvent(g),f[v]&&f[v].call(e,g)}}var Zs=["evt"],Ks=function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=s.evt,n=rs(s,Zs);Qs.pluginEvent.bind(Wo)(e,i,es({dragEl:to,parentEl:eo,ghostEl:io,rootEl:so,nextEl:oo,lastDownEl:no,cloneEl:ro,cloneHidden:ao,dragStarted:Eo,putSortable:mo,activeSortable:Wo.active,originalEvent:o,oldIndex:lo,oldDraggableIndex:co,newIndex:ho,newDraggableIndex:uo,hideGhostForTarget:qo,unhideGhostForTarget:Go,cloneNowHidden:function t(){ao=!0},cloneNowShown:function t(){ao=!1},dispatchSortableEvent:function t(e){Js({sortable:i,name:e,originalEvent:o})}},n))};function Js(t){Ys(es({putSortable:mo,cloneEl:ro,targetEl:to,rootEl:so,oldIndex:lo,oldDraggableIndex:co,newIndex:ho,newDraggableIndex:uo},t))}var to,eo,io,so,oo,no,ro,ao,lo,ho,co,uo,po,mo,go=!1,fo=!1,vo=[],yo,bo,wo,xo,ko,So,Eo,To,_o,Co=!1,Bo=!1,Do,Mo,Ro=[],Ao=!1,jo=[],Lo="undefined"!=typeof document,Po=ps,Fo=cs||hs?"cssFloat":"float",Oo=Lo&&!ms&&!ps&&"draggable"in document.createElement("div"),Io=function(){if(Lo){if(hs)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),No=function t(e,i){var s=Es(e),o=parseInt(s.width)-parseInt(s.paddingLeft)-parseInt(s.paddingRight)-parseInt(s.borderLeftWidth)-parseInt(s.borderRightWidth),n=Ms(e,0,i),r=Ms(e,1,i),a=n&&Es(n),l=r&&Es(r),h=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+Bs(n).width,c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+Bs(r).width;if("flex"===s.display)return"column"===s.flexDirection||"column-reverse"===s.flexDirection?"vertical":"horizontal";if("grid"===s.display)return s.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&a.float&&"none"!==a.float){var d="left"===a.float?"left":"right";return!r||"both"!==l.clear&&l.clear!==d?"horizontal":"vertical"}return n&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||h>=o&&"none"===s[Fo]||r&&"none"===s[Fo]&&h+c>o)?"vertical":"horizontal"},Ho=function t(e,i,s){var o=s?e.left:e.top,n=s?e.right:e.bottom,r=s?e.width:e.height,a=s?i.left:i.top,l=s?i.right:i.bottom,h=s?i.width:i.height;return o===a||n===l||o+r/2===a+h/2},zo=function t(e,i){var s;return vo.some((function(t){var o=t[qs].options.emptyInsertThreshold;if(o&&!Rs(t)){var n=Bs(t),r=e>=n.left-o&&e<=n.right+o,a=i>=n.top-o&&i<=n.bottom+o;return r&&a?s=t:void 0}})),s},Vo=function t(e){function i(t,e){return function(s,o,n,r){var a=s.options.group.name&&o.options.group.name&&s.options.group.name===o.options.group.name;if(null==t&&(e||a))return!0;if(null==t||!1===t)return!1;if(e&&"clone"===t)return t;if("function"==typeof t)return i(t(s,o,n,r),e)(s,o,n,r);var l=(e?s:o).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&t.indexOf(l)>-1}}var s={},o=e.group;o&&"object"==is(o)||(o={name:o}),s.name=o.name,s.checkPull=i(o.pull,!0),s.checkPut=i(o.put),s.revertClone=o.revertClone,e.group=s},qo=function t(){!Io&&io&&Es(io,"display","none")},Go=function t(){!Io&&io&&Es(io,"display","")};Lo&&!ms&&document.addEventListener("click",(function(t){if(fo)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),fo=!1,!1}),!0);var $o=function t(e){if(to){e=e.touches?e.touches[0]:e;var i=zo(e.clientX,e.clientY);if(i){var s={};for(var o in e)e.hasOwnProperty(o)&&(s[o]=e[o]);s.target=s.rootEl=i,s.preventDefault=void 0,s.stopPropagation=void 0,i[qs]._onDragOver(s)}}},Uo=function t(e){to&&to.parentNode[qs]._isOutsideThisEl(e.target)};function Wo(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=os({},e),t[qs]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function e(){return No(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function t(e,i){e.setData("Text",i.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Wo.supportPointer&&"PointerEvent"in window&&!us,emptyInsertThreshold:5};for(var s in Qs.initializePlugins(this,t,i),i)!(s in e)&&(e[s]=i[s]);for(var o in Vo(e),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&Oo,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?fs(t,"pointerdown",this._onTapStart):(fs(t,"mousedown",this._onTapStart),fs(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(fs(t,"dragover",this),fs(t,"dragenter",this)),vo.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),os(this,Gs())}function Xo(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function Qo(t,e,i,s,o,n,r,a){var l,h=t[qs],c=h.options.onMove,d;return!window.CustomEvent||hs||cs?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=i,l.draggedRect=s,l.related=o||e,l.relatedRect=n||Bs(e),l.willInsertAfter=a,l.originalEvent=r,t.dispatchEvent(l),c&&(d=c.call(h,l,r)),d}function Yo(t){t.draggable=!1}function Zo(){Ao=!1}function Ko(t,e,i){var s=Bs(Ms(i.el,0,i.options,!0)),o=Vs(i.el,i.options,io),n=10;return e?t.clientX<o.left-n||t.clientY<s.top&&t.clientX<s.right:t.clientY<o.top-n||t.clientY<s.bottom&&t.clientX<s.left}function Jo(t,e,i){var s=Bs(Rs(i.el,i.options.draggable)),o=Vs(i.el,i.options,io),n=10;return e?t.clientX>o.right+n||t.clientY>s.bottom&&t.clientX>s.left:t.clientY>o.bottom+n||t.clientX>s.right&&t.clientY>s.top}function tn(t,e,i,s,o,n,r,a){var l=s?t.clientY:t.clientX,h=s?i.height:i.width,c=s?i.top:i.left,d=s?i.bottom:i.right,u=!1;if(!r)if(a&&Do<h*o){if(!Co&&(1===_o?l>c+h*n/2:l<d-h*n/2)&&(Co=!0),Co)u=!0;else if(1===_o?l<c+Do:l>d-Do)return-_o}else if(l>c+h*(1-o)/2&&l<d-h*(1-o)/2)return en(e);return(u=u||r)&&(l<c+h*n/2||l>d-h*n/2)?l>c+h/2?1:-1:0}function en(t){return As(to)<As(t)?1:-1}function sn(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,s=0;i--;)s+=e.charCodeAt(i);return s.toString(36)}function on(t){jo.length=0;for(var e=t.getElementsByTagName("input"),i=e.length;i--;){var s=e[i];s.checked&&jo.push(s)}}function nn(t){return setTimeout(t,0)}function rn(t){return clearTimeout(t)}Wo.prototype={constructor:Wo,_isOutsideThisEl:function t(e){this.el.contains(e)||e===this.el||(To=null)},_getDirection:function t(e,i){return"function"==typeof this.options.direction?this.options.direction.call(this,e,i,to):this.options.direction},_onTapStart:function t(e){if(e.cancelable){var i=this,s=this.el,o=this.options,n=o.preventOnFilter,r=e.type,a=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,l=(a||e).target,h=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,c=o.filter;if(on(s),!to&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||o.disabled)&&!h.isContentEditable&&(this.nativeDraggable||!us||!l||"SELECT"!==l.tagName.toUpperCase())&&!((l=ws(l,o.draggable,s,!1))&&l.animated||no===l)){if(lo=As(l),co=As(l,o.draggable),"function"==typeof c){if(c.call(this,e,l,this))return Js({sortable:i,rootEl:h,name:"filter",targetEl:l,toEl:s,fromEl:s}),Ks("filter",i,{evt:e}),void(n&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(t){if(t=ws(h,t.trim(),s,!1))return Js({sortable:i,rootEl:t,name:"filter",targetEl:l,fromEl:s,toEl:s}),Ks("filter",i,{evt:e}),!0}))))return void(n&&e.cancelable&&e.preventDefault());o.handle&&!ws(h,o.handle,s,!1)||this._prepareDragStart(e,a,l)}}},_prepareDragStart:function t(e,i,s){var o=this,n=o.el,r=o.options,a=n.ownerDocument,l;if(s&&!to&&s.parentNode===n){var h=Bs(s);if(so=n,eo=(to=s).parentNode,oo=to.nextSibling,no=s,po=r.group,Wo.dragged=to,yo={target:to,clientX:(i||e).clientX,clientY:(i||e).clientY},ko=yo.clientX-h.left,So=yo.clientY-h.top,this._lastX=(i||e).clientX,this._lastY=(i||e).clientY,to.style["will-change"]="all",l=function t(){Ks("delayEnded",o,{evt:e}),Wo.eventCanceled?o._onDrop():(o._disableDelayedDragEvents(),!ds&&o.nativeDraggable&&(to.draggable=!0),o._triggerDragStart(e,i),Js({sortable:o,name:"choose",originalEvent:e}),Ss(to,r.chosenClass,!0))},r.ignore.split(",").forEach((function(t){_s(to,t.trim(),Yo)})),fs(a,"dragover",$o),fs(a,"mousemove",$o),fs(a,"touchmove",$o),fs(a,"mouseup",o._onDrop),fs(a,"touchend",o._onDrop),fs(a,"touchcancel",o._onDrop),ds&&this.nativeDraggable&&(this.options.touchStartThreshold=4,to.draggable=!0),Ks("delayStart",this,{evt:e}),!r.delay||r.delayOnTouchOnly&&!i||this.nativeDraggable&&(cs||hs))l();else{if(Wo.eventCanceled)return void this._onDrop();fs(a,"mouseup",o._disableDelayedDrag),fs(a,"touchend",o._disableDelayedDrag),fs(a,"touchcancel",o._disableDelayedDrag),fs(a,"mousemove",o._delayedDragTouchMoveHandler),fs(a,"touchmove",o._delayedDragTouchMoveHandler),r.supportPointer&&fs(a,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,r.delay)}}},_delayedDragTouchMoveHandler:function t(e){var i=e.touches?e.touches[0]:e;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function t(){to&&Yo(to),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function t(){var e=this.el.ownerDocument;vs(e,"mouseup",this._disableDelayedDrag),vs(e,"touchend",this._disableDelayedDrag),vs(e,"touchcancel",this._disableDelayedDrag),vs(e,"mousemove",this._delayedDragTouchMoveHandler),vs(e,"touchmove",this._delayedDragTouchMoveHandler),vs(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function t(e,i){i=i||"touch"==e.pointerType&&e,!this.nativeDraggable||i?this.options.supportPointer?fs(document,"pointermove",this._onTouchMove):fs(document,i?"touchmove":"mousemove",this._onTouchMove):(fs(to,"dragend",this),fs(so,"dragstart",this._onDragStart));try{document.selection?nn((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function t(e,i){if(go=!1,so&&to){Ks("dragStarted",this,{evt:i}),this.nativeDraggable&&fs(document,"dragover",Uo);var s=this.options;!e&&Ss(to,s.dragClass,!1),Ss(to,s.ghostClass,!0),Wo.active=this,e&&this._appendGhost(),Js({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function t(){if(bo){this._lastX=bo.clientX,this._lastY=bo.clientY,qo();for(var e=document.elementFromPoint(bo.clientX,bo.clientY),i=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(bo.clientX,bo.clientY))!==i;)i=e;if(to.parentNode[qs]._isOutsideThisEl(e),i)do{if(i[qs]){var s=void 0;if((s=i[qs]._onDragOver({clientX:bo.clientX,clientY:bo.clientY,target:e,rootEl:i}))&&!this.options.dragoverBubble)break}e=i}while(i=i.parentNode);Go()}},_onTouchMove:function t(e){if(yo){var i=this.options,s=i.fallbackTolerance,o=i.fallbackOffset,n=e.touches?e.touches[0]:e,r=io&&Ts(io,!0),a=io&&r&&r.a,l=io&&r&&r.d,h=Po&&Mo&&js(Mo),c=(n.clientX-yo.clientX+o.x)/(a||1)+(h?h[0]-Ro[0]:0)/(a||1),d=(n.clientY-yo.clientY+o.y)/(l||1)+(h?h[1]-Ro[1]:0)/(l||1);if(!Wo.active&&!go){if(s&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<s)return;this._onDragStart(e,!0)}if(io){r?(r.e+=c-(wo||0),r.f+=d-(xo||0)):r={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");Es(io,"webkitTransform",u),Es(io,"mozTransform",u),Es(io,"msTransform",u),Es(io,"transform",u),wo=c,xo=d,bo=n}e.cancelable&&e.preventDefault()}},_appendGhost:function t(){if(!io){var e=this.options.fallbackOnBody?document.body:so,i=Bs(to,!0,Po,!0,e),s=this.options;if(Po){for(Mo=e;"static"===Es(Mo,"position")&&"none"===Es(Mo,"transform")&&Mo!==document;)Mo=Mo.parentNode;Mo!==document.body&&Mo!==document.documentElement?(Mo===document&&(Mo=Cs()),i.top+=Mo.scrollTop,i.left+=Mo.scrollLeft):Mo=Cs(),Ro=js(Mo)}Ss(io=to.cloneNode(!0),s.ghostClass,!1),Ss(io,s.fallbackClass,!0),Ss(io,s.dragClass,!0),Es(io,"transition",""),Es(io,"transform",""),Es(io,"box-sizing","border-box"),Es(io,"margin",0),Es(io,"top",i.top),Es(io,"left",i.left),Es(io,"width",i.width),Es(io,"height",i.height),Es(io,"opacity","0.8"),Es(io,"position",Po?"absolute":"fixed"),Es(io,"zIndex","100000"),Es(io,"pointerEvents","none"),Wo.ghost=io,e.appendChild(io),Es(io,"transform-origin",ko/parseInt(io.style.width)*100+"% "+So/parseInt(io.style.height)*100+"%")}},_onDragStart:function t(e,i){var s=this,o=e.dataTransfer,n=s.options;Ks("dragStart",this,{evt:e}),Wo.eventCanceled?this._onDrop():(Ks("setupClone",this),Wo.eventCanceled||((ro=zs(to)).removeAttribute("id"),ro.draggable=!1,ro.style["will-change"]="",this._hideClone(),Ss(ro,this.options.chosenClass,!1),Wo.clone=ro),s.cloneId=nn((function(){Ks("clone",s),Wo.eventCanceled||(s.options.removeCloneOnHide||so.insertBefore(ro,to),s._hideClone(),Js({sortable:s,name:"clone"}))})),!i&&Ss(to,n.dragClass,!0),i?(fo=!0,s._loopId=setInterval(s._emulateDragOver,50)):(vs(document,"mouseup",s._onDrop),vs(document,"touchend",s._onDrop),vs(document,"touchcancel",s._onDrop),o&&(o.effectAllowed="move",n.setData&&n.setData.call(s,o,to)),fs(document,"drop",s),Es(to,"transform","translateZ(0)")),go=!0,s._dragStartId=nn(s._dragStarted.bind(s,i,e)),fs(document,"selectstart",s),Eo=!0,us&&Es(document.body,"user-select","none"))},_onDragOver:function t(e){var i=this.el,s=e.target,o,n,r,a=this.options,l=a.group,h=Wo.active,c=po===l,d=a.sort,u=mo||h,p,m=this,g=!1;if(!Ao){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=ws(s,a.draggable,i,!0),M("dragOver"),Wo.eventCanceled)return g;if(to.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||m._ignoreWhileAnimating===s)return A(!1);if(fo=!1,h&&!a.disabled&&(c?d||(r=eo!==so):mo===this||(this.lastPutMode=po.checkPull(this,h,to,e))&&l.checkPut(this,h,to,e))){if(p="vertical"===this._getDirection(e,s),o=Bs(to),M("dragOverValid"),Wo.eventCanceled)return g;if(r)return eo=so,R(),this._hideClone(),M("revert"),Wo.eventCanceled||(oo?so.insertBefore(to,oo):so.appendChild(to)),A(!0);var f=Rs(i,a.draggable);if(!f||Jo(e,p,this)&&!f.animated){if(f===to)return A(!1);if(f&&i===e.target&&(s=f),s&&(n=Bs(s)),!1!==Qo(so,i,to,o,s,n,e,!!s))return R(),f&&f.nextSibling?i.insertBefore(to,f.nextSibling):i.appendChild(to),eo=i,j(),A(!0)}else if(f&&Ko(e,p,this)){var v=Ms(i,0,a,!0);if(v===to)return A(!1);if(n=Bs(s=v),!1!==Qo(so,i,to,o,s,n,e,!1))return R(),i.insertBefore(to,v),eo=i,j(),A(!0)}else if(s.parentNode===i){n=Bs(s);var y=0,b,w=to.parentNode!==i,x=!Ho(to.animated&&to.toRect||o,s.animated&&s.toRect||n,p),k=p?"top":"left",S=Ds(s,"top","top")||Ds(to,"top","top"),E=S?S.scrollTop:void 0,T;if(To!==s&&(b=n[k],Co=!1,Bo=!x&&a.invertSwap||w),0!==(y=tn(e,s,n,p,x?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,Bo,To===s))){var _=As(to);do{_-=y,T=eo.children[_]}while(T&&("none"===Es(T,"display")||T===io))}if(0===y||T===s)return A(!1);To=s,_o=y;var C=s.nextElementSibling,B=!1,D=Qo(so,i,to,o,s,n,e,B=1===y);if(!1!==D)return 1!==D&&-1!==D||(B=1===D),Ao=!0,setTimeout(Zo,30),R(),B&&!C?i.appendChild(to):s.parentNode.insertBefore(to,B?C:s),S&&Hs(S,0,E-S.scrollTop),eo=to.parentNode,void 0===b||Bo||(Do=Math.abs(b-Bs(s)[k])),j(),A(!0)}if(i.contains(to))return A(!1)}return!1}function M(t,a){Ks(t,m,es({evt:e,isOwner:c,axis:p?"vertical":"horizontal",revert:r,dragRect:o,targetRect:n,canSort:d,fromSortable:u,target:s,completed:A,onMove:function t(s,n){return Qo(so,i,to,o,s,Bs(s),e,n)},changed:j},a))}function R(){M("dragOverAnimationCapture"),m.captureAnimationState(),m!==u&&u.captureAnimationState()}function A(t){return M("dragOverCompleted",{insertion:t}),t&&(c?h._hideClone():h._showClone(m),m!==u&&(Ss(to,mo?mo.options.ghostClass:h.options.ghostClass,!1),Ss(to,a.ghostClass,!0)),mo!==m&&m!==Wo.active?mo=m:m===Wo.active&&mo&&(mo=null),u===m&&(m._ignoreWhileAnimating=s),m.animateAll((function(){M("dragOverAnimationComplete"),m._ignoreWhileAnimating=null})),m!==u&&(u.animateAll(),u._ignoreWhileAnimating=null)),(s===to&&!to.animated||s===i&&!s.animated)&&(To=null),a.dragoverBubble||e.rootEl||s===document||(to.parentNode[qs]._isOutsideThisEl(e.target),!t&&$o(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function j(){ho=As(to),uo=As(to,a.draggable),Js({sortable:m,name:"change",toEl:i,newIndex:ho,newDraggableIndex:uo,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function t(){vs(document,"mousemove",this._onTouchMove),vs(document,"touchmove",this._onTouchMove),vs(document,"pointermove",this._onTouchMove),vs(document,"dragover",$o),vs(document,"mousemove",$o),vs(document,"touchmove",$o)},_offUpEvents:function t(){var e=this.el.ownerDocument;vs(e,"mouseup",this._onDrop),vs(e,"touchend",this._onDrop),vs(e,"pointerup",this._onDrop),vs(e,"touchcancel",this._onDrop),vs(document,"selectstart",this)},_onDrop:function t(e){var i=this.el,s=this.options;ho=As(to),uo=As(to,s.draggable),Ks("drop",this,{evt:e}),eo=to&&to.parentNode,ho=As(to),uo=As(to,s.draggable),Wo.eventCanceled||(go=!1,Bo=!1,Co=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),rn(this.cloneId),rn(this._dragStartId),this.nativeDraggable&&(vs(document,"drop",this),vs(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),us&&Es(document.body,"user-select",""),Es(to,"transform",""),e&&(Eo&&(e.cancelable&&e.preventDefault(),!s.dropBubble&&e.stopPropagation()),io&&io.parentNode&&io.parentNode.removeChild(io),(so===eo||mo&&"clone"!==mo.lastPutMode)&&ro&&ro.parentNode&&ro.parentNode.removeChild(ro),to&&(this.nativeDraggable&&vs(to,"dragend",this),Yo(to),to.style["will-change"]="",Eo&&!go&&Ss(to,mo?mo.options.ghostClass:this.options.ghostClass,!1),Ss(to,this.options.chosenClass,!1),Js({sortable:this,name:"unchoose",toEl:eo,newIndex:null,newDraggableIndex:null,originalEvent:e}),so!==eo?(ho>=0&&(Js({rootEl:eo,name:"add",toEl:eo,fromEl:so,originalEvent:e}),Js({sortable:this,name:"remove",toEl:eo,originalEvent:e}),Js({rootEl:eo,name:"sort",toEl:eo,fromEl:so,originalEvent:e}),Js({sortable:this,name:"sort",toEl:eo,originalEvent:e})),mo&&mo.save()):ho!==lo&&ho>=0&&(Js({sortable:this,name:"update",toEl:eo,originalEvent:e}),Js({sortable:this,name:"sort",toEl:eo,originalEvent:e})),Wo.active&&(null!=ho&&-1!==ho||(ho=lo,uo=co),Js({sortable:this,name:"end",toEl:eo,originalEvent:e}),this.save())))),this._nulling()},_nulling:function t(){Ks("nulling",this),so=to=eo=io=oo=ro=no=ao=yo=bo=Eo=ho=uo=lo=co=To=_o=mo=po=Wo.dragged=Wo.ghost=Wo.clone=Wo.active=null,jo.forEach((function(t){t.checked=!0})),jo.length=wo=xo=0},handleEvent:function t(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":to&&(this._onDragOver(e),Xo(e));break;case"selectstart":e.preventDefault()}},toArray:function t(){for(var e=[],i,s=this.el.children,o=0,n=s.length,r=this.options;o<n;o++)ws(i=s[o],r.draggable,this.el,!1)&&e.push(i.getAttribute(r.dataIdAttr)||sn(i));return e},sort:function t(e,i){var s={},o=this.el;this.toArray().forEach((function(t,e){var i=o.children[e];ws(i,this.options.draggable,o,!1)&&(s[t]=i)}),this),i&&this.captureAnimationState(),e.forEach((function(t){s[t]&&(o.removeChild(s[t]),o.appendChild(s[t]))})),i&&this.animateAll()},save:function t(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function t(e,i){return ws(e,i||this.options.draggable,this.el,!1)},option:function t(e,i){var s=this.options;if(void 0===i)return s[e];var o=Qs.modifyOption(this,e,i);s[e]=void 0!==o?o:i,"group"===e&&Vo(s)},destroy:function t(){Ks("destroy",this);var e=this.el;e[qs]=null,vs(e,"mousedown",this._onTapStart),vs(e,"touchstart",this._onTapStart),vs(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(vs(e,"dragover",this),vs(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),vo.splice(vo.indexOf(this.el),1),this.el=e=null},_hideClone:function t(){if(!ao){if(Ks("hideClone",this),Wo.eventCanceled)return;Es(ro,"display","none"),this.options.removeCloneOnHide&&ro.parentNode&&ro.parentNode.removeChild(ro),ao=!0}},_showClone:function t(e){if("clone"===e.lastPutMode){if(ao){if(Ks("showClone",this),Wo.eventCanceled)return;to.parentNode!=so||this.options.group.revertClone?oo?so.insertBefore(ro,oo):so.appendChild(ro):so.insertBefore(ro,to),this.options.group.revertClone&&this.animate(to,ro),Es(ro,"display",""),ao=!1}}else this._hideClone()}},Lo&&fs(document,"touchmove",(function(t){(Wo.active||go)&&t.cancelable&&t.preventDefault()})),Wo.utils={on:fs,off:vs,css:Es,find:_s,is:function t(e,i){return!!ws(e,i,e,!1)},extend:Fs,throttle:Is,closest:ws,toggleClass:Ss,clone:zs,index:As,nextTick:nn,cancelNextTick:rn,detectDirection:No,getChild:Ms},Wo.get=function(t){return t[qs]},Wo.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach((function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Wo.utils=es(es({},Wo.utils),t.utils)),Qs.mount(t)}))},Wo.create=function(t,e){return new Wo(t,e)},Wo.version=as;var an=[],ln,hn,cn=!1,dn,un,pn,mn;function gn(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function t(e){var i=e.originalEvent;this.sortable.nativeDraggable?fs(document,"dragover",this._handleAutoScroll):this.options.supportPointer?fs(document,"pointermove",this._handleFallbackAutoScroll):i.touches?fs(document,"touchmove",this._handleFallbackAutoScroll):fs(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function t(e){var i=e.originalEvent;this.options.dragOverBubble||i.rootEl||this._handleAutoScroll(i)},drop:function t(){this.sortable.nativeDraggable?vs(document,"dragover",this._handleAutoScroll):(vs(document,"pointermove",this._handleFallbackAutoScroll),vs(document,"touchmove",this._handleFallbackAutoScroll),vs(document,"mousemove",this._handleFallbackAutoScroll)),vn(),fn(),Ns()},nulling:function t(){pn=hn=ln=cn=mn=dn=un=null,an.length=0},_handleFallbackAutoScroll:function t(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function t(e,i){var s=this,o=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,r=document.elementFromPoint(o,n);if(pn=e,i||this.options.forceAutoScrollFallback||cs||hs||us){yn(e,this.options,r,i);var a=Ps(r,!0);!cn||mn&&o===dn&&n===un||(mn&&vn(),mn=setInterval((function(){var t=Ps(document.elementFromPoint(o,n),!0);t!==a&&(a=t,fn()),yn(e,s.options,t,i)}),10),dn=o,un=n)}else{if(!this.options.bubbleScroll||Ps(r,!0)===Cs())return void fn();yn(e,this.options,Ps(r,!1),!1)}}},os(t,{pluginName:"scroll",initializeByDefault:!0})}function fn(){an.forEach((function(t){clearInterval(t.pid)})),an=[]}function vn(){clearInterval(mn)}var yn=Is((function(t,e,i,s){if(e.scroll){var o=(t.touches?t.touches[0]:t).clientX,n=(t.touches?t.touches[0]:t).clientY,r=e.scrollSensitivity,a=e.scrollSpeed,l=Cs(),h=!1,c;hn!==i&&(hn=i,fn(),ln=e.scroll,c=e.scrollFn,!0===ln&&(ln=Ps(i,!0)));var d=0,u=ln;do{var p=u,m=Bs(p),g=m.top,f=m.bottom,v=m.left,y=m.right,b=m.width,w=m.height,x=void 0,k=void 0,S=p.scrollWidth,E=p.scrollHeight,T=Es(p),_=p.scrollLeft,C=p.scrollTop;p===l?(x=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),k=w<E&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(x=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX),k=w<E&&("auto"===T.overflowY||"scroll"===T.overflowY));var B=x&&(Math.abs(y-o)<=r&&_+b<S)-(Math.abs(v-o)<=r&&!!_),D=k&&(Math.abs(f-n)<=r&&C+w<E)-(Math.abs(g-n)<=r&&!!C);if(!an[d])for(var M=0;M<=d;M++)an[M]||(an[M]={});an[d].vx==B&&an[d].vy==D&&an[d].el===p||(an[d].el=p,an[d].vx=B,an[d].vy=D,clearInterval(an[d].pid),0==B&&0==D||(h=!0,an[d].pid=setInterval(function(){s&&0===this.layer&&Wo.active._onTouchMove(pn);var e=an[this.layer].vy?an[this.layer].vy*a:0,i=an[this.layer].vx?an[this.layer].vx*a:0;"function"==typeof c&&"continue"!==c.call(Wo.dragged.parentNode[qs],i,e,t,pn,an[this.layer].el)||Hs(an[this.layer].el,i,e)}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&u!==l&&(u=Ps(u,!1)));cn=h}}),30),bn=function t(e){var i=e.originalEvent,s=e.putSortable,o=e.dragEl,n=e.activeSortable,r=e.dispatchSortableEvent,a=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(i){var h=s||n;a();var c=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,d=document.elementFromPoint(c.clientX,c.clientY);l(),h&&!h.el.contains(d)&&(r("spill"),this.onSpill({dragEl:o,putSortable:s}))}};function wn(){}function xn(){}wn.prototype={startIndex:null,dragStart:function t(e){var i=e.oldDraggableIndex;this.startIndex=i},onSpill:function t(e){var i=e.dragEl,s=e.putSortable;this.sortable.captureAnimationState(),s&&s.captureAnimationState();var o=Ms(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(i,o):this.sortable.el.appendChild(i),this.sortable.animateAll(),s&&s.animateAll()},drop:bn},os(wn,{pluginName:"revertOnSpill"}),xn.prototype={onSpill:function t(e){var i=e.dragEl,s,o=e.putSortable||this.sortable;o.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),o.animateAll()},drop:bn},os(xn,{pluginName:"removeOnSpill"}),Wo.mount(new gn),Wo.mount(xn,wn);const kn=jQuery;class Sn extends ce{constructor(t,e,i){super(t,e,i),this.searchType=t.searchType||"fulltext",this.mediaUploader=i.mediaUploader,this.typeLabel="Images",this.button_text=t.button_text||"Browse...",this.db_type="text",this.label=t.label||"Images",this.name=t.name||"images",this.images=this.value||[],this.value=JSON.stringify(this.value)}init(){super.init(),this.redrawImages()}setDomElements(){super.setDomElements()}getData(){return this.updateData(),{name:this.name,value:this.images}}getSchema(){const t=super.getSchema();return t.button_text=this.button_text,t}updateData(){const t=[];kn(this.domElements.main).find(".mapsvg-thumbnail-wrap").each((function(e,i){const s=kn(i).data("image");t.push(s)})),this.images=t,this.value=JSON.stringify(this.images),kn(this.domElements.main).find("input").val(this.value)}setEventHandlers(){if(super.setEventHandlers(),this.formBuilder.editMode)return;const t=this,e=kn(this.domElements.main).find(".mapsvg-data-images");this.external.mediaUploader.on("select",(()=>{if(t.formBuilder.mediaUploaderisOpenedFor!==t)return!1;const e=undefined;t.external.mediaUploader.state().get("selection").toJSON().forEach((function(e){const i={sizes:{}};for(const t in e.sizes)i[t]=e.sizes[t].url.replace("http://","//").replace("https://","//"),i.sizes[t]={width:e.sizes[t].width,height:e.sizes[t].height};i.thumbnail||(i.thumbnail=i.full,i.sizes.thumbnail={width:e.sizes.full.width,height:e.sizes.full.height}),i.medium||(i.medium=i.full,i.sizes.medium={width:e.sizes.full.width,height:e.sizes.full.height}),i.caption=e.caption,i.description=e.description,t.images.push(i)})),this.setValue(this.images),t.redrawImages()})),kn(t.domElements.main).on("click",".mapsvg-upload-image",(function(e){e.preventDefault(),t.formBuilder.mediaUploaderisOpenedFor=t,t.external.mediaUploader.open()})),kn(t.domElements.main).on("click",".mapsvg-image-delete",(function(e){e.preventDefault(),kn(this).closest(".mapsvg-thumbnail-wrap").remove(),t.updateData()})),t.sortable=new Wo(e[0],{animation:150,onStart:function(){kn(t.domElements.main).addClass("sorting")},onEnd:function(e){t.images=[],kn(t.domElements.main).find("img").each((function(e,i){t.images.push(kn(i).data("image"))})),this.value=JSON.stringify(t.images),kn(t.domElements.main).find("input").val(this.value),kn(t.domElements.main).removeClass("sorting")}})}redrawImages(){const t=kn(this.domElements.main).find(".mapsvg-data-images");t.empty(),this.images&&this.images.forEach((function(e){const i=kn('<img class="mapsvg-data-thumbnail" />').attr("src",e.thumbnail).data("image",e),s=kn('<div class="mapsvg-thumbnail-wrap"></div>').data("image",e);s.append(i),s.append('<i class="bi bi-x-lg  mapsvg-image-delete"></i>'),t.append(s)})),kn(this.domElements.main).find("input").val(this.value)}destroy(){super.destroy(),this.external.mediaUploader.off("select")}}var En={exports:{}},Tn={exports:{}},_n=Tn.exports,Cn;function Bn(){return Cn||(Cn=1,t=Tn,function(e,i){t.exports=e.document?i(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}}("undefined"!=typeof window?window:_n,(function(t,e){var i=[],s=Object.getPrototypeOf,o=i.slice,n=i.flat?function(t){return i.flat.call(t)}:function(t){return i.concat.apply([],t)},r=i.push,a=i.indexOf,l={},h=l.toString,c=l.hasOwnProperty,d=c.toString,u=d.call(Object),p={},m=function t(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},g=function t(e){return null!=e&&e===e.window},f=t.document,v={type:!0,src:!0,nonce:!0,noModule:!0};function y(t,e,i){var s,o,n=(i=i||f).createElement("script");if(n.text=t,e)for(s in v)(o=e[s]||e.getAttribute&&e.getAttribute(s))&&n.setAttribute(s,o);i.head.appendChild(n).parentNode.removeChild(n)}function b(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?l[h.call(t)]||"object":typeof t}var w="3.7.1",x=/HTML$/i,k=function(t,e){return new k.fn.init(t,e)};function S(t){var e=!!t&&"length"in t&&t.length,i=b(t);return!m(t)&&!g(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function E(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}k.fn=k.prototype={jquery:w,constructor:k,length:0,toArray:function(){return o.call(this)},get:function(t){return null==t?o.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=k.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return k.each(this,t)},map:function(t){return this.pushStack(k.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(k.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(k.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:r,sort:i.sort,splice:i.splice},k.extend=k.fn.extend=function(){var t,e,i,s,o,n,r=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof r&&(h=r,r=arguments[a]||{},a++),"object"==typeof r||m(r)||(r={}),a===l&&(r=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)s=t[e],"__proto__"!==e&&r!==s&&(h&&s&&(k.isPlainObject(s)||(o=Array.isArray(s)))?(i=r[e],n=o&&!Array.isArray(i)?[]:o||k.isPlainObject(i)?i:{},o=!1,r[e]=k.extend(h,n,s)):void 0!==s&&(r[e]=s));return r},k.extend({expando:"jQuery"+(w+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==h.call(t)||(e=s(t))&&("function"!=typeof(i=c.call(e,"constructor")&&e.constructor)||d.call(i)!==u))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,i){y(t,{nonce:e&&e.nonce},i)},each:function(t,e){var i,s=0;if(S(t))for(i=t.length;s<i&&!1!==e.call(t[s],s,t[s]);s++);else for(s in t)if(!1===e.call(t[s],s,t[s]))break;return t},text:function(t){var e,i="",s=0,o=t.nodeType;if(!o)for(;e=t[s++];)i+=k.text(e);return 1===o||11===o?t.textContent:9===o?t.documentElement.textContent:3===o||4===o?t.nodeValue:i},makeArray:function(t,e){var i=e||[];return null!=t&&(S(Object(t))?k.merge(i,"string"==typeof t?[t]:t):r.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:a.call(e,t,i)},isXMLDoc:function(t){var e=t&&t.namespaceURI,i=t&&(t.ownerDocument||t).documentElement;return!x.test(e||i&&i.nodeName||"HTML")},merge:function(t,e){for(var i=+e.length,s=0,o=t.length;s<i;s++)t[o++]=e[s];return t.length=o,t},grep:function(t,e,i){for(var s,o=[],n=0,r=t.length,a=!i;n<r;n++)(s=!e(t[n],n))!==a&&o.push(t[n]);return o},map:function(t,e,i){var s,o,r=0,a=[];if(S(t))for(s=t.length;r<s;r++)null!=(o=e(t[r],r,i))&&a.push(o);else for(r in t)null!=(o=e(t[r],r,i))&&a.push(o);return n(a)},guid:1,support:p}),"function"==typeof Symbol&&(k.fn[Symbol.iterator]=i[Symbol.iterator]),k.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){l["[object "+e+"]"]=e.toLowerCase()}));var T=i.pop,_=i.sort,C=i.splice,B="[\\x20\\t\\r\\n\\f]",D=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g");k.contains=function(t,e){var i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(t.contains?t.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))};var M=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function R(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}k.escapeSelector=function(t){return(t+"").replace(M,R)};var A=f,j=r;!function(){var e,s,n,r,l,h=j,d,u,m,g,f,v=k.expando,y=0,b=0,w=et(),x=et(),S=et(),M=et(),R=function(t,e){return t===e&&(l=!0),0},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="(?:\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",F="\\["+B+"*("+P+")(?:"+B+"*([*^$|!~]?=)"+B+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+P+"))|)"+B+"*\\]",O=":("+P+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",I=new RegExp(B+"+","g"),N=new RegExp("^"+B+"*,"+B+"*"),H=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),z=new RegExp(B+"|>"),V=new RegExp(O),q=new RegExp("^"+P+"$"),G={ID:new RegExp("^#("+P+")"),CLASS:new RegExp("^\\.("+P+")"),TAG:new RegExp("^("+P+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},$=/^(?:input|select|textarea|button)$/i,U=/^h\d$/i,W=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,Q=new RegExp("\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\([^\\r\\n\\f])","g"),Y=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},Z=function(){ht()},K=pt((function(t){return!0===t.disabled&&E(t,"fieldset")}),{dir:"parentNode",next:"legend"});function J(){try{return d.activeElement}catch(t){}}try{h.apply(i=o.call(A.childNodes),A.childNodes),i[A.childNodes.length].nodeType}catch(t){h={apply:function(t,e){j.apply(t,o.call(e))},call:function(t){j.apply(t,o.call(arguments,1))}}}function tt(t,e,i,s){var o,n,r,a,l,c,u,f=e&&e.ownerDocument,y=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==y&&9!==y&&11!==y)return i;if(!s&&(ht(e),e=e||d,m)){if(11!==y&&(l=W.exec(t)))if(o=l[1]){if(9===y){if(!(r=e.getElementById(o)))return i;if(r.id===o)return h.call(i,r),i}else if(f&&(r=f.getElementById(o))&&tt.contains(e,r)&&r.id===o)return h.call(i,r),i}else{if(l[2])return h.apply(i,e.getElementsByTagName(t)),i;if((o=l[3])&&e.getElementsByClassName)return h.apply(i,e.getElementsByClassName(o)),i}if(!(M[t+" "]||g&&g.test(t))){if(u=t,f=e,1===y&&(z.test(t)||H.test(t))){for((f=X.test(t)&&lt(e.parentNode)||e)==e&&p.scope||((a=e.getAttribute("id"))?a=k.escapeSelector(a):e.setAttribute("id",a=v)),n=(c=dt(t)).length;n--;)c[n]=(a?"#"+a:":scope")+" "+ut(c[n]);u=c.join(",")}try{return h.apply(i,f.querySelectorAll(u)),i}catch(e){M(t,!0)}finally{a===v&&e.removeAttribute("id")}}}return xt(t.replace(D,"$1"),e,i,s)}function et(){var t=[];function e(i,o){return t.push(i+" ")>s.cacheLength&&delete e[t.shift()],e[i+" "]=o}return e}function it(t){return t[v]=!0,t}function st(t){var e=d.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ot(t){return function(e){return E(e,"input")&&e.type===t}}function nt(t){return function(e){return(E(e,"input")||E(e,"button"))&&e.type===t}}function rt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&K(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function at(t){return it((function(e){return e=+e,it((function(i,s){for(var o,n=t([],i.length,e),r=n.length;r--;)i[o=n[r]]&&(i[o]=!(s[o]=i[o]))}))}))}function lt(t){return t&&void 0!==t.getElementsByTagName&&t}function ht(t){var e,i=t?t.ownerDocument||t:A;return i!=d&&9===i.nodeType&&i.documentElement?(u=(d=i).documentElement,m=!k.isXMLDoc(d),f=u.matches||u.webkitMatchesSelector||u.msMatchesSelector,u.msMatchesSelector&&A!=d&&(e=d.defaultView)&&e.top!==e&&e.addEventListener("unload",Z),p.getById=st((function(t){return u.appendChild(t).id=k.expando,!d.getElementsByName||!d.getElementsByName(k.expando).length})),p.disconnectedMatch=st((function(t){return f.call(t,"*")})),p.scope=st((function(){return d.querySelectorAll(":scope")})),p.cssHas=st((function(){try{return d.querySelector(":has(*,:jqfake)"),!1}catch(t){return!0}})),p.getById?(s.filter.ID=function(t){var e=t.replace(Q,Y);return function(t){return t.getAttribute("id")===e}},s.find.ID=function(t,e){if(void 0!==e.getElementById&&m){var i=e.getElementById(t);return i?[i]:[]}}):(s.filter.ID=function(t){var e=t.replace(Q,Y);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},s.find.ID=function(t,e){if(void 0!==e.getElementById&&m){var i,s,o,n=e.getElementById(t);if(n){if((i=n.getAttributeNode("id"))&&i.value===t)return[n];for(o=e.getElementsByName(t),s=0;n=o[s++];)if((i=n.getAttributeNode("id"))&&i.value===t)return[n]}return[]}}),s.find.TAG=function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):e.querySelectorAll(t)},s.find.CLASS=function(t,e){if(void 0!==e.getElementsByClassName&&m)return e.getElementsByClassName(t)},g=[],st((function(t){var e;u.appendChild(t).innerHTML="<a id='"+v+"' href='' disabled='disabled'></a><select id='"+v+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||g.push("\\["+B+"*(?:value|"+L+")"),t.querySelectorAll("[id~="+v+"-]").length||g.push("~="),t.querySelectorAll("a#"+v+"+*").length||g.push(".#.+[+~]"),t.querySelectorAll(":checked").length||g.push(":checked"),(e=d.createElement("input")).setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),u.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),(e=d.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||g.push("\\["+B+"*name"+B+"*="+B+"*(?:''|\"\")")})),p.cssHas||g.push(":has"),g=g.length&&new RegExp(g.join("|")),R=function(t,e){if(t===e)return l=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!p.sortDetached&&e.compareDocumentPosition(t)===i?t===d||t.ownerDocument==A&&tt.contains(A,t)?-1:e===d||e.ownerDocument==A&&tt.contains(A,e)?1:r?a.call(r,t)-a.call(r,e):0:4&i?-1:1)},d):d}for(e in tt.matches=function(t,e){return tt(t,null,null,e)},tt.matchesSelector=function(t,e){if(ht(t),m&&!M[e+" "]&&(!g||!g.test(e)))try{var i=f.call(t,e);if(i||p.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){M(e,!0)}return tt(e,d,null,[t]).length>0},tt.contains=function(t,e){return(t.ownerDocument||t)!=d&&ht(t),k.contains(t,e)},tt.attr=function(t,e){(t.ownerDocument||t)!=d&&ht(t);var i=s.attrHandle[e.toLowerCase()],o=i&&c.call(s.attrHandle,e.toLowerCase())?i(t,e,!m):void 0;return void 0!==o?o:t.getAttribute(e)},tt.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},k.uniqueSort=function(t){var e,i=[],s=0,n=0;if(l=!p.sortStable,r=!p.sortStable&&o.call(t,0),_.call(t,R),l){for(;e=t[n++];)e===t[n]&&(s=i.push(n));for(;s--;)C.call(t,i[s],1)}return r=null,t},k.fn.uniqueSort=function(){return this.pushStack(k.uniqueSort(o.apply(this)))},s=k.expr={cacheLength:50,createPseudo:it,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Q,Y),t[3]=(t[3]||t[4]||t[5]||"").replace(Q,Y),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||tt.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&tt.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return G.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&V.test(i)&&(e=dt(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Q,Y).toLowerCase();return"*"===t?function(){return!0}:function(t){return E(t,e)}},CLASS:function(t){var e=w[t+" "];return e||(e=new RegExp("(^|"+B+")"+t+"("+B+"|$)"))&&w(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(s){var o=tt.attr(s,t);return null==o?"!="===e:!e||(o+="","="===e?o===i:"!="===e?o!==i:"^="===e?i&&0===o.indexOf(i):"*="===e?i&&o.indexOf(i)>-1:"$="===e?i&&o.slice(-i.length)===i:"~="===e?(" "+o.replace(I," ")+" ").indexOf(i)>-1:"|="===e&&(o===i||o.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,s,o){var n="nth"!==t.slice(0,3),r="last"!==t.slice(-4),a="of-type"===e;return 1===s&&0===o?function(t){return!!t.parentNode}:function(e,i,l){var h,c,d,u,p,m=n!==r?"nextSibling":"previousSibling",g=e.parentNode,f=a&&e.nodeName.toLowerCase(),b=!l&&!a,w=!1;if(g){if(n){for(;m;){for(d=e;d=d[m];)if(a?E(d,f):1===d.nodeType)return!1;p=m="only"===t&&!p&&"nextSibling"}return!0}if(p=[r?g.firstChild:g.lastChild],r&&b){for(w=(u=(h=(c=g[v]||(g[v]={}))[t]||[])[0]===y&&h[1])&&h[2],d=u&&g.childNodes[u];d=++u&&d&&d[m]||(w=u=0)||p.pop();)if(1===d.nodeType&&++w&&d===e){c[t]=[y,u,w];break}}else if(b&&(w=u=(h=(c=e[v]||(e[v]={}))[t]||[])[0]===y&&h[1]),!1===w)for(;(d=++u&&d&&d[m]||(w=u=0)||p.pop())&&(!(a?E(d,f):1===d.nodeType)||!++w||(b&&((c=d[v]||(d[v]={}))[t]=[y,w]),d!==e)););return(w-=o)===s||w%s==0&&w/s>=0}}},PSEUDO:function(t,e){var i,o=s.pseudos[t]||s.setFilters[t.toLowerCase()]||tt.error("unsupported pseudo: "+t);return o[v]?o(e):o.length>1?(i=[t,t,"",e],s.setFilters.hasOwnProperty(t.toLowerCase())?it((function(t,i){for(var s,n=o(t,e),r=n.length;r--;)t[s=a.call(t,n[r])]=!(i[s]=n[r])})):function(t){return o(t,0,i)}):o}},pseudos:{not:it((function(t){var e=[],i=[],s=wt(t.replace(D,"$1"));return s[v]?it((function(t,e,i,o){for(var n,r=s(t,null,o,[]),a=t.length;a--;)(n=r[a])&&(t[a]=!(e[a]=n))})):function(t,o,n){return e[0]=t,s(e,null,n,i),e[0]=null,!i.pop()}})),has:it((function(t){return function(e){return tt(t,e).length>0}})),contains:it((function(t){return t=t.replace(Q,Y),function(e){return(e.textContent||k.text(e)).indexOf(t)>-1}})),lang:it((function(t){return q.test(t||"")||tt.error("unsupported lang: "+t),t=t.replace(Q,Y).toLowerCase(),function(e){var i;do{if(i=m?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===u},focus:function(t){return t===J()&&d.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:rt(!1),disabled:rt(!0),checked:function(t){return E(t,"input")&&!!t.checked||E(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!s.pseudos.empty(t)},header:function(t){return U.test(t.nodeName)},input:function(t){return $.test(t.nodeName)},button:function(t){return E(t,"input")&&"button"===t.type||E(t,"button")},text:function(t){var e;return E(t,"input")&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:at((function(){return[0]})),last:at((function(t,e){return[e-1]})),eq:at((function(t,e,i){return[i<0?i+e:i]})),even:at((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:at((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:at((function(t,e,i){var s;for(s=i<0?i+e:i>e?e:i;--s>=0;)t.push(s);return t})),gt:at((function(t,e,i){for(var s=i<0?i+e:i;++s<e;)t.push(s);return t}))}},s.pseudos.nth=s.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[e]=ot(e);for(e in{submit:!0,reset:!0})s.pseudos[e]=nt(e);function ct(){}function dt(t,e){var i,o,n,r,a,l,h,c=x[t+" "];if(c)return e?0:c.slice(0);for(a=t,l=[],h=s.preFilter;a;){for(r in i&&!(o=N.exec(a))||(o&&(a=a.slice(o[0].length)||a),l.push(n=[])),i=!1,(o=H.exec(a))&&(i=o.shift(),n.push({value:i,type:o[0].replace(D," ")}),a=a.slice(i.length)),s.filter)!(o=G[r].exec(a))||h[r]&&!(o=h[r](o))||(i=o.shift(),n.push({value:i,type:r,matches:o}),a=a.slice(i.length));if(!i)break}return e?a.length:a?tt.error(t):x(t,l).slice(0)}function ut(t){for(var e=0,i=t.length,s="";e<i;e++)s+=t[e].value;return s}function pt(t,e,i){var s=e.dir,o=e.next,n=o||s,r=i&&"parentNode"===n,a=b++;return e.first?function(e,i,o){for(;e=e[s];)if(1===e.nodeType||r)return t(e,i,o);return!1}:function(e,i,l){var h,c,d=[y,a];if(l){for(;e=e[s];)if((1===e.nodeType||r)&&t(e,i,l))return!0}else for(;e=e[s];)if(1===e.nodeType||r)if(c=e[v]||(e[v]={}),o&&E(e,o))e=e[s]||e;else{if((h=c[n])&&h[0]===y&&h[1]===a)return d[2]=h[2];if(c[n]=d,d[2]=t(e,i,l))return!0}return!1}}function mt(t){return t.length>1?function(e,i,s){for(var o=t.length;o--;)if(!t[o](e,i,s))return!1;return!0}:t[0]}function gt(t,e,i){for(var s=0,o=e.length;s<o;s++)tt(t,e[s],i);return i}function ft(t,e,i,s,o){for(var n,r=[],a=0,l=t.length,h=null!=e;a<l;a++)(n=t[a])&&(i&&!i(n,s,o)||(r.push(n),h&&e.push(a)));return r}function vt(t,e,i,s,o,n){return s&&!s[v]&&(s=vt(s)),o&&!o[v]&&(o=vt(o,n)),it((function(n,r,l,c){var d,u,p,m,g=[],f=[],v=r.length,y=n||gt(e||"*",l.nodeType?[l]:l,[]),b=!t||!n&&e?y:ft(y,g,t,l,c);if(i?i(b,m=o||(n?t:v||s)?[]:r,l,c):m=b,s)for(d=ft(m,f),s(d,[],l,c),u=d.length;u--;)(p=d[u])&&(m[f[u]]=!(b[f[u]]=p));if(n){if(o||t){if(o){for(d=[],u=m.length;u--;)(p=m[u])&&d.push(b[u]=p);o(null,m=[],d,c)}for(u=m.length;u--;)(p=m[u])&&(d=o?a.call(n,p):g[u])>-1&&(n[d]=!(r[d]=p))}}else m=ft(m===r?m.splice(v,m.length):m),o?o(null,r,m,c):h.apply(r,m)}))}function yt(t){for(var e,i,o,r=t.length,l=s.relative[t[0].type],h=l||s.relative[" "],c=l?1:0,d=pt((function(t){return t===e}),h,!0),u=pt((function(t){return a.call(e,t)>-1}),h,!0),p=[function(t,i,s){var o=!l&&(s||i!=n)||((e=i).nodeType?d(t,i,s):u(t,i,s));return e=null,o}];c<r;c++)if(i=s.relative[t[c].type])p=[pt(mt(p),i)];else{if((i=s.filter[t[c].type].apply(null,t[c].matches))[v]){for(o=++c;o<r&&!s.relative[t[o].type];o++);return vt(c>1&&mt(p),c>1&&ut(t.slice(0,c-1).concat({value:" "===t[c-2].type?"*":""})).replace(D,"$1"),i,c<o&&yt(t.slice(c,o)),o<r&&yt(t=t.slice(o)),o<r&&ut(t))}p.push(i)}return mt(p)}function bt(t,e){var i=e.length>0,o=t.length>0,r=function(r,a,l,c,u){var p,g,f,v=0,b="0",w=r&&[],x=[],S=n,E=r||o&&s.find.TAG("*",u),_=y+=null==S?1:Math.random()||.1,C=E.length;for(u&&(n=a==d||a||u);b!==C&&null!=(p=E[b]);b++){if(o&&p){for(g=0,a||p.ownerDocument==d||(ht(p),l=!m);f=t[g++];)if(f(p,a||d,l)){h.call(c,p);break}u&&(y=_)}i&&((p=!f&&p)&&v--,r&&w.push(p))}if(v+=b,i&&b!==v){for(g=0;f=e[g++];)f(w,x,a,l);if(r){if(v>0)for(;b--;)w[b]||x[b]||(x[b]=T.call(c));x=ft(x)}h.apply(c,x),u&&!r&&x.length>0&&v+e.length>1&&k.uniqueSort(c)}return u&&(y=_,n=S),w};return i?it(r):r}function wt(t,e){var i,s=[],o=[],n=S[t+" "];if(!n){for(e||(e=dt(t)),i=e.length;i--;)(n=yt(e[i]))[v]?s.push(n):o.push(n);(n=S(t,bt(o,s))).selector=t}return n}function xt(t,e,i,o){var n,r,a,l,c,d="function"==typeof t&&t,u=!o&&dt(t=d.selector||t);if(i=i||[],1===u.length){if((r=u[0]=u[0].slice(0)).length>2&&"ID"===(a=r[0]).type&&9===e.nodeType&&m&&s.relative[r[1].type]){if(!(e=(s.find.ID(a.matches[0].replace(Q,Y),e)||[])[0]))return i;d&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(n=G.needsContext.test(t)?0:r.length;n--&&(a=r[n],!s.relative[l=a.type]);)if((c=s.find[l])&&(o=c(a.matches[0].replace(Q,Y),X.test(r[0].type)&&lt(e.parentNode)||e))){if(r.splice(n,1),!(t=o.length&&ut(r)))return h.apply(i,o),i;break}}return(d||wt(t,u))(o,e,!m,i,!e||X.test(t)&&lt(e.parentNode)||e),i}ct.prototype=s.filters=s.pseudos,s.setFilters=new ct,p.sortStable=v.split("").sort(R).join("")===v,ht(),p.sortDetached=st((function(t){return 1&t.compareDocumentPosition(d.createElement("fieldset"))})),k.find=tt,k.expr[":"]=k.expr.pseudos,k.unique=k.uniqueSort,tt.compile=wt,tt.select=xt,tt.setDocument=ht,tt.tokenize=dt,tt.escape=k.escapeSelector,tt.getText=k.text,tt.isXML=k.isXMLDoc,tt.selectors=k.expr,tt.support=k.support,tt.uniqueSort=k.uniqueSort}();var L=function(t,e,i){for(var s=[],o=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&k(t).is(i))break;s.push(t)}return s},P=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},F=k.expr.match.needsContext,O=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function I(t,e,i){return m(e)?k.grep(t,(function(t,s){return!!e.call(t,s,t)!==i})):e.nodeType?k.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?k.grep(t,(function(t){return a.call(e,t)>-1!==i})):k.filter(e,t,i)}k.filter=function(t,e,i){var s=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===s.nodeType?k.find.matchesSelector(s,t)?[s]:[]:k.find.matches(t,k.grep(e,(function(t){return 1===t.nodeType})))},k.fn.extend({find:function(t){var e,i,s=this.length,o=this;if("string"!=typeof t)return this.pushStack(k(t).filter((function(){for(e=0;e<s;e++)if(k.contains(o[e],this))return!0})));for(i=this.pushStack([]),e=0;e<s;e++)k.find(t,o[e],i);return s>1?k.uniqueSort(i):i},filter:function(t){return this.pushStack(I(this,t||[],!1))},not:function(t){return this.pushStack(I(this,t||[],!0))},is:function(t){return!!I(this,"string"==typeof t&&F.test(t)?k(t):t||[],!1).length}});var N,H=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,z;(k.fn.init=function(t,e,i){var s,o;if(!t)return this;if(i=i||N,"string"==typeof t){if(!(s="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:H.exec(t))||!s[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(s[1]){if(e=e instanceof k?e[0]:e,k.merge(this,k.parseHTML(s[1],e&&e.nodeType?e.ownerDocument||e:f,!0)),O.test(s[1])&&k.isPlainObject(e))for(s in e)m(this[s])?this[s](e[s]):this.attr(s,e[s]);return this}return(o=f.getElementById(s[2]))&&(this[0]=o,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):m(t)?void 0!==i.ready?i.ready(t):t(k):k.makeArray(t,this)}).prototype=k.fn,N=k(f);var V=/^(?:parents|prev(?:Until|All))/,q={children:!0,contents:!0,next:!0,prev:!0};function G(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}k.fn.extend({has:function(t){var e=k(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(k.contains(this,e[t]))return!0}))},closest:function(t,e){var i,s=0,o=this.length,n=[],r="string"!=typeof t&&k(t);if(!F.test(t))for(;s<o;s++)for(i=this[s];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(r?r.index(i)>-1:1===i.nodeType&&k.find.matchesSelector(i,t))){n.push(i);break}return this.pushStack(n.length>1?k.uniqueSort(n):n)},index:function(t){return t?"string"==typeof t?a.call(k(t),this[0]):a.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(k.uniqueSort(k.merge(this.get(),k(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),k.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return L(t,"parentNode")},parentsUntil:function(t,e,i){return L(t,"parentNode",i)},next:function(t){return G(t,"nextSibling")},prev:function(t){return G(t,"previousSibling")},nextAll:function(t){return L(t,"nextSibling")},prevAll:function(t){return L(t,"previousSibling")},nextUntil:function(t,e,i){return L(t,"nextSibling",i)},prevUntil:function(t,e,i){return L(t,"previousSibling",i)},siblings:function(t){return P((t.parentNode||{}).firstChild,t)},children:function(t){return P(t.firstChild)},contents:function(t){return null!=t.contentDocument&&s(t.contentDocument)?t.contentDocument:(E(t,"template")&&(t=t.content||t),k.merge([],t.childNodes))}},(function(t,e){k.fn[t]=function(i,s){var o=k.map(this,e,i);return"Until"!==t.slice(-5)&&(s=i),s&&"string"==typeof s&&(o=k.filter(s,o)),this.length>1&&(q[t]||k.uniqueSort(o),V.test(t)&&o.reverse()),this.pushStack(o)}}));var $=/[^\x20\t\r\n\f]+/g;function U(t){var e={};return k.each(t.match($)||[],(function(t,i){e[i]=!0})),e}function W(t){return t}function X(t){throw t}function Q(t,e,i,s){var o;try{t&&m(o=t.promise)?o.call(t).done(e).fail(i):t&&m(o=t.then)?o.call(t,e,i):e.apply(void 0,[t].slice(s))}catch(t){i.apply(void 0,[t])}}k.Callbacks=function(t){t="string"==typeof t?U(t):k.extend({},t);var e,i,s,o,n=[],r=[],a=-1,l=function(){for(o=o||t.once,s=e=!0;r.length;a=-1)for(i=r.shift();++a<n.length;)!1===n[a].apply(i[0],i[1])&&t.stopOnFalse&&(a=n.length,i=!1);t.memory||(i=!1),e=!1,o&&(n=i?[]:"")},h={add:function(){return n&&(i&&!e&&(a=n.length-1,r.push(i)),function e(i){k.each(i,(function(i,s){m(s)?t.unique&&h.has(s)||n.push(s):s&&s.length&&"string"!==b(s)&&e(s)}))}(arguments),i&&!e&&l()),this},remove:function(){return k.each(arguments,(function(t,e){for(var i;(i=k.inArray(e,n,i))>-1;)n.splice(i,1),i<=a&&a--})),this},has:function(t){return t?k.inArray(t,n)>-1:n.length>0},empty:function(){return n&&(n=[]),this},disable:function(){return o=r=[],n=i="",this},disabled:function(){return!n},lock:function(){return o=r=[],i||e||(n=i=""),this},locked:function(){return!!o},fireWith:function(t,i){return o||(i=[t,(i=i||[]).slice?i.slice():i],r.push(i),e||l()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!s}};return h},k.extend({Deferred:function(e){var i=[["notify","progress",k.Callbacks("memory"),k.Callbacks("memory"),2],["resolve","done",k.Callbacks("once memory"),k.Callbacks("once memory"),0,"resolved"],["reject","fail",k.Callbacks("once memory"),k.Callbacks("once memory"),1,"rejected"]],s="pending",o={state:function(){return s},always:function(){return n.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var t=arguments;return k.Deferred((function(e){k.each(i,(function(i,s){var o=m(t[s[4]])&&t[s[4]];n[s[1]]((function(){var t=o&&o.apply(this,arguments);t&&m(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[s[0]+"With"](this,o?[t]:arguments)}))})),t=null})).promise()},then:function(e,s,o){var n=0;function r(e,i,s,o){return function(){var a=this,l=arguments,h=function(){var t,h;if(!(e<n)){if((t=s.apply(a,l))===i.promise())throw new TypeError("Thenable self-resolution");h=t&&("object"==typeof t||"function"==typeof t)&&t.then,m(h)?o?h.call(t,r(n,i,W,o),r(n,i,X,o)):(n++,h.call(t,r(n,i,W,o),r(n,i,X,o),r(n,i,W,i.notifyWith))):(s!==W&&(a=void 0,l=[t]),(o||i.resolveWith)(a,l))}},c=o?h:function(){try{h()}catch(t){k.Deferred.exceptionHook&&k.Deferred.exceptionHook(t,c.error),e+1>=n&&(s!==X&&(a=void 0,l=[t]),i.rejectWith(a,l))}};e?c():(k.Deferred.getErrorHook?c.error=k.Deferred.getErrorHook():k.Deferred.getStackHook&&(c.error=k.Deferred.getStackHook()),t.setTimeout(c))}}return k.Deferred((function(t){i[0][3].add(r(0,t,m(o)?o:W,t.notifyWith)),i[1][3].add(r(0,t,m(e)?e:W)),i[2][3].add(r(0,t,m(s)?s:X))})).promise()},promise:function(t){return null!=t?k.extend(t,o):o}},n={};return k.each(i,(function(t,e){var r=e[2],a=e[5];o[e[1]]=r.add,a&&r.add((function(){s=a}),i[3-t][2].disable,i[3-t][3].disable,i[0][2].lock,i[0][3].lock),r.add(e[3].fire),n[e[0]]=function(){return n[e[0]+"With"](this===n?void 0:this,arguments),this},n[e[0]+"With"]=r.fireWith})),o.promise(n),e&&e.call(n,n),n},when:function(t){var e=arguments.length,i=e,s=Array(i),n=o.call(arguments),r=k.Deferred(),a=function(t){return function(i){s[t]=this,n[t]=arguments.length>1?o.call(arguments):i,--e||r.resolveWith(s,n)}};if(e<=1&&(Q(t,r.done(a(i)).resolve,r.reject,!e),"pending"===r.state()||m(n[i]&&n[i].then)))return r.then();for(;i--;)Q(n[i],a(i),r.reject);return r.promise()}});var Y=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;k.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&Y.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},k.readyException=function(e){t.setTimeout((function(){throw e}))};var Z=k.Deferred();function K(){f.removeEventListener("DOMContentLoaded",K),t.removeEventListener("load",K),k.ready()}k.fn.ready=function(t){return Z.then(t).catch((function(t){k.readyException(t)})),this},k.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--k.readyWait:k.isReady)||(k.isReady=!0,!0!==t&&--k.readyWait>0||Z.resolveWith(f,[k]))}}),k.ready.then=Z.then,"complete"===f.readyState||"loading"!==f.readyState&&!f.documentElement.doScroll?t.setTimeout(k.ready):(f.addEventListener("DOMContentLoaded",K),t.addEventListener("load",K));var J=function(t,e,i,s,o,n,r){var a=0,l=t.length,h=null==i;if("object"===b(i))for(a in o=!0,i)J(t,e,a,i[a],!0,n,r);else if(void 0!==s&&(o=!0,m(s)||(r=!0),h&&(r?(e.call(t,s),e=null):(h=e,e=function(t,e,i){return h.call(k(t),i)})),e))for(;a<l;a++)e(t[a],i,r?s:s.call(t[a],a,e(t[a],i)));return o?t:h?e.call(t):l?e(t[0],i):n},tt=/^-ms-/,et=/-([a-z])/g;function it(t,e){return e.toUpperCase()}function st(t){return t.replace(tt,"ms-").replace(et,it)}var ot=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function nt(){this.expando=k.expando+nt.uid++}nt.uid=1,nt.prototype={cache:function(t){var e=t[this.expando];return e||(e={},ot(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var s,o=this.cache(t);if("string"==typeof e)o[st(e)]=i;else for(s in e)o[st(s)]=e[s];return o},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][st(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,s=t[this.expando];if(void 0!==s){if(void 0!==e){i=(e=Array.isArray(e)?e.map(st):(e=st(e))in s?[e]:e.match($)||[]).length;for(;i--;)delete s[e[i]]}(void 0===e||k.isEmptyObject(s))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!k.isEmptyObject(e)}};var rt=new nt,at=new nt,lt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ht=/[A-Z]/g;function ct(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:lt.test(t)?JSON.parse(t):t)}function dt(t,e,i){var s;if(void 0===i&&1===t.nodeType)if(s="data-"+e.replace(ht,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(s))){try{i=ct(i)}catch(t){}at.set(t,e,i)}else i=void 0;return i}k.extend({hasData:function(t){return at.hasData(t)||rt.hasData(t)},data:function(t,e,i){return at.access(t,e,i)},removeData:function(t,e){at.remove(t,e)},_data:function(t,e,i){return rt.access(t,e,i)},_removeData:function(t,e){rt.remove(t,e)}}),k.fn.extend({data:function(t,e){var i,s,o,n=this[0],r=n&&n.attributes;if(void 0===t){if(this.length&&(o=at.get(n),1===n.nodeType&&!rt.get(n,"hasDataAttrs"))){for(i=r.length;i--;)r[i]&&0===(s=r[i].name).indexOf("data-")&&(s=st(s.slice(5)),dt(n,s,o[s]));rt.set(n,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each((function(){at.set(this,t)})):J(this,(function(e){var i;if(n&&void 0===e)return void 0!==(i=at.get(n,t))||void 0!==(i=dt(n,t))?i:void 0;this.each((function(){at.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){at.remove(this,t)}))}}),k.extend({queue:function(t,e,i){var s;if(t)return e=(e||"fx")+"queue",s=rt.get(t,e),i&&(!s||Array.isArray(i)?s=rt.access(t,e,k.makeArray(i)):s.push(i)),s||[]},dequeue:function(t,e){e=e||"fx";var i=k.queue(t,e),s=i.length,o=i.shift(),n=k._queueHooks(t,e),r=function(){k.dequeue(t,e)};"inprogress"===o&&(o=i.shift(),s--),o&&("fx"===e&&i.unshift("inprogress"),delete n.stop,o.call(t,r,n)),!s&&n&&n.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return rt.get(t,i)||rt.access(t,i,{empty:k.Callbacks("once memory").add((function(){rt.remove(t,[e+"queue",i])}))})}}),k.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?k.queue(this[0],t):void 0===e?this:this.each((function(){var i=k.queue(this,t,e);k._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&k.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){k.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,s=1,o=k.Deferred(),n=this,r=this.length,a=function(){--s||o.resolveWith(n,[n])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";r--;)(i=rt.get(n[r],t+"queueHooks"))&&i.empty&&(s++,i.empty.add(a));return a(),o.promise(e)}});var ut=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pt=new RegExp("^(?:([+-])=|)("+ut+")([a-z%]*)$","i"),mt=["Top","Right","Bottom","Left"],gt=f.documentElement,ft=function(t){return k.contains(t.ownerDocument,t)},vt={composed:!0};gt.getRootNode&&(ft=function(t){return k.contains(t.ownerDocument,t)||t.getRootNode(vt)===t.ownerDocument});var yt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&ft(t)&&"none"===k.css(t,"display")};function bt(t,e,i,s){var o,n,r=20,a=s?function(){return s.cur()}:function(){return k.css(t,e,"")},l=a(),h=i&&i[3]||(k.cssNumber[e]?"":"px"),c=t.nodeType&&(k.cssNumber[e]||"px"!==h&&+l)&&pt.exec(k.css(t,e));if(c&&c[3]!==h){for(l/=2,h=h||c[3],c=+l||1;r--;)k.style(t,e,c+h),(1-n)*(1-(n=a()/l||.5))<=0&&(r=0),c/=n;c*=2,k.style(t,e,c+h),i=i||[]}return i&&(c=+c||+l||0,o=i[1]?c+(i[1]+1)*i[2]:+i[2],s&&(s.unit=h,s.start=c,s.end=o)),o}var wt={};function xt(t){var e,i=t.ownerDocument,s=t.nodeName,o=wt[s];return o||(e=i.body.appendChild(i.createElement(s)),o=k.css(e,"display"),e.parentNode.removeChild(e),"none"===o&&(o="block"),wt[s]=o,o)}function kt(t,e){for(var i,s,o=[],n=0,r=t.length;n<r;n++)(s=t[n]).style&&(i=s.style.display,e?("none"===i&&(o[n]=rt.get(s,"display")||null,o[n]||(s.style.display="")),""===s.style.display&&yt(s)&&(o[n]=xt(s))):"none"!==i&&(o[n]="none",rt.set(s,"display",i)));for(n=0;n<r;n++)null!=o[n]&&(t[n].style.display=o[n]);return t}k.fn.extend({show:function(){return kt(this,!0)},hide:function(){return kt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){yt(this)?k(this).show():k(this).hide()}))}});var St=/^(?:checkbox|radio)$/i,Et=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Tt=/^$|^module$|\/(?:java|ecma)script/i,_t,Ct,Bt;Ct=f.createDocumentFragment().appendChild(f.createElement("div")),(Bt=f.createElement("input")).setAttribute("type","radio"),Bt.setAttribute("checked","checked"),Bt.setAttribute("name","t"),Ct.appendChild(Bt),p.checkClone=Ct.cloneNode(!0).cloneNode(!0).lastChild.checked,Ct.innerHTML="<textarea>x</textarea>",p.noCloneChecked=!!Ct.cloneNode(!0).lastChild.defaultValue,Ct.innerHTML="<option></option>",p.option=!!Ct.lastChild;var Dt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Mt(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&E(t,e)?k.merge([t],i):i}function Rt(t,e){for(var i=0,s=t.length;i<s;i++)rt.set(t[i],"globalEval",!e||rt.get(e[i],"globalEval"))}Dt.tbody=Dt.tfoot=Dt.colgroup=Dt.caption=Dt.thead,Dt.th=Dt.td,p.option||(Dt.optgroup=Dt.option=[1,"<select multiple='multiple'>","</select>"]);var At=/<|&#?\w+;/;function jt(t,e,i,s,o){for(var n,r,a,l,h,c,d=e.createDocumentFragment(),u=[],p=0,m=t.length;p<m;p++)if((n=t[p])||0===n)if("object"===b(n))k.merge(u,n.nodeType?[n]:n);else if(At.test(n)){for(r=r||d.appendChild(e.createElement("div")),a=(Et.exec(n)||["",""])[1].toLowerCase(),l=Dt[a]||Dt._default,r.innerHTML=l[1]+k.htmlPrefilter(n)+l[2],c=l[0];c--;)r=r.lastChild;k.merge(u,r.childNodes),(r=d.firstChild).textContent=""}else u.push(e.createTextNode(n));for(d.textContent="",p=0;n=u[p++];)if(s&&k.inArray(n,s)>-1)o&&o.push(n);else if(h=ft(n),r=Mt(d.appendChild(n),"script"),h&&Rt(r),i)for(c=0;n=r[c++];)Tt.test(n.type||"")&&i.push(n);return d}var Lt=/^([^.]*)(?:\.(.+)|)/;function Pt(){return!0}function Ft(){return!1}function Ot(t,e,i,s,o,n){var r,a;if("object"==typeof e){for(a in"string"!=typeof i&&(s=s||i,i=void 0),e)Ot(t,a,i,s,e[a],n);return t}if(null==s&&null==o?(o=i,s=i=void 0):null==o&&("string"==typeof i?(o=s,s=void 0):(o=s,s=i,i=void 0)),!1===o)o=Ft;else if(!o)return t;return 1===n&&(r=o,o=function(t){return k().off(t),r.apply(this,arguments)},o.guid=r.guid||(r.guid=k.guid++)),t.each((function(){k.event.add(this,e,o,s,i)}))}function It(t,e,i){i?(rt.set(t,e,!1),k.event.add(t,e,{namespace:!1,handler:function(t){var i,s=rt.get(this,e);if(1&t.isTrigger&&this[e]){if(s)(k.event.special[e]||{}).delegateType&&t.stopPropagation();else if(s=o.call(arguments),rt.set(this,e,s),this[e](),i=rt.get(this,e),rt.set(this,e,!1),s!==i)return t.stopImmediatePropagation(),t.preventDefault(),i}else s&&(rt.set(this,e,k.event.trigger(s[0],s.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=Pt)}})):void 0===rt.get(t,e)&&k.event.add(t,e,Pt)}k.event={global:{},add:function(t,e,i,s,o){var n,r,a,l,h,c,d,u,p,m,g,f=rt.get(t);if(ot(t))for(i.handler&&(i=(n=i).handler,o=n.selector),o&&k.find.matchesSelector(gt,o),i.guid||(i.guid=k.guid++),(l=f.events)||(l=f.events=Object.create(null)),(r=f.handle)||(r=f.handle=function(e){return void 0!==k&&k.event.triggered!==e.type?k.event.dispatch.apply(t,arguments):void 0}),h=(e=(e||"").match($)||[""]).length;h--;)p=g=(a=Lt.exec(e[h])||[])[1],m=(a[2]||"").split(".").sort(),p&&(d=k.event.special[p]||{},p=(o?d.delegateType:d.bindType)||p,d=k.event.special[p]||{},c=k.extend({type:p,origType:g,data:s,handler:i,guid:i.guid,selector:o,needsContext:o&&k.expr.match.needsContext.test(o),namespace:m.join(".")},n),(u=l[p])||((u=l[p]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(t,s,m,r)||t.addEventListener&&t.addEventListener(p,r)),d.add&&(d.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),o?u.splice(u.delegateCount++,0,c):u.push(c),k.event.global[p]=!0)},remove:function(t,e,i,s,o){var n,r,a,l,h,c,d,u,p,m,g,f=rt.hasData(t)&&rt.get(t);if(f&&(l=f.events)){for(h=(e=(e||"").match($)||[""]).length;h--;)if(p=g=(a=Lt.exec(e[h])||[])[1],m=(a[2]||"").split(".").sort(),p){for(d=k.event.special[p]||{},u=l[p=(s?d.delegateType:d.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),r=n=u.length;n--;)c=u[n],!o&&g!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||s&&s!==c.selector&&("**"!==s||!c.selector)||(u.splice(n,1),c.selector&&u.delegateCount--,d.remove&&d.remove.call(t,c));r&&!u.length&&(d.teardown&&!1!==d.teardown.call(t,m,f.handle)||k.removeEvent(t,p,f.handle),delete l[p])}else for(p in l)k.event.remove(t,p+e[h],i,s,!0);k.isEmptyObject(l)&&rt.remove(t,"handle events")}},dispatch:function(t){var e,i,s,o,n,r,a=new Array(arguments.length),l=k.event.fix(t),h=(rt.get(this,"events")||Object.create(null))[l.type]||[],c=k.event.special[l.type]||{};for(a[0]=l,e=1;e<arguments.length;e++)a[e]=arguments[e];if(l.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,l)){for(r=k.event.handlers.call(this,l,h),e=0;(o=r[e++])&&!l.isPropagationStopped();)for(l.currentTarget=o.elem,i=0;(n=o.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==n.namespace&&!l.rnamespace.test(n.namespace)||(l.handleObj=n,l.data=n.data,void 0!==(s=((k.event.special[n.origType]||{}).handle||n.handler).apply(o.elem,a))&&!1===(l.result=s)&&(l.preventDefault(),l.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,l),l.result}},handlers:function(t,e){var i,s,o,n,r,a=[],l=e.delegateCount,h=t.target;if(l&&h.nodeType&&!("click"===t.type&&t.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==t.type||!0!==h.disabled)){for(n=[],r={},i=0;i<l;i++)void 0===r[o=(s=e[i]).selector+" "]&&(r[o]=s.needsContext?k(o,this).index(h)>-1:k.find(o,this,null,[h]).length),r[o]&&n.push(s);n.length&&a.push({elem:h,handlers:n})}return h=this,l<e.length&&a.push({elem:h,handlers:e.slice(l)}),a},addProp:function(t,e){Object.defineProperty(k.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[k.expando]?t:new k.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return St.test(e.type)&&e.click&&E(e,"input")&&It(e,"click",!0),!1},trigger:function(t){var e=this||t;return St.test(e.type)&&e.click&&E(e,"input")&&It(e,"click"),!0},_default:function(t){var e=t.target;return St.test(e.type)&&e.click&&E(e,"input")&&rt.get(e,"click")||E(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},k.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},k.Event=function(t,e){if(!(this instanceof k.Event))return new k.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Pt:Ft,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&k.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[k.expando]=!0},k.Event.prototype={constructor:k.Event,isDefaultPrevented:Ft,isPropagationStopped:Ft,isImmediatePropagationStopped:Ft,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Pt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Pt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Pt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},k.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},k.event.addProp),k.each({focus:"focusin",blur:"focusout"},(function(t,e){function i(t){if(f.documentMode){var i=rt.get(this,"handle"),s=k.event.fix(t);s.type="focusin"===t.type?"focus":"blur",s.isSimulated=!0,i(t),s.target===s.currentTarget&&i(s)}else k.event.simulate(e,t.target,k.event.fix(t))}k.event.special[t]={setup:function(){var s;if(It(this,t,!0),!f.documentMode)return!1;(s=rt.get(this,e))||this.addEventListener(e,i),rt.set(this,e,(s||0)+1)},trigger:function(){return It(this,t),!0},teardown:function(){var t;if(!f.documentMode)return!1;(t=rt.get(this,e)-1)?rt.set(this,e,t):(this.removeEventListener(e,i),rt.remove(this,e))},_default:function(e){return rt.get(e.target,t)},delegateType:e},k.event.special[e]={setup:function(){var s=this.ownerDocument||this.document||this,o=f.documentMode?this:s,n=rt.get(o,e);n||(f.documentMode?this.addEventListener(e,i):s.addEventListener(t,i,!0)),rt.set(o,e,(n||0)+1)},teardown:function(){var s=this.ownerDocument||this.document||this,o=f.documentMode?this:s,n=rt.get(o,e)-1;n?rt.set(o,e,n):(f.documentMode?this.removeEventListener(e,i):s.removeEventListener(t,i,!0),rt.remove(o,e))}}})),k.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){k.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,s=this,o=t.relatedTarget,n=t.handleObj;return o&&(o===s||k.contains(s,o))||(t.type=n.origType,i=n.handler.apply(this,arguments),t.type=e),i}}})),k.fn.extend({on:function(t,e,i,s){return Ot(this,t,e,i,s)},one:function(t,e,i,s){return Ot(this,t,e,i,s,1)},off:function(t,e,i){var s,o;if(t&&t.preventDefault&&t.handleObj)return s=t.handleObj,k(t.delegateTarget).off(s.namespace?s.origType+"."+s.namespace:s.origType,s.selector,s.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=Ft),this.each((function(){k.event.remove(this,t,i,e)}))}});var Nt=/<script|<style|<link/i,Ht=/checked\s*(?:[^=]|=\s*.checked.)/i,zt=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Vt(t,e){return E(t,"table")&&E(11!==e.nodeType?e:e.firstChild,"tr")&&k(t).children("tbody")[0]||t}function qt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Gt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function $t(t,e){var i,s,o,n,r,a,l;if(1===e.nodeType){if(rt.hasData(t)&&(l=(n=rt.get(t)).events))for(o in rt.remove(e,"handle events"),l)for(i=0,s=l[o].length;i<s;i++)k.event.add(e,o,l[o][i]);at.hasData(t)&&(r=at.access(t),a=k.extend({},r),at.set(e,a))}}function Ut(t,e){var i=e.nodeName.toLowerCase();"input"===i&&St.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function Wt(t,e,i,s){e=n(e);var o,r,a,l,h,c,d=0,u=t.length,g=u-1,f=e[0],v=m(f);if(v||u>1&&"string"==typeof f&&!p.checkClone&&Ht.test(f))return t.each((function(o){var n=t.eq(o);v&&(e[0]=f.call(this,o,n.html())),Wt(n,e,i,s)}));if(u&&(r=(o=jt(e,t[0].ownerDocument,!1,t,s)).firstChild,1===o.childNodes.length&&(o=r),r||s)){for(l=(a=k.map(Mt(o,"script"),qt)).length;d<u;d++)h=o,d!==g&&(h=k.clone(h,!0,!0),l&&k.merge(a,Mt(h,"script"))),i.call(t[d],h,d);if(l)for(c=a[a.length-1].ownerDocument,k.map(a,Gt),d=0;d<l;d++)h=a[d],Tt.test(h.type||"")&&!rt.access(h,"globalEval")&&k.contains(c,h)&&(h.src&&"module"!==(h.type||"").toLowerCase()?k._evalUrl&&!h.noModule&&k._evalUrl(h.src,{nonce:h.nonce||h.getAttribute("nonce")},c):y(h.textContent.replace(zt,""),h,c))}return t}function Xt(t,e,i){for(var s,o=e?k.filter(e,t):t,n=0;null!=(s=o[n]);n++)i||1!==s.nodeType||k.cleanData(Mt(s)),s.parentNode&&(i&&ft(s)&&Rt(Mt(s,"script")),s.parentNode.removeChild(s));return t}k.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var s,o,n,r,a=t.cloneNode(!0),l=ft(t);if(!(p.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||k.isXMLDoc(t)))for(r=Mt(a),s=0,o=(n=Mt(t)).length;s<o;s++)Ut(n[s],r[s]);if(e)if(i)for(n=n||Mt(t),r=r||Mt(a),s=0,o=n.length;s<o;s++)$t(n[s],r[s]);else $t(t,a);return(r=Mt(a,"script")).length>0&&Rt(r,!l&&Mt(t,"script")),a},cleanData:function(t){for(var e,i,s,o=k.event.special,n=0;void 0!==(i=t[n]);n++)if(ot(i)){if(e=i[rt.expando]){if(e.events)for(s in e.events)o[s]?k.event.remove(i,s):k.removeEvent(i,s,e.handle);i[rt.expando]=void 0}i[at.expando]&&(i[at.expando]=void 0)}}}),k.fn.extend({detach:function(t){return Xt(this,t,!0)},remove:function(t){return Xt(this,t)},text:function(t){return J(this,(function(t){return void 0===t?k.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Wt(this,arguments,(function(t){var e;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Vt(this,t).appendChild(t)}))},prepend:function(){return Wt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Vt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Wt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Wt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(k.cleanData(Mt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return k.clone(this,t,e)}))},html:function(t){return J(this,(function(t){var e=this[0]||{},i=0,s=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Nt.test(t)&&!Dt[(Et.exec(t)||["",""])[1].toLowerCase()]){t=k.htmlPrefilter(t);try{for(;i<s;i++)1===(e=this[i]||{}).nodeType&&(k.cleanData(Mt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Wt(this,arguments,(function(e){var i=this.parentNode;k.inArray(this,t)<0&&(k.cleanData(Mt(this)),i&&i.replaceChild(e,this))}),t)}}),k.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){k.fn[t]=function(t){for(var i,s=[],o=k(t),n=o.length-1,a=0;a<=n;a++)i=a===n?this:this.clone(!0),k(o[a])[e](i),r.apply(s,i.get());return this.pushStack(s)}}));var Qt=new RegExp("^("+ut+")(?!px)[a-z%]+$","i"),Yt=/^--/,Zt=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Kt=function(t,e,i){var s,o,n={};for(o in e)n[o]=t.style[o],t.style[o]=e[o];for(o in s=i.call(t),e)t.style[o]=n[o];return s},Jt=new RegExp(mt.join("|"),"i");function te(t,e,i){var s,o,n,r,a=Yt.test(e),l=t.style;return(i=i||Zt(t))&&(r=i.getPropertyValue(e)||i[e],a&&r&&(r=r.replace(D,"$1")||void 0),""!==r||ft(t)||(r=k.style(t,e)),!p.pixelBoxStyles()&&Qt.test(r)&&Jt.test(e)&&(s=l.width,o=l.minWidth,n=l.maxWidth,l.minWidth=l.maxWidth=l.width=r,r=i.width,l.width=s,l.minWidth=o,l.maxWidth=n)),void 0!==r?r+"":r}function ee(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function e(){if(c){h.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",gt.appendChild(h).appendChild(c);var e=t.getComputedStyle(c);s="1%"!==e.top,l=12===i(e.marginLeft),c.style.right="60%",r=36===i(e.right),o=36===i(e.width),c.style.position="absolute",n=12===i(c.offsetWidth/3),gt.removeChild(h),c=null}}function i(t){return Math.round(parseFloat(t))}var s,o,n,r,a,l,h=f.createElement("div"),c=f.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",p.clearCloneStyle="content-box"===c.style.backgroundClip,k.extend(p,{boxSizingReliable:function(){return e(),o},pixelBoxStyles:function(){return e(),r},pixelPosition:function(){return e(),s},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),n},reliableTrDimensions:function(){var e,i,s,o;return null==a&&(e=f.createElement("table"),i=f.createElement("tr"),s=f.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",i.style.cssText="box-sizing:content-box;border:1px solid",i.style.height="1px",s.style.height="9px",s.style.display="block",gt.appendChild(e).appendChild(i).appendChild(s),o=t.getComputedStyle(i),a=parseInt(o.height,10)+parseInt(o.borderTopWidth,10)+parseInt(o.borderBottomWidth,10)===i.offsetHeight,gt.removeChild(e)),a}}))}();var ie=["Webkit","Moz","ms"],se=f.createElement("div").style,oe={};function ne(t){for(var e=t[0].toUpperCase()+t.slice(1),i=ie.length;i--;)if((t=ie[i]+e)in se)return t}function re(t){var e=k.cssProps[t]||oe[t];return e||(t in se?t:oe[t]=ne(t)||t)}var ae=/^(none|table(?!-c[ea]).+)/,le={position:"absolute",visibility:"hidden",display:"block"},he={letterSpacing:"0",fontWeight:"400"};function ce(t,e,i){var s=pt.exec(e);return s?Math.max(0,s[2]-(i||0))+(s[3]||"px"):e}function de(t,e,i,s,o,n){var r="width"===e?1:0,a=0,l=0,h=0;if(i===(s?"border":"content"))return 0;for(;r<4;r+=2)"margin"===i&&(h+=k.css(t,i+mt[r],!0,o)),s?("content"===i&&(l-=k.css(t,"padding"+mt[r],!0,o)),"margin"!==i&&(l-=k.css(t,"border"+mt[r]+"Width",!0,o))):(l+=k.css(t,"padding"+mt[r],!0,o),"padding"!==i?l+=k.css(t,"border"+mt[r]+"Width",!0,o):a+=k.css(t,"border"+mt[r]+"Width",!0,o));return!s&&n>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-n-l-a-.5))||0),l+h}function ue(t,e,i){var s=Zt(t),o,n=(!p.boxSizingReliable()||i)&&"border-box"===k.css(t,"boxSizing",!1,s),r=n,a=te(t,e,s),l="offset"+e[0].toUpperCase()+e.slice(1);if(Qt.test(a)){if(!i)return a;a="auto"}return(!p.boxSizingReliable()&&n||!p.reliableTrDimensions()&&E(t,"tr")||"auto"===a||!parseFloat(a)&&"inline"===k.css(t,"display",!1,s))&&t.getClientRects().length&&(n="border-box"===k.css(t,"boxSizing",!1,s),(r=l in t)&&(a=t[l])),(a=parseFloat(a)||0)+de(t,e,i||(n?"border":"content"),r,s,a)+"px"}function pe(t,e,i,s,o){return new pe.prototype.init(t,e,i,s,o)}k.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=te(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,e,i,s){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,n,r,a=st(e),l=Yt.test(e),h=t.style;if(l||(e=re(a)),r=k.cssHooks[e]||k.cssHooks[a],void 0===i)return r&&"get"in r&&void 0!==(o=r.get(t,!1,s))?o:h[e];"string"==(n=typeof i)&&(o=pt.exec(i))&&o[1]&&(i=bt(t,e,o),n="number"),null!=i&&i==i&&("number"!==n||l||(i+=o&&o[3]||(k.cssNumber[a]?"":"px")),p.clearCloneStyle||""!==i||0!==e.indexOf("background")||(h[e]="inherit"),r&&"set"in r&&void 0===(i=r.set(t,i,s))||(l?h.setProperty(e,i):h[e]=i))}},css:function(t,e,i,s){var o,n,r,a=st(e),l;return Yt.test(e)||(e=re(a)),(r=k.cssHooks[e]||k.cssHooks[a])&&"get"in r&&(o=r.get(t,!0,i)),void 0===o&&(o=te(t,e,s)),"normal"===o&&e in he&&(o=he[e]),""===i||i?(n=parseFloat(o),!0===i||isFinite(n)?n||0:o):o}}),k.each(["height","width"],(function(t,e){k.cssHooks[e]={get:function(t,i,s){if(i)return!ae.test(k.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?ue(t,e,s):Kt(t,le,(function(){return ue(t,e,s)}))},set:function(t,i,s){var o,n=Zt(t),r=!p.scrollboxSize()&&"absolute"===n.position,a,l=(r||s)&&"border-box"===k.css(t,"boxSizing",!1,n),h=s?de(t,e,s,l,n):0;return l&&r&&(h-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(n[e])-de(t,e,"border",!1,n)-.5)),h&&(o=pt.exec(i))&&"px"!==(o[3]||"px")&&(t.style[e]=i,i=k.css(t,e)),ce(t,i,h)}}})),k.cssHooks.marginLeft=ee(p.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(te(t,"marginLeft"))||t.getBoundingClientRect().left-Kt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),k.each({margin:"",padding:"",border:"Width"},(function(t,e){k.cssHooks[t+e]={expand:function(i){for(var s=0,o={},n="string"==typeof i?i.split(" "):[i];s<4;s++)o[t+mt[s]+e]=n[s]||n[s-2]||n[0];return o}},"margin"!==t&&(k.cssHooks[t+e].set=ce)})),k.fn.extend({css:function(t,e){return J(this,(function(t,e,i){var s,o,n={},r=0;if(Array.isArray(e)){for(s=Zt(t),o=e.length;r<o;r++)n[e[r]]=k.css(t,e[r],!1,s);return n}return void 0!==i?k.style(t,e,i):k.css(t,e)}),t,e,arguments.length>1)}}),k.Tween=pe,pe.prototype={constructor:pe,init:function(t,e,i,s,o,n){this.elem=t,this.prop=i,this.easing=o||k.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=s,this.unit=n||(k.cssNumber[i]?"":"px")},cur:function(){var t=pe.propHooks[this.prop];return t&&t.get?t.get(this):pe.propHooks._default.get(this)},run:function(t){var e,i=pe.propHooks[this.prop];return this.options.duration?this.pos=e=k.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):pe.propHooks._default.set(this),this}},pe.prototype.init.prototype=pe.prototype,pe.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=k.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){k.fx.step[t.prop]?k.fx.step[t.prop](t):1!==t.elem.nodeType||!k.cssHooks[t.prop]&&null==t.elem.style[re(t.prop)]?t.elem[t.prop]=t.now:k.style(t.elem,t.prop,t.now+t.unit)}}},pe.propHooks.scrollTop=pe.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},k.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},k.fx=pe.prototype.init,k.fx.step={};var me,ge,fe=/^(?:toggle|show|hide)$/,ve=/queueHooks$/;function ye(){ge&&(!1===f.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(ye):t.setTimeout(ye,k.fx.interval),k.fx.tick())}function be(){return t.setTimeout((function(){me=void 0})),me=Date.now()}function we(t,e){var i,s=0,o={height:t};for(e=e?1:0;s<4;s+=2-e)o["margin"+(i=mt[s])]=o["padding"+i]=t;return e&&(o.opacity=o.width=t),o}function xe(t,e,i){for(var s,o=(Ee.tweeners[e]||[]).concat(Ee.tweeners["*"]),n=0,r=o.length;n<r;n++)if(s=o[n].call(i,e,t))return s}function ke(t,e,i){var s,o,n,r,a,l,h,c,d="width"in e||"height"in e,u=this,p={},m=t.style,g=t.nodeType&&yt(t),f=rt.get(t,"fxshow");for(s in i.queue||(null==(r=k._queueHooks(t,"fx")).unqueued&&(r.unqueued=0,a=r.empty.fire,r.empty.fire=function(){r.unqueued||a()}),r.unqueued++,u.always((function(){u.always((function(){r.unqueued--,k.queue(t,"fx").length||r.empty.fire()}))}))),e)if(o=e[s],fe.test(o)){if(delete e[s],n=n||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!f||void 0===f[s])continue;g=!0}p[s]=f&&f[s]||k.style(t,s)}if((l=!k.isEmptyObject(e))||!k.isEmptyObject(p))for(s in d&&1===t.nodeType&&(i.overflow=[m.overflow,m.overflowX,m.overflowY],null==(h=f&&f.display)&&(h=rt.get(t,"display")),"none"===(c=k.css(t,"display"))&&(h?c=h:(kt([t],!0),h=t.style.display||h,c=k.css(t,"display"),kt([t]))),("inline"===c||"inline-block"===c&&null!=h)&&"none"===k.css(t,"float")&&(l||(u.done((function(){m.display=h})),null==h&&(c=m.display,h="none"===c?"":c)),m.display="inline-block")),i.overflow&&(m.overflow="hidden",u.always((function(){m.overflow=i.overflow[0],m.overflowX=i.overflow[1],m.overflowY=i.overflow[2]}))),l=!1,p)l||(f?"hidden"in f&&(g=f.hidden):f=rt.access(t,"fxshow",{display:h}),n&&(f.hidden=!g),g&&kt([t],!0),u.done((function(){for(s in g||kt([t]),rt.remove(t,"fxshow"),p)k.style(t,s,p[s])}))),l=xe(g?f[s]:0,s,u),s in f||(f[s]=l.start,g&&(l.end=l.start,l.start=0))}function Se(t,e){var i,s,o,n,r;for(i in t)if(o=e[s=st(i)],n=t[i],Array.isArray(n)&&(o=n[1],n=t[i]=n[0]),i!==s&&(t[s]=n,delete t[i]),(r=k.cssHooks[s])&&"expand"in r)for(i in n=r.expand(n),delete t[s],n)i in t||(t[i]=n[i],e[i]=o);else e[s]=o}function Ee(t,e,i){var s,o,n=0,r=Ee.prefilters.length,a=k.Deferred().always((function(){delete l.elem})),l=function(){if(o)return!1;for(var e=me||be(),i=Math.max(0,h.startTime+h.duration-e),s,n=1-(i/h.duration||0),r=0,l=h.tweens.length;r<l;r++)h.tweens[r].run(n);return a.notifyWith(t,[h,n,i]),n<1&&l?i:(l||a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:k.extend({},e),opts:k.extend(!0,{specialEasing:{},easing:k.easing._default},i),originalProperties:e,originalOptions:i,startTime:me||be(),duration:i.duration,tweens:[],createTween:function(e,i){var s=k.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(s),s},stop:function(e){var i=0,s=e?h.tweens.length:0;if(o)return this;for(o=!0;i<s;i++)h.tweens[i].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),c=h.props;for(Se(c,h.opts.specialEasing);n<r;n++)if(s=Ee.prefilters[n].call(h,t,c,h.opts))return m(s.stop)&&(k._queueHooks(h.elem,h.opts.queue).stop=s.stop.bind(s)),s;return k.map(c,xe,h),m(h.opts.start)&&h.opts.start.call(t,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),k.fx.timer(k.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h}k.Animation=k.extend(Ee,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return bt(i.elem,t,pt.exec(e),i),i}]},tweener:function(t,e){m(t)?(e=t,t=["*"]):t=t.match($);for(var i,s=0,o=t.length;s<o;s++)i=t[s],Ee.tweeners[i]=Ee.tweeners[i]||[],Ee.tweeners[i].unshift(e)},prefilters:[ke],prefilter:function(t,e){e?Ee.prefilters.unshift(t):Ee.prefilters.push(t)}}),k.speed=function(t,e,i){var s=t&&"object"==typeof t?k.extend({},t):{complete:i||!i&&e||m(t)&&t,duration:t,easing:i&&e||e&&!m(e)&&e};return k.fx.off?s.duration=0:"number"!=typeof s.duration&&(s.duration in k.fx.speeds?s.duration=k.fx.speeds[s.duration]:s.duration=k.fx.speeds._default),null!=s.queue&&!0!==s.queue||(s.queue="fx"),s.old=s.complete,s.complete=function(){m(s.old)&&s.old.call(this),s.queue&&k.dequeue(this,s.queue)},s},k.fn.extend({fadeTo:function(t,e,i,s){return this.filter(yt).css("opacity",0).show().end().animate({opacity:e},t,i,s)},animate:function(t,e,i,s){var o=k.isEmptyObject(t),n=k.speed(e,i,s),r=function(){var e=Ee(this,k.extend({},t),n);(o||rt.get(this,"finish"))&&e.stop(!0)};return r.finish=r,o||!1===n.queue?this.each(r):this.queue(n.queue,r)},stop:function(t,e,i){var s=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,o=null!=t&&t+"queueHooks",n=k.timers,r=rt.get(this);if(o)r[o]&&r[o].stop&&s(r[o]);else for(o in r)r[o]&&r[o].stop&&ve.test(o)&&s(r[o]);for(o=n.length;o--;)n[o].elem!==this||null!=t&&n[o].queue!==t||(n[o].anim.stop(i),e=!1,n.splice(o,1));!e&&i||k.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=rt.get(this),s=i[t+"queue"],o=i[t+"queueHooks"],n=k.timers,r=s?s.length:0;for(i.finish=!0,k.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=n.length;e--;)n[e].elem===this&&n[e].queue===t&&(n[e].anim.stop(!0),n.splice(e,1));for(e=0;e<r;e++)s[e]&&s[e].finish&&s[e].finish.call(this);delete i.finish}))}}),k.each(["toggle","show","hide"],(function(t,e){var i=k.fn[e];k.fn[e]=function(t,s,o){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(we(e,!0),t,s,o)}})),k.each({slideDown:we("show"),slideUp:we("hide"),slideToggle:we("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){k.fn[t]=function(t,i,s){return this.animate(e,t,i,s)}})),k.timers=[],k.fx.tick=function(){var t,e=0,i=k.timers;for(me=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||k.fx.stop(),me=void 0},k.fx.timer=function(t){k.timers.push(t),k.fx.start()},k.fx.interval=13,k.fx.start=function(){ge||(ge=!0,ye())},k.fx.stop=function(){ge=null},k.fx.speeds={slow:600,fast:200,_default:400},k.fn.delay=function(e,i){return e=k.fx&&k.fx.speeds[e]||e,i=i||"fx",this.queue(i,(function(i,s){var o=t.setTimeout(i,e);s.stop=function(){t.clearTimeout(o)}}))},function(){var t=f.createElement("input"),e,i=f.createElement("select").appendChild(f.createElement("option"));t.type="checkbox",p.checkOn=""!==t.value,p.optSelected=i.selected,(t=f.createElement("input")).value="t",t.type="radio",p.radioValue="t"===t.value}();var Te,_e=k.expr.attrHandle;k.fn.extend({attr:function(t,e){return J(this,k.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){k.removeAttr(this,t)}))}}),k.extend({attr:function(t,e,i){var s,o,n=t.nodeType;if(3!==n&&8!==n&&2!==n)return void 0===t.getAttribute?k.prop(t,e,i):(1===n&&k.isXMLDoc(t)||(o=k.attrHooks[e.toLowerCase()]||(k.expr.match.bool.test(e)?Te:void 0)),void 0!==i?null===i?void k.removeAttr(t,e):o&&"set"in o&&void 0!==(s=o.set(t,i,e))?s:(t.setAttribute(e,i+""),i):o&&"get"in o&&null!==(s=o.get(t,e))?s:null==(s=k.find.attr(t,e))?void 0:s)},attrHooks:{type:{set:function(t,e){if(!p.radioValue&&"radio"===e&&E(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,s=0,o=e&&e.match($);if(o&&1===t.nodeType)for(;i=o[s++];)t.removeAttribute(i)}}),Te={set:function(t,e,i){return!1===e?k.removeAttr(t,i):t.setAttribute(i,i),i}},k.each(k.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=_e[e]||k.find.attr;_e[e]=function(t,e,s){var o,n,r=e.toLowerCase();return s||(n=_e[r],_e[r]=o,o=null!=i(t,e,s)?r:null,_e[r]=n),o}}));var Ce=/^(?:input|select|textarea|button)$/i,Be=/^(?:a|area)$/i;function De(t){var e;return(t.match($)||[]).join(" ")}function Me(t){return t.getAttribute&&t.getAttribute("class")||""}function Re(t){return Array.isArray(t)?t:"string"==typeof t&&t.match($)||[]}k.fn.extend({prop:function(t,e){return J(this,k.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[k.propFix[t]||t]}))}}),k.extend({prop:function(t,e,i){var s,o,n=t.nodeType;if(3!==n&&8!==n&&2!==n)return 1===n&&k.isXMLDoc(t)||(e=k.propFix[e]||e,o=k.propHooks[e]),void 0!==i?o&&"set"in o&&void 0!==(s=o.set(t,i,e))?s:t[e]=i:o&&"get"in o&&null!==(s=o.get(t,e))?s:t[e]},propHooks:{tabIndex:{get:function(t){var e=k.find.attr(t,"tabindex");return e?parseInt(e,10):Ce.test(t.nodeName)||Be.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),p.optSelected||(k.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),k.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){k.propFix[this.toLowerCase()]=this})),k.fn.extend({addClass:function(t){var e,i,s,o,n,r;return m(t)?this.each((function(e){k(this).addClass(t.call(this,e,Me(this)))})):(e=Re(t)).length?this.each((function(){if(s=Me(this),i=1===this.nodeType&&" "+De(s)+" "){for(n=0;n<e.length;n++)o=e[n],i.indexOf(" "+o+" ")<0&&(i+=o+" ");r=De(i),s!==r&&this.setAttribute("class",r)}})):this},removeClass:function(t){var e,i,s,o,n,r;return m(t)?this.each((function(e){k(this).removeClass(t.call(this,e,Me(this)))})):arguments.length?(e=Re(t)).length?this.each((function(){if(s=Me(this),i=1===this.nodeType&&" "+De(s)+" "){for(n=0;n<e.length;n++)for(o=e[n];i.indexOf(" "+o+" ")>-1;)i=i.replace(" "+o+" "," ");r=De(i),s!==r&&this.setAttribute("class",r)}})):this:this.attr("class","")},toggleClass:function(t,e){var i,s,o,n,r=typeof t,a="string"===r||Array.isArray(t);return m(t)?this.each((function(i){k(this).toggleClass(t.call(this,i,Me(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(i=Re(t),this.each((function(){if(a)for(n=k(this),o=0;o<i.length;o++)s=i[o],n.hasClass(s)?n.removeClass(s):n.addClass(s);else void 0!==t&&"boolean"!==r||((s=Me(this))&&rt.set(this,"__className__",s),this.setAttribute&&this.setAttribute("class",s||!1===t?"":rt.get(this,"__className__")||""))})))},hasClass:function(t){var e,i,s=0;for(e=" "+t+" ";i=this[s++];)if(1===i.nodeType&&(" "+De(Me(i))+" ").indexOf(e)>-1)return!0;return!1}});var Ae=/\r/g;k.fn.extend({val:function(t){var e,i,s,o=this[0];return arguments.length?(s=m(t),this.each((function(i){var o;1===this.nodeType&&(null==(o=s?t.call(this,i,k(this).val()):t)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=k.map(o,(function(t){return null==t?"":t+""}))),(e=k.valHooks[this.type]||k.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))}))):o?(e=k.valHooks[o.type]||k.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(o,"value"))?i:"string"==typeof(i=o.value)?i.replace(Ae,""):null==i?"":i:void 0}}),k.extend({valHooks:{option:{get:function(t){var e=k.find.attr(t,"value");return null!=e?e:De(k.text(t))}},select:{get:function(t){var e,i,s,o=t.options,n=t.selectedIndex,r="select-one"===t.type,a=r?null:[],l=r?n+1:o.length;for(s=n<0?l:r?n:0;s<l;s++)if(((i=o[s]).selected||s===n)&&!i.disabled&&(!i.parentNode.disabled||!E(i.parentNode,"optgroup"))){if(e=k(i).val(),r)return e;a.push(e)}return a},set:function(t,e){for(var i,s,o=t.options,n=k.makeArray(e),r=o.length;r--;)((s=o[r]).selected=k.inArray(k.valHooks.option.get(s),n)>-1)&&(i=!0);return i||(t.selectedIndex=-1),n}}}}),k.each(["radio","checkbox"],(function(){k.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=k.inArray(k(t).val(),e)>-1}},p.checkOn||(k.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var je=t.location,Le={guid:Date.now()},Pe=/\?/;k.parseXML=function(e){var i,s;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){}return s=i&&i.getElementsByTagName("parsererror")[0],i&&!s||k.error("Invalid XML: "+(s?k.map(s.childNodes,(function(t){return t.textContent})).join("\n"):e)),i};var Fe=/^(?:focusinfocus|focusoutblur)$/,Oe=function(t){t.stopPropagation()};k.extend(k.event,{trigger:function(e,i,s,o){var n,r,a,l,h,d,u,p,v=[s||f],y=c.call(e,"type")?e.type:e,b=c.call(e,"namespace")?e.namespace.split("."):[];if(r=p=a=s=s||f,3!==s.nodeType&&8!==s.nodeType&&!Fe.test(y+k.event.triggered)&&(y.indexOf(".")>-1&&(b=y.split("."),y=b.shift(),b.sort()),h=y.indexOf(":")<0&&"on"+y,(e=e[k.expando]?e:new k.Event(y,"object"==typeof e&&e)).isTrigger=o?2:3,e.namespace=b.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=s),i=null==i?[e]:k.makeArray(i,[e]),u=k.event.special[y]||{},o||!u.trigger||!1!==u.trigger.apply(s,i))){if(!o&&!u.noBubble&&!g(s)){for(l=u.delegateType||y,Fe.test(l+y)||(r=r.parentNode);r;r=r.parentNode)v.push(r),a=r;a===(s.ownerDocument||f)&&v.push(a.defaultView||a.parentWindow||t)}for(n=0;(r=v[n++])&&!e.isPropagationStopped();)p=r,e.type=n>1?l:u.bindType||y,(d=(rt.get(r,"events")||Object.create(null))[e.type]&&rt.get(r,"handle"))&&d.apply(r,i),(d=h&&r[h])&&d.apply&&ot(r)&&(e.result=d.apply(r,i),!1===e.result&&e.preventDefault());return e.type=y,o||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(v.pop(),i)||!ot(s)||h&&m(s[y])&&!g(s)&&((a=s[h])&&(s[h]=null),k.event.triggered=y,e.isPropagationStopped()&&p.addEventListener(y,Oe),s[y](),e.isPropagationStopped()&&p.removeEventListener(y,Oe),k.event.triggered=void 0,a&&(s[h]=a)),e.result}},simulate:function(t,e,i){var s=k.extend(new k.Event,i,{type:t,isSimulated:!0});k.event.trigger(s,null,e)}}),k.fn.extend({trigger:function(t,e){return this.each((function(){k.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return k.event.trigger(t,e,i,!0)}});var Ie=/\[\]$/,Ne=/\r?\n/g,He=/^(?:submit|button|image|reset|file)$/i,ze=/^(?:input|select|textarea|keygen)/i;function Ve(t,e,i,s){var o;if(Array.isArray(e))k.each(e,(function(e,o){i||Ie.test(t)?s(t,o):Ve(t+"["+("object"==typeof o&&null!=o?e:"")+"]",o,i,s)}));else if(i||"object"!==b(e))s(t,e);else for(o in e)Ve(t+"["+o+"]",e[o],i,s)}k.param=function(t,e){var i,s=[],o=function(t,e){var i=m(e)?e():e;s[s.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!k.isPlainObject(t))k.each(t,(function(){o(this.name,this.value)}));else for(i in t)Ve(i,t[i],e,o);return s.join("&")},k.fn.extend({serialize:function(){return k.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=k.prop(this,"elements");return t?k.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!k(this).is(":disabled")&&ze.test(this.nodeName)&&!He.test(t)&&(this.checked||!St.test(t))})).map((function(t,e){var i=k(this).val();return null==i?null:Array.isArray(i)?k.map(i,(function(t){return{name:e.name,value:t.replace(Ne,"\r\n")}})):{name:e.name,value:i.replace(Ne,"\r\n")}})).get()}});var qe=/%20/g,Ge=/#.*$/,$e=/([?&])_=[^&]*/,Ue=/^(.*?):[ \t]*([^\r\n]*)$/gm,We=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Xe=/^(?:GET|HEAD)$/,Qe=/^\/\//,Ye={},Ze={},Ke="*/".concat("*"),Je=f.createElement("a");function ti(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var s,o=0,n=e.toLowerCase().match($)||[];if(m(i))for(;s=n[o++];)"+"===s[0]?(s=s.slice(1)||"*",(t[s]=t[s]||[]).unshift(i)):(t[s]=t[s]||[]).push(i)}}function ei(t,e,i,s){var o={},n=t===Ze;function r(a){var l;return o[a]=!0,k.each(t[a]||[],(function(t,a){var h=a(e,i,s);return"string"!=typeof h||n||o[h]?n?!(l=h):void 0:(e.dataTypes.unshift(h),r(h),!1)})),l}return r(e.dataTypes[0])||!o["*"]&&r("*")}function ii(t,e){var i,s,o=k.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((o[i]?t:s||(s={}))[i]=e[i]);return s&&k.extend(!0,t,s),t}function si(t,e,i){for(var s,o,n,r,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===s&&(s=t.mimeType||e.getResponseHeader("Content-Type"));if(s)for(o in a)if(a[o]&&a[o].test(s)){l.unshift(o);break}if(l[0]in i)n=l[0];else{for(o in i){if(!l[0]||t.converters[o+" "+l[0]]){n=o;break}r||(r=o)}n=n||r}if(n)return n!==l[0]&&l.unshift(n),i[n]}function oi(t,e,i,s){var o,n,r,a,l,h={},c=t.dataTypes.slice();if(c[1])for(r in t.converters)h[r.toLowerCase()]=t.converters[r];for(n=c.shift();n;)if(t.responseFields[n]&&(i[t.responseFields[n]]=e),!l&&s&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=n,n=c.shift())if("*"===n)n=l;else if("*"!==l&&l!==n){if(!(r=h[l+" "+n]||h["* "+n]))for(o in h)if((a=o.split(" "))[1]===n&&(r=h[l+" "+a[0]]||h["* "+a[0]])){!0===r?r=h[o]:!0!==h[o]&&(n=a[0],c.unshift(a[1]));break}if(!0!==r)if(r&&t.throws)e=r(e);else try{e=r(e)}catch(t){return{state:"parsererror",error:r?t:"No conversion from "+l+" to "+n}}}return{state:"success",data:e}}Je.href=je.href,k.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:je.href,type:"GET",isLocal:We.test(je.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ke,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":k.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?ii(ii(t,k.ajaxSettings),e):ii(k.ajaxSettings,t)},ajaxPrefilter:ti(Ye),ajaxTransport:ti(Ze),ajax:function(e,i){"object"==typeof e&&(i=e,e=void 0),i=i||{};var s,o,n,r,a,l,h,c,d,u,p=k.ajaxSetup({},i),m=p.context||p,g=p.context&&(m.nodeType||m.jquery)?k(m):k.event,v=k.Deferred(),y=k.Callbacks("once memory"),b=p.statusCode||{},w={},x={},S="canceled",E={readyState:0,getResponseHeader:function(t){var e;if(h){if(!r)for(r={};e=Ue.exec(n);)r[e[1].toLowerCase()+" "]=(r[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=r[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return h?n:null},setRequestHeader:function(t,e){return null==h&&(t=x[t.toLowerCase()]=x[t.toLowerCase()]||t,w[t]=e),this},overrideMimeType:function(t){return null==h&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(h)E.always(t[E.status]);else for(e in t)b[e]=[b[e],t[e]];return this},abort:function(t){var e=t||S;return s&&s.abort(e),T(0,e),this}};if(v.promise(E),p.url=((e||p.url||je.href)+"").replace(Qe,je.protocol+"//"),p.type=i.method||i.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match($)||[""],null==p.crossDomain){l=f.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Je.protocol+"//"+Je.host!=l.protocol+"//"+l.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=k.param(p.data,p.traditional)),ei(Ye,p,i,E),h)return E;for(d in(c=k.event&&p.global)&&0==k.active++&&k.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Xe.test(p.type),o=p.url.replace(Ge,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(qe,"+")):(u=p.url.slice(o.length),p.data&&(p.processData||"string"==typeof p.data)&&(o+=(Pe.test(o)?"&":"?")+p.data,delete p.data),!1===p.cache&&(o=o.replace($e,"$1"),u=(Pe.test(o)?"&":"?")+"_="+Le.guid+++u),p.url=o+u),p.ifModified&&(k.lastModified[o]&&E.setRequestHeader("If-Modified-Since",k.lastModified[o]),k.etag[o]&&E.setRequestHeader("If-None-Match",k.etag[o])),(p.data&&p.hasContent&&!1!==p.contentType||i.contentType)&&E.setRequestHeader("Content-Type",p.contentType),E.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ke+"; q=0.01":""):p.accepts["*"]),p.headers)E.setRequestHeader(d,p.headers[d]);if(p.beforeSend&&(!1===p.beforeSend.call(m,E,p)||h))return E.abort();if(S="abort",y.add(p.complete),E.done(p.success),E.fail(p.error),s=ei(Ze,p,i,E)){if(E.readyState=1,c&&g.trigger("ajaxSend",[E,p]),h)return E;p.async&&p.timeout>0&&(a=t.setTimeout((function(){E.abort("timeout")}),p.timeout));try{h=!1,s.send(w,T)}catch(t){if(h)throw t;T(-1,t)}}else T(-1,"No Transport");function T(e,i,r,l){var d,u,f,w,x,S=i;h||(h=!0,a&&t.clearTimeout(a),s=void 0,n=l||"",E.readyState=e>0?4:0,d=e>=200&&e<300||304===e,r&&(w=si(p,E,r)),!d&&k.inArray("script",p.dataTypes)>-1&&k.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=oi(p,w,E,d),d?(p.ifModified&&((x=E.getResponseHeader("Last-Modified"))&&(k.lastModified[o]=x),(x=E.getResponseHeader("etag"))&&(k.etag[o]=x)),204===e||"HEAD"===p.type?S="nocontent":304===e?S="notmodified":(S=w.state,u=w.data,d=!(f=w.error))):(f=S,!e&&S||(S="error",e<0&&(e=0))),E.status=e,E.statusText=(i||S)+"",d?v.resolveWith(m,[u,S,E]):v.rejectWith(m,[E,S,f]),E.statusCode(b),b=void 0,c&&g.trigger(d?"ajaxSuccess":"ajaxError",[E,p,d?u:f]),y.fireWith(m,[E,S]),c&&(g.trigger("ajaxComplete",[E,p]),--k.active||k.event.trigger("ajaxStop")))}return E},getJSON:function(t,e,i){return k.get(t,e,i,"json")},getScript:function(t,e){return k.get(t,void 0,e,"script")}}),k.each(["get","post"],(function(t,e){k[e]=function(t,i,s,o){return m(i)&&(o=o||s,s=i,i=void 0),k.ajax(k.extend({url:t,type:e,dataType:o,data:i,success:s},k.isPlainObject(t)&&t))}})),k.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),k._evalUrl=function(t,e,i){return k.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){k.globalEval(t,e,i)}})},k.fn.extend({wrapAll:function(t){var e;return this[0]&&(m(t)&&(t=t.call(this[0])),e=k(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return m(t)?this.each((function(e){k(this).wrapInner(t.call(this,e))})):this.each((function(){var e=k(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=m(t);return this.each((function(i){k(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){k(this).replaceWith(this.childNodes)})),this}}),k.expr.pseudos.hidden=function(t){return!k.expr.pseudos.visible(t)},k.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},k.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var ni={0:200,1223:204},ri=k.ajaxSettings.xhr();p.cors=!!ri&&"withCredentials"in ri,p.ajax=ri=!!ri,k.ajaxTransport((function(e){var i,s;if(p.cors||ri&&!e.crossDomain)return{send:function(o,n){var r,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)a[r]=e.xhrFields[r];for(r in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)a.setRequestHeader(r,o[r]);i=function(t){return function(){i&&(i=s=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?n(0,"error"):n(a.status,a.statusText):n(ni[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),s=a.onerror=a.ontimeout=i("error"),void 0!==a.onabort?a.onabort=s:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout((function(){i&&s()}))},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}})),k.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),k.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return k.globalEval(t),t}}}),k.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),k.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(s,o){e=k("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&o("error"===t.type?404:200,t.type)}),f.head.appendChild(e[0])},abort:function(){i&&i()}}}));var ai=[],li=/(=)\?(?=&|$)|\?\?/,hi;k.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=ai.pop()||k.expando+"_"+Le.guid++;return this[t]=!0,t}}),k.ajaxPrefilter("json jsonp",(function(e,i,s){var o,n,r,a=!1!==e.jsonp&&(li.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&li.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return o=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(li,"$1"+o):!1!==e.jsonp&&(e.url+=(Pe.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return r||k.error(o+" was not called"),r[0]},e.dataTypes[0]="json",n=t[o],t[o]=function(){r=arguments},s.always((function(){void 0===n?k(t).removeProp(o):t[o]=n,e[o]&&(e.jsonpCallback=i.jsonpCallback,ai.push(o)),r&&m(n)&&n(r[0]),r=n=void 0})),"script"})),p.createHTMLDocument=((hi=f.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===hi.childNodes.length),k.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(p.createHTMLDocument?((s=(e=f.implementation.createHTMLDocument("")).createElement("base")).href=f.location.href,e.head.appendChild(s)):e=f),n=!i&&[],(o=O.exec(t))?[e.createElement(o[1])]:(o=jt([t],e,n),n&&n.length&&k(n).remove(),k.merge([],o.childNodes)));var s,o,n},k.fn.load=function(t,e,i){var s,o,n,r=this,a=t.indexOf(" ");return a>-1&&(s=De(t.slice(a)),t=t.slice(0,a)),m(e)?(i=e,e=void 0):e&&"object"==typeof e&&(o="POST"),r.length>0&&k.ajax({url:t,type:o||"GET",dataType:"html",data:e}).done((function(t){n=arguments,r.html(s?k("<div>").append(k.parseHTML(t)).find(s):t)})).always(i&&function(t,e){r.each((function(){i.apply(this,n||[t.responseText,e,t])}))}),this},k.expr.pseudos.animated=function(t){return k.grep(k.timers,(function(e){return t===e.elem})).length},k.offset={setOffset:function(t,e,i){var s,o,n,r,a,l,h,c=k.css(t,"position"),d=k(t),u={};"static"===c&&(t.style.position="relative"),a=d.offset(),n=k.css(t,"top"),l=k.css(t,"left"),(h=("absolute"===c||"fixed"===c)&&(n+l).indexOf("auto")>-1)?(r=(s=d.position()).top,o=s.left):(r=parseFloat(n)||0,o=parseFloat(l)||0),m(e)&&(e=e.call(t,i,k.extend({},a))),null!=e.top&&(u.top=e.top-a.top+r),null!=e.left&&(u.left=e.left-a.left+o),"using"in e?e.using.call(t,u):d.css(u)}},k.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){k.offset.setOffset(this,t,e)}));var e,i,s=this[0];return s?s.getClientRects().length?(e=s.getBoundingClientRect(),i=s.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,s=this[0],o={top:0,left:0};if("fixed"===k.css(s,"position"))e=s.getBoundingClientRect();else{for(e=this.offset(),i=s.ownerDocument,t=s.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===k.css(t,"position");)t=t.parentNode;t&&t!==s&&1===t.nodeType&&((o=k(t).offset()).top+=k.css(t,"borderTopWidth",!0),o.left+=k.css(t,"borderLeftWidth",!0))}return{top:e.top-o.top-k.css(s,"marginTop",!0),left:e.left-o.left-k.css(s,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===k.css(t,"position");)t=t.offsetParent;return t||gt}))}}),k.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;k.fn[t]=function(s){return J(this,(function(t,s,o){var n;if(g(t)?n=t:9===t.nodeType&&(n=t.defaultView),void 0===o)return n?n[e]:t[s];n?n.scrollTo(i?n.pageXOffset:o,i?o:n.pageYOffset):t[s]=o}),t,s,arguments.length)}})),k.each(["top","left"],(function(t,e){k.cssHooks[e]=ee(p.pixelPosition,(function(t,i){if(i)return i=te(t,e),Qt.test(i)?k(t).position()[e]+"px":i}))})),k.each({Height:"height",Width:"width"},(function(t,e){k.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,s){k.fn[s]=function(o,n){var r=arguments.length&&(i||"boolean"!=typeof o),a=i||(!0===o||!0===n?"margin":"border");return J(this,(function(e,i,o){var n;return g(e)?0===s.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(n=e.documentElement,Math.max(e.body["scroll"+t],n["scroll"+t],e.body["offset"+t],n["offset"+t],n["client"+t])):void 0===o?k.css(e,i,a):k.style(e,i,o,a)}),e,r?o:void 0,r)}}))})),k.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){k.fn[e]=function(t){return this.on(e,t)}})),k.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,s){return this.on(e,t,i,s)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.on("mouseenter",t).on("mouseleave",e||t)}}),k.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){k.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}));var ci=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;k.proxy=function(t,e){var i,s,n;if("string"==typeof e&&(i=t[e],e=t,t=i),m(t))return s=o.call(arguments,2),n=function(){return t.apply(e||this,s.concat(o.call(arguments)))},n.guid=t.guid=t.guid||k.guid++,n},k.holdReady=function(t){t?k.readyWait++:k.ready(!0)},k.isArray=Array.isArray,k.parseJSON=JSON.parse,k.nodeName=E,k.isFunction=m,k.isWindow=g,k.camelCase=st,k.type=b,k.now=Date.now,k.isNumeric=function(t){var e=k.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},k.trim=function(t){return null==t?"":(t+"").replace(ci,"$1")};var di=t.jQuery,ui=t.$;return k.noConflict=function(e){return t.$===k&&(t.$=ui),e&&t.jQuery===k&&(t.jQuery=di),k},void 0===e&&(t.jQuery=t.$=k),k}))),Tn.exports;var t}
/*!
 * typeahead.js 0.11.1
 * https://github.com/twitter/typeahead.js
 * Copyright 2013-2015 Twitter, Inc. and other contributors; Licensed MIT
 */var Dn=En.exports,Mn;function Rn(){return Mn||(Mn=1,i=Dn,s=function(t){var e={isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return void 0===t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(e){return e instanceof t},toStr:function t(i){return e.isUndefined(i)||null===i?"":i+""},bind:t.proxy,each:function(e,i){function s(t,e){return i(e,t)}t.each(e,s)},map:t.map,filter:t.grep,every:function(e,i){var s=!0;return e?(t.each(e,(function(t,o){if(!(s=i.call(null,o,t,e)))return!1})),!!s):s},some:function(e,i){var s=!1;return e?(t.each(e,(function(t,o){if(s=i.call(null,o,t,e))return!1})),!!s):s},mixin:t.extend,identity:function(t){return t},clone:function(e){return t.extend(!0,{},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function e(i){return t.isFunction(i)?i:s;function s(){return String(i)}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var s,o;return function(){var n=this,r=arguments,a,l;return a=function(){s=null,i||(o=t.apply(n,r))},l=i&&!s,clearTimeout(s),s=setTimeout(a,e),l&&(o=t.apply(n,r)),o}},throttle:function(t,e){var i,s,o,n,r,a;return r=0,a=function(){r=new Date,o=null,n=t.apply(i,s)},function(){var l=new Date,h=e-(l-r);return i=this,s=arguments,h<=0?(clearTimeout(o),o=null,r=l,n=t.apply(i,s)):o||(o=setTimeout(a,h)),n}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){}},i="0.11.1",s=function(){return{nonword:i,whitespace:t,obj:{nonword:s(i),whitespace:s(t)}};function t(t){return(t=e.toStr(t))?t.split(/\s+/):[]}function i(t){return(t=e.toStr(t))?t.split(/\W+/):[]}function s(t){return function i(s){return s=e.isArray(s)?s:[].slice.call(arguments,0),function i(o){var n=[];return e.each(s,(function(i){n=n.concat(t(e.toStr(o[i])))})),n}}}}(),o=function(){function i(i){this.maxSize=e.isNumber(i)?i:100,this.reset(),this.maxSize<=0&&(this.set=this.get=t.noop)}function s(){this.head=this.tail=null}function o(t,e){this.key=t,this.val=e,this.prev=this.next=null}return e.mixin(i.prototype,{set:function t(e,i){var s=this.list.tail,n;this.size>=this.maxSize&&(this.list.remove(s),delete this.hash[s.key],this.size--),(n=this.hash[e])?(n.val=i,this.list.moveToFront(n)):(n=new o(e,i),this.list.add(n),this.hash[e]=n,this.size++)},get:function t(e){var i=this.hash[e];if(i)return this.list.moveToFront(i),i.val},reset:function t(){this.size=0,this.hash={},this.list=new s}}),e.mixin(s.prototype,{add:function t(e){this.head&&(e.next=this.head,this.head.prev=e),this.head=e,this.tail=this.tail||e},remove:function t(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),i}(),n=function(){var i;try{(i=window.localStorage).setItem("~~~","!"),i.removeItem("~~~")}catch(t){i=null}function s(t,s){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix)),this.ls=s||i,!this.ls&&this._noop()}return e.mixin(s.prototype,{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=e.noop},_safeSet:function(t,e){try{this.ls.setItem(t,e)}catch(t){"QuotaExceededError"===t.name&&(this.clear(),this._noop())}},get:function(t){return this.isExpired(t)&&this.remove(t),r(this.ls.getItem(this._prefix(t)))},set:function(t,i,s){return e.isNumber(s)?this._safeSet(this._ttlKey(t),n(o()+s)):this.ls.removeItem(this._ttlKey(t)),this._safeSet(this._prefix(t),n(i))},remove:function(t){return this.ls.removeItem(this._ttlKey(t)),this.ls.removeItem(this._prefix(t)),this},clear:function(){var t,e=a(this.keyMatcher);for(t=e.length;t--;)this.remove(e[t]);return this},isExpired:function(t){var i=r(this.ls.getItem(this._ttlKey(t)));return!!(e.isNumber(i)&&o()>i)}}),s;function o(){return(new Date).getTime()}function n(t){return JSON.stringify(e.isUndefined(t)?null:t)}function r(e){return t.parseJSON(e)}function a(t){var e,s,o=[],n=i.length;for(e=0;e<n;e++)(s=i.key(e)).match(t)&&o.push(s.replace(t,""));return o}}(),r=function(){var i=0,s={},n=6,r=new o(10);function a(t){t=t||{},this.cancelled=!1,this.lastReq=null,this._send=t.transport,this._get=t.limiter?t.limiter(this._get):this._get,this._cache=!1===t.cache?new o(0):r}return a.setMaxPendingRequests=function t(e){n=e},a.resetCache=function t(){r.reset()},e.mixin(a.prototype,{_fingerprint:function e(i){return(i=i||{}).url+i.type+t.param(i.data||{})},_get:function(t,e){var o=this,r,a;function l(t){e(null,t),o._cache.set(r,t)}function h(){e(!0)}function c(){i--,delete s[r],o.onDeckRequestArgs&&(o._get.apply(o,o.onDeckRequestArgs),o.onDeckRequestArgs=null)}r=this._fingerprint(t),this.cancelled||r!==this.lastReq||((a=s[r])?a.done(l).fail(h):i<n?(i++,s[r]=this._send(t).done(l).fail(h).always(c)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(i,s){var o,n;s=s||t.noop,i=e.isString(i)?{url:i}:i||{},n=this._fingerprint(i),this.cancelled=!1,this.lastReq=n,(o=this._cache.get(n))?s(null,o):this._get(i,s)},cancel:function(){this.cancelled=!0}}),a}(),a=window.SearchIndex=function(){var i="c",s="i";function o(i){(i=i||{}).datumTokenizer&&i.queryTokenizer||t.error("datumTokenizer and queryTokenizer are both required"),this.identify=i.identify||e.stringify,this.datumTokenizer=i.datumTokenizer,this.queryTokenizer=i.queryTokenizer,this.reset()}return e.mixin(o.prototype,{bootstrap:function t(e){this.datums=e.datums,this.trie=e.trie},add:function(t){var o=this;t=e.isArray(t)?t:[t],e.each(t,(function(t){var a,l;o.datums[a=o.identify(t)]=t,l=n(o.datumTokenizer(t)),e.each(l,(function(t){var e,n,l;for(e=o.trie,n=t.split("");l=n.shift();)(e=e[i][l]||(e[i][l]=r()))[s].push(a)}))}))},get:function t(i){var s=this;return e.map(i,(function(t){return s.datums[t]}))},search:function t(o){var r=this,h,c;return h=n(this.queryTokenizer(o)),e.each(h,(function(t){var e,o,n,a;if(c&&0===c.length)return!1;for(e=r.trie,o=t.split("");e&&(n=o.shift());)e=e[i][n];if(!e||0!==o.length)return c=[],!1;a=e[s].slice(0),c=c?l(c,a):a})),c?e.map(a(c),(function(t){return r.datums[t]})):[]},all:function t(){var e=[];for(var i in this.datums)e.push(this.datums[i]);return e},reset:function t(){this.datums={},this.trie=r()},serialize:function t(){return{datums:this.datums,trie:this.trie}}}),o;function n(t){return t=e.filter(t,(function(t){return!!t})),t=e.map(t,(function(t){return t.toLowerCase()}))}function r(){var t={};return t[s]=[],t[i]={},t}function a(t){for(var e={},i=[],s=0,o=t.length;s<o;s++)e[t[s]]||(e[t[s]]=!0,i.push(t[s]));return i}function l(t,e){var i=0,s=0,o=[];t=t.sort(),e=e.sort();for(var n=t.length,r=e.length;i<n&&s<r;)t[i]<e[s]?i++:(t[i]>e[s]||(o.push(t[i]),i++),s++);return o}}(),l=function(){var t;function i(t){this.url=t.url,this.ttl=t.ttl,this.cache=t.cache,this.prepare=t.prepare,this.transform=t.transform,this.transport=t.transport,this.thumbprint=t.thumbprint,this.storage=new n(t.cacheKey)}return t={data:"data",protocol:"protocol",thumbprint:"thumbprint"},e.mixin(i.prototype,{_settings:function t(){return{url:this.url,type:"GET",dataType:"json"}},store:function e(i){this.cache&&(this.storage.set(t.data,i,this.ttl),this.storage.set(t.protocol,location.protocol,this.ttl),this.storage.set(t.thumbprint,this.thumbprint,this.ttl))},fromCache:function e(){var i={},s;return this.cache?(i.data=this.storage.get(t.data),i.protocol=this.storage.get(t.protocol),i.thumbprint=this.storage.get(t.thumbprint),s=i.thumbprint!==this.thumbprint||i.protocol!==location.protocol,i.data&&!s?i.data:null):null},fromNetwork:function(t){var e=this,i;function s(){t(!0)}function o(i){t(null,e.transform(i))}t&&(i=this.prepare(this._settings()),this.transport(i).fail(s).done(o))},clear:function t(){return this.storage.clear(),this}}),i}(),h=function(){function t(t){this.url=t.url,this.prepare=t.prepare,this.transform=t.transform,this.transport=new r({cache:t.cache,limiter:t.limiter,transport:t.transport})}return e.mixin(t.prototype,{_settings:function t(){return{url:this.url,type:"GET",dataType:"json"}},get:function t(e,i){var s=this,o;if(i)return e=e||"",o=this.prepare(e,this._settings()),this.transport.get(o,n);function n(t,e){i(t?[]:s.transform(e))}},cancelLastRequest:function t(){this.transport.cancel()}}),t}(),c=function(){return function i(n){var r,a;return r={initialize:!0,identify:e.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},!(n=e.mixin(r,n||{})).datumTokenizer&&t.error("datumTokenizer is required"),!n.queryTokenizer&&t.error("queryTokenizer is required"),a=n.sorter,n.sorter=a?function(t){return t.sort(a)}:e.identity,n.local=e.isFunction(n.local)?n.local():n.local,n.prefetch=s(n.prefetch),n.remote=o(n.remote),n};function s(s){var o;return s?(o={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:e.identity,transform:e.identity,transport:null},s=e.isString(s)?{url:s}:s,!(s=e.mixin(o,s)).url&&t.error("prefetch requires url to be set"),s.transform=s.filter||s.transform,s.cacheKey=s.cacheKey||s.url,s.thumbprint=i+s.thumbprint,s.transport=s.transport?a(s.transport):t.ajax,s):null}function o(i){var s;if(i)return s={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:e.identity,transport:null},i=e.isString(i)?{url:i}:i,!(i=e.mixin(s,i)).url&&t.error("remote requires url to be set"),i.transform=i.filter||i.transform,i.prepare=n(i),i.limiter=r(i),i.transport=i.transport?a(i.transport):t.ajax,delete i.replace,delete i.wildcard,delete i.rateLimitBy,delete i.rateLimitWait,i}function n(t){var e,i,s;return e=t.prepare,i=t.replace,s=t.wildcard,e||(e=i?o:t.wildcard?n:r);function o(t,e){return e.url=i(e.url,t),e}function n(t,e){return e.url=e.url.replace(s,encodeURIComponent(t)),e}function r(t,e){return e}}function r(t){var i,s,o;return i=t.limiter,s=t.rateLimitBy,o=t.rateLimitWait,i||(i=/^throttle$/i.test(s)?r(o):n(o)),i;function n(t){return function i(s){return e.debounce(s,t)}}function r(t){return function i(s){return e.throttle(s,t)}}}function a(i){return function s(o){var n=t.Deferred();return i(o,r,a),n;function r(t){e.defer((function(){n.resolve(t)}))}function a(t){e.defer((function(){n.reject(t)}))}}}}(),d=function(){var i;function o(t){t=c(t),this.sorter=t.sorter,this.identify=t.identify,this.sufficient=t.sufficient,this.local=t.local,this.remote=t.remote?new h(t.remote):null,this.prefetch=t.prefetch?new l(t.prefetch):null,this.index=new a({identify:this.identify,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),!1!==t.initialize&&this.initialize()}return i=window&&window.Bloodhound,o.noConflict=function t(){return window&&(window.Bloodhound=i),o},o.tokenizers=s,e.mixin(o.prototype,{__ttAdapter:function t(){var e=this;return this.remote?i:s;function i(t,i,s){return e.search(t,i,s)}function s(t,i){return e.search(t,i)}},_loadPrefetch:function e(){var i=this,s,o;return s=t.Deferred(),this.prefetch?(o=this.prefetch.fromCache())?(this.index.bootstrap(o),s.resolve()):this.prefetch.fromNetwork(n):s.resolve(),s.promise();function n(t,e){if(t)return s.reject();i.add(e),i.prefetch.store(i.index.serialize()),s.resolve()}},_initialize:function t(){var e=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(i),this.initPromise;function i(){e.add(e.local)}},initialize:function t(e){return!this.initPromise||e?this._initialize():this.initPromise},add:function t(e){return this.index.add(e),this},get:function t(i){return i=e.isArray(i)?i:[].slice.call(arguments),this.index.get(i)},search:function t(i,s,o){var n=this,r;return r=this.sorter(this.index.search(i)),s(this.remote?r.slice():r),this.remote&&r.length<this.sufficient?this.remote.get(i,a):this.remote&&this.remote.cancelLastRequest(),this;function a(t){var i=[];e.each(t,(function(t){!e.some(r,(function(e){return n.identify(t)===n.identify(e)}))&&i.push(t)})),o&&o(i)}},all:function t(){return this.index.all()},clear:function t(){return this.index.reset(),this},clearPrefetchCache:function t(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function t(){return r.resetCache(),this},ttAdapter:function t(){return this.__ttAdapter()}}),o}();return d},(t=En).exports=s(Bn()),function(e,i){t.exports=i(Bn())}(Dn,(function(t){var e={isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return void 0===t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(e){return e instanceof t},toStr:function t(i){return e.isUndefined(i)||null===i?"":i+""},bind:t.proxy,each:function(e,i){function s(t,e){return i(e,t)}t.each(e,s)},map:t.map,filter:t.grep,every:function(e,i){var s=!0;return e?(t.each(e,(function(t,o){if(!(s=i.call(null,o,t,e)))return!1})),!!s):s},some:function(e,i){var s=!1;return e?(t.each(e,(function(t,o){if(s=i.call(null,o,t,e))return!1})),!!s):s},mixin:t.extend,identity:function(t){return t},clone:function(e){return t.extend(!0,{},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function e(i){return t.isFunction(i)?i:s;function s(){return String(i)}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var s,o;return function(){var n=this,r=arguments,a,l;return a=function(){s=null,i||(o=t.apply(n,r))},l=i&&!s,clearTimeout(s),s=setTimeout(a,e),l&&(o=t.apply(n,r)),o}},throttle:function(t,e){var i,s,o,n,r,a;return r=0,a=function(){r=new Date,o=null,n=t.apply(i,s)},function(){var l=new Date,h=e-(l-r);return i=this,s=arguments,h<=0?(clearTimeout(o),o=null,r=l,n=t.apply(i,s)):o||(o=setTimeout(a,h)),n}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){}},i=function(){var t={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return i;function i(i){var r,a;return a=e.mixin({},t,i),{css:(r={css:n(),classes:a,html:s(a),selectors:o(a)}).css,html:r.html,classes:r.classes,selectors:r.selectors,mixin:function(t){e.mixin(t,r)}}}function s(t){return{wrapper:'<span class="'+t.wrapper+'"></span>',menu:'<div class="'+t.menu+'"></div>'}}function o(t){var i={};return e.each(t,(function(t,e){i[e]="."+t})),i}function n(){var t={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return e.isMsie()&&e.mixin(t.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),t}}(),s=function(){var i,s;function o(e){e&&e.el||t.error("EventBus initialized without el"),this.$el=t(e.el)}return i="typeahead:",s={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"},e.mixin(o.prototype,{_trigger:function(e,s){var o;return o=t.Event(i+e),(s=s||[]).unshift(o),this.$el.trigger.apply(this.$el,s),o},before:function(t){var e,i;return e=[].slice.call(arguments,1),(i=this._trigger("before"+t,e)).isDefaultPrevented()},trigger:function(t){var e;this._trigger(t,[].slice.call(arguments,1)),(e=s[t])&&this._trigger(e,[].slice.call(arguments,1))}}),o}(),o=function(){var t=/\s+/,e=l();return{onSync:o,onAsync:s,off:n,trigger:r};function i(e,i,s,o){var n;if(!s)return this;for(i=i.split(t),s=o?h(s,o):s,this._callbacks=this._callbacks||{};n=i.shift();)this._callbacks[n]=this._callbacks[n]||{sync:[],async:[]},this._callbacks[n][e].push(s);return this}function s(t,e,s){return i.call(this,"async",t,e,s)}function o(t,e,s){return i.call(this,"sync",t,e,s)}function n(e){var i;if(!this._callbacks)return this;for(e=e.split(t);i=e.shift();)delete this._callbacks[i];return this}function r(i){var s,o,n,r,l;if(!this._callbacks)return this;for(i=i.split(t),n=[].slice.call(arguments,1);(s=i.shift())&&(o=this._callbacks[s]);)r=a(o.sync,this,[s].concat(n)),l=a(o.async,this,[s].concat(n)),r()&&e(l);return this}function a(t,e,i){return s;function s(){for(var s,o=0,n=t.length;!s&&o<n;o+=1)s=!1===t[o].apply(e,i);return!s}}function l(){var t;return t=window.setImmediate?function t(e){setImmediate((function(){e()}))}:function t(e){setTimeout((function(){e()}),0)}}function h(t,e){return t.bind?t.bind(e):function(){t.apply(e,[].slice.call(arguments,0))}}}(),n=function(t){var i={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function o(n){var r;function a(e){var i,s,o;return(i=r.exec(e.data))&&(o=t.createElement(n.tagName),n.className&&(o.className=n.className),(s=e.splitText(i.index)).splitText(i[0].length),o.appendChild(s.cloneNode(!0)),e.parentNode.replaceChild(o,s)),!!i}function l(t,e){for(var i,s=3,o=0;o<t.childNodes.length;o++)3===(i=t.childNodes[o]).nodeType?o+=e(i)?1:0:l(i,e)}(n=e.mixin({},i,n)).node&&n.pattern&&(n.pattern=e.isArray(n.pattern)?n.pattern:[n.pattern],r=s(n.pattern,n.caseSensitive,n.wordsOnly),l(n.node,a))};function s(t,i,s){for(var o=[],n,r=0,a=t.length;r<a;r++)o.push(e.escapeRegExChars(t[r]));return n=s?"\\b("+o.join("|")+")\\b":"("+o.join("|")+")",i?new RegExp(n):new RegExp(n,"i")}}(window.document),r=function(){var i;function s(i,s){(i=i||{}).input||t.error("input is missing"),s.mixin(this),this.$hint=t(i.hint),this.$input=t(i.input),this.query=this.$input.val(),this.queryWhenFocused=this.hasFocus()?this.query:null,this.$overflowHelper=n(this.$input),this._checkLanguageDirection(),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop)}return i={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},s.normalizeQuery=function(t){return e.toStr(t).replace(/^\s*/g,"").replace(/\s{2,}/g," ")},e.mixin(s.prototype,o,{_onBlur:function t(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function t(){this.queryWhenFocused=this.query,this.trigger("focused")},_onKeydown:function t(e){var s=i[e.which||e.keyCode];this._managePreventDefault(s,e),s&&this._shouldTrigger(s,e)&&this.trigger(s+"Keyed",e)},_onInput:function t(){this._setQuery(this.getInputValue()),this.clearHintIfInvalid(),this._checkLanguageDirection()},_managePreventDefault:function t(e,i){var s;switch(e){case"up":case"down":s=!a(i);break;default:s=!1}s&&i.preventDefault()},_shouldTrigger:function t(e,i){var s;return s="tab"!==e||!a(i)},_checkLanguageDirection:function t(){var e=(this.$input.css("direction")||"ltr").toLowerCase();this.dir!==e&&(this.dir=e,this.$hint.attr("dir",e),this.trigger("langDirChanged",e))},_setQuery:function t(e,i){var s,o;o=!!(s=r(e,this.query))&&this.query.length!==e.length,this.query=e,i||s?!i&&o&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},bind:function(){var t=this,s,o,n,r;return s=e.bind(this._onBlur,this),o=e.bind(this._onFocus,this),n=e.bind(this._onKeydown,this),r=e.bind(this._onInput,this),this.$input.on("blur.tt",s).on("focus.tt",o).on("keydown.tt",n),!e.isMsie()||e.isMsie()>9?this.$input.on("input.tt",r):this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",(function(s){i[s.which||s.keyCode]||e.defer(e.bind(t._onInput,t,s))})),this},focus:function t(){this.$input.focus()},blur:function t(){this.$input.blur()},getLangDir:function t(){return this.dir},getQuery:function t(){return this.query||""},setQuery:function t(e,i){this.setInputValue(e),this._setQuery(e,i)},hasQueryChangedSinceLastFocus:function t(){return this.query!==this.queryWhenFocused},getInputValue:function t(){return this.$input.val()},setInputValue:function t(e){this.$input.val(e),this.clearHintIfInvalid(),this._checkLanguageDirection()},resetInputValue:function t(){this.setInputValue(this.query)},getHint:function t(){return this.$hint.val()},setHint:function t(e){this.$hint.val(e)},clearHint:function t(){this.setHint("")},clearHintIfInvalid:function t(){var e,i,s,o;s=(e=this.getInputValue())!==(i=this.getHint())&&0===i.indexOf(e),!(o=""!==e&&s&&!this.hasOverflow())&&this.clearHint()},hasFocus:function t(){return this.$input.is(":focus")},hasOverflow:function t(){var e=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=e},isCursorAtEnd:function(){var t,i,s;return t=this.$input.val().length,i=this.$input[0].selectionStart,e.isNumber(i)?i===t:!document.selection||((s=document.selection.createRange()).moveStart("character",-t),t===s.text.length)},destroy:function e(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$overflowHelper.remove(),this.$hint=this.$input=this.$overflowHelper=t("<div>")}}),s;function n(e){return t('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function r(t,e){return s.normalizeQuery(t)===s.normalizeQuery(e)}function a(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}}(),a=function(){var i,s;function r(i,o){(i=i||{}).templates=i.templates||{},i.templates.notFound=i.templates.notFound||i.templates.empty,i.source||t.error("missing source"),i.node||t.error("missing node"),i.name&&!h(i.name)&&t.error("invalid dataset name: "+i.name),o.mixin(this),this.highlight=!!i.highlight,this.name=i.name||s(),this.limit=i.limit||5,this.displayFn=a(i.display||i.displayKey),this.templates=l(i.templates,this.displayFn),this.source=i.source.__ttAdapter?i.source.__ttAdapter():i.source,this.async=e.isUndefined(i.async)?this.source.length>2:!!i.async,this._resetLastSuggestion(),this.$el=t(i.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}return i={val:"tt-selectable-display",obj:"tt-selectable-object"},s=e.getIdGenerator(),r.extractData=function e(s){var o=t(s);return o.data(i.obj)?{val:o.data(i.val)||"",obj:o.data(i.obj)||null}:null},e.mixin(r.prototype,o,{_overwrite:function t(e,i){(i=i||[]).length?this._renderSuggestions(e,i):this.async&&this.templates.pending?this._renderPending(e):!this.async&&this.templates.notFound?this._renderNotFound(e):this._empty(),this.trigger("rendered",this.name,i,!1)},_append:function t(e,i){(i=i||[]).length&&this.$lastSuggestion.length?this._appendSuggestions(e,i):i.length?this._renderSuggestions(e,i):!this.$lastSuggestion.length&&this.templates.notFound&&this._renderNotFound(e),this.trigger("rendered",this.name,i,!0)},_renderSuggestions:function t(e,i){var s;s=this._getSuggestionsFragment(e,i),this.$lastSuggestion=s.children().last(),this.$el.html(s).prepend(this._getHeader(e,i)).append(this._getFooter(e,i))},_appendSuggestions:function t(e,i){var s,o;o=(s=this._getSuggestionsFragment(e,i)).children().last(),this.$lastSuggestion.after(s),this.$lastSuggestion=o},_renderPending:function t(e){var i=this.templates.pending;this._resetLastSuggestion(),i&&this.$el.html(i({query:e,dataset:this.name}))},_renderNotFound:function t(e){var i=this.templates.notFound;this._resetLastSuggestion(),i&&this.$el.html(i({query:e,dataset:this.name}))},_empty:function t(){this.$el.empty(),this._resetLastSuggestion()},_getSuggestionsFragment:function s(o,r){var a=this,l;return l=document.createDocumentFragment(),e.each(r,(function e(s){var n,r;r=a._injectQuery(o,s),n=t(a.templates.suggestion(r)).data(i.obj,s).data(i.val,a.displayFn(s)).addClass(a.classes.suggestion+" "+a.classes.selectable),l.appendChild(n[0])})),this.highlight&&n({className:this.classes.highlight,node:l,pattern:o}),t(l)},_getFooter:function t(e,i){return this.templates.footer?this.templates.footer({query:e,suggestions:i,dataset:this.name}):null},_getHeader:function t(e,i){return this.templates.header?this.templates.header({query:e,suggestions:i,dataset:this.name}):null},_resetLastSuggestion:function e(){this.$lastSuggestion=t()},_injectQuery:function t(i,s){return e.isObject(s)?e.mixin({_query:i},s):s},update:function e(i){var s=this,o=!1,n=!1,r=0;function a(t){n||(n=!0,t=(t||[]).slice(0,s.limit),r=t.length,s._overwrite(i,t),r<s.limit&&s.async&&s.trigger("asyncRequested",i))}function l(e){e=e||[],!o&&r<s.limit&&(s.cancel=t.noop,r+=e.length,s._append(i,e.slice(0,s.limit-r)),s.async&&s.trigger("asyncReceived",i))}this.cancel(),this.cancel=function e(){o=!0,s.cancel=t.noop,s.async&&s.trigger("asyncCanceled",i)},this.source(i,a,l),!n&&a([])},cancel:t.noop,clear:function t(){this._empty(),this.cancel(),this.trigger("cleared")},isEmpty:function t(){return this.$el.is(":empty")},destroy:function e(){this.$el=t("<div>")}}),r;function a(t){return t=t||e.stringify,e.isFunction(t)?t:i;function i(e){return e[t]}}function l(i,s){return{notFound:i.notFound&&e.templatify(i.notFound),pending:i.pending&&e.templatify(i.pending),header:i.header&&e.templatify(i.header),footer:i.footer&&e.templatify(i.footer),suggestion:i.suggestion||o};function o(e){return t("<div>").text(s(e))}}function h(t){return/^[_a-zA-Z0-9-]+$/.test(t)}}(),l=function(){function i(i,s){var o=this;function n(e){var i=o.$node.find(e.node).first();return e.node=i.length?i:t("<div>").appendTo(o.$node),new a(e,s)}(i=i||{}).node||t.error("node is required"),s.mixin(this),this.$node=t(i.node),this.query=null,this.datasets=e.map(i.datasets,n)}return e.mixin(i.prototype,o,{_onSelectableClick:function e(i){this.trigger("selectableClicked",t(i.currentTarget))},_onRendered:function t(e,i,s,o){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetRendered",i,s,o)},_onCleared:function t(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetCleared")},_propagate:function t(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function t(){return e.every(this.datasets,i);function i(t){return t.isEmpty()}},_getSelectables:function t(){return this.$node.find(this.selectors.selectable)},_removeCursor:function t(){var e=this.getActiveSelectable();e&&e.removeClass(this.classes.cursor)},_ensureVisible:function t(e){var i,s,o,n;s=(i=e.position().top)+e.outerHeight(!0),o=this.$node.scrollTop(),n=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10),i<0?this.$node.scrollTop(o+i):n<s&&this.$node.scrollTop(o+(s-n))},bind:function(){var t=this,i;return i=e.bind(this._onSelectableClick,this),this.$node.on("click.tt",this.selectors.selectable,i),e.each(this.datasets,(function(e){e.onSync("asyncRequested",t._propagate,t).onSync("asyncCanceled",t._propagate,t).onSync("asyncReceived",t._propagate,t).onSync("rendered",t._onRendered,t).onSync("cleared",t._onCleared,t)})),this},isOpen:function t(){return this.$node.hasClass(this.classes.open)},open:function t(){this.$node.addClass(this.classes.open)},close:function t(){this.$node.removeClass(this.classes.open),this._removeCursor()},setLanguageDirection:function t(e){this.$node.attr("dir",e)},selectableRelativeToCursor:function t(e){var i,s,o,n;return s=this.getActiveSelectable(),i=this._getSelectables(),-1===(n=(n=((n=(o=s?i.index(s):-1)+e)+1)%(i.length+1)-1)<-1?i.length-1:n)?null:i.eq(n)},setCursor:function t(e){this._removeCursor(),(e=e&&e.first())&&(e.addClass(this.classes.cursor),this._ensureVisible(e))},getSelectableData:function t(e){return e&&e.length?a.extractData(e):null},getActiveSelectable:function t(){var e=this._getSelectables().filter(this.selectors.cursor).first();return e.length?e:null},getTopSelectable:function t(){var e=this._getSelectables().first();return e.length?e:null},update:function t(i){var s=i!==this.query;return s&&(this.query=i,e.each(this.datasets,o)),s;function o(t){t.update(i)}},empty:function t(){function i(t){t.clear()}e.each(this.datasets,i),this.query=null,this.$node.addClass(this.classes.empty)},destroy:function i(){function s(t){t.destroy()}this.$node.off(".tt"),this.$node=t("<div>"),e.each(this.datasets,s)}}),i}(),h=function(){var t=l.prototype;function i(){l.apply(this,[].slice.call(arguments,0))}return e.mixin(i.prototype,l.prototype,{open:function e(){return!this._allDatasetsEmpty()&&this._show(),t.open.apply(this,[].slice.call(arguments,0))},close:function e(){return this._hide(),t.close.apply(this,[].slice.call(arguments,0))},_onRendered:function e(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),t._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function e(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),t._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function e(i){return this.$node.css("ltr"===i?this.css.ltr:this.css.rtl),t.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function t(){this.$node.hide()},_show:function t(){this.$node.css("display","block")}}),i}(),c=function(){function i(i,o){var n,r,a,l,h,c,d,u,p,m,g;(i=i||{}).input||t.error("missing input"),i.menu||t.error("missing menu"),i.eventBus||t.error("missing event bus"),o.mixin(this),this.eventBus=i.eventBus,this.minLength=e.isNumber(i.minLength)?i.minLength:1,this.input=i.input,this.menu=i.menu,this.enabled=!0,this.active=!1,this.input.hasFocus()&&this.activate(),this.dir=this.input.getLangDir(),this._hacks(),this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this),n=s(this,"activate","open","_onFocused"),r=s(this,"deactivate","_onBlurred"),a=s(this,"isActive","isOpen","_onEnterKeyed"),l=s(this,"isActive","isOpen","_onTabKeyed"),h=s(this,"isActive","_onEscKeyed"),c=s(this,"isActive","open","_onUpKeyed"),d=s(this,"isActive","open","_onDownKeyed"),u=s(this,"isActive","isOpen","_onLeftKeyed"),p=s(this,"isActive","isOpen","_onRightKeyed"),m=s(this,"_openIfActive","_onQueryChanged"),g=s(this,"_openIfActive","_onWhitespaceChanged"),this.input.bind().onSync("focused",n,this).onSync("blurred",r,this).onSync("enterKeyed",a,this).onSync("tabKeyed",l,this).onSync("escKeyed",h,this).onSync("upKeyed",c,this).onSync("downKeyed",d,this).onSync("leftKeyed",u,this).onSync("rightKeyed",p,this).onSync("queryChanged",m,this).onSync("whitespaceChanged",g,this).onSync("langDirChanged",this._onLangDirChanged,this)}return e.mixin(i.prototype,{_hacks:function i(){var s,o;s=this.input.$input||t("<div>"),o=this.menu.$node||t("<div>"),s.on("blur.tt",(function(t){var i,n,r;i=document.activeElement,n=o.is(i),r=o.has(i).length>0,e.isMsie()&&(n||r)&&(t.preventDefault(),t.stopImmediatePropagation(),e.defer((function(){s.focus()})))})),o.on("mousedown.tt",(function(t){t.preventDefault()}))},_onSelectableClicked:function t(e,i){this.select(i)},_onDatasetCleared:function t(){this._updateHint()},_onDatasetRendered:function t(e,i,s,o){this._updateHint(),this.eventBus.trigger("render",s,o,i)},_onAsyncRequested:function t(e,i,s){this.eventBus.trigger("asyncrequest",s,i)},_onAsyncCanceled:function t(e,i,s){this.eventBus.trigger("asynccancel",s,i)},_onAsyncReceived:function t(e,i,s){this.eventBus.trigger("asyncreceive",s,i)},_onFocused:function t(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function t(){this.input.hasQueryChangedSinceLastFocus()&&this.eventBus.trigger("change",this.input.getQuery())},_onEnterKeyed:function t(e,i){var s;(s=this.menu.getActiveSelectable())&&this.select(s)&&i.preventDefault()},_onTabKeyed:function t(e,i){var s;(s=this.menu.getActiveSelectable())?this.select(s)&&i.preventDefault():(s=this.menu.getTopSelectable())&&this.autocomplete(s)&&i.preventDefault()},_onEscKeyed:function t(){this.close()},_onUpKeyed:function t(){this.moveCursor(-1)},_onDownKeyed:function t(){this.moveCursor(1)},_onLeftKeyed:function t(){"rtl"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onRightKeyed:function t(){"ltr"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onQueryChanged:function t(e,i){this._minLengthMet(i)?this.menu.update(i):this.menu.empty()},_onWhitespaceChanged:function t(){this._updateHint()},_onLangDirChanged:function t(e,i){this.dir!==i&&(this.dir=i,this.menu.setLanguageDirection(i))},_openIfActive:function t(){this.isActive()&&this.open()},_minLengthMet:function t(i){return(i=e.isString(i)?i:this.input.getQuery()||"").length>=this.minLength},_updateHint:function t(){var i,s,o,n,a,l,h;i=this.menu.getTopSelectable(),s=this.menu.getSelectableData(i),o=this.input.getInputValue(),!s||e.isBlankString(o)||this.input.hasOverflow()?this.input.clearHint():(n=r.normalizeQuery(o),a=e.escapeRegExChars(n),(h=(l=new RegExp("^(?:"+a+")(.+$)","i")).exec(s.val))&&this.input.setHint(o+h[1]))},isEnabled:function t(){return this.enabled},enable:function t(){this.enabled=!0},disable:function t(){this.enabled=!1},isActive:function t(){return this.active},activate:function t(){return!!this.isActive()||!(!this.isEnabled()||this.eventBus.before("active"))&&(this.active=!0,this.eventBus.trigger("active"),!0)},deactivate:function t(){return!this.isActive()||!this.eventBus.before("idle")&&(this.active=!1,this.close(),this.eventBus.trigger("idle"),!0)},isOpen:function t(){return this.menu.isOpen()},open:function t(){return this.isOpen()||this.eventBus.before("open")||(this.menu.open(),this._updateHint(),this.eventBus.trigger("open")),this.isOpen()},close:function t(){return this.isOpen()&&!this.eventBus.before("close")&&(this.menu.close(),this.input.clearHint(),this.input.resetInputValue(),this.eventBus.trigger("close")),!this.isOpen()},setVal:function t(i){this.input.setQuery(e.toStr(i))},getVal:function t(){return this.input.getQuery()},select:function t(e){var i=this.menu.getSelectableData(e);return!(!i||this.eventBus.before("select",i.obj)||(this.input.setQuery(i.val,!0),this.eventBus.trigger("select",i.obj),this.close(),0))},autocomplete:function t(e){var i,s,o;return i=this.input.getQuery(),!(!(o=(s=this.menu.getSelectableData(e))&&i!==s.val)||this.eventBus.before("autocomplete",s.obj)||(this.input.setQuery(s.val),this.eventBus.trigger("autocomplete",s.obj),0))},moveCursor:function t(e){var i,s,o,n,r;return i=this.input.getQuery(),s=this.menu.selectableRelativeToCursor(e),n=(o=this.menu.getSelectableData(s))?o.obj:null,!(r=this._minLengthMet()&&this.menu.update(i))&&!this.eventBus.before("cursorchange",n)&&(this.menu.setCursor(s),o?this.input.setInputValue(o.val):(this.input.resetInputValue(),this._updateHint()),this.eventBus.trigger("cursorchange",n),!0)},destroy:function t(){this.input.destroy(),this.menu.destroy()}}),i;function s(t){var i=[].slice.call(arguments,1);return function(){var s=[].slice.call(arguments);e.each(i,(function(e){return t[e].apply(t,s)}))}}}();!function(){var o,n,a;function d(e,i){e.each((function(){var e=t(this),s;(s=e.data(n.typeahead))&&i(s,e)}))}function u(t,e){return t.clone().addClass(e.classes.hint).removeData().css(e.css.hint).css(m(t)).prop("readonly",!0).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1})}function p(t,e){t.data(n.attrs,{dir:t.attr("dir"),autocomplete:t.attr("autocomplete"),spellcheck:t.attr("spellcheck"),style:t.attr("style")}),t.addClass(e.classes.input).attr({autocomplete:"off",spellcheck:!1});try{!t.attr("dir")&&t.attr("dir","auto")}catch(t){}return t}function m(t){return{backgroundAttachment:t.css("background-attachment"),backgroundClip:t.css("background-clip"),backgroundColor:t.css("background-color"),backgroundImage:t.css("background-image"),backgroundOrigin:t.css("background-origin"),backgroundPosition:t.css("background-position"),backgroundRepeat:t.css("background-repeat"),backgroundSize:t.css("background-size")}}function g(t){var i,s;i=t.data(n.www),s=t.parent().filter(i.selectors.wrapper),e.each(t.data(n.attrs),(function(i,s){e.isUndefined(i)?t.removeAttr(s):t.attr(s,i)})),t.removeData(n.typeahead).removeData(n.www).removeData(n.attr).removeClass(i.classes.input),s.length&&(t.detach().insertAfter(s),s.remove())}function f(i){var s,o;return(o=(s=e.isJQuery(i)||e.isElement(i))?t(i).first():[]).length?o:null}o=t.fn.typeahead,n={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"},a={initialize:function o(a,d){var m;return d=e.isArray(d)?d:[].slice.call(arguments,1),m=i((a=a||{}).classNames),this.each(g);function g(){var i,o,g,v,y,b,w,x,k,S,E;e.each(d,(function(t){t.highlight=!!a.highlight})),i=t(this),o=t(m.html.wrapper),g=f(a.hint),v=f(a.menu),y=!1!==a.hint&&!g,b=!1!==a.menu&&!v,y&&(g=u(i,m)),b&&(v=t(m.html.menu).css(m.css.menu)),g&&g.val(""),i=p(i,m),(y||b)&&(o.css(m.css.wrapper),i.css(y?m.css.input:m.css.inputWithNoHint),i.wrap(o).parent().prepend(y?g:null).append(b?v:null)),E=b?h:l,w=new s({el:i}),x=new r({hint:g,input:i},m),k=new E({node:v,datasets:d},m),S=new c({input:x,menu:k,eventBus:w,minLength:a.minLength},m),i.data(n.www,m),i.data(n.typeahead,S)}},isEnabled:function t(){var e;return d(this.first(),(function(t){e=t.isEnabled()})),e},enable:function t(){return d(this,(function(t){t.enable()})),this},disable:function t(){return d(this,(function(t){t.disable()})),this},isActive:function t(){var e;return d(this.first(),(function(t){e=t.isActive()})),e},activate:function t(){return d(this,(function(t){t.activate()})),this},deactivate:function t(){return d(this,(function(t){t.deactivate()})),this},isOpen:function t(){var e;return d(this.first(),(function(t){e=t.isOpen()})),e},open:function t(){return d(this,(function(t){t.open()})),this},close:function t(){return d(this,(function(t){t.close()})),this},select:function e(i){var s=!1,o=t(i);return d(this.first(),(function(t){s=t.select(o)})),s},autocomplete:function e(i){var s=!1,o=t(i);return d(this.first(),(function(t){s=t.autocomplete(o)})),s},moveCursor:function t(e){var i=!1;return d(this.first(),(function(t){i=t.moveCursor(e)})),i},val:function t(e){var i;return arguments.length?(d(this,(function(t){t.setVal(e)})),this):(d(this.first(),(function(t){i=t.getVal()})),i)},destroy:function t(){return d(this,(function(t,e){g(e),t.destroy()})),this}},t.fn.typeahead=function(t){return a[t]?a[t].apply(this,[].slice.call(arguments,1)):a.initialize.apply(this,arguments)},t.fn.typeahead.noConflict=function e(){return t.fn.typeahead=o,this}}()}))),En.exports;var t,e,i,s}Rn();const An=jQuery;class jn extends ce{constructor(e,i,o){super(e,i,o),this.label=this.label||(void 0===e.label?"Location":e.label),this.name="location",this.db_type="text",this.typeLabel="Location",this.languages=[{value:"sq",label:"Albanian"},{value:"ar",label:"Arabic"},{value:"eu",label:"Basque"},{value:"be",label:"Belarusian"},{value:"bg",label:"Bulgarian"},{value:"my",label:"Burmese"},{value:"bn",label:"Bengali"},{value:"ca",label:"Catalan"},{value:"zh-cn",label:"Chinese (simplified)"},{value:"zh-tw",label:"Chinese (traditional)"},{value:"hr",label:"Croatian"},{value:"cs",label:"Czech"},{value:"da",label:"Danish"},{value:"nl",label:"Dutch"},{value:"en",label:"English"},{value:"en-au",label:"English (australian)"},{value:"en-gb",label:"English (great Britain)"},{value:"fa",label:"Farsi"},{value:"fi",label:"Finnish"},{value:"fil",label:"Filipino"},{value:"fr",label:"French"},{value:"gl",label:"Galician"},{value:"de",label:"German"},{value:"el",label:"Greek"},{value:"gu",label:"Gujarati"},{value:"iw",label:"Hebrew"},{value:"hi",label:"Hindi"},{value:"hu",label:"Hungarian"},{value:"id",label:"Indonesian"},{value:"it",label:"Italian"},{value:"ja",label:"Japanese"},{value:"kn",label:"Kannada"},{value:"kk",label:"Kazakh"},{value:"ko",label:"Korean"},{value:"ky",label:"Kyrgyz"},{value:"lt",label:"Lithuanian"},{value:"lv",label:"Latvian"},{value:"mk",label:"Macedonian"},{value:"ml",label:"Malayalam"},{value:"mr",label:"Marathi"},{value:"no",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"pt",label:"Portuguese"},{value:"pt-br",label:"Portuguese (brazil)"},{value:"pt-pt",label:"Portuguese (portugal)"},{value:"pa",label:"Punjabi"},{value:"ro",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"sl",label:"Slovenian"},{value:"es",label:"Spanish"},{value:"sv",label:"Swedish"},{value:"tl",label:"Tagalog"},{value:"ta",label:"Tamil"},{value:"te",label:"Telugu"},{value:"th",label:"Thai"},{value:"tr",label:"Turkish"},{value:"uk",label:"Ukrainian"},{value:"uz",label:"Uzbek"},{value:"vi",label:"Vietnamese"}],this.language=e.language,this.markerImages=s.markerImages,this.markersByField=e.markersByField,this.markerField=e.markerField,this.markersByFieldEnabled=t(e.markersByFieldEnabled),this.defaultMarkerPath=e.defaultMarkerPath||this.formBuilder.mapsvg.getData().options.defaultMarkerImage,this.templates.marker=Handlebars.compile(An("#mapsvg-data-tmpl-marker").html())}init(){super.init(),this.value&&this.renderMarker(),this.renderMarkerSelector()}getSchema(){const e=super.getSchema();return e.language=this.language,e.defaultMarkerPath=this.defaultMarkerPath,e.markersByField=this.markersByField,e.markerField=this.markerField,e.markersByFieldEnabled=t(this.markersByFieldEnabled),e}getData(){return{name:this.name,value:this.value}}getDataForTemplate(){const e=super.getDataForTemplate();if(this.formBuilder.admin){e.languages=this.languages,e.markerImages=window.mapsvgAdmin?window.mapsvgAdmin.getData().options.markerImages:[],e.markersByField=this.markersByField,e.markerField=this.markerField,e.markersByFieldEnabled=t(this.markersByFieldEnabled);const i=this;e.markerImages.forEach((function(t){t.relativeUrl===i.defaultMarkerPath?t.default=!0:t.default=!1}))}return e.language=this.language,this.value&&(e.location=this.value,e.location.marker&&(e.location.img=(0===this.value.marker.src.indexOf(s.routes.uploads)?"uploads/":"")+this.value.marker.src.split("/").pop())),e.showUploadBtn=e.external.filtersMode,e}initEditor(){super.initEditor(),this.renderMarkerSelector(),this.fillMarkersByFieldOptions(this.markerField)}setDomElements(){super.setDomElements(),this.domElements.markerImageButton=An(this.domElements.main).find("img")[0]}setEventHandlers(){super.setEventHandlers();const t=this,e=new Xt(s.routes.api);if(t.formBuilder.mapsvg.isGeo()){new Wi({datumTokenizer:Wi.tokenizers.obj.whitespace("formatted_address"),queryTokenizer:Wi.tokenizers.whitespace,remote:{url:e.getUrl("geocoding")+"?address=%QUERY%&language="+this.language,wildcard:"%QUERY%",transform:function(t){return t.error_message&&alert(t.error_message),t.results},rateLimitWait:600}});const t=An(this.domElements.main).find(".typeahead");t.typeahead({minLength:3},{name:"mapsvg-addresses",display:"formatted_address",async:!0,source:(t,e,i)=>{const s=undefined;if(new RegExp(/^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/).test(t)){const i=t.split(",").map((t=>t.trim())),s=undefined;e([{formatted_address:i.join(","),address_components:[],geometry:{location:{lat:()=>i[0],lng:()=>i[1]}}}])}else g({address:t},i)}}).on("typeahead:asyncrequest",(function(t){An(t.target).addClass("tt-loading")})).on("typeahead:asynccancel typeahead:asyncreceive",(function(t){An(t.target).removeClass("tt-loading")})),t.on("typeahead:select",((e,i)=>{this.setValue(null,!1);const s={};s.formatted=i.formatted_address,i.address_components.forEach((t=>{const e=t.types[0];s[e]=t.long_name,t.short_name!=t.long_name&&(s[e+"_short"]=t.short_name)}));const o=this.formBuilder.getData()||{},n={address:s,geoPoint:new zt(i.geometry.location.lat(),i.geometry.location.lng()),img:this.getMarkerImage(o),imagePath:this.getMarkerImage(o)};this.setValue(n,!1),t.typeahead("val",""),this.triggerChanged()}))}An(this.domElements.main).on("change",".marker-file-uploader",(function(){t.markerIconUpload(this)})),An(this.domElements.main).on("click",".mapsvg-marker-image-btn-trigger",(function(e){e.preventDefault(),An(this).toggleClass("active"),t.toggleMarkerSelector()})),An(this.domElements.main).on("click",".mapsvg-marker-delete",(function(e){e.preventDefault(),t.setValue(null),t.triggerChanged()}))}setEditorEventHandlers(){super.setEditorEventHandlers();const t=this;An(this.domElements.edit).on("change",".marker-file-uploader",(function(){t.markerIconUpload(this)})),An(this.domElements.edit).on("change",'select[name="markerField"]',(t=>c(this,void 0,void 0,(function*(){const e=An(t.target).val();this.resetMarkersByField();const i=yield this.fillMarkersByFieldOptions(e);this.setMarkersByField(i)})))),An(this.domElements.edit).on("click",".mapsvg-marker-image-selector button",(function(e){e.preventDefault();const i=An(this).find("img").attr("src");An(this).parent().find("button").removeClass("active"),An(this).addClass("active"),t.setDefaultMarkerPath(i)})),An(this.domElements.edit).on("click",".mapsvg-marker-image-btn-trigger",(function(e){An(this).toggleClass("active"),t.toggleMarkerSelectorInLocationEditor.call(t,An(this),e)}))}markerIconUpload(t){const e=An(t).closest(".btn-file").buttonLoading(!0);for(let i=0;i<t.files.length;i++){const i=new FormData;i.append("file",t.files[0]);const o=undefined;new Xt(s.routes.api).ajax("markers",{type:"POST",data:i,processData:!1,contentType:!1}).done((t=>{if(t.error)alert(t.error);else{const e=t.marker,i=`\n                            <button class="btn btn-outline-secondary mapsvg-marker-image-btn mapsvg-marker-image-btn-choose active">\n                                <img src="${e.relativeUrl}" />\n                            </button>\n                            </button>\n                        `;An(this.domElements.markerSelector).find(".mapsvg-marker-image-btn.active").removeClass("active"),An(i).appendTo(this.domElements.markerSelector),this.setMarkerImage(e.relativeUrl);const s=undefined;window.mapsvgAdmin.getData().options.markerImages.push(e)}})).always((function(){e.buttonLoading(!1)}))}}mayBeAddDistanceRow(){const t=this;this.domElements.editDistanceRow||(this.domElements.editDistanceRow=An(An("#mapsvg-edit-distance-row").html())[0]);const e=An(this.domElements.edit).find(".mapsvg-edit-distance-row:last-child input");if(e&&e.last()&&e.last().val()&&(e.last().val()+"").trim().length){const e=undefined;An(this.templates.editDistanceRow).clone().insertAfter(An(t.domElements.edit).find(".mapsvg-edit-distance-row:last-child"))}const i=An(t.domElements.edit).find(".mapsvg-edit-distance-row"),s=i.eq(i.length-2),o=i.eq(i.length-1);s.length&&o.length&&!s.find("input:eq(0)").val().toString().trim()&&!o.find("input:eq(0)").val().toString().trim()&&o.remove()}fillMarkersByFieldOptions(t){return c(this,void 0,void 0,(function*(){if(!t)return{};0===t.indexOf("Object.")&&(t=t.replace("Object.",""));const e=yield this.formBuilder.mapsvg.objectsRepository.getOptionsByField(t),i={};if(e){const t=this.formBuilder.mapsvg.options.defaultMarkerImage,s=[];e.forEach((e=>{const o=this.markersByField&&this.markersByField[e.value]?this.markersByField[e.value]:t;s.push(`<tr data-option-id="${e.value}"><td>${e.label}</td><td><button class="btn dropdown-toggle btn-outline-secondary mapsvg-marker-image-btn-trigger mapsvg-marker-image-btn"><img src="${o}" class="new-marker-img" /><span class="caret"></span></button></td></tr>`),i[e.value]=o})),An("#markers-by-field").empty().append(s)}return i}))}renderMarker(t){t&&t.location&&(this.value=t.location.getData()),this.renderMarkerHtml()}renderMarkerHtml(){this.value?An(this.domElements.main).find(".mapsvg-new-marker").show().html(this.templates.marker(this.value)):An(this.domElements.main).find(".mapsvg-new-marker").hide()}toggleMarkerSelector(){if(!this.domElements.markerSelectorWrap||!An(this.domElements.markerSelectorWrap).is(":visible"))return this.domElements.markerSelectorWrap&&An(this.domElements.markerSelectorWrap).not(":visible")?(An(this.domElements.markerSelector).find(".active").removeClass("active"),this.value&&this.value.markerImagePath&&An(this.domElements.markerSelector).find('[src="'+this.value.markerImagePath+'"]').parent().addClass("active"),void An(this.domElements.markerSelectorWrap).show()):void 0;An(this.domElements.markerSelectorWrap).hide()}renderMarkerSelector(){const t=this,e=this.formBuilder.editMode?this.domElements.edit:this.domElements.main;if(!e)return;const i=this.value?this.value.markerImagePath:null,s=undefined,o=(window.mapsvgAdmin?window.mapsvgAdmin.getData().options.markerImages:[]).map((t=>{let e=!1;return e=this.formBuilder.editMode?t.default:i==t.relativeUrl,`<button class="btn btn-outline-secondary mapsvg-marker-image-btn mapsvg-marker-image-btn-choose ${e?"active":""}"><img src="${t.relativeUrl}" /></button>`}));this.domElements.markerSelectorWrap=An(e).find(".mapsvg-marker-image-selector")[0],this.domElements.markerSelector=An(this.domElements.markerSelectorWrap).find(".mapsvg-marker-images")[0],this.domElements.markerSelector&&An(this.domElements.markerSelector).empty(),this.formBuilder.editMode||(this.domElements.markerSelectorWrap.style.display="none",An(this.domElements.markerSelector).on("click",".mapsvg-marker-image-btn-choose",(function(e){e.preventDefault();const i=An(this).find("img").attr("src");An(t.domElements.markerSelectorWrap).hide(),An(t.domElements.markerSelector).find(".active").removeClass("active"),An(this).addClass("active"),An(t.domElements.main).find(".mapsvg-marker-image-btn-trigger").toggleClass("active",!1),An(t.domElements.markerImageButton).attr("src",i),t.setMarkerImage(i)}))),An(this.domElements.markerSelector).html(o.join(""))}setMarkerImage(t){this.setDefaultMarkerPath(t);const e=this.value;e&&(e.img=t,e.imagePath=t,this.setValue(e),this.triggerChanged(),this.renderMarker())}toggleMarkerSelectorInLocationEditor(t,e){e.preventDefault();const i=this;if(t.data("markerSelector")&&t.data("markerSelector").is(":visible"))return void t.data("markerSelector").hide();if(t.data("markerSelector")&&t.data("markerSelector").not(":visible"))return void t.data("markerSelector").show();const s=undefined,o=An(this).closest("td").find(".mapsvg-marker-image-btn-trigger").attr("src"),n=undefined,r=(window.mapsvgAdmin?window.mapsvgAdmin.getData().options.markerImages:[]).map((function(t){return`<button class="btn btn-outline-secondary mapsvg-marker-image-btn mapsvg-marker-image-btn-choose ${o==t.relativeUrl?"active":""}"><img src="${t.relativeUrl}" /></button>`}));if(t.data("markerSelector"))t.data("markerSelector").empty();else{const e=An('<div class="mapsvg-marker-image-selector"></div>');t.closest("td").append(e),t.data("markerSelector",e)}t.data("markerSelector").html(r.join("")),t.data("markerSelector").on("click",".mapsvg-marker-image-btn-choose",(function(e){e.preventDefault();const s=An(this).find("img").attr("src");t.data("markerSelector").hide();const o=An(this).closest("td"),n=An(this).closest("tr").data("option-id"),r=o.find(".mapsvg-marker-image-btn-trigger");r.toggleClass("active",!1),r.find("img").attr("src",s),i.setMarkerByField(n,s)}))}setMarkersByField(t){this.markersByField=t}resetMarkersByField(){this.markersByField={}}setMarkerByField(t,e){this.markersByField=this.markersByField||{},this.markersByField[t]=e}deleteMarker(){An(this.domElements.main).find(".mapsvg-new-marker").hide(),An(this.domElements.main).find(".mapsvg-marker-id").attr("disabled","disabled")}destroy(){super.destroy(),this.domElements.markerSelector&&An(this.domElements.markerSelector).popover("dispose")}setDefaultMarkerPath(t){this.defaultMarkerPath=t,this.formBuilder.mapsvg.setDefaultMarkerImage(t)}getMarkerImage(t){let e;if(!this.markersByFieldEnabled)return this.defaultMarkerPath||s.defaultMarkerImage;{const[i,...o]=this.markerField.split("."),r=o.join(".");if(e=n(t,this.markerField),!e)return this.defaultMarkerPath||s.defaultMarkerImage;if("regions"===r?e=e[0]&&e[0].id:"object"==typeof e&&e.length&&(e=e[0].value),this.markersByField[e])return this.markersByField[e]||this.defaultMarkerPath||s.defaultMarkerImage}}setValue(t,e=!0){this.value=t,this.value&&(this.value.address||(this.value.address={}),Object.keys(this.value.address).length<2&&this.value.geoPoint&&(this.value.address.formatted=this.value.geoPoint.lat+","+this.value.geoPoint.lng)),this.renderMarker()}}jQuery;class Ln extends ce{constructor(t,e,i){super(t,e,i),this.showButtonText=t.showButtonText,this.typeLabel="Modal"}getSchema(){const t=super.getSchema();return t.showButtonText=this.showButtonText,t}}const Pn=jQuery;class Fn extends ce{constructor(e,i,s){super(e,i,s),this.formBuilder.admin&&(this.post_types=this.formBuilder.admin.getPostTypes()),this.post_type=e.post_type||this.post_types[0],this.add_fields=t(e.add_fields),this.db_type="int(11)",this.name="post",this.typeLabel="WP Post",this.post=e.post}setDomElements(){super.setDomElements(),this.inputs.postSelect=Pn(this.domElements.main).find(".mapsvg-find-post")[0]}getSchema(){const t=super.getSchema();return t.post_type=this.post_type,t.add_fields=this.add_fields,t}getDataForTemplate(){const t=super.getDataForTemplate();return this.formBuilder.admin&&(t.post_types=this.formBuilder.admin.getPostTypes()),t.post_type=this.post_type,t.post=this.post,t.add_fields=this.add_fields||0,t}setEventHandlers(){super.setEventHandlers();const t=new Xt(s.routes.api);Pn(this.inputs.postSelect).mselect2({placeholder:"Search post by title",allowClear:!0,disabled:this.readonly,ajax:{url:t.getUrl("posts"),dataType:"json",delay:250,data:t=>({filters:{post_type:this.post_type},search:t.term,page:t.page}),processResults:(t,e)=>(e.page=e.page||1,{results:t.posts?t.posts:[],pagination:{more:!1}}),cache:!0},escapeMarkup:t=>t,minimumInputLength:1,templateResult:this.formatRepo,templateSelection:this.formatRepoSelection}).on("select2:select",(t=>{const e=t.params.data;this.setValue(e),this.setInputValue(e),this.triggerChanged()})).on("change",(t=>{""===t.target.value&&(Pn(this.domElements.main).find(".mapsvg-post-id").text(""),Pn(this.domElements.main).find(".mapsvg-post-url").text(""),this.setValue(null,!1),this.triggerChanged())}))}formatRepo(t){return t.loading?t.text:"<div class='select2-result-repository clearfix'>"+t.post_title+"</div>"}formatRepoSelection(t){return(null==t?void 0:t.post_title)||t.text}setValue(t,e=!0){this.value=t,e&&this.setInputValue(t)}setInputValue(t){Pn(this.domElements.main).find(".mapsvg-post-id").text(t.id),Pn(this.domElements.main).find(".mapsvg-post-url").text(t.url).attr("href",t.url)}}const On=jQuery;class In extends ce{constructor(t,e,i){super(t,e,i),this.setOptions(t.options)}setDomElements(){super.setDomElements(),this.inputs.radios=this.formBuilder.getForm().elements[this.name],this.$radios=On(this.domElements.main).find('input[type="radio"]'),this.typeLabel="Radio"}setEventHandlers(){super.setEventHandlers(),this.$radios.on("change",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}setInputValue(t){null===t?this.$radios.prop("checked",!1):this.inputs.radios.value=t}}const Nn=jQuery;class Hn extends ce{constructor(e,i,s){super(e,i,s),this.searchable=t(e.searchable),this.options=this.formBuilder.getRegionsList(),this.label=void 0===e.label?"Regions":e.label,this.name="regions",this.db_type="text",this.typeLabel="Regions",void 0===this.value&&(this.value=[]),this.regionsTableName=this.formBuilder.mapsvg.regionsRepository.getSchema().name}setDomElements(){super.setDomElements(),this.inputs.select=Nn(this.domElements.main).find("select")[0]}getData(){return{name:"regions",value:this.value}}getSchema(){const t=super.getSchema();t.multiselect&&(t.db_type="text");const e=r({},{options:this.options});return t.options=e.options,t.optionsDict={},t.options.forEach((function(e){t.optionsDict[e.id]=e.title||e.id})),t}getDataForTemplate(){const t=super.getDataForTemplate();return t.regionsTableName=this.regionsTableName,t.regionsFromCurrentTable=this.getRegionsForCurrentTable(),t}getRegionsForCurrentTable(){return this.value?this.value.filter((t=>t.tableName===this.regionsTableName)):[]}setEventHandlers(){super.setEventHandlers(),Nn(this.inputs.select).on("change",(t=>{const e=undefined,i=Array.from(this.inputs.select.selectedOptions).map((t=>t.value));this.setValue(i,!1),this.triggerChanged()}))}destroy(){if(Nn().mselect2){const t=Nn(this.domElements.main).find(".mapsvg-select2");t.length&&t.mselect2("destroy")}super.destroy()}setValue(t,e=!0){const i=this.value.filter((t=>t.tableName!==this.regionsTableName)),s=[];t.forEach((t=>{const e=this.formBuilder.mapsvg.getRegion(t);s.push({id:e.id,title:e.title,tableName:this.regionsTableName})})),this.value=s.concat(i),e&&this.setInputValue(t)}}const zn=jQuery;class Vn extends ce{constructor(t,e,i){super(t,e,i),this.readonly=!0}setDomElements(){super.setDomElements(),this.inputs.btnSave=zn(this.domElements.main).find(".btn-save")[0],this.inputs.btnClose=zn(this.domElements.main).find(".mapsvg-close")[0]}setEventHandlers(){super.setEventHandlers(),zn(this.inputs.btnSave).on("click",(t=>{t.preventDefault(),this.events.trigger("click.btn.save")})),zn(this.inputs.btnClose).on("click",(t=>{t.preventDefault(),this.events.trigger("click.btn.close")}))}}const qn=jQuery;class Gn extends ce{constructor(e,i,s){super(e,i,s),this.searchable=t(e.searchable),this.multiselect=t(e.multiselect),this.optionsGrouped=e.optionsGrouped,this.db_type=this.multiselect?"text":"varchar(255)",this.typeLabel="Select",this.setOptions(e.options)}setDomElements(){super.setDomElements(),this.inputs.select=qn(this.domElements.main).find("select")[0]}getSchema(){const e=super.getSchema();e.multiselect=t(this.multiselect),e.multiselect&&(e.db_type="text"),e.optionsGrouped=this.optionsGrouped;const i=r({},{options:this.options});return e.options=i.options||[],e.optionsDict={},e.options.forEach((function(t){e.optionsDict[t.value]=t.label})),e}setEventHandlers(){super.setEventHandlers(),qn(this.inputs.select).on("change",(t=>{if(this.multiselect){const t=undefined,e=Array.from(this.inputs.select.selectedOptions).map((t=>({label:t.label,value:t.value})));this.setValue(e,!1),this.triggerChanged()}else this.setValue(this.inputs.select.value,!1),this.triggerChanged()}))}addSelect2(){if(qn().mselect2){const t={};this.formBuilder.filtersMode&&"select"==this.type&&(t.placeholder=this.placeholder,this.multiselect||(t.allowClear=!0)),qn(this.domElements.main).find("select").css({width:"100%",display:"block"}).mselect2(t).on("select2:focus",(function(){qn(this).mselect2("open")})).on("select2:unselecting",(function(t){qn(this).data("state","unselected")})).on("select2:open",(function(t){if("unselected"===qn(this).data("state")){qn(this).removeData("state");const t=qn(this);setTimeout((function(){t.mselect2("close")}),1)}})),qn(this.domElements.main).find(".select2-selection--multiple .select2-search__field").css("width","100%")}}setOptions(t){return t?(this.options=[],this.optionsDict={},t.forEach(((t,e)=>{this.options.push(t),this.optionsGrouped?t.options.forEach(((t,e)=>{this.optionsDict[t.value]=t})):this.optionsDict[e]=t})),this.options):this.setOptions([{label:"Option one",name:"option_one",value:1},{label:"Option two",name:"option_two",value:2}])}setInputValue(t){this.multiselect?this.value?qn(this.inputs.select).val(this.value.map((t=>t.value))):qn(this.inputs.select).val([]):this.inputs.select.value=this.value,qn(this.inputs.select).trigger("change.select2")}}const $n=jQuery;class Un extends ce{constructor(t,e,i){super(t,e,i),this.label=t.label||"Status",this.name="status",this.typeLabel="Status",this.setOptions(t.options)}setDomElements(){super.setDomElements(),this.inputs.select=$n(this.domElements.main).find("select")[0],$n().colorpicker&&($n(this.domElements.main).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(t){const e=undefined;""==$n(this).find("input").val()&&$n(this).find("i").css({"background-color":""})})),this.domElements.edit&&$n(this.domElements.edit).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(t){const e=undefined;""==$n(this).find("input").val()&&$n(this).find("i").css({"background-color":""})})))}destroy(){if($n().mselect2){const t=$n(this.domElements.main).find(".mapsvg-select2");t.length&&t.mselect2("destroy")}}setEditorEventHandlers(){super.setEditorEventHandlers();const t=this;$n(this.domElements.edit).on("keyup change paste",".mapsvg-edit-status-row input",(function(){t.mayBeAddStatusRow()}))}initEditor(){super.initEditor();const t=this;$n(t.domElements.edit).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(e){const i=$n(this).find("input"),s=$n(this).closest("tr").index();""==i.val()&&$n(this).find("i").css({"background-color":""}),t.options[s]=t.options[s]||{label:"",value:"",color:"",disabled:!1},t.options[s].color=i.val()})),t.mayBeAddStatusRow()}mayBeAddStatusRow(){const t=this,e=$n($n("#mapsvg-edit-status-row").html()),i=$n(t.domElements.edit).find(".mapsvg-edit-status-label:last-child");if(i&&i.last()&&i.last().val()&&(i.last().val()+"").trim().length){const i=e.clone();i.insertAfter($n(t.domElements.edit).find(".mapsvg-edit-status-row:last-child")),i.find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(e){const i=$n(this).find("input"),s=$n(this).closest("tr").index();""==i.val()&&$n(this).find("i").css({"background-color":""}),t.options[s]=t.options[s]||{label:"",value:"",color:"",disabled:!1},t.options[s].color=i.val()}))}const s=$n(t.domElements.edit).find(".mapsvg-edit-status-row"),o=s.eq(s.length-2),n=s.eq(s.length-1);o.length&&n.length&&!(o.find("input:eq(0)").val().toString().trim()||o.find("input:eq(1)").val().toString().trim()||o.find("input:eq(2)").val().toString().trim())&&!(n.find("input:eq(0)").val().toString().trim()||n.find("input:eq(1)").val().toString().trim()||n.find("input:eq(2)").val().toString().trim())&&n.remove()}setEventHandlers(){super.setEventHandlers(),$n(this.inputs.select).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}getSchema(){const e=super.getSchema(),i=r({},{options:this.options});return e.options=i.options,e.optionsDict={},e.options.forEach((function(i,s){""===e.options[s].value?e.options.splice(s,1):(e.options[s].disabled=t(e.options[s].disabled),e.optionsDict[i.value]=i)})),e}setInputValue(t){this.inputs.select.value=t}}const Wn=jQuery;class Xn extends ce{constructor(e,i,s){super(e,i,s),this.searchFallback=t(e.searchFallback),this.searchType=e.searchType,this.width=this.formBuilder.filtersHide&&!this.formBuilder.modal?null:e.width||"100%",this.db_type="varchar(255)",this.typeLabel="Text"}setDomElements(){super.setDomElements(),this.inputs.text=Wn(this.domElements.main).find('input[name="'+this.name+'"]')[0]}getSchema(){const t=super.getSchema();return t.searchType=this.searchType,t}setEventHandlers(){super.setEventHandlers(),Wn(this.inputs.text).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}setInputValue(t){this.inputs.text.value=t}}const Qn=jQuery;class Yn extends ce{constructor(e,i,s){super(e,i,s),this.searchType=e.searchType||"fulltext",this.searchable=t(e.searchable),this.autobr=e.autobr,this.html=e.html,this.format=this.html?"html":e.format||"text",this.db_type="text",this.typeLabel="Long text"}setDomElements(){if(super.setDomElements(),this.inputs.textarea=Qn(this.domElements.main).find("textarea")[0],"text"!==this.format){const t={html:{name:"handlebars",base:"text/html"},json:{name:"javascript",json:!0}};this.editor=window.CodeMirror.fromTextArea(this.inputs.textarea,{mode:t[this.format],matchBrackets:!0,lineNumbers:!0,lint:{esversion:2023,asi:!0},extraKeys:{Tab:function(t){t.replaceSelection("  ","end")}},gutters:["CodeMirror-lint-markers"]}),this.formBuilder.admin&&this.editor.on("change",this.setTextareaValue)}}setEventHandlers(){super.setEventHandlers(),Qn(this.inputs.textarea).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}getSchema(){const t=super.getSchema();return t.autobr=this.autobr,t.html=this.html,t}getDataForTemplate(){const t=super.getDataForTemplate();return t.html=this.html,t}setTextareaValue(t){const e=t.getValue(),i=undefined;Qn(t.getTextArea()).val(e).trigger("change")}destroy(){const t=Qn(this.domElements.main).find(".CodeMirror");t.length&&t.empty().remove(),super.destroy()}}const Zn=jQuery;class Kn extends ce{constructor(e,i,s){super(e,i,s),this.searchFallback=t(e.searchFallback),this.width=this.formBuilder.filtersHide&&!this.formBuilder.modal?null:e.width||"100%",this.db_type="varchar(255)",this.typeLabel="Title"}setDomElements(){super.setDomElements(),this.inputs.text=Zn(this.domElements.main).find('input[type="text"]')[0]}getSchema(){const t=super.getSchema();return t.searchType=this.searchType,t}setEventHandlers(){super.setEventHandlers(),Zn(this.inputs.text).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}setInputValue(t){this.inputs.text.value=t}}jQuery;class Jn{constructor(t){this.mapsvg=t.mapsvg,this.editMode=t.editMode,this.filtersMode=t.filtersMode,this.namespace=t.namespace,this.mediaUploader=t.mediaUploader,this.formBuilder=t.formBuilder,this.showNames=!1!==t.showNames,this.extraParams=null}init(){return c(this,void 0,void 0,(function*(){this.extraParams=yield this.getExtraParams()}))}create(t){if(this.types={checkbox:ue,checkboxes:me,date:fe,distance:Qi,empty:Ki,id:Ji,image:Sn,location:jn,modal:Ln,post:Fn,radio:In,region:Hn,save:Vn,select:Gn,status:Un,text:Xn,textarea:Yn,title:Kn,colorpicker:Zi},!this.extraParams)throw new Error("FormElementFactory.init() must be called before create().");const e=new this.types[t.type](t instanceof Rt?t:new Rt(t),this.formBuilder,this.extraParams);return e.init(),e}getExtraParams(){return c(this,void 0,void 0,(function*(){const t=[];let e=[];const s=[],o=[];let n=[];const r=new Tt("id"),a={mediaUploader:this.mediaUploader,filtersMode:this.filtersMode,showNames:this.showNames,mapIsGeo:!!this.mapsvg&&this.mapsvg.isGeo()};if(!this.editMode)return a;const l=t=>{const e=[],s="post"===t.type||"api"===t.type?"Object":i(t.type);return t.getFields().forEach((t=>c(this,void 0,void 0,(function*(){if("location"!=t.type&&"image"!=t.type)if("post"==t.type){const i=se(["postTypes",t.post_type],this.mapsvg);e.push(`${s}.post.post_title`),e.push(`${s}.post.post_status`);const o=yield i.getPostFields(),{postType:n,meta:r,taxonomy:a}=o;r&&r.filter((t=>!["mapsvg_location","footnotes"].includes(t.name))).forEach((t=>{e.push(`${s}.post.meta.${t.name}`)})),a&&a.forEach((t=>{e.push(`${s}.post.taxonomy.${t.name}`)}))}else e.push(`${s}.${t.name}`)})))),e};return this.mapsvg&&(e=l(this.mapsvg.objectsRepository.getSchema()),n=l(this.mapsvg.regionsRepository.getSchema())),Object.assign(Object.assign({},a),{databaseFields:t,databaseFieldsFilterable:e,databaseFieldsFilterableShort:s,regionFields:o,regionFieldsFilterable:n,regions:r,postTypeData:null})}))}}const tr=jQuery;var er;!function(t){t.AFTER_LOAD="afterLoad",t.CLEAR="clear"}(er||(er={}));class ir{constructor(t){const e=this;if(this.container=t.container,this.namespace=t.namespace,this.mediaUploader=t.mediaUploader,this.schema=t.schema||[],this.editMode=null!=t.editMode&&t.editMode,this.filtersMode=null!=t.filtersMode&&t.filtersMode,this.filtersHide=null!=t.filtersHide&&t.filtersHide,this.modal=null!=t.modal&&t.modal,this.admin=t.admin,this.mapsvg=t.mapsvg,this.data=t.data||{},this.clearButton=t.clearButton||!1,this.clearButtonText=t.clearButtonText||"",this.searchButton=t.searchButton||!1,this.searchButtonText=t.searchButtonText||"",this.showButtonText=t.showButtonText||"",this.scrollable=void 0!==t.scrollable?t.scrollable:!e.editMode&&!e.filtersMode,this.showNames=void 0===t.showNames||t.showNames,this.events=new Bt({context:this,contextName:"form",map:this.mapsvg,parent:t.parent&&t.parent.events?t.parent.events:void 0}),this.formElementFactory=new Jn({mapsvg:this.mapsvg,formBuilder:this,mediaUploader:this.mediaUploader,editMode:this.editMode,filtersMode:this.filtersMode,namespace:this.namespace,showNames:this.showNames}),t.events&&Object.keys(t.events).length>0)for(const e in t.events)this.events.on(e,t.events[e]);this.template="form-builder",this.closeOnSave=!0===t.closeOnSave,this.newRecord=!0===t.newRecord,this.types=t.types||["text","textarea","checkbox","radio","select","image","region","location","post","date"],this.templates={},this.elements={},this.view=tr("<div />").addClass("mapsvg-form-builder")[0],this.editMode&&tr(this.view).addClass("full-flex"),this.showNames||tr(this.view).addClass("hide-names"),this.formElements=new Tt("name")}loadTemplates(t){tr.get(s.routes.root+"dist/"+this.template+".html?v="+s.version,(e=>{tr(e).appendTo("body"),s.templatesLoaded[this.template]=!0,Handlebars.registerPartial("dataMarkerPartial",tr("#mapsvg-data-tmpl-marker").html()),this.editMode&&Handlebars.registerPartial("markerByFieldPartial",tr("#mapsvg-markers-by-field-tmpl-partial").html()),t()}))}init(){return c(this,void 0,void 0,(function*(){if(yield this.formElementFactory.init(),!s.templatesLoaded[this.template])return void this.loadTemplates((()=>this.init()));const t=this;if(this.form=document.createElement("form"),this.form.className="mapsvg-data-form-view",this.filtersMode||this.form.classList.add("form-horizontal"),this.editMode){const t=document.getElementById("mapsvg-form-editor-tmpl-ui").innerHTML,e=Handlebars.compile(t),s=this.types.map((t=>{const e="string"==typeof t?t:t.name;return{name:e,label:"distance"===e?"Address search":i(e),premium:"object"==typeof t&&t.premium}}));this.view.innerHTML=e({types:s}),this.view.classList.add("edit"),this.form.classList.add("mapsvg-data-flex-full"),this.form.classList.add("mapsvg-data-container"),tr(this.view).find(".mapsvg-data-preview").prepend(this.form),this.formEditor=tr(this.view).find("#mapsvg-data-form-edit")[0]}else this.view.appendChild(this.form);t.elements={buttons:{text:tr(t.view).find("#mapsvg-data-btn-text")[0],textarea:tr(t.view).find("#mapsvg-data-btn-textarea")[0],checkbox:tr(t.view).find("#mapsvg-data-btn-checkbox")[0],radio:tr(t.view).find("#mapsvg-data-btn-radio")[0],select:tr(t.view).find("#mapsvg-data-btn-select")[0],image:tr(t.view).find("#mapsvg-data-btn-image")[0],region:tr(t.view).find("#mapsvg-data-btn-region")[0],marker:tr(t.view).find("#mapsvg-data-btn-marker")[0],saveSchema:tr(t.view).find("#mapsvg-data-btn-save-schema")[0]},containers:{buttons_add:tr(t.view).find("#mapsvg-data-buttons-add")[0]}},t.redraw()}))}getForm(){return this.form}getFormEditor(){return this.formEditor}viewDidLoad(){}setEventHandlers(){const t=this;tr(this.getForm()).on("submit",(t=>{t.preventDefault()})),this.filtersMode&&this.clearButton&&tr(this.elements.buttons.clearButton).on("click",(t=>{t.preventDefault(),this.clearAllFields()})),this.editMode&&(tr(this.view).on("click","#mapsvg-data-buttons-add button[data-create]",(function(e){e.preventDefault();const i=tr(this).data("create"),s=t.formElementFactory.create({type:i});t.addField(s)})),tr(this.view).on("click","#mapsvg-data-btn-save-schema",(function(e){e.preventDefault();const i=t.getSchema(),s={};t.formElements.forEach((function(t){s[t.name]=(s[t.name]||0)+1})),tr(t.getForm()).find(".form-group").removeClass("has-error");const o=[],n=["lat","lon","lng","location","location_lat","location_lon","location_lng","location_address","location_img","marker","marker_id","regions","region_id","post","post_title","post_url","keywords","status"],r={regions:"region",status:"status",post:"post",marker:"marker",location:"location"};let a,l;t.formElements.forEach((function(e){let i=!1;if(!t.filtersMode)if(s[e.name]>1)a||(a="Field names should be unique",o.push(a),i=!0);else if(0===e.name.length)l||(l="Field name can't be empty",o.push(l),i=!0);else if(-1!=n.indexOf(e.name)&&(!r[e.name]||r[e.name]&&r[e.name]!=e.type)){const t='Field name "'+e.name+'" is reserved, please set another name';o.push(t),i=!0}if(e.options&&"region"!=e.type&&"marker"!=e.type){const t=e.options.map((function(t){return t.value})),s=[...Array.from(new Set(t).values())];t.length!=s.length&&(o.push('Check "Options" list - values should not repeat'),i=!0)}i&&tr(e.domElements.main).addClass("has-error")})),0===o.length?t.events.trigger("saveSchema",{formBuilder:t,fields:i}):jQuery.growl.error({title:"Errors",message:o.join("<br />")})})),setTimeout((function(){const e=t.getForm();t.sortable=new Sortable(e,{animation:150,onStart:function(){tr(t.getForm()).addClass("sorting")},onEnd:function(){setTimeout((function(){tr(t.getForm()).removeClass("sorting"),t.formElements.clear(),tr(e).find(".form-group").each((function(e,i){t.formElements.push(tr(i).data("formElement"))}))}),500)}})}),1e3)),new m(this.view,(function(){t.scrollApi&&t.scrollApi.reinitialise()}))}clearAllFields(){this.formElements.forEach((t=>t.setValue(null))),this.events.trigger(er.CLEAR,{formBuilder:this})}setFormElementEventHandlers(t){this.editMode&&(t.events.on("click",(t=>{const{formElement:e}=t.data;this.edit(e)})),t.events.on("delete",(t=>{const{formElement:e}=t.data;this.deleteField(e)})))}save(){const t=this;if(t.markerBackup){const e=t.mapsvg.getEditingMarker();e.events.off("change"),t.markerBackup=e.getOptions(),t.mapsvg.unsetEditingMarker()}const e=t.getData();t.saved=!0,this.events.trigger("save",{formBuilder:this,data:e})}getFormElementByType(t){return this.formElements.find((e=>e.type===t))}getFormElementByName(t){return this.formElements.find((e=>e.name===t))}getData(){const t={};return this.formElements.forEach((e=>{if("save"!==e.type&&"empty"!==e.type){const i=e.getData();t[i.name]=i.value}})),t}reset(){this.formElements.forEach((t=>{t.setValue(null)}))}update(t){this.schema.getFields().forEach((e=>{const i=this.formElements.get(e.name);if(i){const s=n(t,e.name);void 0!==s?i.getValue()!==s&&i.setValue(s):i.setValue(null)}}))}redraw(){const t=this;if(delete t.markerBackup,tr(this.container).empty(),tr(this.getForm()).empty(),this.formElements.clear(),this.schema&&this.schema.fields.length>0&&this.schema.fields.forEach((t=>{this.filtersMode?"distance"==t.type?t.value=this.data.distance?this.data.distance:void 0!==t.value?t.value:null:"search"==t.type?t.value=this.data.search:t.value=this.data[t.parameterNameShort]:t.value=this.data?this.data[t.name]:void 0!==t.value?t.value:null,"location"!=t.type||this.editMode?"post"==t.type?t.post=this.data.post:"region"===t.type&&(t.options=new Tt("id",this.getRegionsList())):(t.value&&t.value.marker&&t.value.marker.id,this.admin&&this.admin.setMode&&this.admin.setMode("editMarkers"),this.admin&&this.admin.enableMarkersMode(!0));const e=this.formElementFactory.create(t);this.filtersMode?(!this.filtersHide||this.filtersHide&&this.modal&&"search"!==t.type||!this.modal&&"search"===t.type)&&this.addField(e):this.addField(e)})),!t.editMode)if(0!==this.schema.fields.length||this.filtersMode){if(t.admin&&!t.admin.isMetabox){const e=this.formElementFactory.create({type:"save"});e.events.on("click.btn.save",(()=>{this.save()})),e.events.on("click.btn.close",(()=>{this.close()})),t.addField(e)}}else{const e=this.formElementFactory.create({type:"empty"});t.addField(e)}if(t.filtersMode&&t.filtersHide&&!t.modal){const e=this.formElementFactory.create({type:"modal",showButtonText:t.showButtonText});this.showFiltersButton=t.addField(e)}if(this.scrollable){const e=tr('<div class="nano"></div>'),i=tr('<div class="nano-content"></div>');e.append(i),i.append(this.view),tr(t.container).append(e),"function"==typeof e.jScrollPane&&(e.jScrollPane({contentWidth:"0px",mouseWheelSpeed:30}),t.scrollApi=e.data("jsp"))}else tr(t.container).append(this.view);t.filtersMode&&t.clearButton&&(t.elements.buttons.clearButton=tr('<div class="form-group mapsvg-filters-reset-container"><button type="button" class="btn btn-outline-secondary mapsvg-filters-reset">'+t.clearButtonText+"</button></div>")[0],tr(this.getForm()).append(t.elements.buttons.clearButton)),t.filtersMode&&t.searchButton&&(t.elements.buttons.searchButton=tr('<div class="form-group mapsvg-filters-reset-container" id="mapsvg-search-container"><button class="btn btn-outline-secondary mapsvg-filters-reset">'+t.searchButtonText+"</button></div>")[0],tr(this.getForm()).append(t.elements.buttons.searchButton)),this.editMode||t.filtersMode||tr(this.view).find("input:visible,textarea:visible").not(".tt-hint").first().focus();const e=undefined;tr(this.container).find(".CodeMirror").each((function(t,e){e&&e.CodeMirror.refresh()})),t.setEventHandlers();const i=undefined;[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"][data-premium="true"]')).map((function(t){return new window.bootstrap.Popover(t,{content:'<i class="bi bi-star-fill"></i> Premium feature <a class="btn btn-xs btn-outline-primary" target="_blank" href="https://mapsvg.com/pricing">Upgrade</a>',html:!0,trigger:"focus",placement:"top"})})),this.events.trigger("init",{formBuilder:this,data:this.getData()}),this.events.trigger(er.AFTER_LOAD,{formBuilder:this,data:this.getData()})}updateExtraParamsInFormElements(){return c(this,void 0,void 0,(function*(){this.formElements.forEach((t=>{t.setExternal(this.formElementFactory.extraParams),"location"===t.type&&t.redraw()}))}))}deleteField(t){this.formElements.delete(t.name)}addField(t){const e=this;if(-1!=["region","marker","post","status","distance","location","search"].indexOf(t.type)){let s=!1;if(e.formElements.forEach((function(e){e.type==t.type&&(s=!0)})),s)return void jQuery.growl.error({title:"Error",message:'You can add only 1 "'+i(t.type)+'" field'})}return e.formElements.push(t),e.getForm().append(t.domElements.main),this.setFormElementEventHandlers(t),this.editMode&&(t.protected?t.hide():this.edit(t)),t}edit(t){const e=this;e.currentlyEditing&&e.currentlyEditing.destroyEditor(),this.getFormEditor().appendChild(t.getEditor()),t.initEditor(),e.currentlyEditing=t,tr(e.getForm()).find(".form-group.active").removeClass("active"),tr(t.domElements.main).addClass("active")}get(){}getSchema(){return this.formElements.map((function(t){return t.getSchema()}))}close(){this.formElements.forEach((t=>t.destroy())),this.mediaUploader&&this.mediaUploader.off("select"),this.mapsvg&&tr(window).off("keydown.form.mapsvg-"+this.mapsvg.id),this.events.trigger("close",{formBuilder:this})}destroy(){tr(this.view).empty().remove(),this.mapsvg&&tr(window).off("keydown.form.mapsvg-"+this.mapsvg.id),this.sortable=null}toJSON(t){const e={};function i(e,s,o){if(!t&&!o)return!1;1==s.length?e[s[0]]=o:(null==e[s[0]]&&(""===s[1]?e[s[0]]=[]:e[s[0]]={}),void 0!==e[s[0]].length?e[s[0]].push(o):i(e[s[0]],s.slice(1),o))}return tr(this.elements.containers.formView).find("input, textarea, select").each((function(){if(!tr(this).data("skip")&&!tr(this).prop("disabled")&&tr(this).attr("name")&&(t||"checkbox"!=tr(this).attr("type")||null!=tr(this).attr("checked"))&&("radio"!=tr(this).attr("type")||null!=tr(this).attr("checked"))){let t;t="checkbox"==tr(this).attr("type")?tr(this).prop("checked"):tr(this).val(),i(e,tr(this).attr("name").replace(/]/g,"").split("["),t)}})),e}getRegionsList(){return this.mapsvg.regions.map((function(t){return{id:t.id,title:t.title}}))}getRegionsAsArray(){return this.mapsvg.regions}setRegions(t){const e=this.formElements.get("regions");-1!==this.mapsvg.options.source.indexOf("/geo-calibrated/usa.svg")?e.setValue(["US-"+t.address.state_short]):-1!==this.mapsvg.options.source.indexOf("/geo-calibrated/world.svg")?t.address.country_short&&e.setValue([t.address.country_short]):t.address.administrative_area_level_1&&this.mapsvg.regions.forEach((i=>{i.title!==t.address.administrative_area_level_1&&i.title!==t.address.administrative_area_level_2&&i.id!==t.address.country_short+"-"+t.address.administrative_area_level_1_short||e.setValue([i.id])}))}setIsLoading(t){this.isLoading=t,this.searchButton&&(this.isLoading?tr(this.elements.buttons.searchButton).find("button").attr("disabled","disabled"):tr(this.elements.buttons.searchButton).find("button").removeAttr("disabled"))}}const sr=jQuery;var or,nr,rr;!function(t){t.CLICK_SHOW_FILTERS="click.btnShowFilters",t.CLICK_SEARCH="click.btnSearch"}(or||(or={}));class ar extends le{constructor(t){super(t),this.name="filters",this.classList=["mapsvg-filters-wrap","mapsvg-filters-container","mapsvg-controller-no-padding"],this.position="relative",this.closable=!1,this.withToolbar=!1,this.showButtonText=t.showButtonText,this.clearButton=t.clearButton,this.clearButtonText=t.clearButtonText,this.searchButton=t.searchButton,this.searchButtonText=t.searchButtonText,this.schema=t.schema,this.hideFilters=t.hideFilters,this.query=t.query}viewDidRedraw(){super.viewDidLoad(),this.formBuilder&&this.formBuilder.destroy(),this.formBuilder=new ir({container:this.containers.contentView,filtersMode:!0,schema:this.schema,modal:this.modal,filtersHide:this.hideFilters,showButtonText:this.showButtonText,clearButton:this.clearButton,clearButtonText:this.clearButtonText,searchButton:this.searchButton,searchButtonText:this.searchButtonText,editMode:!1,mapsvg:this.map,data:Object.assign(Object.assign({},this.query.filters),{search:this.query.search}),admin:!1,parent:this,events:{"change.formElement":t=>{const{formElement:e,field:i}=t.data;let s=JSON.parse(JSON.stringify(t.data.value));if("search"===e.type)this.query.setSearch(s);else{const t={};0===s.length&&(s=null),"regions"===i?s=s&&s[0]?{table_name:this.map.regionsRepository.getSchema().name,region_ids:Array.isArray(s)?s.map((t=>t.value)):[s]}:null:"distance"!==i||s.geoPoint&&s.geoPoint.lat&&s.geoPoint.lat||(s=null),f(t,i,s),this.query.setFilters(t)}},clear:t=>{t.data,this.query.clearFilters()},afterLoad:t=>{t.data,this.updateScroll()}}}),this.formBuilder.init()}reset(){this.formBuilder&&this.formBuilder.reset()}update(t){const e=Object.assign({},t.filters);e.search=t.search,e.regions&&e.regions.region_ids&&(e.regions=e.regions.region_ids.map((t=>({value:t})))),this.formBuilder&&this.formBuilder.update(e)}setFiltersCounter(){if(this.hideFilters){const t=Object.keys(this.query.filters).length,e=0===t?"":t.toString();this.formBuilder&&this.formBuilder.showFiltersButton&&sr(this.formBuilder.showFiltersButton.domElements.main).find("button").html(this.showButtonText+" <b>"+e+"</b>")}}setEventHandlers(){super.setEventHandlers();const t=this;sr(this.containers.view).on("click",".mapsvg-btn-show-filters",(function(){t.events.trigger(or.CLICK_SHOW_FILTERS)})),sr(this.containers.view).on("click","#mapsvg-search-container button",(function(){t.events.trigger(or.CLICK_SEARCH)}))}}class lr{constructor(t,e,i,s){this.x=0,this.y=0,this.width=0,this.height=0,this.initialized=!1,void 0!==t&&this.update(t,e,i,s)}update(t,e,i,s){if("object"==typeof t){if(!Array.isArray(t)&&Object.prototype.hasOwnProperty.call(t,"x")&&Object.prototype.hasOwnProperty.call(t,"y")&&Object.prototype.hasOwnProperty.call(t,"width")&&Object.prototype.hasOwnProperty.call(t,"height"))this.x="string"==typeof t.x?parseFloat(t.x):t.x,this.y="string"==typeof t.y?parseFloat(t.y):t.y,this.width="string"==typeof t.width?parseFloat(t.width):t.width,this.height="string"==typeof t.height?parseFloat(t.height):t.height,this.initialized=!0;else if(Array.isArray(t)){if(4!==t.length)throw new Error("ViewBox Array must have 4 elements");this.x="string"==typeof t[0]?parseFloat(t[0]):t[0],this.y="string"==typeof t[1]?parseFloat(t[1]):t[1],this.width="string"==typeof t[2]?parseFloat(t[2]):t[2],this.height="string"==typeof t[3]?parseFloat(t[3]):t[3],this.initialized=!0}}else"string"==typeof t&&void 0===e&&([t,e,i,s]=t.trim().split(" ").map((function(t){return parseFloat(t)}))),this.x="string"==typeof t?parseFloat(t):t,this.y="string"==typeof e?parseFloat(e):e,this.width="string"==typeof i?parseFloat(i):i,this.height="string"==typeof s?parseFloat(s):s,this.initialized=!0}toString(){return this.x+" "+this.y+" "+this.width+" "+this.height}toArray(){return[this.x,this.y,this.width,this.height]}clone(){return new lr({x:this.x,y:this.y,width:this.width,height:this.height})}fitsInViewBox(t,e){return!0===e?t.width>=this.width||t.height>=this.height:t.width>=this.width&&t.height>=this.height}addPadding(t){t.top&&(this.y-=t.top,this.height+=t.top),t.right&&(this.width+=t.right),t.bottom&&(this.height+=t.bottom),t.left&&(this.x-=t.left,this.width+=t.left)}}class hr{constructor(t,e){this.sw=t,this.ne=e}}jQuery,function(t){t.REGION="region",t.MARKER="marker",t.CLUSTER="cluster"}(nr||(nr={})),function(t){t.UPDATE="update",t.CLICK="click",t.MOUSEOVER="mouseOver",t.MOUSEOUT="mouseOut",t.MOUSEDOWN="mouseDown",t.MOUSEUP="mouseUp"}(rr||(rr={}));class cr{constructor(t,e){this.name="mapObject",this.id="",this.element=t,this.mapsvg=e,this.events=new Bt({context:this,contextName:this.name,map:this.mapsvg,parent:this.mapsvg.events})}isRegion(){return this.type===nr.REGION}isMarker(){return this.type===nr.MARKER}isCluster(){return this.type===nr.CLUSTER}getBBox(){return new lr(1,2,3,4)}getGeoBounds(){const t=this.getBBox(),e=new Nt(t.x,t.y+t.height),i=new Nt(t.x+t.width,t.y),s=undefined,o=undefined;return{sw:this.mapsvg.converter.convertSVGToGeo(e),ne:this.mapsvg.converter.convertSVGToGeo(i)}}getComputedStyle(t,e){return e=e||this.element,cr.getComputedStyle(t,e)}static getComputedStyle(t,e){const i=e.getAttribute(t);if(i)return i;const s=e.getAttribute("style");if(s){const e=undefined,i=s.split(";").filter((function(e){const i=undefined;if((e=e.trim()).split(":")[0]==t)return!0}));if(i.length)return i[0].split(":").pop().trim()}const o=e.parentElement,n=o?o.tagName:null;return n&&"svg"!=n?cr.getComputedStyle(t,o):void 0}getStyle(t){const e=this.attr(t);if(e)return e;const i=this.attr("style");if(i){const e=undefined,s=i.split(";").filter((function(e){if(0===(e=e.trim()).indexOf(t))return e}));return s.length?s[0].split(":").pop().trim():void 0}return""}getCenter(){const t=this.element.getBoundingClientRect().left,e=this.element.getBoundingClientRect().top,i=this.element.getBoundingClientRect().width,s=this.element.getBoundingClientRect().height,o=undefined;return new Ot(t+i/2,e+s/2)}getCenterSVG(){const t=Number(this.element.getAttribute("data-label-x")),e=Number(this.element.getAttribute("data-label-y"));if(t&&e)return new Nt(t,e);{const t=this.getBBox();return new Nt(t.x+t.width/2,t.y+t.height/2)}}getCenterLatLng(t){t=t||0;const e=this.getBBox(),i=e.x+e.width/2,s=e.y+e.height/2-t,o=new Nt(i,s);return this.mapsvg.converter.convertSVGToGeo(o)}attr(t,e=null){const i=this.element;if("object"==typeof t)for(const e in t){const s=t[e];"string"!=typeof s&&"number"!=typeof s||i.setAttribute(e,""+s)}else if("string"!=typeof t||"string"!=typeof e&&"number"!=typeof e){if(null==e)return i.getAttribute(t)}else i.setAttribute(t,""+e)}setId(t){void 0!==t&&(this.id=t,this.element.setAttribute("id",t))}}const dr=jQuery;class ur extends cr{constructor(t){if(super(null,t.mapsvg),this.name="marker",this.type=nr.MARKER,this.element=dr("<div />").addClass("mapsvg-marker")[0],this.image=dr('<img src="" />').addClass("mapsvg-marker-image")[0],this.image.style.visibility="hidden",t.object&&this.setObject(t.object),!(t.location instanceof Vt))throw new Error("No Location provided for Marker initializaton");this.location=t.location,this.location.marker=this,this.setImage(this.location.imagePath),dr(this.element).append(this.image),t.width&&t.height?this.setSize(t.width,t.height):this.setSize(15,24),this.setId(t.id||(this.object?`marker_${this.object.id}`:this.mapsvg.markerId())),this.setSvgPointFromLocation(),this.setAltAttr()}reload(){this.setImage(),this.setSvgPointFromLocation()}getImagePath(){return this.object&&this.object.getMarkerImage()||this.location.getMarkerImage()}setSize(t,e){this.width=t,this.height=e,this.setCentered(this.width===this.height)}setSvgPointFromLocation(){const t=this.location.svgPoint?this.location.svgPoint:this.location.geoPoint&&0!==this.location.geoPoint.lat&&0!==this.location.geoPoint.lng?this.mapsvg.converter.convertGeoToSVG(this.location.geoPoint):null;t&&this.setSvgPoint(t)}setId(t){cr.prototype.setId.call(this,t),this.mapsvg.markers.reindex()}getBBox(){return this.centered?new lr(this.svgPoint.x-this.width/2/this.mapsvg.scale,this.svgPoint.y-this.height/2/this.mapsvg.scale,this.width/this.mapsvg.scale,this.height/this.mapsvg.scale):new lr(this.svgPoint.x-this.width/2/this.mapsvg.scale,this.svgPoint.y-this.height/this.mapsvg.scale,this.width/this.mapsvg.scale,this.height/this.mapsvg.scale)}getOptions(){const t={id:this.id,src:this.src,svgPoint:this.svgPoint,geoPoint:this.geoPoint};return dr.each(t,(function(e,i){null==i&&delete t[e]})),t}update(t){for(const e in t){const s="set"+i(e);s in this&&this[s](t[e])}}setImage(t,e=!1){t||(t=this.getImagePath()),this.src=v(t);const i=new Image;i.onload=()=>{"src"!==this.image.getAttribute("src")&&this.image.setAttribute("src",this.src),this.setSize(i.width,i.height),this.image.style.visibility="visible",this.adjustScreenPosition()},i.src=this.src,this.events.trigger("change")}setAltAttr(){const t=this;t.altAttr=void 0!==t.object&&void 0!==t.object.title&&""!==t.object.title?t.object.title:t.id,t.image.setAttribute("alt",t.altAttr)}setSvgPoint(t){this.svgPoint=t,this.adjustScreenPosition(),this.events.trigger("change")}adjustScreenPosition(){const t=this.mapsvg.converter.convertSVGToPixel(this.svgPoint);t.x-=this.width/2,t.y-=this.centered?this.height/2:this.height,this.setScreenPosition(t.x,t.y)}moveSrceenPositionBy(t,e){const i=this.screenPoint,s=i.x-t,o=i.y-e;this.setScreenPosition(s,o)}setScreenPosition(t,e){this.screenPoint instanceof Ot?(this.screenPoint.x=t,this.screenPoint.y=e):this.screenPoint=new Ot(t,e),this.updateVisibility(),!0===this.visible&&(this.element.style.transform="translate("+t+"px,"+e+"px)",this.adjustLabelScreenPosition())}adjustLabelScreenPosition(){if(this.label){const t=this.screenPoint;Math.round(t.x+this.width/2-dr(this.label).outerWidth()/2),Math.round(t.y-dr(this.label).outerHeight())}}inViewBox(){const t=this.screenPoint.x,e=this.screenPoint.y,i=this.mapsvg.containers.map.offsetWidth,s=this.mapsvg.containers.map.offsetHeight;return t-this.width/2<2*i&&t+this.width/2>-i&&e-this.height/2<2*s&&e+this.height/2>-s}updateVisibility(){return!0===this.inViewBox()?(this.visible=!0,this.element.classList.remove("mapsvg-out-of-sight"),this.label&&this.label.classList.remove("mapsvg-out-of-sight")):(this.visible=!1,this.element.classList.add("mapsvg-out-of-sight"),this.label&&this.label.classList.add("mapsvg-out-of-sight")),this.visible}isMoving(){return this.moving}setMoving(t){this.moving=t}drag(t,e,i,s){const o=this;this.svgPointBeforeDrag=new Nt(this.svgPoint.x,this.svgPoint.y),this.setMoving(!0),dr("body").on("mousemove.drag.mapsvg",(function(i){i.preventDefault(),dr(o.mapsvg.containers.map).addClass("no-transitions");const s=y(i),n=s.x-t.x,r=s.y-t.y,a=new Nt(o.svgPointBeforeDrag.x+n/e,o.svgPointBeforeDrag.y+r/e);o.location.setSvgPoint(a)})),dr("body").on("mouseup.drag.mapsvg",(function(n){n.preventDefault(),o.undrag();const r=y(n),a=r.x-t.x,l=r.y-t.y,h=new Nt(o.svgPointBeforeDrag.x+a/e,o.svgPointBeforeDrag.y+l/e);if(o.location.setSvgPoint(h),o.mapsvg.isGeo()){const t=o.mapsvg.converter.convertSVGToGeo(h);o.location.setGeoPoint(t)}i&&i.call(o),o.svgPointBeforeDrag.x==o.svgPoint.x&&o.svgPointBeforeDrag.y==o.svgPoint.y&&s&&s.call(o)}))}undrag(){this.setMoving(!1),dr("body").off(".drag.mapsvg"),dr(this.mapsvg.containers.map).removeClass("no-transitions")}delete(){this.label&&(this.label.remove(),this.label=null),dr(this.element).empty().remove()}setObject(t){this.object=t,dr(this.element).attr("data-object-id",this.object.id)}hide(){dr(this.element).addClass("mapsvg-marker-hidden"),this.label&&dr(this.label).hide()}show(){dr(this.element).removeClass("mapsvg-marker-hidden"),this.label&&dr(this.label).show()}highlight(){dr(this.element).addClass("mapsvg-marker-hover")}unhighlight(){dr(this.element).removeClass("mapsvg-marker-hover")}select(){this.selected=!0,dr(this.element).addClass("mapsvg-marker-active")}deselect(){this.selected=!1,dr(this.element).removeClass("mapsvg-marker-active")}getData(){return this.object}getChoroplethColor(){const t=parseFloat(this.object[this.mapsvg.options.choropleth.sourceField]);let e;if(t)if("gradient"===this.mapsvg.options.choropleth.coloring.mode){const i=this.mapsvg.options.choropleth.coloring.gradient,s=0===i.values.maxAdjusted?0:(t-i.values.min)/i.values.maxAdjusted,o=Math.round(i.colors.diffRGB.r*s+i.colors.lowRGB.r),n=Math.round(i.colors.diffRGB.g*s+i.colors.lowRGB.g),r=Math.round(i.colors.diffRGB.b*s+i.colors.lowRGB.b),a=(i.colors.diffRGB.a*s+i.colors.lowRGB.a).toFixed(2);e="rgba("+o+","+n+","+r+","+a+")"}else{const i=this.mapsvg.options.choropleth.coloring.palette.colors;!i[0].valueFrom&&t<i[0].valueTo?e=i[0].color:!i[i.length-1].valueTo&&t>i[i.length-1].valueFrom?e=i[i.length-1].color:(i.forEach((function(i){t>=i.valueFrom&&t<i.valueTo&&(e=i.color)})),e=e||this.mapsvg.options.choropleth.coloring.palette.outOfRange.color)}else e=this.mapsvg.options.choropleth.coloring.noData.color;return e}getBubbleSize(){let t;if(this.object[this.mapsvg.options.choropleth.sourceField]){const e=Number(this.mapsvg.options.choropleth.bubbleSize.max),i=Number(this.mapsvg.options.choropleth.bubbleSize.min),s=this.mapsvg.options.choropleth.coloring.gradient.values.max,o=this.mapsvg.options.choropleth.coloring.gradient.values.min,n=undefined;t=(parseFloat(this.object[this.mapsvg.options.choropleth.sourceField])-o)/(s-o)*(e-i)+Number(i)}else t=!1;return t}getBubbleScreenPosition(){const t=Number(this.getBubbleSize());return{x:this.width/2-t/2,y:this.height-t/2}}drawBubble(){const t="mapsvg-bubble-"+this.object.id,e=undefined;if(parseFloat(this.object[this.mapsvg.options.choropleth.sourceField])){this.bubble||(this.bubble=dr('<div id="'+t+'" data-marker-id="'+this.element.id+'" class="mapsvg-bubble mapsvg-marker-bubble"></div>')[0],dr(this.element).append(this.bubble));const e=this.getChoroplethColor(),i=Number(this.getBubbleSize());dr(this.bubble).css("background-color",e).css("width",i+"px").css("height",i+"px").css("lineHeight",i-2+"px")}else dr("#"+t).remove(),delete this.bubble}setBubbleMode(t){this.bubbleMode=t,t?(this.setCentered(!0),this.drawBubble(),this.bubble&&(this.width=this.bubble.offsetWidth,this.height=this.bubble.offsetHeight,this.adjustScreenPosition())):this.setImage(this.src)}setLabel(t){t?(this.label||(this.label=dr("<div />").addClass("mapsvg-marker-label")[0],dr(this.element).append(this.label)),dr(this.label).html(t)):this.label&&(dr(this.label).remove(),delete this.label)}setCentered(t){this.centered=t}}const pr=jQuery;class mr extends cr{constructor(t,e){super(null,e),this.type=nr.CLUSTER,this.svgPoint=t.svgPoint,this.cellX=t.cellX,this.cellY=t.cellY,this.markers=t.markers||[],this.cellSize=50,this.width=30,this.elem=pr('<div class="mapsvg-marker-cluster">'+this.markers.length+"</div>")[0],pr(this.elem).data("cluster",this),this.markers.length<2&&pr(this.elem).hide(),this.adjustScreenPosition()}addMarker(t){if(this.markers.push(t),this.markers.length>1){if(2===this.markers.length&&pr(this.elem).show(),2===this.markers.length){const t=this.markers.map((function(t){return t.svgPoint.x}));this.min_x=Math.min.apply(null,t),this.max_x=Math.max.apply(null,t);const e=this.markers.map((function(t){return t.svgPoint.y}));this.min_y=Math.min.apply(null,e),this.max_y=Math.max.apply(null,e),this.svgPoint.x=this.min_x+(this.max_x-this.min_x)/2,this.svgPoint.y=this.min_y+(this.max_y-this.min_y)/2}this.markers.length>2&&(t.svgPoint.x<this.min_x?this.min_x=t.svgPoint.x:t.svgPoint.x>this.max_x&&(this.max_x=t.svgPoint.x),t.svgPoint.y<this.min_y?this.min_y=t.svgPoint.y:t.svgPoint.x>this.max_x&&(this.max_y=t.svgPoint.y),this.svgPoint.x=this.min_x+(this.max_x-this.min_x)/2,this.svgPoint.y=this.min_y+(this.max_y-this.min_y)/2)}else this.svgPoint.x=t.svgPoint.x,this.svgPoint.y=t.svgPoint.y;pr(this.elem).text(this.markers.length),this.adjustScreenPosition()}canTakeMarker(t){const e=undefined,i=this.mapsvg.converter.convertSVGToPixel(t.svgPoint);return this.cellX===Math.ceil(i.x/this.cellSize)&&this.cellY===Math.ceil(i.y/this.cellSize)}destroy(){this.markers=null,pr(this.elem).remove()}adjustScreenPosition(){const t=this.mapsvg.converter.convertSVGToPixel(this.svgPoint);t.x-=this.width/2,t.y-=this.width/2,this.setScreenPosition(t.x,t.y)}moveSrceenPositionBy(t,e){const i=this.screenPoint,s=i.x-t,o=i.y-e;this.setScreenPosition(s,o)}setScreenPosition(t,e){this.screenPoint instanceof Ot?(this.screenPoint.x=t,this.screenPoint.y=e):this.screenPoint=new Ot(t,e),this.updateVisibility(),!0===this.visible&&(this.elem.style.transform="translate("+t+"px,"+e+"px)")}inViewBox(){const t=this.screenPoint.x,e=this.screenPoint.y,i=this.mapsvg.containers.map.offsetWidth,s=this.mapsvg.containers.map.offsetHeight;return t-this.width/2<i&&t+this.width/2>0&&e-this.width/2<s&&e+this.width/2>0}updateVisibility(){return!0===this.inViewBox()?(this.visible=!0,this.elem.classList.remove("mapsvg-out-of-sight")):(this.visible=!1,this.elem.classList.add("mapsvg-out-of-sight")),this.visible}getBBox(){const t={x:this.svgPoint.x,y:this.svgPoint.y,width:this.cellSize/this.mapsvg.getScale(),height:this.cellSize/this.mapsvg.getScale()};return new lr(t.x,t.y,t.width,t.height)}getData(){return this.markers.map((t=>t.object))}}const gr=jQuery;class fr extends ae{constructor(t){super(t),this.autoresize=!0,this.name="popover",this.classList.push("mapsvg-popover"),this.opened=!1,this.closable=!0,this.point=t.point,this.yShift=t.yShift,this.mapObject=t.mapObject,this.id=this.mapObject.id+"_"+Math.random(),gr(this.containers.main).data("popover-id",this.id)}setPoint(t){this.point=t}viewDidAppear(){this.adjustScreenPosition()}adjustScreenPosition(){if(this.point){const t=this.map.converter.convertSVGToPixel(this.point);t.y-=this.yShift,t.x=Math.round(t.x),t.y=Math.round(t.y),this.setScreenPosition(t.x,t.y)}}moveSrceenPositionBy(t,e){const i=this.screenPoint,s=i.x-t,o=i.y-e;this.setScreenPosition(s,o)}setScreenPosition(t,e){this.screenPoint=new Ot(t,e),this.containers.main.style.transform="translate(-50%) translate("+t+"px,"+e+"px)"}viewWillClose(){return"type"in this.mapObject&&this.mapObject.isRegion()&&this.map.deselectRegion(this.mapObject),"type"in this.mapObject&&this.mapObject.isMarker()&&this.map.deselectAllMarkers(),!0}}const vr=jQuery;var yr;!function(t){t[t.click=0]="click",t[t.mouseover=1]="mouseover",t[t.mouseout=2]="mouseout"}(yr||(yr={}));class br extends cr{constructor(t){super(t.element,t.mapsvg),this.options=t.options||{},this.statusOptions=this.mapsvg.options.regionStatuses||{1:{disabled:!1,label:"Enabled",color:"",value:"1"}},this.status="undefined",this.name="region",this.type=nr.REGION,this.objects=new Tt("id",[],{autoId:!1,unique:!0}),this.id=this.element.getAttribute("id"),this.title=this.element.getAttribute("title"),this.id_no_spaces=this.id.replace(/\s/g,"_"),this.element.setAttribute("class",(this.element.className||"")+" mapsvg-region"),this.setStyleInitial(),this.disabled=this.getDisabledState(),this.disabled&&this.attr("class",this.attr("class")+" mapsvg-disabled");const i=this.options,{selected:s}=i,o=e(i,["selected"]);this.selected=s,this.bbox=this.getBBox(),this.update(o),this.saveState()}adjustStroke(t){this.element.style.strokeWidth=this.style["stroke-width"]/t+"px"}setStyleInitial(){let t;this.style={fill:this.getComputedStyle("fill")},this.style.stroke=this.getComputedStyle("stroke")||"",t=this.getComputedStyle("stroke-width"),t=t?t.replace("px",""):"1",t=parseFloat(t),this.style["stroke-width"]=t,this.styleSvg=Object.assign({},this.style),vr(this.element).attr("data-stroke-width",t)}saveState(){this.initialState=JSON.stringify(this.getOptions())}getBBox(){if(this.bbox&&this.bbox.width>0&&this.bbox.height>0)return this.bbox;const t=this.element.getBBox(),e=new lr(t.x,t.y,t.width,t.height),i=this.element.getTransformToElement(this.mapsvg.containers.svg);if(!i)return t;const s=e.x+e.width,o=e.y+e.height;let n=this.mapsvg.containers.svg.createSVGPoint();return n.x=e.x,n.y=e.y,n=n.matrixTransform(i),e.x=n.x,e.y=n.y,n.x=s,n.y=o,n=n.matrixTransform(i),e.width=n.x-e.x,e.height=n.y-e.y,this.bbox=e,e}changed(){return JSON.stringify(this.getOptions())!=this.initialState}edit(){this.elemOriginal=vr(this.element).clone()[0]}editCommit(){this.elemOriginal=null}editCancel(){this.mapsvg.containers.svg.appendChild(this.elemOriginal),this.element=this.elemOriginal,this.elemOriginal=null}getOptions(t){const e={id:this.id,id_no_spaces:this.id_no_spaces,title:this.title,fill:this.mapsvg.options.regions[this.id]&&this.mapsvg.options.regions[this.id].style&&this.mapsvg.options.regions[this.id].style.fill,data:this.data,choroplethValue:this.choroplethValue,disabled:t?this.disabled:void 0};for(const t in e)void 0===e[t]&&delete e[t];if(this.customAttrs){const t=this;this.customAttrs.forEach((function(i){e[i]=t[i]}))}return e}forTemplate(){var t,e,i;const s=undefined;return Object.assign(Object.assign({id:this.id,title:this.title},null===(t=this.data)||void 0===t?void 0:t.getData()),{objects:this.objects.map((t=>t.getData())),data:null===(e=this.data)||void 0===e?void 0:e.getData(),fill:null!==(i=this.style.fill)&&void 0!==i?i:"",status:this.status})}getData(){return this.forTemplate()}getModel(){return this.data}update(t){for(const e in t){const s="set"+i(e);s in this?this[s](t[e]):(this[e]=t[e],this.customAttrs=this.customAttrs||[],this.customAttrs.push(e))}}setTitle(t){t&&(this.title=t,this.element.setAttribute("title",this.title),this.events.trigger(rr.UPDATE,{region:this,data:{title:t}}))}setStyle(t){r(this.style,t);for(const e in t)this.element.style[e]=t[e];this.events.trigger(rr.UPDATE,{region:this,data:{style:t}})}setStyleByType(t){t||(t=this.selected?"selected":this.hovered?"hover":"default"),this.styleByState[this.status]&&this.setStyle(this.styleByState[this.status][t])}setFill(t){const e=this.status||"undefined",i={[e]:{default:{fill:t}}};this.setStylesByState(i),this.events.trigger(rr.UPDATE,{region:this,data:{fill:t}})}setStylesByState(t,e=!0){e&&(this.styleByState||(this.styleByState={}),r(this.styleByState,t)),this.setStyleByType()}getChoroplethColor(){const t=this.mapsvg.options.choropleth;let e="";if(this.data&&(this.data[this.mapsvg.options.regionChoroplethField]||0===this.data[this.mapsvg.options.regionChoroplethField])){const i=0===t.maxAdjusted?0:(parseFloat(this.data[this.mapsvg.options.regionChoroplethField])-t.min)/t.maxAdjusted,s={r:Math.round(t.colors.diffRGB.r*i+t.colors.lowRGB.r),g:Math.round(t.colors.diffRGB.g*i+t.colors.lowRGB.g),b:Math.round(t.colors.diffRGB.b*i+t.colors.lowRGB.b),a:(t.colors.diffRGB.a*i+t.colors.lowRGB.a).toFixed(2)};e="rgba("+s.r+","+s.g+","+s.b+","+s.a+")"}else e=t.colors.noData;return e}getBubbleSize(){let t;if(this.data&&this.data[this.mapsvg.options.choropleth.sourceField]){const e=Number(this.mapsvg.options.choropleth.bubbleSize.max),i=Number(this.mapsvg.options.choropleth.bubbleSize.min),s=this.mapsvg.options.choropleth.coloring.gradient.values.max,o=this.mapsvg.options.choropleth.coloring.gradient.values.min,n=undefined;t=(parseFloat(this.data[this.mapsvg.options.choropleth.sourceField])-o)/(s-o)*(e-i)+i}else t=!1;return t}setDisabled(e,i){e=void 0!==e?t(e):this.getDisabledState();const s=this.disabled;this.disabled=e,this.attr("class",this.attr("class").replace("mapsvg-disabled","")),e&&this.attr("class",this.attr("class")+" mapsvg-disabled"),this.disabled!=s&&this.mapsvg.deselectRegion(this),!i&&this.events.trigger(rr.UPDATE,{region:this,data:{disabled:e}})}setStatus(t){const e=this.mapsvg.options.regionStatuses[t];if(this.data,!e)return!1;this.status=t,this.setDisabled(e.disabled,!0),this.setStyleByType(),this.events.trigger(rr.UPDATE,{region:this,data:{status:t}})}setSelected(t){t?this.mapsvg.selectRegion(this):this.mapsvg.deselectRegion(this),this.events.trigger(rr.UPDATE,{region:this,data:{selected:t}})}setchoroplethValue(t){vr.isNumeric(t)?("string"==typeof t&&(t=parseFloat(t)),this.choroplethValue=t):this.choroplethValue=void 0,this.events.trigger(rr.UPDATE,{region:this,data:{choroplethValue:this.choroplethValue}})}getDisabledState(t){return this.mapsvg.options.regions[this.id],!t&&this.options&&void 0!==this.options.disabled?this.options.disabled:this.mapsvg.options.disableAll||"none"===this.style.fill||"labels"==this.id||"Labels"==this.id}highlight(){this.hovered=!0,this.setStyleByType(),vr(this.element).addClass("mapsvg-region-hover"),this.events.trigger(rr.UPDATE,{region:this,data:{hovered:!0}})}unhighlight(){this.hovered=!1,this.setStyleByType(),vr(this.element).removeClass("mapsvg-region-hover"),this.events.trigger(rr.UPDATE,{region:this,data:{hovered:!1}})}select(){this.selected=!0,this.setStyleByType(),vr(this.element).addClass("mapsvg-region-active"),this.events.trigger(rr.UPDATE,{region:this,data:{selected:!0}})}deselect(){this.selected=!1,this.setStyleByType(),vr(this.element).removeClass("mapsvg-region-active"),this.events.trigger(rr.UPDATE,{region:this,data:{selected:!1}})}setData(t){var e,i;this.data=t,this.data&&"function"==typeof this.data.getData&&void 0!==(null===(e=this.data.getData())||void 0===e?void 0:e.title)&&null!==(null===(i=this.data.getData())||void 0===i?void 0:i.title)&&this.setTitle(this.data.getData().title),this.events.trigger(rr.UPDATE,{region:this,data:{data:t}})}drawBubble(){if(this.data){const t="mapsvg-bubble-"+this.id,e=parseFloat(this.data[this.mapsvg.options.choropleth.sourceField]);if(e){this.center||(this.center=this.getCenterSVG());const i=this.mapsvg.converter.convertSVGToPixel(this.center);this.bubble||(this.bubble=vr('<div id="'+t+'" class="mapsvg-bubble mapsvg-region-bubble">'+e+"</div>")[0],vr(this.mapsvg.layers.bubbles).append(this.bubble));const s=this.getChoroplethColor(),o=Number(this.getBubbleSize());this.bubble.style.transform="translate(-50%,-50%) translate("+i.x+"px,"+i.y+"px)",this.bubble.style.backgroundColor=s,this.bubble.style.width=o+"px",this.bubble.style.height=o+"px",this.bubble.style.lineHeight=o-2+"px"}else delete this.bubble}}adjustLabelScreenPosition(){if(this.label){this.center||(this.center=this.getCenterSVG());const t=this.mapsvg.converter.convertSizePixelToSVG({width:this.label.offsetWidth,height:this.label.offsetHeight}),e=this.mapsvg.converter.convertSVGToPixel(this.center),i=e.x-this.label.offsetWidth/2,s=e.y-this.label.offsetHeight/2;this.setLabelScreenPosition(i,s);const o=this.getBBox();this.label.style.opacity=t.width>o.width?"0":"1"}}adjustBubbleScreenPosition(){if(this.bubble){this.center||(this.center=this.getCenterSVG());const t=this.mapsvg.converter.convertSVGToPixel(this.center),e=t.x-this.bubble.offsetWidth/2,i=t.y-this.bubble.offsetHeight/2;this.setBubbleScreenPosition(e,i)}}moveLabelScreenPositionBy(t,e){if(this.label){const i=window.getComputedStyle(this.label),s=undefined,o=(i.transform||i.webkitTransform).match(/matrix.*\((.+)\)/);if(o&&o.length>0){const i=o[1].split(", "),s=parseFloat(i[4])-t,n=parseFloat(i[5])-e;this.setLabelScreenPosition(s,n)}}}moveBubbleScreenPositionBy(t,e){if(this.bubble){const i=window.getComputedStyle(this.bubble),s=undefined,o=(i.transform||i.webkitTransform).match(/matrix.*\((.+)\)/)[1].split(", "),n=parseFloat(o[4])-t,r=parseFloat(o[5])-e;this.setBubbleScreenPosition(n,r)}}setLabelScreenPosition(t,e){this.label&&(this.label.style.transform="translate("+t+"px,"+e+"px)")}setBubbleScreenPosition(t,e){this.bubble&&(this.bubble.style.transform="translate("+t+"px,"+e+"px)")}}const wr=jQuery;class xr extends ae{constructor(t){super(t),this.classList.push("mapsvg-tooltip"),this.name="tooltip",this.position="absolute",this.opened=!1,this.closable=!1,this.withToolbar=!1,this.scrollable=!1,this.withToolbar=!1,this.autoresize=!1,this.screenPoint=new Ot(0,0),this.positionToCursor=t.positionToCursor||"",this.posOriginal={},this.posShifted={},this.posShiftedPrev={},this.mirror={}}setSize(t,e){}setPositionToCursor(t){const e=t.split("-");-1==e[0].indexOf("top")&&-1==e[0].indexOf("bottom")||(this.posOriginal.topbottom=e[0]),-1==e[0].indexOf("left")&&-1==e[0].indexOf("right")||(this.posOriginal.leftright=e[0]),e[1]&&(this.posOriginal.leftright=e[1]),this.containers.main.className=this.containers.main.className.replace(/(^|\s)mapsvg-tt-\S+/g,""),this.containers.main.classList.add("mapsvg-tt-"+t)}setScreenPoint(t,e){this.screenPoint.x=t,this.screenPoint.y=e}viewDidLoad(){super.viewDidLoad.call(this),this.setPositionToCursor(this.positionToCursor)}setScreenPosition(t,e){this.setScreenPoint(t,e),this.containers.main.style.transform="translateX(-50%) translate("+t+"px,"+e+"px)"}setEventHandlers(){const t="mousemove.tooltip.mapsvg-"+this.uid;wr("body").off(t),wr("body").on(t,(t=>this.move(t)))}destroy(){super.destroy(),wr("body").off("mousemove.tooltip.mapsvg-"+this.uid)}move(t){{if(this.destroyed)return;this.containers.main.style.left=t.clientX+wr(window).scrollLeft()-wr(this.map.containers.map).offset().left+"px",this.containers.main.style.top=t.clientY+wr(window).scrollTop()-wr(this.map.containers.map).offset().top+"px";const e=new Ot(t.clientX+wr(window).scrollLeft(),t.clientY+wr(window).scrollTop()),i=this.containers.main.getBoundingClientRect(),s=this.map.containers.map.getBoundingClientRect(),o={top:i.top+wr(window).scrollTop(),bottom:i.bottom+wr(window).scrollTop(),left:i.left+wr(window).scrollLeft(),right:i.right+wr(window).scrollLeft(),width:i.width,height:i.height},n={top:s.top+wr(window).scrollTop(),bottom:s.bottom+wr(window).scrollTop(),left:s.left+wr(window).scrollLeft(),right:s.right+wr(window).scrollLeft(),width:s.width,height:s.height};if(e.x>n.right||e.y>n.bottom||e.x<n.left||e.y<n.top)return;this.mirror.top||this.mirror.bottom?this.mirror.top&&e.y>this.mirror.top?(this.mirror.top=0,delete this.posShifted.topbottom):this.mirror.bottom&&e.y<this.mirror.bottom&&(this.mirror.bottom=0,delete this.posShifted.topbottom):o.bottom<n.top+o.height?(this.posShifted.topbottom="bottom",this.mirror.top=e.y):o.top>n.bottom-o.height&&(this.posShifted.topbottom="top",this.mirror.bottom=e.y),this.mirror.right||this.mirror.left?this.mirror.left&&e.x>this.mirror.left?(this.mirror.left=0,delete this.posShifted.leftright):this.mirror.right&&e.x<this.mirror.right&&(this.mirror.right=0,delete this.posShifted.leftright):o.right<n.left+o.width?(this.posShifted.leftright="right",this.mirror.left=e.x):o.left>n.right-o.width&&(this.posShifted.leftright="left",this.mirror.right=e.x);let r=wr.extend({},this.posOriginal,this.posShifted);const a=[];r.topbottom&&a.push(r.topbottom),r.leftright&&a.push(r.leftright),r=a.join("-"),this.posShifted.topbottom==this.posOriginal.topbottom&&this.posShifted.leftright==this.posOriginal.leftright||(this.containers.main.className=this.containers.main.className.replace(/(^|\s)mapsvg-tt-\S+/g,""),this.containers.main.classList.add("mapsvg-tt-"+r),this.posShiftedPrev=r),this.opened||this.open()}}}class kr{constructor(t){this.mapElement=t.containers.map,this.defViewBox=t.svgDefault.viewBox,this.viewBox=t.viewBox,this.map=t,this.yShift=0,t.geoViewBox&&this.setGeoViewBox(t.geoViewBox)}setYShift(){if(20426!==this.defViewBox.width){if(this.geoViewBox){const t=this.convertGeoToSVG(this.geoViewBox.ne);this.yShift=t.y-this.defViewBox.y}}else this.yShift=0}setGeoViewBox(t){this.geoViewBox=t,this.mapLonDelta=this.geoViewBox.ne.lng-this.geoViewBox.sw.lng,this.mapLatBottomDegree=this.geoViewBox.sw.lat*Math.PI/180,this.worldMapWidth=this.defViewBox.width/this.mapLonDelta*360,this.worldMapRadius=this.defViewBox.width/this.mapLonDelta*360/(2*Math.PI),this.setYShift()}setWorldShift(t){this.worldShift=t}getScale(){return this.mapElement.clientWidth/this.viewBox.width}convertSVGToPixel(t){const e=this.getScale();let i=0;const s=0;return this.worldShift&&this.viewBox.x-this.defViewBox.x>this.defViewBox.width&&(i=this.worldMapWidth*Math.floor((this.viewBox.x-this.defViewBox.x)/this.defViewBox.width)),new Ot((t.x-this.viewBox.x+i)*e,(t.y-this.viewBox.y+0)*e)}convertPixelToSVG(t){const e=this.getScale();return new Nt(t.x/e+this.viewBox.x,t.y/e+this.viewBox.y)}convertSizePixelToSVG({width:t,height:e}){const i=this.getScale();return{width:t/i,height:e/i}}convertGeoToSVG(t){if(!this.geoViewBox)throw new Error("Can't do convertGeoToSVG() - geoViewBox is not provided.");let e=(t.lng-this.geoViewBox.sw.lng)*(this.defViewBox.width/this.mapLonDelta);const i=t.lat*Math.PI/180,s=this.worldMapRadius/2*Math.log((1+Math.sin(this.mapLatBottomDegree))/(1-Math.sin(this.mapLatBottomDegree)));let o=this.defViewBox.height-(this.worldMapRadius/2*Math.log((1+Math.sin(i))/(1-Math.sin(i)))-s);return e+=this.defViewBox.x,o+=this.defViewBox.y,o-=this.yShift,new Nt(e,o)}convertSVGToGeo(t){if(!this.geoViewBox)throw new Error("Can't do convertSVGToGeo() - geoViewBox is not provided.");const e=t.x-this.defViewBox.x,i=t.y-this.defViewBox.y,s=this.worldMapRadius/2*Math.log((1+Math.sin(this.mapLatBottomDegree))/(1-Math.sin(this.mapLatBottomDegree))),o=undefined,n=(this.defViewBox.height+s-i)/this.worldMapRadius;let r=180/Math.PI*(2*Math.atan(Math.exp(n))-Math.PI/2),a=this.geoViewBox.sw.lng+e/this.defViewBox.width*this.mapLonDelta;return r=parseFloat(r.toFixed(6)),a=parseFloat(a.toFixed(6)),new zt(r,a)}convertGoogleBoundsToViewBox(t){const e=t.getSouthWest(),i=t.getNorthEast(),s=this.convertGeoToSVG(new zt(e.lat(),e.lng())),o=this.convertGeoToSVG(new zt(i.lat(),i.lng()));return new lr(s.x,s.y,o.x-s.x,o.y-s.y)}}var Sr;!function(t){t.CLICK="click",t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout"}(Sr||(Sr={}));const Er='\n    <div class="mapsvg-mobile-buttons">    \n      <div class="mapsvg-button mapsvg-button-menu" data-controller="menu"><i class="mapsvg-icon-menu"></i>\n          {{labelList}}\n      </div>\n      <div class="mapsvg-button mapsvg-button-map" data-controller="map"><i class="mapsvg-icon-map"></i>\n          {{labelMap}}\n      </div>\n    </div>';class Tr extends ae{constructor(t){super(t=Object.assign(Object.assign({},t),{template:Er,opened:!0,closable:!1,scrollable:!1,fullscreen:{sm:!1,md:!1,lg:!1},autoresize:!1,withToolbar:!1,noPadding:!0})),this.name="toolbar",this.classList.push("mapsvg-toolbar")}viewDidRedraw(){super.viewDidRedraw(),this.buttons={},this.buttons.menu=$(this.containers.view).find(".mapsvg-button-menu")[0],this.buttons.map=$(this.containers.view).find(".mapsvg-button-map")[0]}setEventHandlers(){super.setEventHandlers(),$(this.containers.view).on("click.toolbar.mapsvg",".mapsvg-button",(t=>{if("I"==t.target.nodeName)return;const e=t.target.getAttribute("data-controller"),i=this.buttons[e];$(this.containers.view).find(".mapsvg-button").removeClass("active"),$(i).addClass("active"),this.events.trigger("click",t,{target:i,buttonName:e})}))}show(t){$(this.buttons[t]).trigger("click")}}const _r='<div>\n  <p>This is the demo content of the <strong>Region %templateType%</strong>.</p>\n  <p>How to edit it: if you are in mapsvg control panel now, click on the following link to open the template editor for this view: <a href="#" class="mapsvg-template-link" data-template="%templateTypeSnake%Region">Menu > Templates > Region %templateType%</a>.</p>\n  <p>More information about templates: <a href="https://mapsvg.com/docs/map-editor/templates" target="_blank">mapsvg.com/docs/map-editor/templates</a></p>\n</div>\n<hr />\n\n\x3c!-- Region fields are available in this template --\x3e\n<h5>{{#if title}} {{title}} {{else}} {{id}} {{/if}}</h5>\n<p>Status: {{status_text}}</p>\n\n\x3c!-- Show all linked Database Objects: --\x3e\n{{#each objects}}\n\n  \x3c!-- DB Object are available inside of this block --\x3e\n\n  <h5>{{title}}</h5>\n  \x3c!-- When you need to render a field as HTML, use 3 curly braces instead of 2:--\x3e\n  <p>{{{description}}}</p>\n  <p><em>{{location.address.formatted}}</em></p>\n\n  \x3c!-- Show all images: --\x3e\n  {{#each images}}\n    \x3c!-- Image fields "thumbnail", "medium", "full" --\x3e\n    \x3c!-- are available in this block                --\x3e\n    <img src="{{thumbnail}}" />\n  {{/each}}\n\n{{/each}}',Cr='<div>\n  <p>This is the demo content of the <strong>DB Object %templateType%</strong>.</p>\n  <p>How to edit it: if you are in mapsvg control panel now, click on the following link to open the template editor for this view: <a href="#" class="mapsvg-template-link" data-template="%templateTypeSnake%">Menu > Templates > DB Object %templateType%</a>.</p>\n  <p>More information about templates: <a href="https://mapsvg.com/docs/map-editor/templates" target="_blank">mapsvg.com/docs/map-editor/templates</a></p>\n</div>\n<hr />\n\n\x3c!-- DB Object fields are available in this template. --\x3e\n<h5>{{title}}</h5>\n\x3c!-- When you need to render a fields as HTML, use 3 curly braces instead of 2:--\x3e\n<p>{{{description}}}</p>\n<p><em>{{location.address.formatted}}</em></p>\n\n\x3c!-- Show all images: --\x3e\n{{#each images}}\n  \x3c!-- Image fields "thumbnail", "medium", "full" --\x3e\n  \x3c!-- are available in this block                --\x3e\n  <img src="{{thumbnail}}" />\n{{/each}}\n\n\x3c!-- Show all linked Regions, comma-separated: --\x3e\n<p> Regions: \n  {{#each regions}}\n    \x3c!-- Region fields are available in this block --\x3e\n    {{#if title}}\n      {{title}}\n    {{else}}\n      {{id}}\n    {{/if}}{{#unless @last}}, {{/unless}}\n  {{/each}}\n</p>',Br={source:"",markerLastID:0,regionLastID:0,dataLastID:1,disableAll:!1,width:void 0,height:void 0,lockAspectRatio:!1,padding:{top:0,left:0,right:0,bottom:0},maxWidth:void 0,maxHeight:void 0,minWidth:void 0,minHeight:void 0,loadingText:"",colorsIgnore:!1,colors:{baseDefault:"#000000",background:"#eeeeee",selected:40,hover:20,directory:"#fafafa",detailsView:"#ffffff",status:{},clusters:"",clustersBorders:"",clustersText:"",clustersHover:"",clustersHoverBorders:"",clustersHoverText:"",markers:{base:{opacity:100,saturation:100},hovered:{opacity:100,saturation:100},unhovered:{opacity:40,saturation:100},active:{opacity:100,saturation:100},inactive:{opacity:40,saturation:100}}},regions:{},regionsDynamicStatus:{filtered:void 0,noObjects:void 0},clustering:{on:!1},viewBox:[],cursor:"default",manualRegions:!1,onClick:null,mouseOver:null,mouseOut:null,menuOnClick:null,beforeLoad:null,afterLoad:null,zoom:{on:!0,limit:[0,22],delta:2,buttons:{on:!0,location:"right"},mousewheel:!0,fingers:!0,hideSvg:!1,hideSvgZoomLevel:7},scroll:{on:!0,limit:!1,background:!1,spacebar:!1},responsive:!0,tooltips:{on:!1,position:"bottom-right",template:"",maxWidth:"",minWidth:100},popovers:{on:!1,position:"top",template:"",centerOn:!0,width:300,maxWidth:50,maxHeight:50},multiSelect:!1,regionStatuses:{1:{label:"Enabled",value:"1",color:"",disabled:!1},0:{label:"Disabled",value:"0",color:"",disabled:!0}},middlewares:{mapLoad:'function(data, ctx){\n  const { map } = ctx\n\n  // Example: Modify map options dynamically before applying them.\n  // You can conditionally change map settings based on factors like the current URL,\n  // user roles, or other runtime conditions.\n\n  // IMPORTANT: Consider checking if the map is being displayed in the WordPress admin area \n  // (by verifying map.inBackend). Typically, you don\'t want to run this middleware in the backend, \n  // because if you modify the map options here and then save the map, those modifications \n  // will be saved as default options in the database.\n\n  // For example, if the map is not in the backend and the user is viewing a specific post, \n  // you might disable the zoom controls:\n  // \n  // if (!map.inBackend && window.location.href.includes("/a-post-about-cats")) {\n  //   data.controls.zoom = false;\n  // }\n\n  // Always return the modified or unmodified data from the middleware:\n  return data\n}',render:'function(data, ctx){\n  const { controller } = ctx;\n\n  // This middleware function allows you to modify the data before it is sent to a specific controller.\n  // Available controllers: details, popover, tooltip, directory, filters.\n  // You can customize the data for different controllers, such as formatting numbers, strings, etc.\n\n  // Example: If the controller is "details", format the "totalAmount" field from "1000000" to "1,000,000".\n  // Uncomment and customize the following block to apply such transformations:\n  //\n  // if(controller.is("details")){\n  //    return { ...data, totalAmount: data.totalAmount.toLocaleString(\'en-US\') };  \n  // }\n\n  // Always return the data object after processing to ensure it continues through the middleware chain.\n  return data;      \n}',request:'function(data, ctx){\n  const { request, repository, map } = ctx;\n  \n  // This middleware function allows you to modify the request data before it is sent to the server.\n  // Use this when you need to interact with a custom API that expects a different query format from MapSVG.\n  \n  // Example: If the request is for the "users" repository and the action is "index",\n  // you can modify the request data by appending "_bar" to the "foo" property.\n  //\n  // if(repository.schema.objectNamePlural === "users" && request.action === "index") {\n  //   data = {\n  //     ...data,\n  //     foo: data.foo + "_bar"\n  //   };\n  // }\n\n  // Always return the data object after processing to ensure it continues through the middleware chain.\n  return data;\n}',response:'function(data, ctx){\n  const { request, response, repository, map } = ctx;\n  \n  // This middleware function allows you to modify the response data received from the server.\n  // Use this when working with a custom API that returns data in a format different from what MapSVG expects.\n  \n  // Example: A response format that is compatible with MapSVG might look like this:\n  // {\n  //   users: {\n  //     items: [\n  //       {id: 1, name: "John"},\n  //       {id: 2, name: "Anna"},\n  //     ],\n  //     hasMore: true\n  //   }\n  // }\n  //\n  // Suppose your actual API response has this structure:\n  // {\n  //   items: [\n  //     {id: 1, name: "John"},\n  //     {id: 2, name: "Anna"},\n  //   ],\n  //   page: 3,\n  //   totalPages: 120\n  // }\n  //\n  // The following code modifies the response for the "users" repository \n  // when fetching a list of models (the "index" action).\n  // \n  // if(repository.schema.objectNamePlural === "users" && request.action === "index") {\n  //   const dataParsed = typeof response.data === "string" ? JSON.parse(response.data) : data;\n  //   const dataFormatted = {\n  //     users: {\n  //       items: dataParsed.items,\n  //       hasMore: dataParsed.page < dataParsed.totalPages\n  //     }\n  //   };\n  //   return dataFormatted;\n  // } \n  \n  // Always return the data object after processing to ensure it continues through the middleware chain.\n  return data;    \n}\n'},events:{afterInit:"function(event) {\n  const { map } = event;\n\n  // This event handler triggers after the map has fully initialized and all data has loaded.\n  // It's a good place to execute any custom logic or manipulation that requires the map to be fully set up.\n\n  // \"map\" gives you access to the MapSVG instance, allowing you to:\n  // - Interact with the map's regions, markers, and other elements.\n  // - Access or modify the map's settings, such as zoom level, center position, etc.\n  // - Attach additional event listeners or perform post-initialization tasks.\n}\n",beforeInit:'function(event) {\n  const { map } = event;\n\n  // This event handler triggers just before the map begins its initialization process.\n  // It\'s a good place to set up any pre-initialization configurations or modifications.\n\n  // "map" provides access to the MapSVG instance, allowing you to:\n  // - Set or modify map settings before initialization starts (e.g., set default options).\n  // - Add or alter data that will be used during initialization, such as regions or markers.\n  // - Prepare any custom logic that needs to run early in the initialization phase.\n}\n',zoom:'function(event) {\n  const { map } = event;\n\n  // This event handler triggers whenever the map is zoomed in or out.\n  // It\'s useful for executing actions based on the zoom level of the map.\n\n  // "map.zoomLevel" provides the current zoom level of the map.\n  // You can use this to perform tasks like:\n  // - Adjusting the visibility of certain elements based on zoom.\n  // - Logging or displaying the current zoom level for debugging or user information.\n  // - Dynamically loading additional data or layers depending on the zoom level.\n\n  // Example usage:\n  // console.log(map.zoomLevel);\n}\n',afterLoadRegions:"function(event) {\n  const { map } = event;\n\n  // This event triggers after all regions from the regionsRepository have been fully loaded onto the map.\n  // At this point:\n  // - Regions are connected to their respective data objects.\n  // - The directory (if present) is refreshed and populated with the updated data.\n\n  // This is a good place to:\n  // - Perform actions that depend on the regions being fully available on the map.\n  // - Update or manipulate the directory based on the newly loaded data.\n  // - Implement custom logic or effects that require all regions to be loaded.\n\n  // Example:\n  // console.log('Regions are fully loaded and connected to data:', map.regions);\n}\n",afterLoadObjects:"function(event) {\n  const { map } = event;\n\n  // This event triggers after all objects from the objectsRepository have been fully loaded onto the map.\n  // At this point:\n  // - Objects are connected to their respective markers and regions.\n  // - The directory (if present) is updated with the new data for these objects.\n\n  // This is a good place to:\n  // - Perform actions that depend on the objects being fully loaded and connected.\n  // - Update or manipulate the map’s markers or regions based on the newly loaded objects.\n  // - Implement custom logic or visual effects that require all objects to be loaded and displayed.\n\n  // Example:\n  // console.log('Objects are fully loaded and connected to markers and regions:', map.objects);\n}\n","beforeLoad.repository":"function(event) {\n  const { map, data: { repository } } = event  \n\n  // Perform actions or logging before the data is fetched from an API source into repository internal storage.\n\n}","afterLoad.repository":"function(event) {\n  const { map, data: { repository } } = event  \n\n  // Perform actions or logging before the data is fetched from an API source into repository internal storage.\n\n}","click.region":"function(event) {\n  const { map, data: { region } } = event\n\n  // Triggered when a region on the map is clicked.\n  // You can access the clicked region's data using the 'region' property.\n}","mouseover.region":"function(event) {\n  const { map, data: { region } } = event\n\n  // Triggered when the mouse pointer hovers over a region on the map.\n  // You can access the hovered region's data using the 'region' property.\n}","mouseout.region":"function(event) {\n  const { map, data: { region } } = event\n\n  // Triggered when the mouse pointer moves out of a region on the map.\n  // You can access the region's data using the 'region' property.\n}","click.marker":"function(event) {\n  const { map, data: { marker } } = event  \n  \n}","mouseover.marker":"function(event) {\n  const { map, data: { marker } } = event  \n  \n}","mouseout.marker":"function(event) {\n  const { map, data: { marker } } = event  \n  \n}","click.directoryItem":"function(event) {\n  const { map, data: { region, object, directoryItem } } = event      \n  \n}","mouseover.directoryItem":"function(event) {\n  const { map, data: { region, object, directoryItem } } = event      \n  \n}","mouseout.directoryItem":"function(event) {\n  const { map, data: { region, object, directoryItem } } = event        \n  \n}","beforeRedraw.popover":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterRedraw.popover":"function(event) {\n  const { map, data: { controller } } = event      \n}","beforeShow.popover":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterShow.popover":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","beforeClose.popover":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","afterClose.popover":"function(event) {\n  const { map, data: { controller } } = event      \n\n}","beforeRedraw.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterRedraw.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","beforeClose.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","afterClose.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","beforeShow.detailsView":"function(event) {\n  const { map, data: { controller } } = event          \n\n}","afterShow.detailsView":"function(event) {\n  const { map, data: { controller } } = event          \n\n}","beforeRedraw.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterRedraw.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","beforeClose.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterClose.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","beforeShow.tooltip":"function(event) {\n  const { map, data: { controller } } = event          \n}","afterShow.tooltip":"function(event) {\n  const { map, data: { controller } } = event          \n}"},css:"#mapsvg-map-%id% .mapsvg-tooltip {\n\n}\n#mapsvg-map-%id% .mapsvg-popover {\n\n}\n#mapsvg-map-%id% .mapsvg-details-container {\n\n}\n#mapsvg-map-%id% .mapsvg-directory-item {\n\n}\n#mapsvg-map-%id% .mapsvg-region-label {\n  /* background-color: rgba(255,255,255,.6); */\n  font-size: 11px;\n  padding: 3px 5px;\n  border-radius: 4px;\n}\n#mapsvg-map-%id% .mapsvg-marker-label {\n  padding: 3px 5px;\n  /*\n  border-radius: 4px;\n  background-color: white;\n  margin-top: -4px;\n  */\n}\n#mapsvg-map-%id% .mapsvg-filters-wrap {\n\n}\n\n\n\n\n\n\n",templates:{list:'<div class="mapsvg-details-list">\n            {{#each objects}}\n          <div class="mapsvg-details-list-item">\n                  <div class="mapsvg-details-list-item-image">\n                    <img src="{{images.0.thumbnail}}" />\n                  </div>\n                <div class="mapsvg-details-list-item-info">    m\t      \n                    <h6>{{title}}</h6>\n                    <p class="mapsvg-details-address">{{location.address.formatted}}</p>   \n              <p class="mapsvg-details-category">{{category_text}}</p>                                   \n                    <p>{{description}}</p>  \n                <div class="mapsvg-details-link"><a href="{{link}}">{{link}}</a></div>              \n                  </div>\t            \n              </div>\n            {{/each}}\n          </div>',default:'<div class="mapsvg-details-flex">\n        \n        <div class="mapsvg-details-hero">\n          <img src="{{images.0.full}}" class="mapsvg-details-hero-image"/>\n        </div>\n        <div class="mapsvg-details-info">\n          <h4 class="mapsvg-details-header">{{#if title}} {{title}} {{else}} {{id}} {{/if}}</h4>\n          {{description}}\n        </div>\n      </div>    \n    ',post:"{{{post}}}",title:"{{title}}",imageTitle:'<div class="mapsvg-imageTitle-content">\n  <div class="mapsvg-imageTitle-image">\n    <img src="{{images.0.thumbnail}}" />\n  </div>\n  <div class="mapsvg-imageTitle-title">    \t      \n    {{title}}                                  \n  </div>\t            \n</div>',address:"{{#if location.address.formatted}}\n        {{location.address.formatted}}\n      {{else}}\n        {{#if location.geoPoint.lat}}\n          {{location.geoPoint.lat}}, {{location.geoPoint.lng}}\n        {{/if}}\n      {{/if}}",popoverRegion:_r.replace(/%templateType%/g,"Popover").replace(/%templateTypeSnake%/g,"popover"),popoverMarker:Cr.replace(/%templateType%/g,"Popover").replace(/%templateTypeSnake%/g,"popover"),tooltipRegion:"{{id}} - {{title}}",tooltipMarker:"{{title}}",detailsView:Cr.replace(/%templateType%/g,"Details View").replace(/%templateTypeSnake%/g,"detailsView"),detailsViewRegion:_r.replace(/%templateType%/g,"Details View").replace(/%templateTypeSnake%/g,"detailsView"),labelMarker:"{{#if location.address.formatted}}\n        {{location.address.formatted}}\n      {{else}}\n        {{#if location.geoPoint.lat}}\n          {{location.geoPoint.lat}}, {{location.geoPoint.lng}}\n        {{/if}}\n      {{/if}}",labelRegion:"{{title}}",labelLocation:"You are here!",directory:'{{#if categories}}\n  {{#each categories}}\n    {{>directoryCategoryItem}}\n  {{/each}}\n{{else}}  \n  {{#each items}}\n      {{>directoryItem}}      \n  {{/each}}\n  {{#unless items.length}}\n    <div class="mapsvg-no-results">{{noResultsLabel}}</div>\n  {{/unless}}\n{{/if}}',directoryItem:'<div id="mapsvg-directory-item-{{toSnakeCase id}}" class="mapsvg-directory-item" data-object-id="{{id}}">\n  {{title}} \n</div>',directoryCategoryItem:'<div id="mapsvg-category-item-{{value}}" class="mapsvg-category-item" data-category-value="{{value}}">\n  <span class="mapsvg-category-label">{{label}}</span>\n  <span class="mapsvg-category-counter">{{counter}}</span>\n  <span class="mapsvg-chevron"></span>\n</div>\n<div class="mapsvg-category-block" data-category-id="{{value}}">\n  {{#each items}}\n    {{>directoryItem}}\n  {{/each}}  \n</div>    \n    '},choropleth:{on:!1,source:"regions",sourceFieldSelect:{on:!1,variants:[]},bubbleMode:!1,bubbleSize:{min:20,max:40},labels:{low:"low",high:"high"},colors:{lowRGB:null,highRGB:null,low:"#550000",high:"#ee0000",noData:"#333333"},min:0,max:0,coloring:{mode:"gradient",noData:{color:"#999999",description:"No data"},gradient:{colors:{lowRGB:null,highRGB:null,diffRGB:null,low:"#550000",high:"#ee0000"},labels:{low:"low",high:"high"},values:{min:null,max:null,maxAdjusted:null}},palette:{outOfRange:{color:"#ececec",description:"Out of range"},colors:[{color:"#550000",valueFrom:0,valueTo:50,description:""}]},legend:{on:!0,layout:"vertical",container:"bottom-left",title:"Choropleth map",text:"",description:"",width:"20%",height:"20%"}}},filters:{on:!0,source:"database",location:"header",modalLocation:"map",width:"100%",hide:!1,showButtonText:"Filters",clearButtonText:"Clear all",clearButton:!1,searchButton:!1,searchButtonText:"Search",padding:""},menu:{on:!1,hideOnMobile:!0,location:"leftSidebar",locationMobile:"leftSidebar",search:!1,containerId:"",searchPlaceholder:"Search...",searchFallback:!1,source:"database",showFirst:"map",showMapOnClick:!0,minHeight:"400",sortBy:"id",sortDirection:"desc",categories:{on:!1,groupBy:"",hideEmpty:!0,collapse:!0,collapseOther:!0},clickActions:{region:"default",marker:"default",directoryItem:{triggerClick:!0,showPopover:!1,showDetails:!0}},detailsViewLocation:"overDirectory",noResultsText:"No results found",filterout:{field:"",cond:"=",val:""}},database:{on:!0,regionsTableName:"",objectsTableName:"",pagination:{on:!0,perpage:30,next:"Next",prev:"Prev.",showIn:"both"},loadOnStart:!0,table:"",schemas:{regions:{objectNameSingular:"region",objectNamePlural:"regions",name:"",apiEndpoints:[{url:"regions/%name%",method:"GET",name:"index"},{url:"regions/%name%/[:id]",method:"GET",name:"show"},{url:"regions/%name%",method:"POST",name:"create"},{url:"regions/%name%/[:id]",method:"PUT",name:"update"},{url:"regions/%name%/[:id]",method:"DELETE",name:"delete"},{url:"regions/%name%",method:"DELETE",name:"clear"}]},objects:{objectNameSingular:"object",objectNamePlural:"objects",name:"",apiEndpoints:[{url:"objects/%name%",method:"GET",name:"index"},{url:"objects/%name%/[:id]",method:"GET",name:"show"},{url:"objects/%name%",method:"POST",name:"create"},{url:"objects/%name%/[:id]",method:"PUT",name:"update"},{url:"objects/%name%/[:id]",method:"DELETE",name:"delete"},{url:"objects/%name%",method:"DELETE",name:"clear"}]}}},actions:{map:{afterLoad:{selectRegion:!0,selectMarker:!0}},region:{mouseover:{showTooltip:!1,tooltipTemplate:"title"},click:{addIdToUrl:!1,showDetails:!0,showDetailsFor:"region",detailsViewTemplate:"default",filterDirectory:!1,loadObjects:!1,showPopover:!1,showPopoverFor:"region",popoverTemplate:"default",goToLink:!1,linkField:"Region.link"},touch:{showPopover:!1}},marker:{mouseover:{showTooltip:!1,tooltipTemplate:"address"},click:{addIdToUrl:!1,showDetails:!0,detailsViewTemplate:"default",showPopover:!1,popoverTemplate:"default",goToLink:!1,linkField:"Object.link"},touch:{showPopover:!1}},directoryItem:{click:{showDetails:!0,detailsViewTemplate:"default",showPopover:!1,goToLink:!1,selectRegion:!0,fireRegionOnClick:!0,linkField:"Object.link"},hover:{centerOnMarker:!1}}},detailsView:{location:"map",containerId:"",width:"100%",mobileFullscreen:!0},mobileView:{labelMap:"Map",labelList:"List",labelClose:"Close"},googleMaps:{on:!1,apiKey:"",loaded:!1,center:"auto",type:"roadmap",minZoom:1,style:"default",styleJSON:[],language:"en"},groups:[],floors:[],layersControl:{on:!1,position:"top-left",label:"Show on map",expanded:!0,maxHeight:"100%"},floorsControl:{on:!1,position:"top-left",label:"Floors",expanded:!1,maxHeight:"100%"},containers:{leftSidebar:{on:!1,width:"250px"},rightSidebar:{on:!1,width:"250px"},header:{on:!0,height:"auto"},footer:{on:!1,height:"auto"}},labelsMarkers:{on:!1},labelsRegions:{on:!1},svgFileVersion:1,fitMarkers:!1,fitMarkersOnStart:!1,fitSingleMarkerZoom:20,controls:{location:"right",zoom:!0,zoomReset:!1,userLocation:!1,previousMap:!1},previousMapsIds:[]},Dr=jQuery;var Mr;!function(t){t.AFTER_INIT="afterInit",t.BEFORE_INIT="beforeInit",t.ZOOM="zoom",t.AFTER_CHANGE_BOUNDS="afterChangeBounds",t.RESIZE="resize"}(Mr||(Mr={}));class Rr{constructor(t,e,i={prefetch:!0,inBackend:!1}){var o;if(this.markerOptions={src:s.routes.root+"markers/pin1_red.png"},this.previousPaddingBottom=0,this.dirtyFields=[],this.regions=new Tt("id"),this.objects=new Tt("id"),this.drawMode=!1,this.geoCoordinates=!1,this.highlightedRegions=[],this.editRegions={on:!1},this.editMarkers={on:!1},this.editData={on:!1},this.googleMaps={loaded:!1,initialized:!1,map:null,zoomLimit:!0,maxZoomService:null},this.groups=new Tt("id",[],{autoId:!0,unique:!0}),this.svgDefault={},this.viewBox=new lr,this._viewBox=new lr,this.geoViewBox=new hr(new zt(0,0),new zt(0,0)),this.isScrolling=!1,this.zoomDelta=0,this.scale=1,this.scroll={tx:0,ty:0,vxi:0,vyi:0,x:0,y:0,dx:0,dy:0,vx:0,vy:0,gx:0,gy:0,touchScrollStart:0},this.containers={},this.containersCreated=!1,this.eventsBaseInitialized=!1,this.controllers={},this.markers=new Tt("id",[],{unique:!0}),this.markersClusters=new Tt("id"),this.selected_id=[],this.layers={},this.eventsPreventList={},this.svgFileLoaded=!1,this.mapDataLoaded=!1,this.touchActive=!1,this.reloadRegionStyles=t=>{const e=this.getRegionStylesByState(t);e&&t.setStylesByState(e)},this.redrawGauge=()=>{const t=this;t.updateGaugeMinMax(),t.reloadAllRegionStyles()},i?(this.extras=i,this.inBackend=null!==(o=i.inBackend)&&void 0!==o&&o):this.extras={},!e)throw new Error("To create a new map, you need to provide either SVG file URL or map ID and API url.");this.container="string"==typeof t?document.getElementById(t):t,this.id=e.id,this.svgFileLastChanged="number"==typeof e.svgFileLastChanged?e.svgFileLastChanged:Number(e.svgFileLastChanged),this.events=new Bt({context:this,contextName:"map",map:this}),this.options=r({},Br,e.options),this.svgFileLoadedPromise=new Promise(((t,e)=>{this.svgFileLoadedResolve=t})),this.setLoadingText(e.options&&e.options.loadingText||""),this.addLoadingMessage(),this.showLoadingMessage(),this.middlewares=new Dt,this.touchMoveHandler=this.touchMove.bind(this),this.touchEndHandler=this.touchEnd.bind(this),this.init()}loadSvgFile(t,e=1){return this.svgFilePromise=fetch(t+"?version="+(e||"")).then((t=>c(this,void 0,void 0,(function*(){if(!t.ok){if(404===t.status){const t="MapSVG couldn't load SVG file. Please check if the file exists: "+this.options.source+". If the file exists, please contact support (this message is showing up only in wp-admin area).";throw new Error(t)}throw t.status,new Error(`MapSVG: SVG file loading error! status: ${t.status}`)}return(yield t.text()).trim()})))).then((t=>c(this,void 0,void 0,(function*(){const e=undefined,i=(new DOMParser).parseFromString(t,"image/svg+xml");setTimeout((()=>{this.renderSvgData(i),this.svgFileLoaded=!0,this.reloadRegions(),this.decrementAfterloadBlockers(),this.svgFileLoadedResolve(!0)}),500)})))).catch((t=>{this.inBackend?Dr.growl.error({message:t,duration:6e4}):console.error("MapSVG couldn't load SVG file")})),this.svgFilePromise}init(){var t,i;s.addInstance(this),this.afterLoadBlockers=2,this.loaded=!1,this.afterLoadBlockers+=this.extras.prefetch?2:0;const o=this.options;if(e(o,["filters"]),this.setEventHandlers(),this.id&&!1!==this.extras.prefetch){const o=!0===(null===(i=null===(t=this.options)||void 0===t?void 0:t.database)||void 0===i?void 0:i.loadOnStart)||this.inBackend?"objects,regions":"regions",n=s.routes.api+`maps/${this.id}`,a=n.includes("?")?"&":"?",l=`${n}${a}withData=${o}`;this.mapDataPromise=fetch(l).then((t=>c(this,void 0,void 0,(function*(){if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return yield t.json()})))).then((t=>c(this,void 0,void 0,(function*(){const i=t.map;if(this.version=i.version,this.svgFileLastChanged=i.svgFileLastChanged,r(this.options,i.options),Array.isArray(this.options.regions)){const t={};this.options.regions.forEach(((e,i)=>{"string"==typeof i&&(t[i]=e)})),this.options.regions=t}if(Array.isArray(this.options.regionStatuses)){const t={};this.options.regionStatuses.forEach(((e,i)=>{t[i]=e})),this.options.regionStatuses=t}this.setRegionPrefix(this.options.regionPrefix||""),this.setLoadingText(this.options.loadingText||""),this.events&&this.options&&this.options.events&&this.options.events.beforeInit&&this.setEvents({beforeInit:this.options.events.beforeInit}),this.events.trigger(Mr.BEFORE_INIT,{options:this.options}),this.createContainers();const o=b(this.options.source)&&!w(this.options.source,s.routes.home)?s.routes.api+`maps/${this.id}/svg`:this.urlToRelativePath(this.options.source);if(this.loadSvgFile(o,this.svgFileLastChanged),yield this.initMap(this.options),!t.regions&&this.id&&this.options.database.regionsTableName)this.regionsRepository.events.once(Yt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()}));else if(t.regions){this.regionsRepository.events.once(Yt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()}));const i={repository:this.regionsRepository,url:this.regionsRepository.getApiEndpoint("index").url||"",action:"index",method:"GET"},s=t.regions,{schema:o}=s,n=e(s,["schema"]);this.regionsRepository.schema.update(o),this.regionsRepository.loadDataFromResponse(n,{request:i,response:{data:n}})}else this.decrementAfterloadBlockers();if(!t.objects&&this.id&&i.options.database.objectsTableName)i.options.database.loadOnStart?this.objectsRepository.events.once(Yt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()})):this.decrementAfterloadBlockers();else if(t.objects&&(this.inBackend||i.options.database.loadOnStart)){this.objectsRepository.events.once(Yt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()}));const i={repository:this.objectsRepository,url:this.objectsRepository.getApiEndpoint("index").url||"",action:"index",method:"GET"},s=t.objects,{schema:o}=s,n=e(s,["schema"]);this.objectsRepository.schema.update(o),"api"===this.objectsRepository.schema.type?this.objectsRepository.find():this.objectsRepository.loadDataFromResponse(n,{request:i,response:{data:n}})}else this.decrementAfterloadBlockers()})))).catch((t=>{console.error("Fetch error:",t)}))}else{this.events.trigger(Mr.BEFORE_INIT,{options:this.options}),this.createContainers();const t=b(this.options.source)&&!w(this.options.source,s.routes.home)?s.routes.api+`maps/${this.id}/svg`:this.urlToRelativePath(this.options.source);this.loadSvgFile(t,this.svgFileLastChanged).then((()=>c(this,void 0,void 0,(function*(){yield this.svgFileLoadedPromise,this.loadMockRegions()})))),this.updateOutdatedOptions({version:this.version||"1.0.0",options:this.options}).then((({version:t,options:e})=>{this.version=t,this.initMap(e)})).catch((t=>{console.error("Failed to update options:",t)}))}return this.debouncedShowTooltip=x((t=>{this.showTooltip(t)}),20),this}initMap(t,i){return c(this,void 0,void 0,(function*(){const{data_regions:i,data_objects:o,events:n,middlewares:a}=t,l=undefined;let h=e(t,["data_regions","data_objects","events","middlewares"]);n&&this.setEvents(n,!0);const{mapLoad:c}=a,d=e(a,["mapLoad"]);c&&this.setMiddlewares({mapLoad:c},!0),h=this.middlewares.run(xt.MAP_LOAD,[h,{map:this}]),this.regionsRepository=se(h.database.schemas.regions,this),this.regionsRepository.init(),this.regionsRepository.query.update({perpage:0}),this.objectsRepository=se(h.database.schemas.objects,this),this.objectsRepository.init(),this.objectsRepository.query.update({perpage:h.database.pagination.on?h.database.pagination.perpage:0}),this.setMiddlewares(d,!0),this.setRepositoryEvents(),this.mapDataLoaded=!0,yield this.svgFileLoadedPromise,h=r({},this.svgDefault,h);const{viewBox:u,width:p,height:m,responsive:g}=h,f=e(h,["viewBox","width","height","responsive"]),v={width:Number(p)||this.viewBox.width||this.svgDefault.width,height:Number(m)||this.viewBox.height||this.svgDefault.height,responsive:g};this.setSvgTagViewBox(this.svgDefault.viewBox),this.setSize(v.width,v.height,v.responsive);const y=u&&u.length>0?new lr(u):this.svgDefault.viewBox;this.setInitialViewBox(y),this.setWhRatio(y.width/y.height),this.setViewBox(y),this.initialZoomLevel=this.zoomLevel,this.converter=new kr(this),this.geoViewBox&&this.converter.setGeoViewBox(this.geoViewBox),this.update(f),this.options.googleMaps.on&&this.afterLoadBlockers++,this.filtersShouldBeShown()&&this.afterLoadBlockers++,s.googleMaps.apiKey&&(this.inBackend||this.options.googleMaps.on||this.options.filters.on&&this.options.filtersSchema&&this.options.filtersSchema.find((t=>"distance"===t.type)))&&this.loadGoogleMapsAPI((()=>1),(()=>1)),this.options.colors&&this.options.colors.background&&(this.containers.map.style.background=this.options.colors.background),this.decrementAfterloadBlockers()}))}loadMockRegions(){const t={repository:this.regionsRepository,url:this.regionsRepository.getApiEndpoint("index").url||"",action:"index",method:"GET"},e={items:this.regions.map((t=>({id:t.id,title:t.title}))),schema:{fields:[{type:"id",name:"id"},{type:"text",name:"title"}]},hasMore:!1,page:1,perpage:0};this.regionsRepository.loadDataFromResponse(e,{request:t,response:{data:e}})}urlToRelativePath(t){return t=0===t.indexOf("//")?t.replace(/^\/\/[^/]+/,"").replace("//","/"):t.replace(/^.*:\/\/[^/]+/,"").replace("//","/")}setGroups(t){t&&(this.groups.clear(),this.groups.push(...t),this.options.groups=this.groups),this.groups.forEach((t=>{t.objects&&t.objects.length&&t.objects.forEach((e=>{const i=this.containers.svg.querySelector(`[id="${e.value}"]`);i&&i.classList.toggle("mapsvg-hidden",!t.visible)}))}))}getGroupSelectOptions(){const t=[],e=[],i=[];return Dr(this.containers.svg).find("g").each((function(t){const i=Dr(this)[0].getAttribute("id");if(i){const t=Dr(this)[0].getAttribute("title")||"";e.push({label:t||i,value:i})}})),t.push({title:"SVG Layers / Groups",options:e}),Dr(this.containers.svg).find("path,ellipse,circle,polyline,polygon,rectangle,img,text").each((function(t){const e=Dr(this)[0].getAttribute("id");if(e){const t=Dr(this)[0].getAttribute("title");i.push({label:t||e,value:e})}})),t.push({title:"Other SVG objects",options:i}),t}setLayersControl(t){const e=this;if(t&&r(this.options.layersControl,t),this.options.layersControl.on){if(!this.containers.layersControl){this.containers.layersControl=document.createElement("div"),this.containers.layersControl.classList.add("mapsvg-layers-control"),this.containers.layersControlLabel=document.createElement("div"),this.containers.layersControlLabel.classList.add("mapsvg-layers-label"),this.containers.layersControl.appendChild(this.containers.layersControlLabel);const t=document.createElement("div");t.classList.add("mapsvg-layers-list-wrap"),this.containers.layersControl.appendChild(t),this.containers.layersControlListNano=document.createElement("div"),this.containers.layersControlListNano.classList.add("nano"),t.appendChild(this.containers.layersControlListNano),this.containers.layersControlList=document.createElement("div"),this.containers.layersControlList.classList.add("mapsvg-layers-list"),this.containers.layersControlList.classList.add("nano-content"),this.containers.layersControlListNano.appendChild(this.containers.layersControlList),this.containers.mapContainer.appendChild(this.containers.layersControl)}for(this.containers.layersControl.style.display="block",this.containers.layersControlLabel.innerHTML=this.options.layersControl.label,this.containers.layersControlLabel.style.display="block",this.containers.layersControlList.innerHTML="";this.containers.layersControlList.firstChild;)this.containers.layersControlList.removeChild(this.containers.layersControlList.firstChild);this.containers.layersControl.classList.remove("mapsvg-top-left","mapsvg-top-right","mapsvg-bottom-left","mapsvg-bottom-right"),this.containers.layersControl.classList.add("mapsvg-"+this.options.layersControl.position),this.options.menu.on&&!this.options.menu.customContainer&&-1!==this.options.layersControl.position.indexOf("left")&&(this.containers.layersControl.style.left=this.options.menu.width),this.containers.layersControl.style.maxHeight=this.options.layersControl.maxHeight,this.options.groups.forEach((t=>{const e=document.createElement("div");e.classList.add("mapsvg-layers-item"),e.setAttribute("data-group-id",t.id),e.innerHTML='<input type="checkbox" class="ios8-switch ios8-switch-sm" '+(t.visible?"checked":"")+" /><label>"+t.title+"</label>",this.containers.layersControlList.appendChild(e)})),Dr(this.containers.layersControlListNano).nanoScroller({preventPageScrolling:!0,iOSNativeScrolling:!0}),Dr(this.containers.layersControl).off(),Dr(this.containers.layersControl).on("click",".mapsvg-layers-item",(function(){const t=Dr(this).data("group-id"),i=Dr(this).find("input");i.prop("checked",!i.prop("checked")),e.groups.forEach((function(e){e.id===t&&(e.visible=!e.visible)})),e.setGroups()})),Dr(this.containers.layersControlLabel).off(),Dr(this.containers.layersControlLabel).on("click",(()=>{Dr(e.containers.layersControl).toggleClass("closed")})),Dr(this.containers.layersControl).toggleClass("closed",!this.options.layersControl.expanded)}else this.containers.layersControl&&(this.containers.layersControl.style.display="none")}loadDataObjects(t){return this.objectsRepository.find(t)}loadItemsToDirectory(){var t,e,i,s,o,n,r,a,l;let h=[];const c=this;if(!(null===(t=this.controllers.directory)||void 0===t?void 0:t.repository)||!(null===(e=this.controllers.directory)||void 0===e?void 0:e.repository.loaded))return!1;if(this.options.menu.categories&&this.options.menu.categories.on&&this.options.menu.categories.groupBy){const t=this.options.menu.categories.groupBy;if(void 0===(null===(i=this.controllers.directory)||void 0===i?void 0:i.repository.getSchema().getField(t))||void 0===(null===(s=this.controllers.directory)||void 0===s?void 0:s.repository.getSchema().getField(t).options))return!1;const e=undefined;(null===(o=this.controllers.directory)||void 0===o?void 0:o.repository.getSchema().getField(t).options).forEach((e=>{var i;let s=null===(i=this.controllers.directory)||void 0===i?void 0:i.repository.getLoaded().map((t=>t.getData()));s=this.directoryFilterOut(s);const o=[];s.forEach((t=>{o.push(t)}));const n=o.filter((function(i){if("regions"===t){const s=undefined,o=undefined;return-1!==(void 0!==i[t]&&i[t].length?i[t]:[]).map((function(t){return t.id})).indexOf(e.id)}return i[t]==e.value}));e.counter=n.length,"regions"===t&&(e.label=e.title,e.value=e.id),n.sort((function(t,e){const i=c.options.menu.sortBy,s="asc"===c.options.menu.sortDirection?1:-1;return t[i]===e[i]?0:t[i]>e[i]?s:-s})),h.push(Object.assign(Object.assign({},e),{items:n}))})),this.options.menu.categories.hideEmpty&&(h=h.filter((function(t){return t.counter>0}))),null===(n=this.controllers.directory)||void 0===n||n.setState({categories:h,items:null})}else"regions"===this.options.menu.source?(h=null===(r=this.controllers.directory)||void 0===r?void 0:r.repository.getLoaded().map((t=>{const e=t.getData(),i=undefined;return this.getRegion(e.id)?(e.objects=this.getRegion(e.id).objects,e):null})).filter((t=>null!==t)),h=this.directoryFilterOut(h)):h=null===(a=this.controllers.directory)||void 0===a?void 0:a.repository.getLoaded().map((t=>t.getData())),null===(l=this.controllers.directory)||void 0===l||l.setState({categories:null,items:h})}directoryFilterOut(t){var e;const i=this;if(-1!==(null===(e=this.controllers.directory)||void 0===e?void 0:e.repository.schema.objectNameSingular.indexOf("region"))){const e={field:"",val:""};this.options.menu.filterout.field&&(e.field=this.options.menu.filterout.field,e.val=this.options.menu.filterout.val),t=t.filter((function(t){let s=!0;const o=i.options.regionStatuses;return o[t.status]&&(s=!o[t.status].disabled),s&&e.field&&(s=t[e.field]!=e.val),s}))}return t}loadDirectory(){(this.inBackend||"database"!==this.options.menu.source||this.objectsRepository.loaded)&&(this.options.menu.on&&this.controllers.directory&&this.loadItemsToDirectory(),this.setPagination())}setPagination(){var t;this.containers.pagerMap&&Dr(this.containers.pagerMap).empty().remove(),this.containers.pagerDir&&Dr(this.containers.pagerDir).empty().remove();const e=["map","both"].includes(this.options.database.pagination.showIn),i=["directory","both"].includes(this.options.database.pagination.showIn),s=this.options.database.pagination.on&&0!==this.options.database.pagination.perpage,o=undefined,n=i&&s&&this.controllers.directory&&this.options.menu.on?this.getPagination():null;this.controllers.directory&&(null===(t=this.controllers.directory)||void 0===t||t.setPagination(n));const r=e&&s;this.containers.pagerMap=r?this.getPagination():null,this.containers.pagerMap&&this.containers.map.appendChild(this.containers.pagerMap)}getPagination(t){const e=this,i=Dr('<nav class="mapsvg-pagination"><ul class="pager">\x3c!--<li class="mapsvg-first"><a href="#">First</a></li>--\x3e<li class="mapsvg-prev"><a href="#">&larr; '+e.options.database.pagination.prev+" "+e.options.database.pagination.perpage+'</a></li><li class="mapsvg-next"><a href="#">'+e.options.database.pagination.next+" "+e.options.database.pagination.perpage+' &rarr;</a></li>\x3c!--<li class="mapsvg-last"><a href="#">Last</a></li>--\x3e</ul></nav>');return this.objectsRepository?(this.objectsRepository.onFirstPage()&&this.objectsRepository.onLastPage()?i.hide():(i.find(".mapsvg-prev").removeClass("disabled"),i.find(".mapsvg-first").removeClass("disabled"),i.find(".mapsvg-last").removeClass("disabled"),i.find(".mapsvg-next").removeClass("disabled"),this.objectsRepository.onLastPage()&&i.find(".mapsvg-next").addClass("disabled")&&i.find(".mapsvg-last").addClass("disabled"),this.objectsRepository.onFirstPage()&&i.find(".mapsvg-prev").addClass("disabled")&&i.find(".mapsvg-first").addClass("disabled")),i.on("click",".mapsvg-next:not(.disabled)",(e=>{if(e.preventDefault(),this.objectsRepository.onLastPage())return;const i=new Ut({page:this.objectsRepository.query.page+1});this.objectsRepository.find(i).done((function(){t&&t()}))})).on("click",".mapsvg-prev:not(.disabled)",(function(i){if(i.preventDefault(),e.objectsRepository.onFirstPage())return;const s=new Ut({page:e.objectsRepository.query.page-1});e.objectsRepository.find(s).done((function(){t&&t()}))})).on("click",".mapsvg-first:not(.disabled)",(function(i){if(i.preventDefault(),e.objectsRepository.onFirstPage())return;const s=new Ut({page:1});e.objectsRepository.find(s).done((function(){t&&t()}))})).on("click",".mapsvg-last:not(.disabled)",(function(i){if(i.preventDefault(),e.objectsRepository.onLastPage())return;const s=new Ut({lastpage:!0});e.objectsRepository.find(s).done((function(){t&&t()}))})),i[0]):i[0]}deleteMarkers(){for(;this.markers.length;)this.markerDelete(this.markers[0])}deleteClusters(){this.markersClusters&&(this.markersClusters.forEach((function(t){t.destroy()})),this.markersClusters.clear()),this.clustersFromWorker=[]}addLocation(t){let e=this.objectsRepository.getSchema().getFieldByType("location");if(e&&(e=e.name,e)){this.firstDataLoad&&this.setMarkerImagesDependency();const i=t[e];if(i.img&&(i.geoPoint||i.svgPoint)){const e=new ur({location:i,object:t,mapsvg:this});this.markerAdd(e)}}}addClustersFromWorker(t){this.clustersFromWorker=[];for(const e in t){const i=t[e].markers.map((t=>{const e=this.objectsRepository.objects.findById(t.id);if(e&&e.location)return e.location.marker}));this.clustersFromWorker.push(new mr({markers:i,svgPoint:new Nt(t[e].x,t[e].y),cellX:t[e].cellX,cellY:t[e].cellY},this))}this.clusterizeMarkers()}startClusterizer(){return c(this,void 0,void 0,(function*(){if(this.clustersFromWorker=[],!this.objectsRepository||0===this.objectsRepository.getLoaded().length)return;const t=undefined;if(!this.objectsRepository.getSchema().getFieldByType("location"))return!1;this.clusterizerWorker||(this.clusterizerWorker=new Worker(s.routes.root+"js/mapsvg/Core/ClusteringWorker.js"),this.clusterizerWorker.onmessage=t=>{t.data.clusters&&this.addClustersFromWorker(t.data.clusters)},this.events.on(Mr.ZOOM,(()=>{this.clusterizerWorker&&this.options.clustering.on&&this.clusterizerWorker.postMessage({message:"zoom",zoomLevel:this.zoomLevel,viewBox:this.viewBox})})),this.events.on(Mr.RESIZE,(t=>{this.clusterizerWorker&&this.options.clustering.on&&this.clusterizerWorker.postMessage({message:"resize",viewBox:t.data.viewBox,mapWidth:t.data.mapWidth,mapHeight:t.data.mapHeight})})));const e=[];this.objectsRepository.getLoaded().filter((t=>t.location&&t.location.marker)).forEach((t=>{const{x:i,y:s}=t.location.marker.svgPoint;e.push({id:t.getData().id,x:i,y:s})})),this.clusterizerWorker.postMessage({objects:e,cellSize:50,mapWidth:this.containers.map.clientWidth,zoomLevel:this.zoomLevel,zoomDelta:this.zoomDelta,svgViewBox:this.svgDefault.viewBox,viewBox:this.viewBox})}))}clusterizeMarkers(t){Dr(this.layers.markers).children().each(((t,e)=>{Dr(e).detach()})),this.markers.clear(),this.markersClusters.clear(),Dr(this.containers.map).addClass("no-transitions-markers"),this.clustersFromWorker&&this.clustersFromWorker.length>0&&this.clustersFromWorker.forEach((t=>{this.googleMaps.map&&this.googleMaps.map.getZoom()>=17?this.markerAdd(t.markers[0]):t.markers.length>1?this.markersClusterAdd(t):this.markerAdd(t.markers[0])})),this.editingMarker&&this.markerAdd(this.editingMarker),t||this.mayBeFitMarkers(),this.options.labelsMarkers.on&&this.setLabelsMarkers(),Dr(this.containers.map).removeClass("no-transitions-markers")}getCssUrl(){return s.routes.root+"css/mapsvg.css"}isGeo(){return this.mapIsGeo}getOptions(t,e){const i=r({},this.options);function o(t){for(const e in t)t[e]&&"object"==typeof t[e]&&(o(t[e]),0===Object.keys(t[e]).length&&delete t[e])}return o(i.regions),r(i,this.optionsDelta),i.viewBox=this._viewBox.toArray(),this.filtersSchema&&(i.filtersSchema=this.filtersSchema.getFields(),i.filtersSchema.length>0&&i.filtersSchema.forEach((t=>{"distance"===t.type&&(t.value="")}))),delete i.markers,t&&(i.svgFilename=i.source.split("/").pop(),i.svgFiles=s.svgFiles),e&&Dr.each(i,((t,e)=>{JSON.stringify(e)==JSON.stringify(this.defaults[t])&&delete i[t]})),i}restoreDeltaOptions(){this.update(this.optionsDelta),this.optionsDelta={}}setMiddlewares(t,e=!1){let i;for(const s in t){if("string"==typeof t[s]){if(i=""!=t[s]?k(t[s]):null,!i||i.error||i instanceof TypeError||i instanceof SyntaxError)continue}else"function"==typeof t[s]&&(i=t[s]);this.setMiddleware(s,i,e)}r(this.options.middlewares,t)}setMiddleware(t,e,i=!1){switch(this.middlewares.add(t,e,i),t){case xt.REQUEST:case xt.RESPONSE:this.objectsRepository&&this.objectsRepository.middlewares.add(t,e,i),this.regionsRepository&&this.regionsRepository.middlewares.add(t,e,i)}}setEvents(t,e){var i,s;let o;for(const n in t){if("string"==typeof t[n]){if(o=""!=t[n]?k(t[n]):null,!o||o.error||o instanceof TypeError||o instanceof SyntaxError)continue}else"function"==typeof t[n]&&(o=t[n]);if(this.events.on(n,o,{unique:null!=e&&e}),-1!==n.indexOf("directory")){const t=n.split(".")[0];this.controllers&&this.controllers.directory&&(null===(i=this.controllers.directory)||void 0===i||i.events.off(t),null===(s=this.controllers.directory)||void 0===s||s.events.on(t,o))}}r(this.options.events,t)}setActions(t){r(this.options.actions,t)}setDetailsView(t){t=t||this.options.detailsView||{},r(this.options.detailsView,t)}setMobileView(t){r(this.options.mobileView,t)}attachDataToRegions(t){const e=undefined,i=t.getRegionsForTable(this.options.database.regionsTableName).map((t=>t.id));this.regions.filter((t=>i.includes(t.id))).forEach((t=>{t.objects.clear()})),this.objectsRepository.getLoaded().forEach(((t,e)=>{const i=t.getRegionsForTable(this.options.database.regionsTableName);i&&i.length&&i.forEach((e=>{const i=this.getRegion(e.id);i&&i.objects.push(t)}))}))}setTemplates(t){var e;this.templates=this.templates||{};for(const i in t)if(void 0!==i){if(this.options.templates[i]=t[i],"directoryItem"==i||"directoryCategoryItem"==i){Handlebars.unregisterPartial(i+"-"+this.id),Handlebars.unregisterPartial(i);try{"directoryCategoryItem"==i&&(t[i]=t[i].replace(/\{\{\s*>?\s*directoryItem\s*\}\}/g,"{{>directoryItem-"+this.id+"}}")),Handlebars.registerPartial(i+"-"+this.id,t[i])}catch(t){Handlebars.registerPartial(i+"-"+this.id,""),console.error(t)}}else try{"directory"!=i&&"directoryCategoryItem"!=i||(t[i]=t[i].replace(/\{\{\s*>?\s*directoryItem\s*\}\}/g,"{{>directoryItem-"+this.id+"}}").replace(/\{\{\s*>?\s*directoryCategoryItem\s*\}\}/g,"{{>directoryCategoryItem-"+this.id+"}}")),this.options.templates[i]=t[i],this.templates[i]=Handlebars.compile(t[i],{strict:!1})}catch(t){console.error(t),this.templates[i]=Handlebars.compile("",{strict:!1})}this.inBackend&&("directory"==i||"directoryCategoryItem"==i||"directoryItem"==i)&&this.controllers&&this.controllers.directory&&(this.controllers.directory.templates.main=this.templates.directory,null===(e=this.controllers.directory)||void 0===e||e.redraw())}}update(t){var s,o;if(!t)return;const{width:n,height:r,responsive:a}=t,l=e(t,["width","height","responsive"]);for(const e in l)if("regions"==e)for(const e in t.regions){const i=this.getRegion(e);i&&i.update(t.regions[e]),this.reloadRegionStyles(i),i&&(this.options.regions[e]=Object.assign(Object.assign({},this.options.regions[e]),t.regions[e])),void 0!==t.regions[e].disabled&&(this.deselectRegion(i),this.options.regions[e]=this.options.regions[e]||{},this.options.regions[e].disabled=i.disabled)}else{const s="set"+i(e);"function"==typeof this[s]?this[s](t[e]):this.options[e]=t[e]}if(n||r){const t={width:void 0!==n?Number(n):null!==(s=this.options.width)&&void 0!==s?s:this.svgDefault.width,height:void 0!==r?Number(r):null!==(o=this.options.height)&&void 0!==o?o:this.svgDefault.height,responsive:void 0!==a?!!a:this.options.responsive};this.setSize(t.width,t.height,t.responsive)}}getDirtyFields(){return this.getData()}clearDirtyFields(){this.dirtyFields=[]}setTitle(t){t&&(this.options.title=t)}setExtension(t){t?this.options.extension=t:delete this.options.extension}setDisableLinks(t){t=S.numbers.parseBoolean(t),this.disableLinks=t}setLoadingText(t){this.options.loadingText=t,this.containers.loading&&(Dr(this.containers.loading).find(".mapsvg-loading-text")[0].innerHTML=this.options.loadingText)}setLockAspectRatio(t){this.options.lockAspectRatio=S.numbers.parseBoolean(t)}setMarkerEditHandler(t){this.markerEditHandler=t}setChoroplethSourceField(t){this.options.choropleth.sourceField=t,this.redrawChoropleth()}setRegionEditHandler(t){this.regionEditHandler=t}setDisableAll(t){t=S.numbers.parseBoolean(t),r(this.options,{disableAll:t}),Dr(this.containers.map).toggleClass("mapsvg-disabled-regions",t)}getChoroplethColor(t){const e=this.options.choropleth;let i="";if(t.data&&(t.data[this.options.regionChoroplethField]||0===t.data[this.options.regionChoroplethField])){const s=0===e.maxAdjusted?0:(parseFloat(t.data[this.options.regionChoroplethField])-e.min)/e.maxAdjusted,o={r:Math.round(e.colors.diffRGB.r*s+e.colors.lowRGB.r),g:Math.round(e.colors.diffRGB.g*s+e.colors.lowRGB.g),b:Math.round(e.colors.diffRGB.b*s+e.colors.lowRGB.b),a:(e.colors.diffRGB.a*s+e.colors.lowRGB.a).toFixed(2)};i="rgba("+o.r+","+o.g+","+o.b+","+o.a+")"}else i=e.colors.noData;return i}getBubbleSize(t){let e;if(t.data&&t.data[this.options.choropleth.sourceField]){const i=Number(this.options.choropleth.bubbleSize.max),s=Number(this.options.choropleth.bubbleSize.min),o=this.options.choropleth.coloring.gradient.values.max,n=this.options.choropleth.coloring.gradient.values.min,r=undefined;e=(parseFloat(t.data[this.options.choropleth.sourceField])-n)/(o-n)*(i-s)+s}else e=!1;return e}getRegionStylesByState(t){var e,i;if(!t)return null;if(this.drawMode)return{default:{selected:{},hover:{},default:{}}};const s={},o=t,n=this.regionsRepository.getSchema().getFieldByType("status")||{options:[]},r=n?n.options.map((t=>t.value)):[];r.push("undefined");for(const t of r){const r={},a={},l={},h=n.options.find((e=>e.value===t));(null==h?void 0:h.color)?r.fill=h.color:this.options.choropleth.on?r.fill=this.getChoroplethColor(o):this.options.regions[o.id]&&this.options.regions[o.id].style&&this.options.regions[o.id].style.fill?r.fill=this.options.regions[o.id].style.fill:this.options.colors.base?r.fill=this.options.colors.base:"none"!=o.styleSvg.fill?r.fill=null!==(e=o.styleSvg.fill)&&void 0!==e?e:this.options.colors.baseDefault:r.fill="none",E(this.options.colors.selected)?a.fill=j(r.fill).lighten(parseFloat(""+this.options.colors.selected)).toRgbString():a.fill=this.options.colors.selected,E(this.options.colors.hover)?l.fill=j(r.fill).lighten(parseFloat(""+this.options.colors.hover)).toRgbString():l.fill=this.options.colors.hover,"none"!=o.style.stroke&&null!=this.options.colors.stroke?r.stroke=this.options.colors.stroke:r.stroke=null!==(i=o.style.stroke)&&void 0!==i?i:"",a.stroke=r.stroke,l.stroke=r.stroke,s[t]={selected:a,hover:l,default:r}}return s}setRegions(t){for(const[e,i]of Object.entries(t)){if(Array.isArray(i.style)){console.error("MapSVG: wrong format of region style options.");continue}this.options.regions[e]?Object.assign(this.options.regions[e],i):this.options.regions[e]=i;const t=this.getRegion(e);t&&t.update(this.options.regions[e])}}setRegionStatuses(t){this.options.regionStatuses=t;const e={};for(const i in t){const s=t[i];e[s.value]=s.color.length?s.color:null}this.setColors({status:e})}setColorsIgnore(t){this.options.colorsIgnore=S.numbers.parseBoolean(t),this.reloadAllRegionStyles()}setColors(t){var e;for(const e in t)if("status"===e)for(const i in t[e])T(t[e][i]);else"string"==typeof t[e]&&T(t[e]);if(r(this.options,{colors:t}),t&&t.status&&(this.options.colors.status=t.status),this.options.colors.markers)for(const t in this.options.colors.markers)for(const e in this.options.colors.markers[t])this.options.colors.markers[t][e]=parseInt(this.options.colors.markers[t][e]);this.options.colors.background&&Dr(this.containers.map).css({background:this.options.colors.background}),this.options.colors.hover&&(this.options.colors.hover=isNaN(this.options.colors.hover)?this.options.colors.hover:parseInt(this.options.colors.hover+"")),this.options.colors.selected&&(this.options.colors.selected=isNaN(this.options.colors.selected)?this.options.colors.selected:parseInt(this.options.colors.selected+"")),Dr(this.containers.leftSidebar).css({"background-color":this.options.colors.leftSidebar}),Dr(this.containers.rightSidebar).css({"background-color":this.options.colors.rightSidebar}),Dr(this.containers.header).css({"background-color":this.options.colors.header}),Dr(this.containers.footer).css({"background-color":this.options.colors.footer}),this.controllers.detailsView&&void 0!==this.options.colors.detailsView&&this.controllers.detailsView.setStyles({backgroundColor:this.options.colors.detailsView}),this.controllers.directory&&void 0!==this.options.colors.directory&&(null===(e=this.controllers.directory)||void 0===e||e.setStyles({backgroundColor:this.options.colors.directory})),this.controllers.filters&&(this.options.colors.directorySearch?this.controllers.filters.setStyles({backgroundColor:this.options.colors.directorySearch}):this.controllers.filters.setStyles({backgroundColor:""})),Dr(this.containers.filtersModal)&&void 0!==this.options.colors.modalFilters&&Dr(this.containers.filtersModal).css({"background-color":this.options.colors.modalFilters}),this.containers.clustersCss||(this.containers.clustersCss=Dr("<style></style>").appendTo("body")[0]);let i="";this.options.colors.clusters&&(i+="background-color: "+this.options.colors.clusters+";"),this.options.colors.clustersBorders&&(i+="border-color: "+this.options.colors.clustersBorders+";"),this.options.colors.clustersText&&(i+="color: "+this.options.colors.clustersText+";"),Dr(this.containers.clustersCss).html(".mapsvg-marker-cluster {"+i+"}"),this.containers.clustersHoverCss||(this.containers.clustersHoverCss=Dr("<style></style>").appendTo("body")[0]);let s="";this.options.colors.clustersHover&&(s+="background-color: "+this.options.colors.clustersHover+";"),this.options.colors.clustersHoverBorders&&(s+="border-color: "+this.options.colors.clustersHoverBorders+";"),this.options.colors.clustersHoverText&&(s+="color: "+this.options.colors.clustersHoverText+";"),Dr(this.containers.clustersHoverCss).html(".mapsvg-marker-cluster:hover {"+s+"}"),this.containers.markersCss||(this.containers.markersCss=Dr("<style></style>").appendTo("head")[0]);const o=".mapsvg-with-marker-active .mapsvg-marker {\n  opacity: "+this.options.colors.markers.inactive.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.inactive.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.inactive.saturation)+"%);\n}\n.mapsvg-with-marker-active .mapsvg-marker-active {\n  opacity: "+this.options.colors.markers.active.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.active.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.active.saturation)+"%);\n}\n.mapsvg-with-marker-hover .mapsvg-marker {\n  opacity: "+this.options.colors.markers.unhovered.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.unhovered.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.unhovered.saturation)+"%);\n}\n.mapsvg-with-marker-hover .mapsvg-marker-hover {\n  opacity: "+this.options.colors.markers.hovered.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.hovered.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.hovered.saturation)+"%);\n}\n";Dr(this.containers.markersCss).html(o),Dr.each(this.options.colors,((t,e)=>{null===e&&delete this.options.colors[t]})),this.reloadAllRegionStyles()}setTooltips(t){void 0!==t.on&&(t.on=S.numbers.parseBoolean(t.on)),r(this.options,{tooltips:t}),this.controllers.tooltips={}}setPopovers(t){void 0!==t.on&&(t.on=S.numbers.parseBoolean(t.on)),r(this.options.popovers,t)}setRegionPrefix(t){this.options.regionPrefix=t}setInitialViewBox(t){this._viewBox.update(t)}setWhRatio(t){this.whRatio={original:this.svgDefault.viewBox.width/this.svgDefault.viewBox.height,current:t}}setSvgTagViewBox(t){this.containers.svg.setAttribute("viewBox",t.toString()),this.vbStart=!0}setViewBox(t,e=!0){if(!this.svgFileLoaded)return;let i=!1;t&&(i=this.checkIfZoomIsNeeded(t),this.viewBox.update(t));const s=100*this.viewBox.height/this.viewBox.width;Math.abs(s-this.previousPaddingBottom)>1&&(Dr(this.containers.map).css({width:"100%",height:"0","padding-bottom":s+"%"}),this.previousPaddingBottom=s),this.whRatio.current=this.viewBox.width/this.viewBox.height,this.scale=this.getScale(),this.whRatio.current,this.whRatio.original;const o=this.whRatio.current,n=this.whRatio.original;if(this.superScale=Math.max(o/n,n/o),this.scroll.tx=Math.round((this.svgDefault.viewBox.x-this.viewBox.x)*this.scale),this.scroll.ty=Math.round((this.svgDefault.viewBox.y-this.viewBox.y)*this.scale),this.googleMaps.map&&!1!==e){const t=this.googleMaps.map.getZoom();i&&this.googleFitCurrentGeoBounds(),t!==this.googleMaps.map.getZoom()&&this.googleMaps.map.setCenter(this.getCenterGeoPoint())}else{const t=this.getRelativeScale();this.containers.scrollpane.style.transform=`translate(${this.scroll.tx}px, ${this.scroll.ty}px) scale(${t})`,this.events.trigger(Mr.AFTER_CHANGE_BOUNDS,{center:{geoPoint:this.getCenterGeoPoint(),svgPoint:this.getCenterSvgPoint()},viewBox:this.viewBox,zoomLevel:this.zoomLevel,scale:this._scale})}return this.movingItemsAdjustScreenPosition(),i&&(this.adjustStrokes(),this.throttle(this.toggleSvgLayerOnZoom,50,this),this.options.clustering.on?this.throttle(this.clusterizeOnZoom,400,this):this.events.trigger(Mr.ZOOM)),!0}getCenterGeoPoint(t=!1,e){return this.isGeo()?this.converter?this.converter.convertSVGToGeo(this.getCenterSvgPoint(t,e)):new zt(0,0):null}getCenterSvgPoint(t=!1,e){return t?new Nt(this.svgDefault.viewBox.x+this.svgDefault.viewBox.width/2,this.svgDefault.viewBox.y+this.svgDefault.viewBox.height/2):e?new Nt(e.x+e.width/2,e.y+e.height/2):new Nt(this.viewBox.x+this.viewBox.width/2,this.viewBox.y+this.viewBox.height/2)}getZoomRange(){const t={min:0,max:0};return t.min=this.options.zoom.limit[0],t.max=this.options.zoom.limit[1],t}enableMovingElementsAnimation(){Dr(this.containers.map).removeClass("no-transitions-markers no-transitions-labels no-transitions-bubbles")}disableMovingElementsAnimation(){Dr(this.containers.map).addClass("no-transitions-markers no-transitions-labels no-transitions-bubbles")}clusterizeOnZoom(){this.events.trigger(Mr.ZOOM),this.clusterizeMarkers(!0)}throttle(t,e,i,s){clearTimeout(t._tId),t._tId=setTimeout((function(){t.apply(i,s)}),e)}googleFitCurrentGeoBounds(){const t=this.getGeoBounds();this.googleMaps.map.fitBounds({south:t.sw.lat,west:t.sw.lng,north:t.ne.lat,east:t.ne.lng},0)}setViewBoxByGoogleMapBounds(){const t=this.googleMaps.map.getBounds();if(!t)return;const e=t.toJSON();-180==e.west&&180==e.east&&this.googleMaps.map.getCenter().toJSON();const i=new zt(t.getNorthEast().lat(),t.getNorthEast().lng()),s=new zt(t.getSouthWest().lat(),t.getSouthWest().lng()),o=this.converter.convertGeoToSVG(i),n=this.converter.convertGeoToSVG(s);if(o.x<n.y){const t=this.svgDefault.viewBox.width/this.converter.mapLonDelta*360;n.x=-(t-n.y)}const r=o.x-n.x,a=n.y-o.y,l=new lr(n.x,o.y,r,a);this.setViewBox(l)}redraw(){var t,e;this.disableAnimation(),this.googleMaps.map?google.maps.event.trigger(this.googleMaps.map,"resize"):this.setViewBox(this.viewBox),Dr(this.containers.popover)&&Dr(this.containers.popover).css({"max-height":this.options.popovers.maxHeight*Dr(this.containers.wrap).outerHeight()/100+"px"}),this.controllers&&this.controllers.directory&&(null===(t=this.controllers.directory)||void 0===t||t.updateTopShift(),null===(e=this.controllers.directory)||void 0===e||e.updateScroll()),this.movingItemsAdjustScreenPosition(),this.adjustStrokes(),this.options.choropleth.on&&this.options.choropleth.bubbleMode&&this.redrawBubbles(),setTimeout((()=>{this.enableAnimation()}),400)}setSize(t,e,i){this.options.width=t,this.options.height=e,this.options.responsive=null!=i&&null!=i?S.numbers.parseBoolean(i):this.options.responsive,this.options.width||this.options.height?!this.options.width&&this.options.height?this.options.width=this.options.height*this.svgDefault.width/this.svgDefault.height:this.options.width&&!this.options.height&&(this.options.height=this.options.width*this.svgDefault.height/this.svgDefault.width):(this.options.width=this.svgDefault.width,this.options.height=this.svgDefault.height),this.scale=this.getScale(),this.setResponsive(i),this.loaded&&this.redraw()}setResponsive(t){t=null!=t?S.numbers.parseBoolean(t):this.options.responsive,Dr(this.containers.wrap).css({width:"100%",height:"auto"}),r(this.options,{responsive:t})}setScroll(t,e){null!=t.on&&(t.on=S.numbers.parseBoolean(t.on)),null!=t.limit&&(t.limit=S.numbers.parseBoolean(t.limit)),r(this.options,{scroll:t}),!e&&this.setEventHandlers()}setZoom(t){null!=(t=t||{}).on&&(t.on=S.numbers.parseBoolean(t.on)),null!=t.fingers&&(t.fingers=S.numbers.parseBoolean(t.fingers)),null!=t.mousewheel&&(t.mousewheel=S.numbers.parseBoolean(t.mousewheel)),t.limit&&("string"==typeof t.limit&&(t.limit=t.limit.split(";")),t.limit=[parseInt(t.limit[0]),parseInt(t.limit[1])]),r(this.options,{zoom:t}),Dr(this.containers.scrollpaneWrap).off("wheel.mapsvg"),this.options.zoom.mousewheel&&(S.env.getBrowser().firefox&&(this.firefoxScroll={insideIframe:!1,scrollX:0,scrollY:0},Dr(this.containers.scrollpaneWrap).on("mouseenter",(()=>{this.firefoxScroll.insideIframe=!0,this.firefoxScroll.scrollX=window.scrollX,this.firefoxScroll.scrollY=window.scrollY})).on("mouseleave",(()=>{this.firefoxScroll.insideIframe=!1})),Dr(document).scroll((()=>{this.firefoxScroll.insideIframe&&window.scrollTo(this.firefoxScroll.scrollX,this.firefoxScroll.scrollY)}))),Dr(this.containers.scrollpaneWrap).on("wheel.mapsvg",(t=>(t.preventDefault(),this.mouseWheelZoom(t),!1))),Dr(this.layers.markers).on("wheel.mapsvg",(t=>(t.preventDefault(),this.mouseWheelZoom(t),!1)))),this.canZoom=!0}mouseWheelZoom(t){t.preventDefault();const e=Math.sign(-t.originalEvent.deltaY),i=this.getSvgPointAtClick(t.originalEvent);e>0?this.zoomIn(i):this.zoomOut(i)}setControls(t){t=t||{},r(this.options,{controls:t}),this.options.controls.zoom=S.numbers.parseBoolean(this.options.controls.zoom),this.options.controls.zoomReset=S.numbers.parseBoolean(this.options.controls.zoomReset),this.options.controls.userLocation=S.numbers.parseBoolean(this.options.controls.userLocation),this.options.controls.previousMap=S.numbers.parseBoolean(this.options.controls.previousMap);const e=this.options.controls.location||"right";if(!this.containers.controls){const t=Dr("<div />").addClass("mapsvg-buttons"),e=Dr("<div />").addClass("mapsvg-btn-group").appendTo(t),i=Dr("<div />").addClass("mapsvg-btn-map mapsvg-in");i.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.zoomIn()}));const s=Dr("<div />").addClass("mapsvg-btn-map mapsvg-out");s.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.zoomOut()})),e.append(i).append(s);const o=Dr("<div />").addClass("mapsvg-btn-map mapsvg-btn-location");o.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.showUserLocation((t=>{this.options.scroll.on&&this.centerOn(t.marker)}))}));const n='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 447.342 447.342" style="enable-background:new 0 0 447.342 447.342;" xml:space="preserve"><path d="M443.537,3.805c-3.84-3.84-9.686-4.893-14.625-2.613L7.553,195.239c-4.827,2.215-7.807,7.153-7.535,12.459 c0.254,5.305,3.727,9.908,8.762,11.63l129.476,44.289c21.349,7.314,38.125,24.089,45.438,45.438l44.321,129.509 c1.72,5.018,6.325,8.491,11.63,8.762c5.306,0.271,10.244-2.725,12.458-7.535L446.15,18.429 C448.428,13.491,447.377,7.644,443.537,3.805z"/></svg>';o.html(n);const r=Dr("<div />").addClass("mapsvg-btn-group").appendTo(t);r.append(o);const a='<svg height="14px" version="1.1" viewBox="0 0 14 14" width="14px" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink"><g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1"><g fill="#000000" transform="translate(-215.000000, -257.000000)"><g id="fullscreen" transform="translate(215.000000, 257.000000)"><path d="M2,9 L0,9 L0,14 L5,14 L5,12 L2,12 L2,9 L2,9 Z M0,5 L2,5 L2,2 L5,2 L5,0 L0,0 L0,5 L0,5 Z M12,12 L9,12 L9,14 L14,14 L14,9 L12,9 L12,12 L12,12 Z M9,0 L9,2 L12,2 L12,5 L14,5 L14,0 L9,0 L9,0 Z" /></g></g></g></svg>',l=Dr("<div />").html(a).addClass("mapsvg-btn-map mapsvg-btn-zoom-reset");l.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.viewBoxReset("custom")}));const h=Dr("<div />").addClass("mapsvg-btn-group").appendTo(t);h.append(l),this.containers.controls=t[0],this.controls={zoom:e[0],userLocation:r[0],zoomReset:h[0]},Dr(this.containers.map).append(Dr(this.containers.controls))}Dr(this.controls.zoom).toggle(this.options.controls.zoom),Dr(this.controls.userLocation).toggle(this.options.controls.userLocation),Dr(this.controls.zoomReset).toggle(this.options.controls.zoomReset),Dr(this.containers.controls).removeClass("left"),Dr(this.containers.controls).removeClass("right"),"right"!==e&&"left"!==e||Dr(this.containers.controls).addClass(e)}getZoomLevelViewBox(t){const e=this.getAdjustedSvgDefaultViewBox(),i=this.googleMaps.map?2:this.options.zoom.delta,s=t>=0?Math.pow(i,t):1/Math.pow(i,Math.abs(t));return e.update(0,0,e.width/s,e.height/s),e}setCursor(t){t="pointer"==t?"pointer":"default",this.options.cursor=t,"pointer"==t?Dr(this.containers.map).addClass("mapsvg-cursor-pointer"):Dr(this.containers.map).removeClass("mapsvg-cursor-pointer")}setMultiSelect(t,e){this.options.multiSelect=S.numbers.parseBoolean(t),!1!==e&&this.deselectAllRegions()}_new_setChoropleth(t){if(null!=(t=t||this.options.choropleth).on&&(t.on=S.numbers.parseBoolean(t.on)),void 0===t.coloring||void 0===t.coloring.palette||void 0===t.coloring.palette.colors)void 0===t.sourceFieldSelect||void 0===t.sourceFieldSelect.variants?r(this.options.choropleth,t):this.options.choropleth.sourceFieldSelect.variants=t.sourceFieldSelect.variants;else{const e=Object.keys(t.coloring.palette.colors);if(e.length>1||"0"==e[0]&&Object.keys(t.coloring.palette.colors[0]).length>1)this.options.choropleth.coloring.palette.colors=t.coloring.palette.colors;else{const e=Object.keys(t.coloring.palette.colors)[0];r(this.options.choropleth.coloring.palette.colors[e],t.coloring.palette.colors[e])}}if(this.updateChoroplethMinMax(),this.options.choropleth.on&&this.options.choropleth.sourceFieldSelect.on&&this.options.choropleth.sourceFieldSelect.variants)if(this.containers.choroplethSourceSelect)Dr(this.containers.choroplethSourceSelect.select).mselect2("destroy"),Dr(this.containers.choroplethSourceSelect.select).find("option").remove(),this.containers.choroplethSourceSelect.options=[],this.options.choropleth.sourceFieldSelect.variants.forEach((t=>{this.containers.choroplethSourceSelect.options.push(Dr('<option value="'+t+'" '+(t===this.options.choropleth.sourceField?"selected":"")+">"+t+"</option>")[0])})),Dr(this.containers.choroplethSourceSelect.select).append(this.containers.choroplethSourceSelect.options),Dr(this.containers.choroplethSourceSelect.select).mselect2({width:"100%"});else{const t=[];this.options.choropleth.sourceFieldSelect.variants.forEach((e=>{t.push(Dr('<option value="'+e+'" '+(e===this.options.choropleth.sourceField?"selected":"")+">"+e+"</option>"))})),this.containers.choroplethSourceSelect={container:Dr('<div class="mapsvg-choropleth-source-field"></div>')[0],select:Dr('<select id="mapsvg-choropleth-source-field-select" class="mapsvg-select2"></select>')[0],options:t},Dr(this.containers.choroplethSourceSelect.select).append(this.containers.choroplethSourceSelect.options),Dr(this.containers.choroplethSourceSelect.container).append(Dr(this.containers.choroplethSourceSelect.select)),Dr(this.containers.map).append(Dr(this.containers.choroplethSourceSelect.container)),Dr(this.containers.choroplethSourceSelect.select).mselect2(),Dr(this.containers.choroplethSourceSelect.select).mselect2().on("select2:select select2:unselecting",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.setChoropleth({sourceField:Dr(t.target).mselect2().val()})}))}if(this.options.choropleth.on&&this.options.choropleth.sourceFieldSelect.on||!this.containers.choroplethSourceSelect||!Dr(this.containers.choroplethSourceSelect.container).is(":visible")?this.options.choropleth.on&&this.options.choropleth.sourceFieldSelect.on&&this.containers.choroplethSourceSelect&&!Dr(this.containers.choroplethSourceSelect.container).is(":visible")&&Dr(this.containers.choroplethSourceSelect.container).show():Dr(this.containers.choroplethSourceSelect.container).hide(),Dr(this.containers.map).find(".mapsvg-choropleth-legend").remove(),this.options.choropleth.on&&this.options.choropleth.coloring.legend.on){const t=this.options.choropleth.coloring.legend;let e="";if("gradient"===this.options.choropleth.coloring.mode){e+='<div class="mapsvg-choropleth-legend-gradient-no-data">'+this.options.choropleth.coloring.noData.description+"</div>";let t="";for(let e=1;e<5;e++)t+='<div class="mapsvg-choropleth-legend-gradient-chunk">'+(this.options.choropleth.coloring.gradient.values.maxAdjusted*e/5+this.options.choropleth.coloring.gradient.values.min)+"</div>";e+='<div class="mapsvg-choropleth-legend-gradient-colors">'+t+"</div>"}else{e+='<div class="mapsvg-choropleth-legend-palette-color-wrap" data-idx="no-data"><div class="mapsvg-choropleth-legend-palette-color"></div><div class="mapsvg-choropleth-legend-palette-color-description">'+this.options.choropleth.coloring.noData.description+"</div></div>",e+='<div class="mapsvg-choropleth-legend-palette-color-wrap" data-idx="out-of-range"><div class="mapsvg-choropleth-legend-palette-color"></div><div class="mapsvg-choropleth-legend-palette-color-description">'+this.options.choropleth.coloring.palette.outOfRange.description+"</div></div>";const i=this.options.choropleth.coloring.palette.colors;i.forEach(((s,o)=>{let n="";n=s.description?s.description:0!==o||s.valueFrom||0===s.valueFrom?o!==i.length-1||s.valueTo?s.valueFrom+" &#8804; "+s.valueTo:"vertical"===t.layout?s.valueFrom+" or more":s.valueFrom+" <":"vertical"===t.layout?"Less then "+s.valueTo:"< "+s.valueTo,e+='<div class="mapsvg-choropleth-legend-palette-color-wrap" data-idx="'+o+'"><div class="mapsvg-choropleth-legend-palette-color"></div><div class="mapsvg-choropleth-legend-palette-color-description">'+n+"</div></div>"}))}this.containers.legend={title:Dr('<div class="mapsvg-choropleth-legend-title">'+t.title+"</div>")[0],text:Dr('<div class="mapsvg-choropleth-legend-text">'+t.text+"</div>")[0],coloring:Dr('<div class="mapsvg-choropleth-legend-'+this.options.choropleth.coloring.mode+'">'+e+"</div>")[0],description:Dr('<div class="mapsvg-choropleth-legend-description">'+t.description+"</div>")[0],container:Dr("<div />").addClass("mapsvg-choropleth-legend mapsvg-choropleth-legend-"+t.layout+" mapsvg-choropleth-legend-container-"+t.container)[0]},Dr(this.containers.legend.container).append(this.containers.legend.title).append(this.containers.legend.text).append(this.containers.legend.coloring).append(this.containers.legend.description),Dr(this.containers.map).append(this.containers.legend.container),this.setChoroplethLegendCSS(),this.regionsRepository.events.on(Yt.AFTER_UPDATE,(()=>{this.redrawChoropleth()})),this.objectsRepository.events.on(Yt.AFTER_UPDATE,(()=>{this.redrawChoropleth()}))}if(this.options.choropleth.on&&"gradient"===this.options.choropleth.coloring.mode){const t=this.options.choropleth.coloring.gradient.colors;t&&(t.lowRGB=j(t.low).toRgb(),t.highRGB=j(t.high).toRgb(),t.diffRGB={r:t.highRGB.r-t.lowRGB.r,g:t.highRGB.g-t.lowRGB.g,b:t.highRGB.b-t.lowRGB.b,a:t.highRGB.a-t.lowRGB.a},this.containers.legend&&this.setChoroplethLegendCSS())}this.redrawChoropleth()}redrawChoropleth(){this.updateChoroplethMinMax(),this.redrawBubbles(),this.reloadAllRegionStyles()}updateChoroplethMinMax(){if(this.options.choropleth.on){const t=this.options.choropleth.coloring.gradient,e=[];t.values.min=0,t.values.max=null,"regions"===this.options.choropleth.source?this.regionsRepository.getLoaded().forEach((t=>{const i=t.getData()[this.options.choropleth.sourceField];i&&e.push(i)})):this.objectsRepository.objects.forEach((t=>{const i=t.getData()[this.options.choropleth.sourceField];null!=i&&""!==i&&e.push(i)})),e.length>0&&(t.values.min=Math.min.apply(null,e),t.values.max=Math.max.apply(null,e),t.values.maxAdjusted=t.values.max-t.values.min)}}setChoroplethLegendCSS(){const t=this.options.choropleth.coloring.gradient,e=this.options.choropleth.coloring.legend,i=this.options.choropleth.coloring.noData,s=this.options.choropleth.coloring.palette.outOfRange;if(Dr(".mapsvg-choropleth-legend").css({width:e.width,height:e.height}),"gradient"===this.options.choropleth.coloring.mode)"horizontal"===e.layout?Dr(".mapsvg-choropleth-legend-horizontal .mapsvg-choropleth-legend-gradient-colors").css({background:"linear-gradient(to right,"+t.colors.low+" 1%,"+t.colors.high+" 100%)"}):Dr(".mapsvg-choropleth-legend-vertical .mapsvg-choropleth-legend-gradient-colors").css({background:"linear-gradient(to bottom,"+t.colors.low+" 1%,"+t.colors.high+" 100%)"}),Dr(".mapsvg-choropleth-legend-gradient-no-data").css({"background-color":i.color});else{const t=undefined;this.options.choropleth.coloring.palette.colors.forEach((function(t,e){Dr('.mapsvg-choropleth-legend-palette-color-wrap[data-idx="'+e+'"] .mapsvg-choropleth-legend-palette-color').css({"background-color":t.color})})),Dr('.mapsvg-choropleth-legend-palette-color-wrap[data-idx="no-data"] .mapsvg-choropleth-legend-palette-color').css({"background-color":i.color}),Dr('.mapsvg-choropleth-legend-palette-color-wrap[data-idx="out-of-range"] .mapsvg-choropleth-legend-palette-color').css({"background-color":s.color})}}setCss(t){t&&-1!==t.indexOf("%id%")&&(t=t.replace(/%id%/g,""+this.id)),this.options.css=t||this.options.css,this.liveCss=this.liveCss||Dr("<style></style>").appendTo("head")[0],Dr(this.liveCss).html(this.options.css)}setFiltersSchema(t){r(this.options,{filtersSchema:t}),this.filtersSchema||(this.filtersSchema=new Pt({objectNamePlural:"filters",objectNameSingular:"filter",fields:this.options.filtersSchema})),this.filtersSchema.setFields(t),this.setFilters()}setFilters(t){var e,i;if(null!=(t=t||this.options.filters).on&&(t.on=S.numbers.parseBoolean(t.on)),null!=t.hide&&(t.hide=S.numbers.parseBoolean(t.hide)),r(this.options,{filters:t}),void 0!==this.filtersSchema){if(!s.googleMapsApiLoaded&&this.options.filters.on&&this.filtersSchema&&this.filtersSchema.getField("distance")&&this.loadGoogleMapsAPI((()=>1),(()=>1)),-1===["leftSidebar","rightSidebar","header","footer","custom","map"].indexOf(this.options.filters.location)&&(this.options.filters.location="leftSidebar"),this.options.filters.on){let t;if(this.formBuilder&&this.formBuilder.destroy(),this.containers.filters?(Dr(this.containers.filters).empty(),Dr(this.containers.filters).show()):this.containers.filters=Dr('<div class="mapsvg-filters-wrap"></div>')[0],Dr(this.containers.filtersModal)&&Dr(this.containers.filtersModal).css({width:this.options.filters.width}),"custom"===this.options.filters.location){if(!Dr("#"+this.options.filters.containerId).length)return this.decrementAfterloadBlockers(),void console.error("MapSVG: filter container #"+this.options.filters.containerId+" does not exist");t=Dr("#"+this.options.filters.containerId)[0]}else if(u())t=this.containers.header,this.setContainers({header:{on:!0}});else{const i=u()?"header":this.options.filters.location;if(this.options.menu.on&&this.controllers.directory&&this.options.menu.location===this.options.filters.location){if(t=Dr(null===(e=this.controllers.directory)||void 0===e?void 0:e.containers.view).find(".mapsvg-directory-filter-wrap")[0],!t)return}else t=this.containers[i]}(this.regionsRepository||this.objectsRepository)&&this.loadFiltersController(t,!1)}else this.controllers.filters&&this.controllers.filters.destroy(),this.controllers.filters=null;this.controllers.directory&&this.options.menu.location===this.options.filters.location&&(null===(i=this.controllers.directory)||void 0===i||i.updateTopShift()),setTimeout((()=>{this.updateFiltersState()}),100)}}updateFiltersState(){this.options.filters&&this.options.filters.on&&this.controllers.filters&&this.controllers.filters.update(this.filtersRepository.query),this.updateFilterTags()}setGlobalDistanceFilter(){this.objectsRepository&&this.objectsRepository.query.filters&&this.objectsRepository.query.filters.distance?(this.objectsRepository.query.filters.distance,s.distanceSearch=this.objectsRepository.query.filters.distance):s.distanceSearch=null}seFilterTags(){var t,e;this.containers.filterTags=this.containers.filterTags||Dr('<div class="mapsvg-filter-tags"></div>')[0],Dr(this.containers.filterTags).empty(),Dr(this.containers.filterTags).off(),this.options.filters.on?Dr(this.containers.filterTags).hide():(Dr(this.containers.filterTags).show(),this.options.menu.on&&this.controllers.directory?(Dr(null===(t=this.controllers.directory)||void 0===t?void 0:t.containers.toolbar).append(this.containers.filterTags),null===(e=this.controllers.directory)||void 0===e||e.updateTopShift()):(Dr(this.containers.map).append(this.containers.filterTags),this.options.zoom.buttons.on&&(this.options.layersControl.on?"top-left"==this.options.layersControl.position?Dr(this.containers.filterTags).css({right:0,bottom:0}):Dr(this.containers.filterTags).css({bottom:0}):"left"==this.options.zoom.buttons.location&&Dr(this.containers.filterTags).css({right:0}))),Dr(this.containers.filterTags).on("click",".mapsvg-filter-delete",(t=>{const e=Dr(t.target).data("filter");Dr(t.target).parent().remove();const i="regions"===this.options.filters.source?this.regionsRepository:this.objectsRepository;"search"===e?i.query.setSearch(null):i.query.removeFilter(e),this.deselectAllRegions(),i.find()})))}updateFilterTags(){var t;if(this.seFilterTags(),this.options.filters.on)return;const i="regions"===this.options.filters.source?this.regionsRepository:this.objectsRepository,s=[];i.query.search&&s.push({label:"",value:i.query.search,name:"search"});const o=i.query.filters,{distance:n}=o,r=e(o,["distance"]);n&&n.address&&s.push({label:"",value:n.address,name:"distance"});for(const e in r){const o=r[e],n=this.filtersSchema.getField(e),a=n?n.parameterNameShort:e,l=i.getSchema().getField(a);if(!l)continue;const h=n?n.label:null!==(t=l.label)&&void 0!==t?t:"";let c=o;n&&"select"===n.type&&(c=n.multiselect?o.map((t=>t.label)).join(", "):n.options.find((t=>t.value===o)).label),s.push({label:h,value:c,name:e})}Dr(this.containers.filterTags).html(s.map((t=>`<div class="mapsvg-filter-tag">${t.label?t.label+": ":""}${t.value}<span class="mapsvg-filter-delete" data-filter="${t.name}">×</span></div>`)).join(""))}createContainers(){this.containers=Object.assign(Object.assign({},this.containers),{map:this.container,scrollpane:Dr('<div class="mapsvg-scrollpane"></div>')[0],scrollpaneWrap:Dr('<div class="mapsvg-scrollpane-wrap"></div>')[0],layers:Dr('<div class="mapsvg-layers-wrap"></div>')[0]}),this.containers.map.appendChild(this.containers.layers),this.containers.map.appendChild(this.containers.scrollpaneWrap),this.containers.scrollpaneWrap.appendChild(this.containers.scrollpane),this.containers.map.classList.add("mapsvg"),this.containers.wrapAll=document.createElement("div"),this.containers.wrapAll.classList.add("mapsvg-wrap-all"),this.containers.wrapAll.id="mapsvg-map-"+this.id,this.containers.wrapAll.setAttribute("data-map-id",this.id?this.id.toString():""),this.containers.wrap=document.createElement("div"),this.containers.wrap.classList.add("mapsvg-wrap"),this.containers.mapContainer=document.createElement("div"),this.containers.mapContainer.classList.add("mapsvg-map-container"),this.containers.leftSidebar=document.createElement("div"),this.containers.leftSidebar.className="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-left",this.containers.rightSidebar=document.createElement("div"),this.containers.rightSidebar.className="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-right",this.containers.header=document.createElement("div"),this.containers.header.className="mapsvg-header mapsvg-top-container",this.containers.footer=document.createElement("div"),this.containers.footer.className="mapsvg-footer mapsvg-top-container",this.containers.wrapAll=Dr('<div class="mapsvg-wrap-all"></div>').attr("id","mapsvg-map-"+this.id).attr("data-map-id",this.id)[0],this.containers.wrap=Dr('<div class="mapsvg-wrap"></div>')[0],this.containers.mapContainer=Dr('<div class="mapsvg-map-container"></div>')[0],this.containers.leftSidebar=Dr('<div class="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-left"></div>').hide()[0],this.containers.rightSidebar=Dr('<div class="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-right"></div>').hide()[0],this.containers.header=Dr('<div class="mapsvg-header mapsvg-top-container"></div>').hide()[0],this.containers.footer=Dr('<div class="mapsvg-footer mapsvg-top-container"></div>').hide()[0],this.containers.map.parentNode.insertBefore(this.containers.wrapAll,this.containers.map),this.containers.wrapAll.appendChild(this.containers.header),this.containers.wrapAll.appendChild(this.containers.wrap),this.containers.wrapAll.appendChild(this.containers.footer),this.containers.mapContainer.appendChild(this.containers.map),this.containers.wrap.appendChild(this.containers.leftSidebar),this.containers.wrap.appendChild(this.containers.mapContainer),this.containers.wrap.appendChild(this.containers.rightSidebar),this.containersCreated=!0,this.resizeSensor||(this.resizeSensor=new m(this.containers.map,(()=>{this.throttle((()=>{this.redraw(),this.events.trigger(Mr.RESIZE,{viewBox:this.viewBox,mapWidth:this.containers.map.clientWidth,mapHeight:this.containers.map.clientHeight})}),50,this)}))),this.containers.toolbar=Dr('<div class="mapsvg-map-toolbar"></div>')[0],this.containers.wrapAll.appendChild(this.containers.toolbar),this.disableAnimation(),this.addLayer("markers"),this.addLayer("labels"),this.addLayer("bubbles"),this.addLayer("popovers"),this.addLayer("scrollpane")}setContainers(t){const e=this;t=t||e.options.containers||{};for(const i in t){void 0!==t[i].on&&(t[i].on=S.numbers.parseBoolean(t[i].on)),t[i].width&&(("string"!=typeof t[i].width||-1===t[i].width.indexOf("px")&&-1===t[i].width.indexOf("%")&&"auto"!==t[i].width)&&(t[i].width=t[i].width+"px"),Dr(e.containers[i]).css({"flex-basis":t[i].width})),t[i].height&&(("string"!=typeof t[i].height||-1===t[i].height.indexOf("px")&&-1===t[i].height.indexOf("%")&&"auto"!==t[i].height)&&(t[i].height=t[i].height+"px"),Dr(e.containers[i]).css({"flex-basis":t[i].height,height:t[i].height})),r(e.options,{containers:t});let s=e.options.containers[i].on;u()&&e.options.menu.hideOnMobile&&(e.options.menu.location===i||"custom"===e.options.menu.location)&&-1!==["leftSidebar","rightSidebar"].indexOf(i)?s=!1:u()&&!e.options.menu.hideOnMobile&&e.options.menu.location===i&&-1!==["leftSidebar","rightSidebar"].indexOf(i)&&Dr(e.containers.wrapAll).addClass("mapsvg-directory-visible"),Dr(e.containers[i]).toggle(s)}e.setDetailsView()}createToolbar(){this.controllers.toolbar&&this.controllers.toolbar.destroy(),this.controllers.toolbar=new Tr({map:this,parent:this,container:this.containers.toolbar,state:Object.assign({active:"map"},this.options.mobileView),events:{click:t=>{const{buttonName:e}=t.data;switch(e){case"map":Dr(this.containers.mapContainer).show(),Dr(this.controllers.directory.containers.parent).hide(),u()&&(Dr(this.containers.wrap).css("height","auto"),this.controllers.directory.updateScroll()),this.redraw();break;case"menu":Dr(this.containers.mapContainer).hide(),Dr(this.controllers.directory.containers.parent).show(),u()&&Dr(this.controllers.directory.containers.main).height()<parseInt(this.controllers.directory.options.minHeight)&&(Dr(this.containers.wrap).css("height",parseInt(this.controllers.directory.options.minHeight)+"px"),this.controllers.directory.updateScroll())}this.controllers.directory.updateTopShift()}}}),this.controllers.toolbar.init()}shouldBeScrollable(t){const e=this;switch(t){case"map":case"fullscreen":case"leftSidebar":case"rightSidebar":return!0;case"custom":default:return!1;case"header":case"footer":return!(!e.options.containers[t].height||"auto"===e.options.containers[t].height||"100%"===e.options.containers[t].height)}}extractField(t,e,i,s){const{object:o,field:r}=_(i);let a;if(!s)throw new Error("extractField: no callback provided");if(o&&r){if(!["Region","Object"].includes(o))throw new Error("extractField: Incorrect object type "+o);const i="Region"==o?t.getData():e.getData();return a=n(i,r),s(a)}}setDatabase(t){(t=t||this.options.database).noFiltersNoLoad&&this.objectsRepository&&this.objectsRepository.setNoFiltersNoLoad(!0),t.pagination&&(null!=t.pagination.on&&(t.pagination.on=S.numbers.parseBoolean(t.pagination.on)),null!=t.pagination.perpage&&(t.pagination.perpage=parseInt(t.pagination.perpage)));const e=Object.assign({},this.options.database.pagination);if(r(this.options,{database:t}),t.pagination)if(void 0!==t.pagination.on&&e.on!==t.pagination.on||void 0!==t.pagination.perpage&&e.perpage!==t.pagination.perpage){const t=new Ut({perpage:this.options.database.pagination.on?this.options.database.pagination.perpage:0});this.options.database.on&&this.objectsRepository&&this.objectsRepository.find(t)}else this.setPagination()}updateGoogleMapsMaxZoom(t){this.googleMaps.maxZoomService.getMaxZoomAtLatLng(t,(t=>{"OK"===t.status&&(this.googleMaps.currentMaxZoom=t.zoom)}))}setGoogleMaps(t){if(null!=(t=t||this.options.googleMaps).on&&(t.on=S.numbers.parseBoolean(t.on)),this.googleMaps||(this.googleMaps={loaded:!1,initialized:!1,map:null,overlay:null}),r(this.options,{googleMaps:t}),this.options.googleMaps.on){if(!s.googleMaps.apiKey)return void console.error("Google Maps API key is required no enable Google Maps");if(Dr(this.containers.map).toggleClass("mapsvg-with-google-map",!0),s.googleMaps.loaded)if(this.googleMaps.map)this.googleMaps.map.setZoom(this.zoomLevel),this.googleMaps.map.setCenter(this.getCenterGeoPoint()),Dr(this.containers.googleMaps)&&Dr(this.containers.googleMaps).css({opacity:1}),t.type&&this.googleMaps.map.setMapTypeId(t.type);else{this.containers.googleMaps=Dr('<div class="mapsvg-layer mapsvg-layer-gm" id="mapsvg-google-maps-'+this.id+'"></div>').prependTo(this.containers.map)[0],Dr(this.containers.googleMaps).css({position:"absolute",top:0,left:0,bottom:0,right:0,"z-index":"0",opacity:1}),this.googleMaps.map=new google.maps.Map(this.containers.googleMaps,{mapTypeId:t.type,fullscreenControl:!1,keyboardShortcuts:!1,mapTypeControl:!1,scaleControl:!1,scrollwheel:!1,streetViewControl:!1,zoomControl:!1,styles:t.styleJSON,tilt:0});const e=new google.maps.LatLng(this.geoViewBox.sw.lat,this.geoViewBox.sw.lng),i=new google.maps.LatLng(this.geoViewBox.ne.lat,this.geoViewBox.ne.lng),s=new google.maps.LatLngBounds(e,i);this.googleMaps.overlay=this.createGoogleMapOverlay(s,this.googleMaps.map),this.googleFitCurrentGeoBounds(),this.googleMaps.maxZoomService=new google.maps.MaxZoomService,this.googleMaps.map.addListener("idle",(()=>{this.isZooming=!1})),google.maps.event.addListenerOnce(this.googleMaps.map,"idle",(()=>{setTimeout((()=>{Dr(this.containers.map).addClass("mapsvg-fade-in"),setTimeout((()=>{this.googleMaps.initialized=!0,Dr(this.containers.map).removeClass("mapsvg-google-map-loading"),Dr(this.containers.map).removeClass("mapsvg-fade-in"),this.options.googleMaps.center&&this.options.googleMaps.zoom||(this.options.googleMaps.center=this.googleMaps.map.getCenter().toJSON(),this.options.googleMaps.zoom=this.googleMaps.map.getZoom()),this.updateGoogleMapsMaxZoom(this.options.googleMaps.center),this.setViewBoxByGoogleMapsOverlay(),this.throttle(this.toggleSvgLayerOnZoom,50,this),this.events.trigger("afterLoad.googleMaps"),this.decrementAfterloadBlockers(),this.finalizeMapLoading()}),400)}),1)})),this.events.on("boundsChanged.googleMaps",(({data:t})=>{this.setViewBoxByGoogleMapsOverlay()}))}else this.loadGoogleMapsAPI((()=>{this.setGoogleMaps()}),(()=>{this.setGoogleMaps({on:!1})}))}else Dr(this.containers.googleMaps)&&Dr(this.containers.googleMaps).css({opacity:0});this.converter&&this.converter.setWorldShift(!!this.googleMaps.map)}createGoogleMapOverlay(t,e){class i extends google.maps.OverlayView{constructor(t,e,i){super(),this.bounds_=t,this.map_=e,this.mapsvg=i,this.setMap(e),this.prevCoords={sw:{x:0,y:0},sw2:{x:0,y:0},ne:{x:0,y:0},ne2:{x:0,y:0}}}draw(){this.mapsvg.events.trigger("boundsChanged.googleMaps",{bounds:this.getPixelBounds(),map:this.map_})}getScale(){const t=this.getPixelBounds();return t?(t.ne.x-t.sw.x)/this.mapsvg.svgDefault.viewBox.width:null}onAdd(){this.element=document.createElement("div"),this.element.style.borderStyle="none",this.element.style.borderWidth="0px",this.element.style.position="absolute";const t=undefined;this.getPanes().overlayLayer.appendChild(this.element)}getPixelBounds(){const t=this.getProjection();if(!t)return;const e=this.bounds_.getSouthWest(),i=this.bounds_.getNorthEast(),s={sw:t.fromLatLngToDivPixel(e),ne:t.fromLatLngToDivPixel(i),sw2:t.fromLatLngToContainerPixel(e),ne2:t.fromLatLngToContainerPixel(i)},o=t.getWorldWidth();return this.prevCoords.sw&&s.ne.x<s.sw.x&&(Math.abs(this.prevCoords.sw.x-s.sw.x)>Math.abs(this.prevCoords.ne.x-s.ne.x)?s.sw.x=s.sw.x-o:s.ne.x=s.ne.x+o,Math.abs(this.prevCoords.sw2.x-s.sw2.x)>Math.abs(this.prevCoords.ne2.x-s.ne2.x)?s.sw2.x=s.sw2.x-o:s.ne2.x=s.ne2.x+o),this.element.style.left=s.sw.x+"px",this.element.style.top=s.ne.y+"px",this.element.style.width=s.ne.x-s.sw.x+"px",this.element.style.height=s.sw.y-s.ne.y+"px",this.prevCoords=s,{sw:s.sw2,ne:s.ne2}}}return new i(t,e,this)}loadGoogleMapsAPI(t,e){if(!s.googleMaps.apiKey)return void console.error("MapSVG: can't load Google API because no API key has been provided");if(void 0!==window.google&&google.maps&&(s.googleMaps.loaded=!0),s.googleMaps.loaded)return void("function"==typeof t&&t());if(Dr(this.containers.map).addClass("mapsvg-google-map-loading"),s.googleMaps.onLoadCallbacks=s.googleMaps.onLoadCallbacks||[],"function"==typeof t&&s.googleMaps.onLoadCallbacks.push(t),s.googleMaps.apiIsLoading)return;s.googleMaps.apiIsLoading=!0,window.gm_authFailure=()=>{console.error("MapSVG: Google maps API key is incorrect.")},this.googleMapsScript=document.createElement("script"),this.googleMapsScript.async=!0,window.mapsvgInitGoogleMap=()=>{s.googleMaps.loaded=!0,s.googleMaps.onLoadCallbacks.forEach((e=>{"function"==typeof t&&e()}))};const i=[];this.options.googleMaps.drawingTools&&i.push("drawing"),this.options.googleMaps.geometry&&i.push("geometry");let o="";i.length>0&&(o="&libraries="+i.join(",")),this.googleMapsScript.src="https://maps.googleapis.com/maps/api/js?language="+this.options.googleMaps.language+"&loading=async&callback=mapsvgInitGoogleMap&key="+s.googleMaps.apiKey+o;try{document.head.appendChild(this.googleMapsScript)}catch(t){console.error(t),this.decrementAfterloadBlockers(),this.finalizeMapLoading()}}showDetails(t,e){this.loadDetailsView(t,e)}loadDetailsView(t,e){this.controllers.popover&&this.controllers.popover.close(),this.controllers.detailsView&&this.controllers.detailsView.destroy();const i="fullscreen"===this.options.detailsView.location||u()&&this.options.detailsView.mobileFullscreen&&"custom"!==this.options.detailsView.location;let s;Dr(this.containers.detailsView)&&void 0!==this.options.colors.detailsView&&Dr(this.containers.detailsView).css({"background-color":this.options.colors.detailsView}),s="custom"===this.options.detailsView.location?Dr("#"+this.options.detailsView.containerId)[0]:this.containers[this.options.detailsView.location];const o=e?this.options.templates[e]:"type"in t&&t.isRegion()?this.options.templates.detailsViewRegion:this.options.templates.detailsView;this.controllers.detailsView=new le({map:this,parent:this,styles:{backgroundColor:this.options.colors.detailsView,margin:this.options.detailsView.margin,width:this.options.detailsView.width},autoresize:!i&&this.options.detailsView.autoresize,container:s,template:o,state:t.getData(),scrollable:i||this.shouldBeScrollable(this.options.detailsView.location),withToolbar:!((u()||p())&&this.options.detailsView.mobileFullscreen),fullscreen:{sm:this.options.detailsView.mobileFullscreen||"fullscreen"===this.options.detailsView.location,md:this.options.detailsView.mobileFullscreen||"fullscreen"===this.options.detailsView.location,lg:"fullscreen"===this.options.detailsView.location},position:["custom","header","footer"].includes(this.options.detailsView.location)?"relative":"absolute",events:{afterShow:t=>{t.data},afterClose:t=>{var e;t.data,this.deselectAllRegions(),this.deselectAllMarkers(),this.controllers&&this.controllers.directory&&(null===(e=this.controllers.directory)||void 0===e||e.deselectItems())}},middleware:this.middlewares.middlewares.filter((t=>t.name==xt.RENDER))}),this.controllers.detailsView.init(),this.controllers.detailsView.open()}loadFiltersModal(){"custom"!=this.options.filters.modalLocation?(this.containers.filtersModal||(this.containers.filtersModal=Dr('<div class="mapsvg-details-container mapsvg-filters-wrap"></div>')[0]),this.setColors(),Dr(this.containers.filtersModal).css({width:this.options.filters.width}),u()?(Dr("body").append(Dr(this.containers.filtersModal)),Dr(this.containers.filtersModal).css({width:""})):Dr(this.containers[this.options.filters.modalLocation]).append(Dr(this.containers.filtersModal))):(this.containers.filtersModal=Dr("#"+this.options.filters.containerId)[0],Dr(this.containers.filtersModal).css({width:""})),this.loadFiltersController(this.containers.filtersModal,!0)}loadFiltersController(t,e=!1){var i,s,o;if(!this.filtersShouldBeShown())return void(null===(i=this.controllers.filters)||void 0===i||i.destroy());let n;u()?(n=!0,this.options.filters.hideOnMobile):(n=this.options.menu.on&&this.controllers.directory&&this.options.menu.location===this.options.filters.location,this.options.filters.hide),this.filtersRepository="regions"===this.options.filters.source?this.regionsRepository:this.objectsRepository,this.options.filters.searchButton?(this.changedFields=null,this.changedSearch=null):(this.changedSearch=()=>{this.filtersRepository.query.searchFallback=this.filtersSchema.getFieldByType("search").searchFallback,this.throttle(this.filtersRepository.reload,400,this.filtersRepository)},this.changedFields=()=>{this.throttle(this.filtersRepository.reload,400,this.filtersRepository)}),null===(s=this.controllers.filters)||void 0===s||s.destroy(),this.controllers.filters=new ar({map:this,parent:this,middleware:this.middlewares.middlewares.filter((t=>t.name===xt.RENDER)),container:t,classList:"custom"===this.options.filters.location?["mapsvg-filter-container-custom"]:[],styles:{backgroundColor:this.options.colors.directorySearch,width:Dr(t).hasClass("mapsvg-map-container")?this.options.filters.width:"100%",padding:this.options.filters.padding},query:null===(o=this.filtersRepository)||void 0===o?void 0:o.query,schema:this.filtersSchema,template:'<div class="mapsvg-filters-container"></div>',scrollable:e||!n&&-1!==["leftSidebar","rightSidebar"].indexOf(this.options.filters.location),modal:e,withToolbar:!u()&&e,modalLocation:this.options.filters.modalLocation,hideFilters:this.options.filters.hide,hideOnMobile:this.options.filters.hideOnMobile,showButtonText:this.options.filters.showButtonText,clearButton:this.options.filters.clearButton,clearButtonText:this.options.filters.clearButtonText,searchButton:this.options.filters.searchButton,searchButtonText:this.options.filters.searchButtonText,events:{afterRedraw:()=>{var t;n&&(null===(t=this.controllers.directory)||void 0===t||t.updateTopShift())},"clear.form":t=>{this.deselectAllRegions(),this.filtersRepository.find()},"change.formElement.form":t=>{const{formElement:e}=t.data;"search"===e.type?this.changedSearch&&this.changedSearch():this.changedFields&&this.changedFields()},"click.btnSearch":()=>{this.filtersRepository.find()},"afterLoad.form":()=>{var t;this.controllers.directory&&(null===(t=this.controllers.directory)||void 0===t||t.updateTopShift()),this.decrementAfterloadBlockers()},"click.btnShowFilters":()=>{this.loadFiltersModal()}}}),this.controllers.filters.init()}filtersShouldBeShown(){return this.options.filters.on&&this.options.filtersSchema&&this.options.filtersSchema.length>0}textSearch(t,e=!1){const i=new Ut({filters:{search:t},searchFallback:e});this.filtersRepository.find(i)}getRegion(t){return this.regions.findById(t)}getRegions(){return this.regions}getMarker(t){return this.markers.findById(t)}checkId(t){return this.getRegion(t)?{canUse:!1,error:"This ID is already being used by a Region"}:this.markers.findById(t)?{canUse:!1,error:"This ID is already being used by another Marker"}:{canUse:!0,error:""}}reloadAllRegionStyles(){this.regions.forEach(this.reloadRegionStyles)}redrawBubbles(){Dr(this.containers.map).removeClass("bubbles-regions-on bubbles-database-on"),this.options.choropleth.on&&this.options.choropleth.bubbleMode&&Dr(this.containers.map).addClass("bubbles-"+this.options.choropleth.source+"-on"),this.regions.forEach((function(t){t.drawBubble()}));const t=this.options.choropleth.on&&"database"==this.options.choropleth.source&&this.options.choropleth.bubbleMode;this.markers.forEach((function(e){e.setBubbleMode(t)}))}destroy(){Dr(this.containers.map).empty().insertBefore(Dr(this.containers.wrapAll)).attr("class","mapsvg"),this.controllers.popover&&this.controllers.popover.close(),this.controllers.detailsView&&this.controllers.detailsView.destroy(),this.controllers.directory&&this.controllers.directory.destroy(),Dr(this.containers.detailsView).remove(),Dr(this.containers.popover).remove(),Dr(this.containers.tooltipRegion).remove(),Dr(this.containers.tooltipCluster).remove(),Dr(this.containers.tooltipMarker).remove(),Dr(this.containers.wrapAll).remove(),Dr(this.containers.filtersModal).remove(),Dr(this.containers.filters).remove(),Dr(this.containers.map).empty().remove();const t=s.instances.findIndex((t=>t.id===this.id));-1!==t&&s.instances.splice(t,1)}getData(){return{id:this.id,title:this.options.title,options:this.getOptions(!1,!1),version:this.version,svgFileLastChanged:this.svgFileLastChanged}}mayBeFitMarkers(){this.lastTimeFitWas||(this.lastTimeFitWas=Date.now()-99999),this.fitDelta=Date.now()-this.lastTimeFitWas;const{fitMarkersOnStart:t,fitMarkers:e}=this.options,i=!this.fitOnDataLoadDone&&(this.firstDataLoad?t:e);this.fitDelta>1e3&&i&&(this.options.googleMaps.on&&!this.googleMaps.map?this.events.on("afterLoad.googleMaps",(()=>{this.fitMarkers()})):this.fitMarkers(),this.fitOnDataLoadDone=!0),this.lastTimeFitWas=Date.now()}fitMarkers(){const t=this.objectsRepository.getLoaded();if(t&&0!==t.length)if(this.googleMaps.map){const e=[],i=[];if(t.length>1){t.forEach((t=>{t.getData().location&&t.getData().location.geoPoint&&(e.push(t.getData().location.geoPoint.lat),i.push(t.getData().location.geoPoint.lng))}));const s=Math.min.apply(null,e),o=Math.max.apply(null,e),n=Math.min.apply(null,i),r=Math.max.apply(null,i),a=new google.maps.LatLngBounds({lat:s,lng:n},{lat:o,lng:r});this.googleMaps.map.fitBounds(a,0)}else if(t[0].getData().location&&t[0].getData().location.geoPoint.lat&&t[0].getData().location.geoPoint.lng){const e={lat:t[0].getData().location.geoPoint.lat,lng:t[0].getData().location.geoPoint.lng};this.googleMaps.map&&(this.googleMaps.map.setCenter(e),this.googleMaps.map.setZoom(this.options.fitSingleMarkerZoom))}}else{if(this.options.clustering.on){const t=[];return this.markersClusters.forEach((e=>{t.push(e)})),this.markers.forEach((e=>{t.push(e)})),void this.zoomTo(t)}this.zoomTo(this.markers)}}setFitSingleMarkerZoom(t){this.options.fitSingleMarkerZoom=parseInt(t)}showUserLocation(t){this.getUserLocation((e=>{this.userLocation=null,this.userLocation=new Vt({geoPoint:e,img:s.routes.root+"/markers/user-location.svg"}),this.userLocationMarker&&this.userLocationMarker.delete(),this.userLocationMarker=new ur({location:this.userLocation,mapsvg:this,width:15,height:15}),Dr(this.userLocationMarker.element).addClass("mapsvg-user-location"),this.userLocationMarker.centered=!0,this.getLayer("markers").append(this.userLocationMarker.element),this.userLocationMarker.adjustScreenPosition(),t&&t(this.userLocation)}))}getUserLocation(t){return!!navigator.geolocation&&(navigator.geolocation.getCurrentPosition((function(e){const i=new zt(e.coords.latitude,e.coords.longitude);t&&t(i)})),!0)}getScale(){const t=undefined;return this.containers.map.clientWidth/this.viewBox.width||1}getAdjustedSvgDefaultViewBox(){return this.adjustViewBoxToSize(this.svgDefault.viewBox,this.options.width,this.options.height)}getRelativeScale(){return this.svgDefault.viewBox.width/this.viewBox.width}get _scale(){return this.getRelativeScale()}get zoomLevel(){if(this.googleMaps.map)return this.googleMaps.map.getZoom();{const t=undefined,e=this.getAdjustedSvgDefaultViewBox().width/this.viewBox.width;return Math.round(Math.log(e)/Math.log(this.options.zoom.delta)*10)/10}}getViewBox(){return this.viewBox}setRatio(t){let e,i;this.getCenterSvgPoint();const s=undefined;t>this.svgDefault.viewBox.width/this.svgDefault.viewBox.height?(e=this.svgDefault.viewBox.height*t,i=this.svgDefault.viewBox.height):(e=this.svgDefault.viewBox.width,i=this.svgDefault.viewBox.width/t),this.viewBoxSetBySize(e,i)}adjustViewBoxToSize(t,e,i){const s=t.clone(),o=s.x+s.width/2,n=s.y+s.height/2,r=e/i,a=undefined;let l,h;r>s.width/s.height?(h=s.height,l=h*r):(l=s.width,h=l/r);const c=o-l/2,d=n-h/2;return s.update({x:c,y:d,width:l,height:h}),s}viewBoxSetBySize(t,e){this.setSize(t,e);const i=this.adjustViewBoxToSize(this._viewBox,t,e);this.setInitialViewBox(i);const s=this.adjustViewBoxToSize(this.viewBox,t,e);return this.setViewBox(s),this.setSize(t,e),this.viewBox}viewBoxGetByRatio(t){const e=this.svgDefault.viewBox.width/this.svgDefault.viewBox.height,i=this.svgDefault.viewBox.clone();return t!=e&&(t>e?(i.width=this.svgDefault.viewBox.height*t,i.x=this.svgDefault.viewBox.x-(i.width-this.svgDefault.viewBox.width)/2):(i.height=this.svgDefault.viewBox.width/t,i.y=this.svgDefault.viewBox.y-(i.height-this.svgDefault.viewBox.height)/2)),i}viewBoxGetBySize(t,e){const i=t/e,s=this.svgDefault.viewBox.width/this.svgDefault.viewBox.height,o=this.svgDefault.viewBox.clone();return i!=s&&(i>s?(o.width=this.svgDefault.viewBox.height*i,o.x=this.svgDefault.viewBox.x-(o.width-this.svgDefault.viewBox.width)/2):(o.height=this.svgDefault.viewBox.width/i,o.y=this.svgDefault.viewBox.y-(o.height-this.svgDefault.viewBox.height)/2)),o}viewBoxReset(t="custom"){const e=this.getViewBoxByState(t);if(this.googleMaps.map){switch(t){case"custom":{const t=this.getGeoBounds(this._viewBox),e=new google.maps.LatLngBounds(new google.maps.LatLng(t.sw),new google.maps.LatLng(t.ne));this.googleMaps.map.fitBounds(e,0);break}case"initial":{const t=this.getGeoBounds(this.svgDefault.viewBox),e=new google.maps.LatLngBounds(new google.maps.LatLng(t.sw),new google.maps.LatLng(t.ne));this.googleMaps.map.fitBounds(e,0);break}}return e}return this.setViewBox(e),this.viewBox}getViewBoxByState(t){switch(t){case"custom":return this._viewBox;case"initial":return this.getAdjustedSvgDefaultViewBox();case"svg":return this.svgDefault.viewBox}}getGeoViewBox(){const t=this.viewBox,e=new Nt(t.x,t.y),i=new Nt(t.x+t.width,t.y),s=new Nt(t.x,t.y),o=new Nt(t.x,t.y+t.height),n=this.converter.convertSVGToGeo(e).lng,r=this.converter.convertSVGToGeo(i).lng,a=undefined,l=undefined;return[n,this.converter.convertSVGToGeo(s).lat,r,this.converter.convertSVGToGeo(o).lat]}getGeoBounds(t){const e=null!=t?t:this.viewBox,i=new Nt(e.x,e.y),s=new Nt(e.x+e.width,e.y),o=new Nt(e.x,e.y),n=new Nt(e.x,e.y+e.height),r=this.converter.convertSVGToGeo(i).lng,a=this.converter.convertSVGToGeo(s).lng,l=this.converter.convertSVGToGeo(o).lat,h=undefined;return{sw:{lng:r,lat:this.converter.convertSVGToGeo(n).lat},ne:{lng:a,lat:l}}}setStrokes(){Dr(this.containers.svg).find("path, polygon, circle, ellipse, rect, line, polyline").each(((t,e)=>{const i=cr.getComputedStyle("stroke-width",e);i&&Dr(e).attr("data-stroke-width",i.replace("px",""))}))}adjustStrokes(){Dr(this.containers.svg).find("path, polygon, circle, ellipse, rect, line, polyline").each(((t,e)=>{const i=e.getAttribute("data-stroke-width");i&&Dr(e).css("stroke-width",Number(i)/this.scale)}))}zoomIn(t){this.requestZoom()&&this.zoom(this.zoomLevel+1,t)}zoomOut(t){this.requestZoom()&&this.zoom(this.zoomLevel-1,t)}zoomTo(t,e){var i;if(Array.isArray(t)||t.type===nr.REGION){const s=Array.isArray(t)?t:[t];if(!(null===(i=this.googleMaps)||void 0===i?void 0:i.map)){const t=this.getGroupBBox(s);return this.fitViewBox(t,e)}{const t=this.getGroupBounds(s),e=new google.maps.LatLngBounds(new google.maps.LatLng(t.sw),new google.maps.LatLng(t.ne));this.googleMaps.map.fitBounds(e,10)}}else if(t.isMarker()||t.isCluster())return this.zoomToMarkerOrCluster(t,e)}zoomToMarkerOrCluster(t,e){if(this.requestZoom()){const i=null!=e?e:1,s=this.getZoomLevelViewBox(i),o=new lr(t.svgPoint.x-s.width/2,t.svgPoint.y-s.height/2,s.width,s.height);return this.setViewBox(o),!0}return!1}getGroupBounds(t){const e=[],i=[];if(t.forEach((t=>{const s=t.getGeoBounds();e.push(s.sw.lat,s.ne.lat),i.push(s.sw.lng,s.ne.lng)})),0===e.length||0===i.length)throw new Error("No valid geo points found in the provided objects.");const s=Math.min(...e),o=Math.max(...e),n=Math.min(...i),r=Math.max(...i);return{sw:new zt(s,n),ne:new zt(o,r)}}getGroupBBox(t){let e;const i=[],s=[],o=[],n=[];for(let r=0;r<t.length;r++){e=t[r].getBBox(),o.push(e.x),n.push(e.y);const a=e.x+e.width,l=e.y+e.height;i.push(a),s.push(l)}const r=Math.min(...o),a=Math.min(...n),l=Math.max(...i)-r,h=Math.max(...s)-a;let c=10;const d=new Ot(c,0),u=new Ot(0,0);return c=this.converter.convertPixelToSVG(d).x-this.converter.convertPixelToSVG(u).x,new lr(r-c,a-c,l+2*c,h+2*c)}getZoomLevelByViewBox(t,e){if(void 0!==e)return this.getZoomLevelViewBox(e);const i=this.getAdjustedSvgDefaultViewBox(),s=i.width/t.width,o=i.height/t.height,n=Math.min(s,o),r=Math.floor(Math.log(n)/Math.log(this.options.zoom.delta));return this.getZoomLevelViewBox(r)}checkIfZoomIsNeeded(t){return t.width!==this.viewBox.width||t.height!==this.viewBox.height}requestZoom(){return!!this.canZoom&&(this.isZooming=!0,this.canZoom=!1,setTimeout((()=>{this.isZooming=!1,this.canZoom=!0}),700),!0)}fitViewBox(t,e){const i=this.getZoomLevelByViewBox(t,e);if(this.googleMaps.map){const e=this.getGeoBounds(t),i=new google.maps.LatLngBounds(new google.maps.LatLng(e.sw),new google.maps.LatLng(e.ne));return this.googleMaps.map.fitBounds(i,10),!0}{const e=new lr(t.x-i.width/2+t.width/2,t.y-i.height/2+t.height/2,i.width,i.height);return this.enableAnimation(),this.setViewBox(e),!0}}zoomToRegion(t,e){return this.fitViewBox(t.getBBox(),e),!0}setZoomLevel(t){this.zoom(t)}setCenter(t){let e;if(t instanceof zt){if(!this.isGeo())throw new Error("MapSVG: can't center on a lat,lng point on a non-geo map.");e=this.converter.convertGeoToSVG(t)}else e=t;return this.centerOn(e),t}centerOn(t,e){if(e=e?(e+12)/this.getScale():0,t||(t=this.getCenterSvgPoint(!0)),t instanceof Nt||It(t)||t instanceof zt||Ht(t)){const i=It(t)?t:this.converter.convertGeoToSVG(t),s=this.viewBox,o=new lr(i.x-s.width/2,i.y-s.height/2-e,s.width,s.height);this.setViewBox(o)}else{if(!this.googleMaps.map){const i=t.getBBox(),s=this.viewBox,o=new lr(i.x-s.width/2+i.width/2,i.y-s.height/2+i.height/2-e,s.width,s.height);return this.setViewBox(o),o}{Dr(this.containers.map).addClass("scrolling");const i=t.getCenterLatLng(e);this.googleMaps.map.panTo(i),setTimeout((()=>{Dr(this.containers.map).removeClass("scrolling")}),100)}}}zoom(t,e){const i=t>this.zoomLevel?1:-1,s=i>0,o=i<0,n=this.getZoomRange(),r=this.zoomLevel>=n.min&&this.zoomLevel<=n.max,a=r&&(t>n.max||t<n.min&&t<this.initialZoomLevel),l=!r&&(s&&t>n.max||o&&t<n.min);if(a||l)return;let h=[];const c=this.googleMaps.map?this.viewBox.clone():this.getZoomLevelViewBox(t);if(this.googleMaps.map){const e=Math.pow(2,t-this.zoomLevel);c.width/=e,c.height/=e}if(e){const t=this.svgDefault.viewBox.width/c.width,i=this.svgDefault.viewBox.height/c.height,s=Math.min(t,i),o=this.svgDefault.viewBox.width/this.viewBox.width,n=this.svgDefault.viewBox.height/this.viewBox.height,r=undefined,a=Math.min(o,n)/s;c.x=this.viewBox.x+(e.x-this.viewBox.x)*(1-a),c.y=this.viewBox.y+(e.y-this.viewBox.y)*(1-a)}else h=[(this.viewBox.width-c.width)/2,(this.viewBox.height-c.height)/2],c.x=this.viewBox.x+h[0],c.y=this.viewBox.y+h[1];this.shiftViewBoxToScrollBoundaries(c),this.googleMaps.map?(this.googleMaps.map.setZoom(t),e&&this.googleMaps.map.setCenter(this.getCenterGeoPoint(!1,c))):this.setViewBox(c)}toggleSvgLayerOnZoom(){this.googleMaps.map&&this.options.zoom.hideSvg&&this.googleMaps.map.getZoom()>=this.options.zoom.hideSvgZoomLevel?Dr(this.containers.svg).hasClass("mapsvg-invisible")||Dr(this.containers.svg).animate({opacity:0},400,"linear",(()=>{Dr(this.containers.svg).addClass("mapsvg-invisible")})):Dr(this.containers.svg).hasClass("mapsvg-invisible")&&Dr(this.containers.svg).animate({opacity:1},400,"linear",(()=>{Dr(this.containers.svg).removeClass("mapsvg-invisible")}))}shiftViewBoxToScrollBoundaries(t){return this.options.scroll.limit&&(t.x<this.svgDefault.viewBox.x?t.x=this.svgDefault.viewBox.x:t.x+t.width>this.svgDefault.viewBox.x+this.svgDefault.viewBox.width&&(t.x=this.svgDefault.viewBox.x+this.svgDefault.viewBox.width-t.width),t.y<this.svgDefault.viewBox.y?t.y=this.svgDefault.viewBox.y:t.y+t.height>this.svgDefault.viewBox.y+this.svgDefault.viewBox.height&&(t.y=this.svgDefault.viewBox.y+this.svgDefault.viewBox.height-t.height)),t}markerDelete(t){this.editingMarker&&this.editingMarker.id==t.id&&this.unsetEditingMarker(),this.markers.findById(t.id)&&this.markers.delete(t.id),t.delete(),t=null,0===this.markers.length&&(this.options.markerLastID=0)}markersClusterAdd(t){this.layers.markers.append(t.elem),this.markersClusters.push(t),t.adjustScreenPosition()}markerAdd(t){Dr(t.element).hide(),t.adjustScreenPosition(),this.layers.markers.append(t.element),this.markers.push(t),t.mapped=!0,setTimeout((function(){Dr(t.element).show()}),100)}markerRemove(t){this.editingMarker&&this.editingMarker.id==t.id&&(this.editingMarker=null,delete this.editingMarker),this.markers.findById(t.id)&&(this.markers.findById(t.id).delete(),this.markers.delete(t.id),t=null),0===this.markers.length&&(this.options.markerLastID=0)}markerId(){this.options.markerLastID=this.options.markerLastID+1;const t="marker_"+this.options.markerLastID;return this.markers.findById(t)?this.markerId():t}movingItemsAdjustScreenPosition(){this.markersAdjustScreenPosition(),this.popoverAdjustScreenPosition(),this.bubblesRegionsAdjustScreenPosition(),this.labelsRegionsAdjustScreenPosition()}movingItemsMoveScreenPositionBy(t,e){this.markersMoveScreenPositionBy(t,e),this.popoverMoveScreenPositionBy(t,e),this.bubblesRegionsMoveScreenPositionBy(t,e),this.labelsRegionsMoveScreenPositionBy(t,e)}labelsRegionsAdjustScreenPosition(){Dr(this.containers.map).is(":visible")&&this.regions.forEach((function(t){t.adjustLabelScreenPosition()}))}bubblesRegionsAdjustScreenPosition(){Dr(this.containers.map).is(":visible")&&this.regions.forEach((function(t){t.adjustBubbleScreenPosition()}))}labelsRegionsMoveScreenPositionBy(t,e){Dr(this.containers.map).is(":visible")&&this.regions.forEach((function(i){i.moveLabelScreenPositionBy(t,e)}))}bubblesRegionsMoveScreenPositionBy(t,e){Dr(this.containers.map).is(":visible")&&this.regions.forEach((i=>{i.moveBubbleScreenPositionBy(t,e)}))}markersAdjustScreenPosition(){this.markers.forEach((t=>{t.adjustScreenPosition()})),this.markersClusters.forEach((t=>{t.adjustScreenPosition()})),this.userLocationMarker&&this.userLocationMarker.adjustScreenPosition()}markersMoveScreenPositionBy(t,e){this.markers.forEach((i=>{i.moveSrceenPositionBy(t,e)})),this.markersClusters.forEach((i=>{i.moveSrceenPositionBy(t,e)})),this.userLocationMarker&&this.userLocationMarker.moveSrceenPositionBy(t,e)}setEditingMarker(t){this.editingMarker=t,this.editingMarker.mapped||this.markerAdd(this.editingMarker)}unsetEditingMarker(){this.editingMarker&&this.editingMarker.mapped&&this.markerRemove(this.editingMarker),this.editingMarker=null}getEditingMarker(){return this.editingMarker}isLinkClicked(t){var e,i,s;const o=(null===(e=t.target)||void 0===e?void 0:e.getAttribute("href"))||(null===(s=null===(i=t.target)||void 0===i?void 0:i.parentElement)||void 0===s?void 0:s.getAttribute("href"));return!!(t.target&&Dr(t.target).is("a")||Dr(t.target).closest("a").length||o)}handleLinkClick(t){if(this.isLinkClicked(t)){const e=Dr(t.target).is("a")?t.target:Dr(t.target).closest("a")[0],i=Dr(e),s=i.attr("href")||i.attr("xlink:href");s&&s.startsWith("http")&&(t.preventDefault(),"_blank"===i.attr("target")?window.open(s,"_blank"):window.location.href=s),s&&s.startsWith("#")&&t.preventDefault()}}scrollStart(t,e){if(Dr(t.target).hasClass("mapsvg-btn-map")||Dr(t.target).closest(".mapsvg-choropleth").length)return;if(this.editMarkers.on&&Dr(t.target).hasClass("mapsvg-marker"))return;t.preventDefault(),Dr(this.containers.map).addClass("no-transitions");const i=t.touches&&t.touches[0]?t.touches[0]:t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?t.originalEvent.touches[0]:t;this.scrollStarted=!0,this.scroll={tx:this.scroll.tx||0,ty:this.scroll.ty||0,vxi:this.viewBox.x,vyi:this.viewBox.y,x:i.clientX,y:i.clientY,dx:0,dy:0,vx:0,vy:0,gx:i.clientX,gy:i.clientY,touchScrollStart:0},0===t.type.indexOf("mouse")&&(Dr(document).on("mousemove.scroll.mapsvg",(t=>{this.scrollMove(t)})),this.options.scroll.spacebar?Dr(document).on("keyup.scroll.mapsvg",(t=>{32==t.keyCode&&this.scrollEnd(t,e)})):Dr(document).on("mouseup.scroll.mapsvg",(t=>{this.scrollEnd(t,e)})))}scrollMove(t){t.preventDefault(),this.isScrolling||(this.isScrolling=!0,Dr(this.containers.map).addClass("scrolling"));const e=t.touches&&t.touches[0]?t.touches[0]:t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?t.originalEvent.touches[0]:t;this.panBy(this.scroll.gx-e.clientX,this.scroll.gy-e.clientY),this.scroll.gx=e.clientX,this.scroll.gy=e.clientY,this.scroll.dx=this.scroll.x-e.clientX,this.scroll.dy=this.scroll.y-e.clientY;let i=this.scroll.vxi+this.scroll.dx/this.scale,s=this.scroll.vyi+this.scroll.dy/this.scale;this.options.scroll.limit&&(i<this.svgDefault.viewBox.x?i=this.svgDefault.viewBox.x:this.viewBox.width+i>this.svgDefault.viewBox.x+this.svgDefault.viewBox.width&&(i=this.svgDefault.viewBox.x+this.svgDefault.viewBox.width-this.viewBox.width),s<this.svgDefault.viewBox.y?s=this.svgDefault.viewBox.y:this.viewBox.height+s>this.svgDefault.viewBox.y+this.svgDefault.viewBox.height&&(s=this.svgDefault.viewBox.y+this.svgDefault.viewBox.height-this.viewBox.height)),this.scroll.vx=i,this.scroll.vy=s}scrollEnd(t,e,i){if(setTimeout((()=>{this.enableAnimation(),this.scrollStarted=!1,this.isScrolling=!1}),100),this.googleMaps.map&&this.googleMaps.overlay&&this.googleMaps.overlay.draw(),Dr(this.containers.map).removeClass("scrolling"),Dr(document).off("keyup.scroll.mapsvg"),Dr(document).off("mousemove.scroll.mapsvg"),Dr(document).off("mouseup.scroll.mapsvg"),!0!==i&&Math.abs(this.scroll.dx)<5&&Math.abs(this.scroll.dy)<5){if(this.isLinkClicked(t))return void this.handleLinkClick(t);this.editMarkers.on?this.clickAddsMarker&&this.markerAddClickHandler(t):this.objectClickedBeforeScroll&&(this.objectClickedBeforeScroll.isMarker()?this.markerClickHandler(t,this.objectClickedBeforeScroll):this.objectClickedBeforeScroll.isRegion()?this.regionClickHandler(t,this.objectClickedBeforeScroll):this.objectClickedBeforeScroll.isCluster()&&this.markerClusterClickHandler(t,this.objectClickedBeforeScroll))}this.viewBox.x=this.scroll.vx||this.viewBox.x,this.viewBox.y=this.scroll.vy||this.viewBox.y}setViewBoxByGoogleMapsOverlay(){if(!this.googleMaps.initialized)return;const t=this.googleMaps.overlay.getPixelBounds(),e=this.googleMaps.overlay.getScale();if(!e||!t)return;const i=new lr(this.svgDefault.viewBox.x-t.sw.x/e,this.svgDefault.viewBox.y-t.ne.y/e,this.containers.map.offsetWidth/e,this.containers.map.offsetHeight/e);this.setViewBox(i,!1)}panBy(t,e){let i=this.scroll.tx-t,s=this.scroll.ty-e;const o={x:!0,y:!0};if(this.options.scroll.limit){const n=Dr(this.containers.svg)[0].getBoundingClientRect(),r=Dr(this.containers.map)[0].getBoundingClientRect();(n.left-t>r.left&&t<0||n.right-t<r.right&&t>0)&&(i=this.scroll.tx,o.x=!1),(n.top-e>r.top&&e<0||n.bottom-e<r.bottom&&e>0)&&(s=this.scroll.ty,o.y=!1)}const n=this.svgDefault.viewBox.width/this.viewBox.width;if(this.containers.scrollpane.style.transform="translate("+i+"px, "+s+"px) scale("+n+")",this.scroll.tx=i,this.scroll.ty=s,o.x||o.y){const i=o.x?t:0,s=o.y?e:0;if(this.movingItemsMoveScreenPositionBy(i,s),this.googleMaps.map){let t=this.googleMaps.map.getCenter();const e=this.googleMaps.overlay.getProjection(),o=e.fromLatLngToDivPixel(t);o.x+=i,o.y+=s,t=e.fromDivPixelToLatLng(o),this.googleMaps.map.setCenter(t)}}return o}setObjectClickedBeforeScroll(t){this.objectClickedBeforeScroll=t}touchStart(t,e){t.preventDefault(),this.scrollStarted&&this.scrollEnd(t,e,!0);const i=t.originalEvent||t;this.options.zoom.fingers&&i.touches&&2==i.touches.length?(this.touchZoomStart=!0,this.scaleDistStart=Math.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY)):i.touches&&1==i.touches.length&&this.scrollStart(t,e),document.addEventListener("touchmove",this.touchMoveHandler,{passive:!1}),document.addEventListener("touchend",this.touchEndHandler,{passive:!1})}touchMove(t,e){t.preventDefault();const i=t.originalEvent||t;if(this.options.zoom.fingers&&i.touches&&2==i.touches.length){if(C.getDevice().ios||(i.scale=Math.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY)/this.scaleDistStart),1!=i.scale&&this.canZoom){const t=i.scale>1?1:-1,e=i.touches[0].pageX>=i.touches[1].pageX?i.touches[0].pageX-(i.touches[0].pageX-i.touches[1].pageX)/2-Dr(this.containers.map).offset().left:i.touches[1].pageX-(i.touches[1].pageX-i.touches[0].pageX)/2-Dr(this.containers.map).offset().left,s=i.touches[0].pageY>=i.touches[1].pageY?i.touches[0].pageY-(i.touches[0].pageY-i.touches[1].pageY)-Dr(this.containers.map).offset().top:i.touches[1].pageY-(i.touches[1].pageY-i.touches[0].pageY)-Dr(this.containers.map).offset().top,o=this.converter.convertPixelToSVG(new Ot(e,s));t>0?this.zoomIn(o):this.zoomOut(o)}}else i.touches&&1==i.touches.length&&this.scrollMove(t)}touchEnd(t,e){t.preventDefault(),this.touchZoomStart?this.touchZoomStart=!1:this.scrollStarted&&this.scrollEnd(t,e),document.removeEventListener("touchmove",this.touchMoveHandler,!1),document.removeEventListener("touchend",this.touchEndHandler,!1)}getSelected(){return this.selected_id}selectRegion(t,e){var i,s,o;let n,r;if(n="string"==typeof t?this.getRegion(t):t,!n)return;if(this.options.multiSelect&&!this.editRegions.on){if(n.selected)return this.deselectRegion(n),void(!e&&this.options.menu.on&&("database"==this.options.menu.source?n.objects&&n.objects.length&&(r=n.objects.map((t=>t.getData().id.toString()))):r=[n.id],null===(i=this.controllers.directory)||void 0===i||i.deselectItems()))}else this.selected_id.length>0&&(this.deselectAllRegions(),!e&&this.options.menu.on&&("database"==this.options.menu.source?n.objects&&n.objects.length&&(r=n.objects.map((t=>t.getData().id.toString()))):r=[n.id],null===(s=this.controllers.directory)||void 0===s||s.deselectItems()));this.unhighlightRegions();const a=this.highlightedRegions.indexOf(n);a>-1&&(n.unhighlight(),this.highlightedRegions.splice(a,1)),this.selected_id.push(n.id),n.select();const l=undefined;!this.options.actions.region.click.filterDirectory&&!e&&this.options.menu.on&&this.controllers&&this.controllers.directory&&(r="database"==this.options.menu.source&&n.objects&&n.objects.length?n.objects.map((t=>t.getData().id.toString())):[n.id],null===(o=this.controllers.directory)||void 0===o||o.selectItems(r)),this.options.actions.region.click.addIdToUrl&&!this.options.actions.region.click.showAnotherMap&&(window.location.hash="/m/r/"+n.id)}deselectAllRegions(){Dr.each(this.selected_id,((t,e)=>{this.deselectRegion(this.getRegion(e))}))}deselectRegion(t){if(t||(t=this.getRegion(this.selected_id[0])),t){t.deselect();const e=Dr.inArray(t.id,this.selected_id);this.selected_id.splice(e,1)}this.options.actions.region.click.addIdToUrl&&-1!==window.location.hash.indexOf(t.id)&&history.replaceState(null,null," ")}highlightRegions(t){t.forEach((t=>{!t||t.selected||t.disabled||(this.highlightedRegions.push(t),t.highlight())}))}unhighlightRegions(){this.highlightedRegions.forEach((t=>{!t||t.selected||t.disabled||t.unhighlight()})),this.highlightedRegions=[]}selectMarker(t){var e,i;t.isMarker()&&(this.deselectAllMarkers(),t.select(),this.selected_marker=t,Dr(this.layers.markers).addClass("mapsvg-with-marker-active"),this.options.menu.on&&"database"==this.options.menu.source&&(null===(e=this.controllers.directory)||void 0===e||e.deselectItems(),null===(i=this.controllers.directory)||void 0===i||i.selectItems(t.object.getData().id)))}deselectAllMarkers(){this.selected_marker&&this.selected_marker.deselect(),Dr(this.layers.markers).removeClass("mapsvg-with-marker-active")}deselectMarker(t){t&&t.deselect()}highlightMarker(t){Dr(this.layers.markers).addClass("mapsvg-with-marker-hover"),t.highlight(),this.highlighted_marker=t}unhighlightMarker(){Dr(this.layers.markers).removeClass("mapsvg-with-marker-hover"),this.highlighted_marker&&this.highlighted_marker.unhighlight()}convertMouseToSVG(t){const e=y(t),i=e.x-Dr(this.containers.map).offset().left,s=e.y-Dr(this.containers.map).offset().top,o=new Ot(i,s);return this.converter.convertPixelToSVG(o)}pickChoroplethColor(t){const e=(t-this.options.choropleth.coloring.gradient.values.min)/this.options.choropleth.coloring.gradient.values.maxAdjusted,i=undefined;return{r:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.r*e+this.options.choropleth.coloring.gradient.colors.lowRGB.r),g:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.g*e+this.options.choropleth.coloring.gradient.colors.lowRGB.g),b:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.b*e+this.options.choropleth.coloring.gradient.colors.lowRGB.b),a:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.a*e+this.options.choropleth.coloring.gradient.colors.lowRGB.a)}}isRegionDisabled(t,e){return!(!this.options.regions[t]||!this.options.regions[t].disabled&&"none"!=e)||!(null!=this.options.regions[t]&&!S.numbers.parseBoolean(this.options.regions[t].disabled)||!this.options.disableAll&&"none"!=e&&"labels"!=t&&"Labels"!=t)}markerClusterClickHandler(t,e){this.objectClickedBeforeScroll=null,this.eventsPreventList.click||this.zoomTo(e.markers)}regionClickHandler(t,e){if(this.objectClickedBeforeScroll=null,this.eventsPreventList.click)return;if(this.editRegions.on)return void this.regionEditHandler.call(e);const i=this.options.actions;if(i.region.click.zoom&&this.zoomTo(e,void 0!==i.region.click.zoomToLevel?parseInt(i.region.click.zoomToLevel):void 0),i.region.click.filterDirectory&&this.options.database.on){const t=new Ut({filters:{regions:{table_name:this.regionsRepository.getSchema().name,region_ids:[e.id]}}});this.objectsRepository.query.resetFilters(),this.setFilterOut(),this.objectsRepository.find(t).done((()=>{this.controllers.popover&&this.controllers.popover.setState(e.getData()),this.controllers.detailsView&&this.controllers.detailsView.setState(e.getData())})),this.updateFiltersState()}if(i.region.click.showDetails){const t=this.options.actions.region.click.detailsViewTemplate;this.loadDetailsView(e,t)}if(i.region.click.showPopover){const t=this.options.actions.region.click.popoverTemplate,s=i.region.click.zoom?400:0;setTimeout((()=>{this.showPopover(e,t)}),s)}else if(t&&-1!==t.type.indexOf("touch")&&i.region.touch.showPopover){const t=this.options.actions.region.click.popoverTemplate;i.region.click.zoom,setTimeout((()=>{this.showPopover(e,t)}),400)}this.selectRegion(e.id),this.events.trigger("click.region",t,{region:e})}markerClickHandler(t,e){if(this.objectClickedBeforeScroll=null,this.eventsPreventList.click)return;const i=this.options.actions;this.selectMarker(e);const s=e.object;if(i.marker.click.zoom&&this.zoomTo(e,void 0!==i.marker.click.zoomToLevel?parseInt(i.marker.click.zoomToLevel):void 0),i.marker.click.filterDirectory&&this.options.database.on){const t=new Ut({filters:{id:e.object.getData().id}});this.objectsRepository.find(t),this.updateFiltersState()}if(i.marker.click.showDetails){const t=this.options.actions.marker.click.detailsViewTemplate;this.loadDetailsView(s,t)}if(i.marker.click.showPopover){const t=this.options.actions.marker.click.popoverTemplate,e=i.marker.click.zoom&&this.googleMaps.map?700:0;setTimeout((()=>{this.showPopover(s,t)}),e)}else if(t&&-1!==t.type.indexOf("touch")&&i.marker.touch.showPopover){const t=this.options.actions.marker.click.popoverTemplate,e=i.marker.click.zoom&&this.googleMaps.map?700:0;setTimeout((()=>{this.showPopover(s,t)}),e)}this.options.actions.marker.click.addIdToUrl&&!this.options.actions.marker.click.showAnotherMap&&(window.location.hash="/m/db/"+e.object.getData().id),this.events.trigger("click.marker",t,{marker:e})}fileExists(t){if("data"==t.substr(0,4))return!0;const e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),404!=e.status}hideMarkers(){this.markers.forEach((function(t){t.hide()})),Dr(this.containers.wrap).addClass("mapsvg-edit-marker-mode")}hideMarkersExceptOne(t){this.markers.forEach((function(e){(void 0===t||e.object&&t!==String(e.id))&&e.hide()})),Dr(this.containers.wrap).addClass("mapsvg-edit-marker-mode")}showMarkers(){this.markers.forEach((function(t){t.show()})),this.deselectAllMarkers(),Dr(this.containers.wrap).removeClass("mapsvg-edit-marker-mode")}markerAddClickHandler(t){if(Dr(t.target).hasClass("mapsvg-marker"))return;const e=this.getSvgPointAtClick(t),i=this.isGeo()?this.converter.convertSVGToGeo(e):null;if(!Dr.isNumeric(e.x)||!Dr.isNumeric(e.y))return;if(this.editingMarker)return i&&this.editingMarker.location.setGeoPoint(i),void(e&&this.editingMarker.location.setSvgPoint(e));const s=new Vt({svgPoint:e,geoPoint:i,img:this.options.defaultMarkerImage}),o=new ur({location:s,mapsvg:this});this.markerAdd(o),this.markerEditHandler&&this.markerEditHandler.call(s,s)}getSvgPointAtClick(t){const e=y(t),i=e.x-Dr(this.containers.map).offset().left,s=e.y-Dr(this.containers.map).offset().top,o=new Ot(i,s);return this.converter.convertPixelToSVG(o)}setDefaultMarkerImage(t){this.options.defaultMarkerImage=t}setMarkerImagesDependency(){this.locationField=this.objectsRepository.schema.getFieldByType("location"),this.locationField&&this.locationField.markersByFieldEnabled&&this.locationField.markerField&&Object.values(this.locationField.markersByField).length>0?this.setMarkersByField=!0:this.setMarkersByField=!1}getMarkerImage(t,e){let i;return this.setMarkersByField&&("object"==typeof t?(i=t[this.locationField.markerField],"regions"===this.locationField.markerField?i=i[0]&&i[0].id:"object"==typeof i&&i.length&&(i=i[0].value)):i=t,this.locationField.markersByField[i])?this.locationField.markersByField[i]:e&&e.imagePath?e.imagePath:this.options.defaultMarkerImage?this.options.defaultMarkerImage:s.routes.root+"markers/_pin_default.png"}setMarkersEditMode(t,e){this.editMarkers.on=S.numbers.parseBoolean(t),this.clickAddsMarker=this.editMarkers.on,this.setEventHandlers()}setRegionsEditMode(t){this.editRegions.on=S.numbers.parseBoolean(t),this.deselectAllRegions(),this.setEventHandlers()}setEditMode(t){this.inBackend=t}setDataEditMode(t){this.editData.on=S.numbers.parseBoolean(t),this.deselectAllRegions(),this.setEventHandlers()}setDrawMode(t){this.drawMode=S.numbers.parseBoolean(t),this.drawMode?this.regions.forEach((t=>{t.setStyle(t.styleSvg)})):this.reloadAllRegionStyles()}download(){window.location.href=window.location.origin+this.options.source}svg(){return{download:()=>{const t=window.location.protocol+"//"+window.location.host+this.options.source,e=document.createElement("a");e.href=t;const i=t.split("/").pop()||"download";e.download=i,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)},open:()=>{window.location.href=window.location.origin+this.options.source}}}popoverAdjustScreenPosition(){this.controllers.popover instanceof fr&&this.controllers.popover.adjustScreenPosition()}popoverMoveScreenPositionBy(t,e){this.controllers.popover instanceof fr&&this.controllers.popover.moveSrceenPositionBy(t,e)}showPopover(t,e){const i="type"in t&&t.isRegion()?t:t.location&&t.location.marker?t.location.marker:null;if(!i)return;let s;s=i.isMarker()?i.svgPoint:i.getCenterSVG();const o=e?this.options.templates[e]:"type"in t&&t.isRegion()?this.options.templates.popoverRegion:this.options.templates.popoverMarker;this.controllers.popover&&this.controllers.popover.destroy(),this.controllers.popover=new fr({map:this,parent:this,container:this.layers.popovers,point:s,yShift:"type"in i&&i.isMarker()?i.height:i.isRegion()&&i.label?i.label.offsetHeight/2:0,template:o,state:t.getData(),mapObject:i,scrollable:!0,fullscreen:{sm:this.options.popovers.mobileFullscreen,md:this.options.popovers.mobileFullscreen,lg:!1},withToolbar:!(u()&&this.options.popovers.mobileFullscreen),styles:{width:this.options.popovers.width+"px",backgroundColor:this.options.colors.popover,maxWidth:this.options.popovers.maxWidth+"%",maxHeight:parseInt(this.options.popovers.maxHeight+"")*Dr(this.layers.popovers).outerHeight()/100+"px"},middleware:this.middlewares.middlewares.filter((t=>t.name===xt.RENDER)),events:{afterShow:t=>{const{controller:e}=t.data;if(this.options.popovers.centerOn){const t=e.containers.main.offsetHeight/2;!this.options.popovers.centerOn||u()&&this.options.popovers.mobileFullscreen||this.centerOn(i,t)}this.popoverShowingFor=i},afterClose:t=>{var e;t.data,this.options.popovers.resetViewboxOnClose&&this.viewBoxReset("custom"),this.popoverShowingFor=null,"type"in i&&i.isRegion()?this.deselectRegion(i):"type"in i&&i.isMarker()&&this.deselectAllMarkers(),this.controllers&&this.controllers.directory&&(null===(e=this.controllers.directory)||void 0===e||e.deselectItems()),Dr("body").off(`mouseup.popover.mapsvg-${this.id} touchend.popover.mapsvg-${this.id}`)},resize:t=>{const{controller:e}=t.data;if(this.options.popovers.centerOn){const t=e.containers.main.offsetHeight/2;!this.options.popovers.centerOn||u()&&this.options.popovers.mobileFullscreen||this.centerOn(i,t)}}}}),this.controllers.popover.init(),this.controllers.popover.open(),setTimeout((()=>{Dr("body").on(`mouseup.popover.mapsvg-${this.id} touchend.popover.mapsvg-${this.id}`,(t=>{this.isScrolling||Dr(t.target).closest(".mapsvg-directory").length||Dr(t.target).closest(".mapsvg-popover").length||Dr(t.target).hasClass("mapsvg-btn-map")||this.controllers.popover.close()}))}),50)}hidePopover(){this.controllers.popover&&this.controllers.popover.close()}popoverOffHandler(t){this.isScrolling||Dr(t.target).closest(".mapsvg-popover").length||Dr(t.target).hasClass("mapsvg-btn-map")}mouseOverHandler(t,e){var i;if(this.eventsPreventList.mouseover)return;if(e.isMarker()&&this.options.actions.marker.mouseover.showTooltip){const t=this.options.actions.marker.mouseover.tooltipTemplate;this.showTooltip(e,t)}if(e.isRegion()&&this.options.actions.region.mouseover.showTooltip){const t=this.options.actions.region.mouseover.tooltipTemplate;this.showTooltip(e,t)}let s;this.options.menu.on&&this.controllers.directory&&("database"==this.options.menu.source?(e.isRegion()&&e.objects.length&&(s=e.objects.map((t=>t.getData().id))),e.isMarker()&&(s=e.object?[e.object.getData().id]:[])):(e.isRegion()&&(s=[e.id]),e.isMarker()&&e.object.getData().regions&&e.object.getData().regions.length&&(s=e.object.getData().regions.map((t=>t.id)))),null===(i=this.controllers.directory)||void 0===i||i.highlightItems(s)),e.isRegion()?(e.selected||e.highlight(),this.events.trigger("mouseover.region",t,{region:e})):(this.highlightMarker(e),this.events.trigger("mouseover.marker",t,{marker:e}))}showTooltip(t,e){let s,o;if(t.isRegion()?(s="region",o=t):t.isMarker()?(s="marker",o=t.object):(s="cluster",o=t),null!=o&&this.popoverShowingFor!==t){const n=`tooltip${i(s)}`;this.controllers.tooltips[n]&&this.controllers.tooltips[n].destroy();const r=e?this.options.templates[e]:this.options.templates[n],a=new xr({map:this,parent:this,middleware:this.middlewares.middlewares.filter((t=>t.name===xt.RENDER)),state:o.getData(),template:r,container:this.containers.map,styles:{backgroundColor:this.options.colors.tooltip,minWidth:this.options.tooltips.minWidth?this.options.tooltips.minWidth+"px":"auto",maxWidth:this.options.tooltips.maxWidth?this.options.tooltips.maxWidth+"px":"auto"},positionToCursor:this.options.tooltips.position});t.tooltip=a,a.init(),this.controllers.tooltips[n]=a}}mouseOutHandler(t,e){var i;if(!this.eventsPreventList.mouseout&&(e.tooltip&&(e.tooltip.destroy(),e.tooltip=null),e.isRegion()?(e.unhighlight(),this.events.trigger("mouseout.region",t,{region:e})):(this.unhighlightMarker(),this.events.trigger("mouseout.marker",t,{marker:e})),this.options.menu.on&&this.controllers.directory)){if("database"==this.options.menu.source&&e.isMarker()){const t=e;!t.object||t.object.getData().id}null===(i=this.controllers.directory)||void 0===i||i.unhighlightItems()}}eventsPrevent(t){this.eventsPreventList[t]=!0}eventsRestore(t){t?this.eventsPreventList[t]=!1:this.eventsPreventList={}}linkObjectToRegions(t){var e;if(0===this.regions.length)return;const i=undefined,s=t.getRegionsForTable(null===(e=this.regionsRepository.schema)||void 0===e?void 0:e.name).map((t=>t.id));s.length>0&&this.regions.filter((t=>s.includes(t.id))).forEach((e=>{e.objects.get(t.getData().id)||e.objects.push(t)}))}addObject(t){this.addLocation(t)}objectsLoadedToMapHandler(){var t,e;this.mayBeFitMarkers(),this.fixMarkersWorldScreen(),this.loadDirectory(),this.options.labelsMarkers.on&&this.setLabelsMarkers(),-1!==this.options.templates.labelRegion.indexOf("{{objects")&&this.setLabelsRegions(),this.options.filters.on&&"database"===this.options.filters.source&&this.controllers.filters&&this.controllers.filters.hideFilters&&this.controllers.filters.setFiltersCounter(),this.hideLoadingMessage(),this.updateFiltersState(),(null===(t=this.options.choropleth)||void 0===t?void 0:t.on)&&this.setChoropleth();const i=null===(e=this.options.regionsDynamicStatus)||void 0===e?void 0:e.noObjects;void 0!==i&&this.regions.filter((t=>0===t.objects.length)).forEach((t=>{t.setStatus(i)})),this.events.trigger("afterLoadObjects",{objects:this.objectsRepository.getLoaded()})}setRepositoryEvents(){var t;this.eventsBaseInitialized=!0,this.objectsRepository.events.on(Yt.BEFORE_LOAD,(()=>{this.showLoadingMessage(),void 0===this.firstDataLoad?this.firstDataLoad=!0:!0===this.firstDataLoad&&(this.firstDataLoad=!1)})),this.objectsRepository.events.on(Yt.FAILED_LOAD,(()=>{this.hideLoadingMessage(),console.error("Could not load objects")})),this.objectsRepository.events.on(Yt.AFTER_LOAD,(t=>{const{repository:e}=t.data;this.fitOnDataLoadDone=!1,this.setGlobalDistanceFilter(),this.deleteMarkers(),this.deleteClusters(),this.regions.forEach((t=>{t.objects.clear()})),e.objects.forEach((t=>{t.getData().regions&&t.getData().regions.length>0&&this.linkObjectToRegions(t)})),e.objects.filter((t=>t.getData().location)).forEach((t=>this.addObject(t))),this.options.clustering.on&&this.startClusterizer(),this.reloadRegionsFull(),this.objectsLoadedToMapHandler()})),null===(t=this.objectsRepository.schema)||void 0===t||t.events.on(At.UPDATE,(()=>{this.objectsRepository.find()})),this.objectsRepository.events.on(Yt.AFTER_UPDATE,(t=>{const{object:e,updatedFields:i}=t.data;i.regions&&this.linkObjectToRegions(e),this.objectsLoadedToMapHandler()})),this.objectsRepository.events.on(Yt.AFTER_CREATE,(t=>{const{object:e}=t.data;this.linkObjectToRegions(e),this.objectsLoadedToMapHandler()})),this.objectsRepository.events.on(Yt.AFTER_DELETE,(t=>{const{id:e}=t.data;this.regions.forEach((t=>{const i=t.objects.findIndex((t=>t.getData().id===e));-1!==i&&t.objects.delete(i)})),this.objectsLoadedToMapHandler()})),this.regionsRepository.events.on(Yt.BEFORE_LOAD,(()=>{this.showLoadingMessage()})),this.regionsRepository.events.on(Yt.FAILED_LOAD,(()=>{this.hideLoadingMessage(),console.error("Could not load regions")})),this.regionsRepository.events.on(Yt.AFTER_LOAD,(()=>{this.hideLoadingMessage(),this.reloadRegionsFull(),this.events.trigger("afterLoadRegions",{regions:this.regions})})),this.regionsRepository.events.on(Yt.AFTER_UPDATE,(()=>{this.reloadRegionsFull()})),this.regionsRepository.events.on(Yt.AFTER_CREATE,(()=>{this.reloadRegionsFull()})),this.regionsRepository.events.on(Yt.AFTER_DELETE,(()=>{this.reloadRegionsFull()}))}setEventHandlers(){const t=this;Dr(t.containers.map).off(".common.mapsvg"),Dr(t.containers.scrollpane).off(".common.mapsvg"),Dr(document).off(".scroll.mapsvg"),Dr(document).off(".scrollInit.mapsvg"),t.editMarkers.on&&Dr(t.containers.map).on("touchstart.common.mapsvg mousedown.common.mapsvg",".mapsvg-marker",(e=>{e.originalEvent.preventDefault();const i=Dr(e.target).attr("id"),s=this.markers.get(i),o=y(e);s.drag(o,t.scale)})),t.editMarkers.on||Dr(t.containers.map).on("mouseover.common.mapsvg",".mapsvg-region",(function(e){const i=Dr(this).attr("id");t.mouseOverHandler.call(t,e,t.getRegion(i))})).on("mouseleave.common.mapsvg",".mapsvg-region",(function(e){const i=Dr(this).attr("id");t.mouseOutHandler.call(t,e,t.getRegion(i))})),this.editRegions.on||Dr(this.containers.map).on("mouseover.common.mapsvg",".mapsvg-marker",(t=>{const e=t.target.id;this.mouseOverHandler.call(this,t,this.markers.get(e))})).on("mouseleave.common.mapsvg",".mapsvg-marker",(t=>{const e=t.target.id;this.mouseOutHandler.call(this,t,this.markers.get(e))})),t.options.scroll.spacebar?Dr(document).on("keydown.scroll.mapsvg",(function(e){"INPUT"===document.activeElement.tagName&&"text"===Dr(document.activeElement).attr("type")||t.isScrolling||32!=e.keyCode||(e.preventDefault(),Dr(t.containers.map).addClass("mapsvg-scrollable"),Dr(document).on("mousemove.scrollInit.mapsvg",(function(e){t.isScrolling=!0,Dr(document).off("mousemove.scrollInit.mapsvg"),t.scrollStart(e,t)})).on("keyup.scroll.mapsvg",(function(e){32==e.keyCode&&(Dr(document).off("mousemove.scrollInit.mapsvg"),Dr(t.containers.map).removeClass("mapsvg-scrollable"))})))})):t.options.scroll.on?(Dr(t.containers.map).on("click.common.mapsvg touchstart.common.mapsvg","svg a",(function(t){t.preventDefault()})),Dr(t.containers.map).on("touchstart.common.mapsvg mousedown.common.mapsvg",(function(e){if(Dr(e.target).hasClass("mapsvg-popover")||Dr(e.target).closest(".mapsvg-popover").length||Dr(e.target).hasClass("mapsvg-details-container")||Dr(e.target).closest(".mapsvg-details-container").length||Dr(e.target).closest(".mapsvg-popover-container").length)return void(Dr(e.target).hasClass("mapsvg-popover-close")&&"touchstart"==e.type&&e.cancelable&&e.preventDefault());let i;if("touchstart"==e.type&&e.cancelable&&e.preventDefault(),e.target&&Dr(e.target).attr("class")&&-1!=Dr(e.target).attr("class").indexOf("mapsvg-region"))i=t.getRegion(Dr(e.target).attr("id")),t.setObjectClickedBeforeScroll(i);else if(e.target&&Dr(e.target).attr("class")&&-1!=Dr(e.target).attr("class").indexOf("mapsvg-marker")&&-1===Dr(e.target).attr("class").indexOf("mapsvg-marker-cluster")){if(t.editMarkers.on)return;const s=Dr(e.target).closest(".mapsvg-marker").attr("id")||e.target.id;i=t.markers.get(s),t.setObjectClickedBeforeScroll(i)}else if(e.target&&Dr(e.target).attr("class")&&-1!=Dr(e.target).attr("class").indexOf("mapsvg-marker-cluster")){if(t.editMarkers.on)return;i=Dr(e.target).data("cluster"),t.setObjectClickedBeforeScroll(i)}"mousedown"==e.type?t.scrollStart(e,t):t.touchStart(e,t)}))):t.editMarkers.on?t.clickAddsMarker&&Dr(t.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",(function(e){e.cancelable&&e.preventDefault(),t.markerAddClickHandler(e)})):(Dr(t.containers.map).on("touchstart.common.mapsvg",".mapsvg-region",(function(e){t.scroll.touchScrollStart=Dr(window).scrollTop()})),Dr(t.containers.map).on("touchstart.common.mapsvg",".mapsvg-marker",(function(e){t.scroll.touchScrollStart=Dr(window).scrollTop()})),Dr(t.containers.map).on("touchstart.common.mapsvg mousedown.common.mapsvg","svg a",(function(e){return t.isLinkClicked(e),!0})),Dr(t.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",".mapsvg-region",(function(e){e.cancelable&&e.preventDefault(),t.scroll.touchScrollStart&&t.scroll.touchScrollStart!==Dr(window).scrollTop()||t.regionClickHandler(e,t.getRegion(Dr(this).attr("id")))})),Dr(this.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",".mapsvg-marker",(t=>{if(t.cancelable&&t.preventDefault(),!this.scroll.touchScrollStart||this.scroll.touchScrollStart===Dr(window).scrollTop()){const e=t.target.id;this.markerClickHandler.call(this,t,this.markers.get(e))}})),Dr(t.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",".mapsvg-marker-cluster",(function(e){if(e.cancelable&&e.preventDefault(),!t.scroll.touchScrollStart||t.scroll.touchScrollStart==Dr(window).scrollTop()){const e=Dr(this).data("cluster");t.zoomTo(e.markers)}}))),Dr(t.containers.map).on("mouseleave.common.mapsvg",".mapsvg-choropleth-gradient-wrap",(t=>{this.controllers.tooltips.region.close()}))}setLabelsRegions(t){null!=(t=t||this.options.labelsRegions).on&&(t.on=S.numbers.parseBoolean(t.on)),r(this.options,{labelsRegions:t}),this.options.labelsRegions.on?(this.regions.forEach((t=>{t.label||(t.label=document.createElement("div"),t.label.className="mapsvg-region-label",t.label.setAttribute("data-region-id",t.id),Dr(this.layers.labels).append(t.label));try{Dr(t.label).html(this.templates.labelRegion(t.forTemplate()))}catch(t){console.error('MapSVG: Error in the "Region Label" template')}})),this.labelsRegionsAdjustScreenPosition()):this.regions.forEach((t=>{t.label&&(Dr(t.label).remove(),t.label=null,delete t.label)}))}setLabelsMarkers(t){null!=(t=t||this.options.labelsMarkers).on&&(t.on=S.numbers.parseBoolean(t.on)),r(this.options,{labelsMarkers:t}),this.options.labelsMarkers.on?this.markers.forEach((t=>{try{t.setLabel(this.templates.labelMarker(t.object.getData()))}catch(t){console.error('MapSVG: Error in the "Marker Label" template')}})):this.markers.forEach((t=>{t.setLabel("")}))}addLayer(t){return this.layers[t]=Dr('<div class="mapsvg-layer mapsvg-layer-'+t+'"></div>')[0],this.containers.layers.appendChild(this.layers[t]),this.layers[t]}getLayer(t){return this.layers[t]}getDb(){return this.objectsRepository}getDbRegions(){return this.regionsRepository}regionAdd(t){const e=new br({element:t,mapsvg:this,options:this.options.regions[t.id],statusOptions:this.options.regionStatuses});return this.reloadRegionStyles(e),e.events.on(rr.UPDATE,(t=>{const{region:e,data:i}=t.data,s=undefined;["choroplethValue"].some((t=>t in i))&&this.reloadRegionStyles(e)})),this.regions.push(e),this.regions.sort((function(t,e){return t.id==e.id?0:+(t.id>e.id)||-1})),e}regionDelete(t){this.regions.findById(t)?(this.regions.findById(t).elem.remove(),this.regions.delete(t)):Dr("#"+t).length&&Dr("#"+t).remove()}reloadRegions(){this.regions.clear(),Dr(this.containers.svg).find(".mapsvg-region").removeClass("mapsvg-region"),Dr(this.containers.svg).find(".mapsvg-region-disabled").removeClass("mapsvg-region-disabled"),Dr(this.containers.svg).find("path, polygon, circle, ellipse, rect").each(((t,e)=>{const i=e;Dr(i).closest("defs").length||(i.getAttribute("data-stroke-width")&&(i.style["stroke-width"]=i.getAttribute("data-stroke-width")),i.getAttribute("id")&&(!this.options.regionPrefix||this.options.regionPrefix&&0===i.getAttribute("id").indexOf(this.options.regionPrefix))&&this.regionAdd(i))}))}reloadRegionsFull(){this.reloadAllRegionStyles();const t=this.regionsRepository.getSchema().getFieldByType("status");this.regions.forEach((e=>{var i;const s=this.regionsRepository.getLoaded().findById(e.id);if(s){const i=null==s?void 0:s.getData();e.setData(s),t&&void 0!==i.status&&null!==i.status&&e.setStatus(i.status)}else{const t=null===(i=this.options.regionsDynamicStatus)||void 0===i?void 0:i.filtered;if(t||0===t||"regions"===this.options.menu.source&&this.options.menu.filterout&&"status"===this.options.menu.filterout.field&&this.options.menu.filterout.val||0===this.options.menu.filterout.val){const i=t||0===t?t:this.options.menu.filterout.val;e.setStatus(i)}}})),this.loadDirectory(),this.setChoropleth(),this.setLayersControl(),this.setGroups(),this.options.labelsRegions.on&&this.setLabelsRegions(),this.options.filters.on&&"regions"===this.options.filters.source&&this.controllers.filters&&this.controllers.filters.hideFilters&&this.controllers.filters.setFiltersCounter(),this.updateFiltersState()}fixMarkersWorldScreen(){this.googleMaps.map&&setTimeout((()=>{const t={left:0,right:0,leftOut:0,rightOut:0};if(this.markers.length>1&&(this.markers.forEach((e=>{Dr(e.element).offset().left<Dr(this.containers.map).offset().left+this.containers.map.clientWidth/2?(t.left++,Dr(e.element).offset().left<Dr(this.containers.map).offset().left&&t.leftOut++):(t.right++,Dr(e.element).offset().left>Dr(this.containers.map).offset().left+this.containers.map.clientWidth&&t.rightOut++)})),0===t.left&&t.rightOut||0===t.right&&t.leftOut)){const e=0===t.left?1:-1,i=this.svgDefault.viewBox.width/this.converter.mapLonDelta*360*this.getScale();this.googleMaps.map.panBy(e*i,0)}}),600)}updateOutdatedOptions(t){return c(this,arguments,void 0,(function*({version:t,options:e}){if(this.version&&B(this.version,s.version)<0){const t=yield import("./migrate-DhYo4EW-.js"),{options:i,success:o}=t.migrate(this.version,e);if(o)return{version:s.version,options:i};throw Error("Could not update options")}return{version:t,options:e}}))}getContainer(t){return this.containers[t]}renderSvgData(t){const e=Dr(t).find("svg");if(this.containers.svg=e[0],e.attr("width")&&e.attr("height"))this.svgDefault.width=parseFloat(e.attr("width").replace(/px/g,"")),this.svgDefault.height=parseFloat(e.attr("height").replace(/px/g,"")),this.svgDefault.viewBox=e.attr("viewBox")?new lr(e.attr("viewBox").split(" ")):new lr(0,0,this.svgDefault.width,this.svgDefault.height);else{if(!e.attr("viewBox")){const t="MapSVG couldn't load SVG file. Please check if the file exists: "+this.options.source+". If the file exists, please contact support (this message is showing up only in wp-admin area).";return this.inBackend?Dr.growl.error({message:t,duration:6e4}):console.error("MapSVG couldn't load SVG file"),!1}this.svgDefault.viewBox=new lr(e.attr("viewBox").split(" ")),this.svgDefault.width=this.svgDefault.viewBox.width,this.svgDefault.height=this.svgDefault.viewBox.height}this.viewBox.update(this.svgDefault.viewBox),this.geoViewBox=this.getGeoViewBoxFromSvgTag(this.containers.svg),e.attr("preserveAspectRatio","xMidYMid meet"),e.removeAttr("width"),e.removeAttr("height"),Dr(this.containers.scrollpane).append(e),this.containers.svg.style.width="auto",Dr(this.containers.svg).find("path, polygon, circle, ellipse, rect, line, polyline").each(((t,e)=>{const i=cr.getComputedStyle("stroke-width",e);i&&Dr(e).attr("data-stroke-width",i.replace("px",""))}))}setFilterOut(){if(this.objectsRepository)if(this.options.menu.filterout.field){const t={};t[this.options.menu.filterout.field]=this.options.menu.filterout.val,"regions"==this.options.menu.source||this.objectsRepository.query.setFilterOut(t)}else this.objectsRepository.query.setFilterOut(null)}getGeoViewBoxFromSvgTag(t){const e=Dr(t).attr("mapsvg:geoViewBox")||Dr(t).attr("mapsvg:geoviewbox");if(!e)return null;{const t=e.split(" ").map((t=>parseFloat(t)));if(4==t.length){this.mapIsGeo=!0,this.geoCoordinates=!0;const e=new zt(t[3],t[0]),i=new zt(t[1],t[2]);return new hr(e,i)}}}svgLoadingFailed(t){if(404==t.status){let t="MapSVG: file not found - "+this.options.source+"\n\nIf you moved MapSVG from another server please read the following docs page: https://mapsvg.com/docs/installation/moving";if(this.inBackend){t+="\n\nIf you know the correct path for the SVG file, please write it and press OK:";const e=this.options.source,i=prompt(t,e);null!==i?Dr.ajax({url:i+"?v="+this.svgFileLastChanged}).fail((function(){location.reload()})).done((t=>{this.options.source=i,this.renderSvgData(t);const e=undefined;se("maps",this).update(this)})):location.reload()}else console.error(t)}else{const t="MapSVG: can't load SVG file for unknown reason. Please contact support.";this.inBackend?alert(t):console.error(t)}}addLoadingMessage(){this.containers.loading=document.createElement("div"),this.containers.loading.className="mapsvg-loading";const t=document.createElement("div");t.className="mapsvg-loading-text",t.innerHTML=this.options.loadingText;const e=document.createElement("div");e.className="spinner-border spinner-border-sm",this.containers.loading.appendChild(e),this.containers.loading.appendChild(t),this.container.appendChild(this.containers.loading)}hideLoadingMessage(){Dr(this.containers.loading).hide()}showLoadingMessage(){Dr(this.containers.loading).show()}disableAnimation(){this.containers.map.classList.add("no-transitions")}enableAnimation(){this.containers.map.classList.remove("no-transitions")}loadExtensions(){if(this.options.extension&&Dr().mapSvg.extensions&&Dr().mapSvg.extensions[_this.options.extension]){const t=Dr().mapSvg.extensions[_this.options.extension];t&&t.common(this)}}decrementAfterloadBlockers(){this.afterLoadBlockers>0&&(this.afterLoadBlockers--,0===this.afterLoadBlockers&&this.finalizeMapLoading())}finalizeMapLoading(){this.afterLoadBlockers>0||this.loaded||(this.selectObjectsByIdFromUrl(),this.redraw(),setTimeout((()=>{if(u()&&this.options.menu.on&&this.options.menu.hideOnMobile)switch(this.options.menu.showFirst){case"map":this.controllers.toolbar.show("map");break;case"directory":this.controllers.toolbar.show("menu")}setTimeout((()=>{this.hideLoadingMessage(),Dr(this.containers.loading).find(".mapsvg-loading-text").hide()}),400)}),100),this.loaded=!0,this.events.trigger(Mr.AFTER_INIT,{mapsvg:this}))}selectObjectsByIdFromUrl(){const t=RegExp("[?&]mapsvg_select=([^&]*)").exec(window.location.search);if(t){const e=decodeURIComponent(t[1].replace(/\+/g," "));this.selectRegion(e)}if(window.location.hash&&-1!==window.location.hash.indexOf("#/m/")){let t=window.location.hash.replace("#/m/","");if(this.options.actions.map.afterLoad.selectRegion&&(0===t.indexOf("r/")||-1===t.indexOf("r/")&&-1===t.indexOf("db/"))){0===t.indexOf("r/")&&(t=t.replace("r/",""));const e=this.getRegion(t);e&&this.regionClickHandler(null,e)}else if(this.options.actions.map.afterLoad.selectMarker&&0===t.indexOf("db/")){t=t.replace("db/","");const e=t=>{const e=this.markers.get(`marker_${t.getData().id}`);e&&this.markerClickHandler.call(this,null,e)},i=this.objectsRepository.getLoaded().find((e=>e.getData().id===t));i?e(i):this.objectsRepository.findById(t,!1).done((t=>{this.addObject(t),this.objectsLoadedToMapHandler(),e(t)}))}}}getConverter(){return this.converter}setChoropleth(t){const e=this;null!=(t=t||e.options.choropleth).on&&(t.on=S.numbers.parseBoolean(t.on)),r(e.options,{choropleth:t});let i=!1;if(!e.$gauge){e.$gauge={},e.$gauge.gradient=Dr("<td>&nbsp;</td>").addClass("mapsvg-gauge-gradient"),e.setGaugeGradientCSS(),e.$gauge.container=Dr("<div />").addClass("mapsvg-gauge").hide(),e.$gauge.table=Dr("<table />");const t=Dr("<tr />");e.$gauge.labelLow=Dr("<td>"+e.options.choropleth.labels.low+"</td>"),e.$gauge.labelHigh=Dr("<td>"+e.options.choropleth.labels.high+"</td>"),t.append(e.$gauge.labelLow),t.append(e.$gauge.gradient),t.append(e.$gauge.labelHigh),e.$gauge.table.append(t),e.$gauge.container.append(e.$gauge.table),e.$gauge.container.append(e.$gauge.table),Dr(e.containers.map).append(e.$gauge.container)}!e.options.choropleth.on&&e.$gauge.container.is(":visible")?(e.$gauge.container.hide(),i=!0):e.options.choropleth.on&&!e.$gauge.container.is(":visible")&&(e.$gauge.container.show(),i=!0,this.regionsRepository.events.on(Yt.AFTER_UPDATE,this.redrawGauge),this.regionsRepository.events.on(Yt.AFTER_LOAD,this.redrawGauge)),this.options.choropleth.on||(this.regionsRepository.events.off(Yt.AFTER_UPDATE,this.redrawGauge),this.regionsRepository.events.off(Yt.AFTER_LOAD,this.redrawGauge)),t.colors&&(e.options.choropleth.colors.lowRGB=j(e.options.choropleth.colors.low).toRgb(),e.options.choropleth.colors.highRGB=j(e.options.choropleth.colors.high).toRgb(),e.options.choropleth.colors.diffRGB={r:e.options.choropleth.colors.highRGB.r-e.options.choropleth.colors.lowRGB.r,g:e.options.choropleth.colors.highRGB.g-e.options.choropleth.colors.lowRGB.g,b:e.options.choropleth.colors.highRGB.b-e.options.choropleth.colors.lowRGB.b,a:e.options.choropleth.colors.highRGB.a-e.options.choropleth.colors.lowRGB.a},i=!0,e.$gauge&&e.setGaugeGradientCSS()),t.labels&&(e.$gauge.labelLow.html(e.options.choropleth.labels.low),e.$gauge.labelHigh.html(e.options.choropleth.labels.high)),i&&e.redrawGauge()}updateGaugeMinMax(){const t=this;t.options.choropleth.min=0,t.options.choropleth.max=!1;const e=[];t.regions.forEach((function(i){const s=i.data&&i.data[t.options.regionChoroplethField];null!=s&&e.push(s)})),e.length>0&&(t.options.choropleth.min=1==e.length?0:Math.min.apply(null,e),t.options.choropleth.max=Math.max.apply(null,e),t.options.choropleth.maxAdjusted=t.options.choropleth.max-t.options.choropleth.min)}setGaugeGradientCSS(){const t=this;t.$gauge.gradient.css({background:"linear-gradient(to right,"+t.options.choropleth.colors.low+" 1%,"+t.options.choropleth.colors.high+" 100%)",filter:'progid:DXImageTransform.Microsoft.gradient( startColorstr="'+t.options.choropleth.colors.low+'", endColorstr="'+t.options.choropleth.colors.high+'",GradientType=1 )'})}setRegionsDynamicStatus(t){r(this.options.regionsDynamicStatus,t),this.regionsRepository.getLoaded().length>0&&(this.reloadRegionsFull(),this.objectsLoadedToMapHandler())}setSvgFileLastChanged(t){this.svgFileLastChanged=t}get $map(){return Dr(this.getContainer("map"))}get $svg(){return Dr(this.getContainer("svg"))}get $popover(){return Dr(this.getContainer("popover"))}get $details(){return Dr(this.getContainer("detailsView"))}get $directory(){return Dr(this.getContainer("directory"))}get database(){return this.objectsRepository}get regionsDatabase(){return this.regionsRepository}}class Ar extends Zt{constructor(){super("map","maps"),this.path="maps-v2/"}encodeData(t){const e={};return e.options=JSON.stringify(t.options),e.options=e.options.replace(/select/g,"!mapsvg-encoded-slct"),e.options=e.options.replace(/table/g,"!mapsvg-encoded-tbl"),e.options=e.options.replace(/database/g,"!mapsvg-encoded-db"),e.options=e.options.replace(/varchar/g,"!mapsvg-encoded-vc"),e.id=t.id,e.title=t.title,e}defaultResponseMiddleware(t){let e;return e="string"==typeof t?JSON.parse(t):t,e}}class jr extends D{constructor(){super(),this.arrayIndexed=Tt,this.customObject=Gt,this.formBuilder=ir,this.geoPoint=zt,this.location=Vt,this.mapsRepository=Jt,this.mapsV2Repository=Ar,this.marker=ur,this.region=br,this.query=Ut,this.repository=Zt,this.schema=Pt,this.schemaRepository=Kt,this.screenPoint=Ot,this.server=Xt,this.svgPoint=SVGPoint,this.map=Rr,this.utils=S,this.instances=s.instances,this.nonce=s.nonce,this.mediaUploader=s.mediaUploader,this.templatesLoaded=s.templatesLoaded,this.routes=s.routes,this.mouse=s.mouse,this.useRepository=se}}const Lr=()=>{window.mapsvg=new jr,window.MapSVG=Object.assign(Object.create(Object.getPrototypeOf(window.mapsvg)),window.mapsvg),Object.assign(window.MapSVG,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({mouseCoords:S.env.getMouseCoords,isPhone:S.env.isPhone},s),S.env),S.files),S.funcs),S.http),S.numbers),S.strings)),window.mapsvg.initialized=!0,window.dispatchEvent(new Event("mapsvgClientInitialized"))};export{jr as MapsvgClient,Lr as initGlobals};
//# sourceMappingURL=InitGlobals-C_qV3Lbq.js.map
